<MIVA STANDARDOUTPUTLEVEL = "">

<MvCOMMENT>
|
| Miva Merchant
|
| This file and the source codes contained herein are the property of
| Miva, Inc.  Use of this file is restricted to the specific terms and
| conditions in the License Agreement associated with this file.  Distribution
| of this file or portions of this file for uses not covered by the License
| Agreement is not allowed without a written agreement signed by an officer of
| Miva, Inc.
|
| Copyright 1998-2025 Miva, Inc.  All rights reserved.
| http://www.miva.com
|
| Prefix         : MER-TUI-DTB-
| Next Error Code: 976  
|
</MvCOMMENT>

<MvFUNCTION NAME = "TUI_CreateDataFiles" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT [ g.Module_Library_DB ].DomainPrivilege_Insert( 'PAGE', 'Pages' ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "TUI_Store_Create" PARAMETERS = "store var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT [ g.Module_Library_DB ].StoreKey_Insert( 'Pages', 1 )											OR
					NOT [ g.Module_Library_DB ].StoreKey_Insert( 'PageVersions', 1 )									OR
					NOT [ g.Module_Library_DB ].StoreKey_Insert( 'PageReferences', 1 )									OR
					NOT [ g.Module_Library_DB ].StoreKey_Insert( 'Items', 1 )											OR
					NOT [ g.Module_Library_DB ].StoreKey_Insert( 'ItemVersions', 1 )									OR
					NOT [ g.Module_Library_DB ].StoreKey_Insert( 'ItemExtensionDisplayOrder', 1 )						OR
					NOT [ g.Module_Library_DB ].StoreKey_Insert( 'Branches', 2 )										OR
					NOT [ g.Module_Library_DB ].StoreKey_Insert( 'Changesets', 1 )										OR
					NOT [ g.Module_Library_DB ].StoreKey_Insert( 'ManagedTemplates', 1 )								OR
					NOT [ g.Module_Library_DB ].StoreKey_Insert( 'ManagedTemplateVersions', 1 )							OR
					NOT [ g.Module_Library_DB ].StoreKey_Insert( 'CSSResources', 1 )									OR
					NOT [ g.Module_Library_DB ].StoreKey_Insert( 'CSSResourceVersions', 1 )								OR
					NOT [ g.Module_Library_DB ].StoreKey_Insert( 'CSSResourceReferences', 1 )							OR
					NOT [ g.Module_Library_DB ].StoreKey_Insert( 'CSSResourceXGroupDisplayOrder', 1 )					OR
					NOT [ g.Module_Library_DB ].StoreKey_Insert( 'CSSCombinedResourceXResourceDisplayOrder', 1 )		OR
					NOT [ g.Module_Library_DB ].StoreKey_Insert( 'JavaScriptResources', 1 )								OR
					NOT [ g.Module_Library_DB ].StoreKey_Insert( 'JavaScriptResourceVersions', 1 )						OR
					NOT [ g.Module_Library_DB ].StoreKey_Insert( 'JavaScriptResourceReferences', 1 )					OR
					NOT [ g.Module_Library_DB ].StoreKey_Insert( 'JavaScriptResourceXGroupDisplayOrder', 1 )			OR
					NOT [ g.Module_Library_DB ].StoreKey_Insert( 'JavaScriptCombinedResourceXResourceDisplayOrder', 1 )	OR
					NOT [ g.Module_Library_DB ].StoreKey_Insert( 'ResourceGroups', 1 )									OR
					NOT [ g.Module_Library_DB ].StoreKey_Insert( 'ManagedProperties', 1 )								OR
					NOT [ g.Module_Library_DB ].StoreKey_Insert( 'ManagedPropertyVersions', 1 )							OR
					NOT [ g.Module_Library_DB ].StoreKey_Insert( 'CopyPageRules', 1 )									OR
					NOT [ g.Module_Library_DB ].StoreKey_Insert( 'ManagedContent', 1 ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_Pages
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $  g.Store_Table_Prefix $ 'Pages
						  (
							id			' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ ',
							templ_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00001', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'Pages_1 ON ' $ g.Store_Table_Prefix $ 'Pages ( id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00002', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'Pages_2 ON ' $ g.Store_Table_Prefix $ 'Pages ( templ_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00616', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_PageVersions
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $  g.Store_Table_Prefix $ 'PageVersions
						  (
							id			' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							page_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							xref_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							user_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							admin		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()		$ ',
							layout		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()		$ ',
							fragment	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()		$ ',
							secure		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()		$ ',
							public		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()		$ ',
							code		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 50 )	$ ',
							name		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 100 )	$ ',
							title		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 254 )	$ ',
							ui_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							cache		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 20 )	$ ',
							cacheset	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_MEMO()		$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00751', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'PageVersions_1 ON ' $ g.Store_Table_Prefix $ 'PageVersions ( id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00781', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'PageVersions_2 ON ' $ g.Store_Table_Prefix $ 'PageVersions ( page_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00782', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'PageVersions_3 ON ' $ g.Store_Table_Prefix $ 'PageVersions ( xref_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00783', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_PageBranchVersions
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $  g.Store_Table_Prefix $ 'PageBranchVersions
						  (
							branch_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							page_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							version_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							code		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 50 )	$ ',
							head		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()		$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00784', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'PageBranchVersions_1 ON ' $ g.Store_Table_Prefix $ 'PageBranchVersions ( branch_id, page_id, version_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00785', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'PageBranchVersions_2 ON ' $ g.Store_Table_Prefix $ 'PageBranchVersions ( branch_id, page_id, head )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00786', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'PageBranchVersions_3 ON ' $ g.Store_Table_Prefix $ 'PageBranchVersions ( page_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00787', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'PageBranchVersions_4 ON ' $ g.Store_Table_Prefix $ 'PageBranchVersions ( branch_id, head, code )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00788', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_PageChanges
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'PageChanges
						  (
							branch_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							set_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							page_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							old_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							new_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							xref_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00735', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'PageChanges_1 ON ' $ g.Store_Table_Prefix $ 'PageChanges ( set_id, page_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00736', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'PageChanges_2 ON ' $ g.Store_Table_Prefix $ 'PageChanges ( page_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00737', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'PageChanges_3 ON ' $ g.Store_Table_Prefix $ 'PageChanges ( branch_id, page_id, set_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00738', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_Items
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'Items
						  (
							id ' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00004', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'Items_1 ON ' $ g.Store_Table_Prefix $ 'Items ( id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00005', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_ItemVersions
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'ItemVersions
						  (
							id			' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							item_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							user_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							code		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 50 )	$ ',
							mod_code	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 50 )	$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00857', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'ItemVersions_1 ON ' $ g.Store_Table_Prefix $ 'ItemVersions ( id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00858', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'ItemVersions_2 ON ' $ g.Store_Table_Prefix $ 'ItemVersions ( code )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00859', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_ItemBranchVersions
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'ItemBranchVersions
						  (
							branch_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							item_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							version_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							code		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 50 )	$ ',
							head		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()		$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00860', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'ItemBranchVersions_1 ON ' $ g.Store_Table_Prefix $ 'ItemBranchVersions ( branch_id, item_id, version_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00861', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'ItemBranchVersions_2 ON ' $ g.Store_Table_Prefix $ 'ItemBranchVersions ( branch_id, item_id, head )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00862', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'ItemBranchVersions_3 ON ' $ g.Store_Table_Prefix $ 'ItemBranchVersions ( item_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00863', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'ItemBranchVersions_4 ON ' $ g.Store_Table_Prefix $ 'ItemBranchVersions ( branch_id, head, code )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00864', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_ItemChanges
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'ItemChanges
						  (
							branch_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							set_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							item_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							old_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							new_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00865', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'ItemChanges_1 ON ' $ g.Store_Table_Prefix $ 'ItemChanges ( set_id, item_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00866', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'ItemChanges_2 ON ' $ g.Store_Table_Prefix $ 'ItemChanges ( item_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00867', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'ItemChanges_3 ON ' $ g.Store_Table_Prefix $ 'ItemChanges ( branch_id, item_id, set_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00868', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_ItemExtensions
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'ItemExtensions
						  (
							item_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							version_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							mod_code	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 50 )	$ ',
							initord		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00008', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'ItemExtensions_1 ON ' $ g.Store_Table_Prefix $ 'ItemExtensions ( item_id, version_id, mod_code )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00009', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'ItemExtensions_2 ON ' $ g.Store_Table_Prefix $ 'ItemExtensions ( item_id, initord )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00010', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_PageXItem
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'PageXItem
						  (
							page_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							xref_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							item_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00011', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'PageXItem_1 ON ' $ g.Store_Table_Prefix $ 'PageXItem ( page_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00012', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'PageXItem_2 ON ' $ g.Store_Table_Prefix $ 'PageXItem ( item_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00013', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_Branches
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'Branches
						  (
							id			' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()			$ ',
							immutable	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()			$ ',
							branchkey	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 50 )		$ ',
							name		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 100 )		$ ',
							color		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 7 )			$ ',
							framework	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 100 )		$ ',
							tmpldir		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 254 )		$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00310', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'Branches_1 ON ' $ g.Store_Table_Prefix $ 'Branches ( id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00311', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'Branches_2 ON ' $ g.Store_Table_Prefix $ 'Branches ( branchkey )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00312', g.MvQUERY_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.branch:id"			VALUE = 1>
	<MvASSIGN NAME = "l.branch:immutable"	VALUE = 1>
	<MvASSIGN NAME = "l.branch:branchkey"	VALUE = "{ MakeSessionID() }">
	<MvASSIGN NAME = "l.branch:name"		VALUE = "Production">
	<MvASSIGN NAME = "l.branch:color"		VALUE = "#20c171">
	<MvASSIGN NAME = "l.branch:framework"	VALUE = "">
	<MvASSIGN NAME = "l.branch:tmpldir"		VALUE = "">

	<MvIF EXPR = "{ NOT Branch_Insert( l.branch ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvASSIGN NAME = "l.store:branch"		VALUE = "{ l.branch }">

	<MvCOMMENT>
	|
	| sNN_ManagedTemplateBranchVersions
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions
						  (
							branch_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ ',
							templ_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ ',
							version_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ ',
							head		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()	$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00313', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions_1 ON ' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions ( branch_id, templ_id, version_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00314', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions_2 ON ' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions ( branch_id, templ_id, head )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00338', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions_3 ON ' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions ( templ_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00315', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions_4 ON ' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions ( version_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00464', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_Changesets
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'Changesets
						  (
							id			' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ ',
							parent_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ ',
							branch_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ ',
							user_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ ',
							dtstamp		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ ',
							notes		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_MEMO()	$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00316', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'Changesets_1 ON ' $ g.Store_Table_Prefix $ 'Changesets ( id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00317', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'Changesets_2 ON ' $ g.Store_Table_Prefix $ 'Changesets ( branch_id, id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00368', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'Changesets_3 ON ' $ g.Store_Table_Prefix $ 'Changesets ( branch_id DESC, id DESC )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00596', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_ChangesetTags
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'ChangesetTags
						  (
							set_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							tag			' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 100 )	$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00339', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'ChangesetTags_1 ON ' $ g.Store_Table_Prefix $ 'ChangesetTags ( set_id, tag )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00340', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'ChangesetTags_2 ON ' $ g.Store_Table_Prefix $ 'ChangesetTags ( tag )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00341', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_ManagedTemplateTags
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'ManagedTemplateTags
						  (
							tag	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 100 ) $ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00342', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'ManagedTemplateTags_1 ON ' $ g.Store_Table_Prefix $ 'ManagedTemplateTags ( tag )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00343', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_ManagedTemplateChanges
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'ManagedTemplateChanges
						  (
							branch_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							set_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							templ_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							old_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							new_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00318', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'ManagedTemplateChanges_1 ON ' $ g.Store_Table_Prefix $ 'ManagedTemplateChanges ( set_id, templ_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00319', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'ManagedTemplateChanges_2 ON ' $ g.Store_Table_Prefix $ 'ManagedTemplateChanges ( templ_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00369', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'ManagedTemplateChanges_3 ON ' $ g.Store_Table_Prefix $ 'ManagedTemplateChanges ( branch_id, templ_id, set_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00505', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_ManagedTemplates
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $  g.Store_Table_Prefix $ 'ManagedTemplates
						  (
							id			' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							parent_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							item_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							prop_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							sync		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()		$ ',
							filename	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 254 )	$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00014', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'ManagedTemplates_1 ON ' $ g.Store_Table_Prefix $ 'ManagedTemplates ( id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00015', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'ManagedTemplates_2 ON ' $ g.Store_Table_Prefix $ 'ManagedTemplates ( filename )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00067', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'ManagedTemplates_3 ON ' $ g.Store_Table_Prefix $ 'ManagedTemplates ( parent_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00617', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_ManagedTemplateVersions
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $  g.Store_Table_Prefix $ 'ManagedTemplateVersions
						  (
							id			' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							templ_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							user_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							immutable	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()		$ ',
							dtstamp		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							notes		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 100 )	$ ',
							source		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_MEMO()		$ ',
							settings	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_MEMO()		$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00016', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'ManagedTemplateVersions_1 ON ' $ g.Store_Table_Prefix $ 'ManagedTemplateVersions ( id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00017', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'ManagedTemplateVersions_2 ON ' $ g.Store_Table_Prefix $ 'ManagedTemplateVersions ( templ_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00018', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_SKINs
	|
	</MvCOMMENT>

	<MvIF EXPR = "{ NOT SKIN_Store_Create() }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_JavaScriptResources
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'JavaScriptResources
						  (
							id			' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							templ_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00157', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'JavaScriptResources_1 ON ' $ g.Store_Table_Prefix $ 'JavaScriptResources ( id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00158', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'JavaScriptResources_2 ON ' $ g.Store_Table_Prefix $ 'JavaScriptResources ( templ_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00618', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_JavaScriptResourceVersions
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'JavaScriptResourceVersions
						  (
							id			' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							code		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 50 )	$ ',
							res_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							xref_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							user_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							content_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							immutable	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()		$ ',
							type		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 1 )		$ ',
							is_global	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()		$ ',
							active		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()		$ ',
							file		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 254 )	$ ',
							mod_code	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 50 )	$ ',
							mod_data	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 100 )	$ ',
							attributes	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_MEMO()		$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00391', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'JavaScriptResourceVersions_1 ON ' $ g.Store_Table_Prefix $ 'JavaScriptResourceVersions ( id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00392', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'JavaScriptResourceVersions_2 ON ' $ g.Store_Table_Prefix $ 'JavaScriptResourceVersions ( res_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00393', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'JavaScriptResourceVersions_3 ON ' $ g.Store_Table_Prefix $ 'JavaScriptResourceVersions ( xref_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00394', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_JavaScriptResourceBranchVersions
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions
						  (
							branch_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							res_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							version_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							code		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 50 )	$ ',
							head		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()		$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00395', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions_1 ON ' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions ( branch_id, res_id, version_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00396', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions_2 ON ' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions ( branch_id, res_id, head )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00397', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions_3 ON ' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions ( res_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00398', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions_4 ON ' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions ( branch_id, head, code )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00706', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_JavaScriptResourceChanges
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'JavaScriptResourceChanges
						  (
							branch_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							set_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							res_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							old_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							new_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							xref_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00399', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'JavaScriptResourceChanges_1 ON ' $ g.Store_Table_Prefix $ 'JavaScriptResourceChanges ( set_id, res_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00400', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'JavaScriptResourceChanges_2 ON ' $ g.Store_Table_Prefix $ 'JavaScriptResourceChanges ( res_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00401', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'JavaScriptResourceChanges_3 ON ' $ g.Store_Table_Prefix $ 'JavaScriptResourceChanges ( branch_id, res_id, set_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00506', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_JavaScriptCombinedResourceXResource
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'JavaScriptCombinedResourceXResource
						  (
							comb_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							res_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							xref_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							disp_order	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00268', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'JavaScriptCombinedResourceXResource_1 ON ' $ g.Store_Table_Prefix $ 'JavaScriptCombinedResourceXResource ( comb_id, res_id, xref_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00269', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'JavaScriptCombinedResourceXResource_2 ON ' $ g.Store_Table_Prefix $ 'JavaScriptCombinedResourceXResource ( comb_id, disp_order )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00270', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'JavaScriptCombinedResourceXResource_3 ON ' $ g.Store_Table_Prefix $ 'JavaScriptCombinedResourceXResource ( res_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00308', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_JavaScriptResourceXGroup
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'JavaScriptResourceXGroup
						  (
							script_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							xref_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ ',
							group_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							disp_order	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00160', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'JavaScriptResourceXGroup_1 ON ' $ g.Store_Table_Prefix $ 'JavaScriptResourceXGroup ( script_id, xref_id, group_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00161', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'JavaScriptResourceXGroup_2 ON ' $ g.Store_Table_Prefix $ 'JavaScriptResourceXGroup ( group_id, disp_order )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00162', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'JavaScriptResourceXGroup_3 ON ' $ g.Store_Table_Prefix $ 'JavaScriptResourceXGroup ( script_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00402', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_JavaScriptResourceXPage
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'JavaScriptResourceXPage
						  (
							script_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							xref_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ ',
							page_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00163', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'JavaScriptResourceXPage_1 ON ' $ g.Store_Table_Prefix $ 'JavaScriptResourceXPage ( script_id, xref_id, page_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00164', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'JavaScriptResourceXPage_2 ON ' $ g.Store_Table_Prefix $ 'JavaScriptResourceXPage ( page_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00165', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'JavaScriptResourceXPage_3 ON ' $ g.Store_Table_Prefix $ 'JavaScriptResourceXPage ( script_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00403', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_CSSResources
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'CSSResources
						  (
							id			' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							templ_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00166', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'CSSResources_1 ON ' $ g.Store_Table_Prefix $ 'CSSResources ( id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00167', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'CSSResources_2 ON ' $ g.Store_Table_Prefix $ 'CSSResources ( templ_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00619', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_CSSResourceVersions
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'CSSResourceVersions
						  (
							id			' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							code		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 50 )	$ ',
							res_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							xref_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							user_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							content_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							immutable	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()		$ ',
							type		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 1 )		$ ',
							is_global	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()		$ ',
							active		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()		$ ',
							file		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 254 )	$ ',
							mod_code	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 50 )	$ ',
							mod_data	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 100 )	$ ',
							attributes	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_MEMO()		$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00371', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'CSSResourceVersions_1 ON ' $ g.Store_Table_Prefix $ 'CSSResourceVersions ( id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00372', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'CSSResourceVersions_2 ON ' $ g.Store_Table_Prefix $ 'CSSResourceVersions ( res_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00373', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'CSSResourceVersions_3 ON ' $ g.Store_Table_Prefix $ 'CSSResourceVersions ( xref_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00374', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_CSSResourceBranchVersions
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions
						  (
							branch_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							res_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							version_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							code		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 50 )	$ ',
							head		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()		$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00375', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions_1 ON ' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions ( branch_id, res_id, version_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00376', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions_2 ON ' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions ( branch_id, res_id, head )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00377', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions_3 ON ' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions ( res_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00378', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions_4 ON ' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions ( branch_id, head, code )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00707', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_CSSResourceChanges
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'CSSResourceChanges
						  (
							branch_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							set_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							res_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							old_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							new_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							xref_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00379', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'CSSResourceChanges_1 ON ' $ g.Store_Table_Prefix $ 'CSSResourceChanges ( set_id, res_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00380', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'CSSResourceChanges_2 ON ' $ g.Store_Table_Prefix $ 'CSSResourceChanges ( res_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00381', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'CSSResourceChanges_3 ON ' $ g.Store_Table_Prefix $ 'CSSResourceChanges ( branch_id, res_id, set_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00507', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_CSSCombinedResourceXResource
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'CSSCombinedResourceXResource
						  (
							comb_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							res_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							xref_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ ',
							disp_order	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00271', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'CSSCombinedResourceXResource_1 ON ' $ g.Store_Table_Prefix $ 'CSSCombinedResourceXResource ( comb_id, res_id, xref_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00272', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'CSSCombinedResourceXResource_2 ON ' $ g.Store_Table_Prefix $ 'CSSCombinedResourceXResource ( comb_id, disp_order )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00273', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'CSSCombinedResourceXResource_3 ON ' $ g.Store_Table_Prefix $ 'CSSCombinedResourceXResource ( res_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00309', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_CSSResourceXGroup
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'CSSResourceXGroup
						  (
							css_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							xref_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							group_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							disp_order	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00169', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'CSSResourceXGroup_1 ON ' $ g.Store_Table_Prefix $ 'CSSResourceXGroup ( css_id, xref_id, group_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00170', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'CSSResourceXGroup_2 ON ' $ g.Store_Table_Prefix $ 'CSSResourceXGroup ( group_id, disp_order )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00171', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'CSSResourceXGroup_3 ON ' $ g.Store_Table_Prefix $ 'CSSResourceXGroup ( css_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00383', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_CSSResourceXPage
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'CSSResourceXPage
						  (
							css_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							xref_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ ',
							page_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00172', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'CSSResourceXPage_1 ON ' $ g.Store_Table_Prefix $ 'CSSResourceXPage ( css_id, xref_id, page_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00173', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'CSSResourceXPage_2 ON ' $ g.Store_Table_Prefix $ 'CSSResourceXPage ( page_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00174', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'CSSResourceXPage_3 ON ' $ g.Store_Table_Prefix $ 'CSSResourceXPage ( css_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00384', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_ResourceGroups
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'ResourceGroups
						  (
							id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							code	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 50 )	$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00175', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'ResourceGroups_1 ON ' $ g.Store_Table_Prefix $ 'ResourceGroups ( id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00176', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'ResourceGroups_2 ON ' $ g.Store_Table_Prefix $ 'ResourceGroups ( code )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00177', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_ManagedProperties
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'ManagedProperties
						  (
							id			' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							sync		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()		$ ',
							templ_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00508', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'ManagedProperties_1 ON ' $ g.Store_Table_Prefix $ 'ManagedProperties ( id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00509', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'ManagedProperties_2 ON ' $ g.Store_Table_Prefix $ 'ManagedProperties ( templ_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00620', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_ManagedPropertyVersions
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions
						  (
							id			' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							prop_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							user_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							type		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 50 )	$ ',
							code		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 50 )	$ ',
							product_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							cat_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							image_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							content_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							immutable	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()		$ ',
							settings	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_MEMO()		$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00511', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions_1 ON ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions ( id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00512', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions_2 ON ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions ( prop_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00513', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions_3 ON ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions ( image_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00621', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions_4 ON ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions ( type, code, product_id, cat_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00682', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions_5 ON ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions ( product_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00683', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions_6 ON ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions ( cat_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00684', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_ManagedPropertyVersionImageReferences
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $  g.Store_Table_Prefix $ 'ManagedPropertyVersionImageReferences
						  (
							prop_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							version_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							image_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							head_count	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00636', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersionImageReferences_1 ON ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersionImageReferences ( version_id, image_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00637', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_ManagedPropertyBranchVersions
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions
						  (
							branch_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							prop_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							version_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							type		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 50 )	$ ',
							code		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 50 )	$ ',
							product_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							cat_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							head		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()		$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00514', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions_1 ON ' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions ( branch_id, prop_id, version_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00515', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions_2 ON ' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions ( branch_id, prop_id, head )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00516', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions_3 ON ' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions ( prop_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00517', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions_4 ON ' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions ( version_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00518', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions_5 ON ' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions ( branch_id, head, type, code, product_id, cat_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00695', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_ManagedPropertyChanges
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'ManagedPropertyChanges
						  (
							branch_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							set_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							prop_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							old_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							new_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00586', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'ManagedPropertyChanges_1 ON ' $ g.Store_Table_Prefix $ 'ManagedPropertyChanges ( set_id, prop_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00587', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'ManagedPropertyChanges_2 ON ' $ g.Store_Table_Prefix $ 'ManagedPropertyChanges ( prop_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00588', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'ManagedPropertyChanges_3 ON ' $ g.Store_Table_Prefix $ 'ManagedPropertyChanges ( branch_id, prop_id, set_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00591', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_CopyPageRules
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'CopyPageRules
						  (
							id			' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							name		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 100 )	$ ',
							secure		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()		$ ',
							title		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()		$ ',
							template	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()		$ ',
							items		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()		$ ',
							settings	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 10 )	$ ',
							jsres		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()		$ ',
							cssres		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()		$ ',
							cacheset	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()		$ ',
							public		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()		$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00648', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'CopyPageRules_1 ON ' $ g.Store_Table_Prefix $ 'CopyPageRules ( id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00649', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'CopyPageRules_2 ON ' $ g.Store_Table_Prefix $ 'CopyPageRules ( name )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00650', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_CopyPageRulesXSettings
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'CopyPageRulesXSettings
						  (
							rules_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							item_code	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 50 )	$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00651', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'CopyPageRulesXSettings_1 ON ' $ g.Store_Table_Prefix $ 'CopyPageRulesXSettings ( rules_id, item_code )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00652', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_ManagedContent
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'ManagedContent
						  (
							id			' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							refcount	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							md5			' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 100 )	$ ',
							encoding	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 20 )	$ ',
							content		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_MEMO()		$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00697', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'ManagedContent_1 ON ' $ g.Store_Table_Prefix $ 'ManagedContent ( id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00698', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'ManagedContent_2 ON ' $ g.Store_Table_Prefix $ 'ManagedContent ( md5 )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00699', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "SKIN_Store_Create" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT [ g.Module_Library_DB ].StoreKey_Insert( 'SKINs', 1 ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvQUERY NAME   = "Merchant"
			 QUERY  = "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'SKIN
						  (
							id          	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()			$ ',
							code        	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 100 )       $ ',
							version     	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 10 )        $ ',
							title       	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 254 )       $ ',
							descrip     	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_MEMO()            $ ',
							signature   	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 40 )        $ ',
							previewurl  	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 254 )       $ ',
							previewimg  	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 254 )       $ ',
							provider    	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 254 )       $ ',
							created_dt		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() 		$ ',
							applied_dt		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() 		$ ',
							has_comps   	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()            $ '
						  )' }">

	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00068', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'SKIN_1 ON ' $ g.Store_Table_Prefix $ 'SKIN ( id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00069', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'SKIN_2 ON ' $ g.Store_Table_Prefix $ 'SKIN ( code )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00070', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "TUI_Store_Delete" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Feature_Filename_TUI_MGR ].TemplateManager_Delete_All_ManagedTemplate_Files() }">

	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'SKIN' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'Pages' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'PageVersions' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'PageBranchVersions' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'PageChanges' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'Items' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'ItemVersions' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'ItemBranchVersions' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'ItemChanges' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'ItemExtensions' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'PageXItem' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'Branches' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'Changesets' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'ChangesetTags' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'ManagedTemplateTags' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'ManagedTemplateChanges' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'ManagedTemplates' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'ManagedTemplateVersions' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'JavaScriptResources' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'JavaScriptResourceVersions' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'JavaScriptResourceChanges' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'JavaScriptResourceXGroup' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'JavaScriptResourceXPage' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'JavaScriptCombinedResourceXResource' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'CSSResources' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'CSSResourceVersions' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'CSSResourceChanges' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'CSSResourceXGroup' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'CSSResourceXPage' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'CSSCombinedResourceXResource' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'ResourceGroups' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'ManagedProperties' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersionImageReferences' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'ManagedPropertyChanges' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'CopyPageRules' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'CopyPageRulesXSettings' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'ManagedContent' }">

	<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Library_DB ].StoreKey_Delete( 'Pages' ) }">
	<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Library_DB ].StoreKey_Delete( 'PageVersions' ) }">
	<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Library_DB ].StoreKey_Delete( 'PageReferences' ) }">
	<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Library_DB ].StoreKey_Delete( 'Items' ) }">
	<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Library_DB ].StoreKey_Delete( 'ItemVersions' ) }">
	<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Library_DB ].StoreKey_Delete( 'ItemExtensionDisplayOrder' ) }">
	<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Library_DB ].StoreKey_Delete( 'Branches' ) }">
	<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Library_DB ].StoreKey_Delete( 'Changesets' ) }">
	<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Library_DB ].StoreKey_Delete( 'ManagedTemplates' ) }">
	<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Library_DB ].StoreKey_Delete( 'ManagedTemplateVersions' ) }">
	<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Library_DB ].StoreKey_Delete( 'JavaScriptResources' ) }">
	<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Library_DB ].StoreKey_Delete( 'JavaScriptResourceVersions' ) }">
	<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Library_DB ].StoreKey_Delete( 'JavaScriptResourceReferences' ) }">
	<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Library_DB ].StoreKey_Delete( 'JavaScriptResourceXGroupDisplayOrder' ) }">
	<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Library_DB ].StoreKey_Delete( 'CSSResources' ) }">
	<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Library_DB ].StoreKey_Delete( 'CSSResourceVersions' ) }">
	<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Library_DB ].StoreKey_Delete( 'CSSResourceReferences' ) }">
	<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Library_DB ].StoreKey_Delete( 'CSSResourceXGroupDisplayOrder' ) }">
	<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Library_DB ].StoreKey_Delete( 'ResourceGroups' ) }">
	<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Library_DB ].StoreKey_Delete( 'ManagedProperties' ) }">
	<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Library_DB ].StoreKey_Delete( 'ManagedPropertyVersions' ) }">
	<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Library_DB ].StoreKey_Delete( 'CopyPageRules' ) }">
	<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Library_DB ].StoreKey_Delete( 'ManagedContent' ) }">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_Pages
|
</MvCOMMENT>

<MvFUNCTION NAME = "Page_Read" PARAMETERS = "page var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.page:id"			VALUE = "{ Pages.d.id }">
	<MvASSIGN NAME = "l.page:templ_id"		VALUE = "{ Pages.d.templ_id }">

	<MvCOMMENT>
	|
	| The following columns are pulled in via a join to sNN_PageVersion for backwards
	| compatibility.
	|
	</MvCOMMENT>

	<MvASSIGN NAME = "l.page:version_id"	VALUE = "{ Pages.d.version_id }">
	<MvASSIGN NAME = "l.page:xref_id"		VALUE = "{ Pages.d.version_xref_id }">
	<MvASSIGN NAME = "l.page:user_id"		VALUE = "{ Pages.d.version_user_id }">
	<MvASSIGN NAME = "l.page:admin"			VALUE = "{ Pages.d.version_admin }">
	<MvASSIGN NAME = "l.page:layout"		VALUE = "{ Pages.d.version_layout }">
	<MvASSIGN NAME = "l.page:fragment"		VALUE = "{ Pages.d.version_fragment }">
	<MvASSIGN NAME = "l.page:secure"		VALUE = "{ Pages.d.version_secure }">
	<MvASSIGN NAME = "l.page:public"		VALUE = "{ Pages.d.version_public }">
	<MvASSIGN NAME = "l.page:code"			VALUE = "{ Pages.d.version_code }">
	<MvASSIGN NAME = "l.page:name"			VALUE = "{ Pages.d.version_name }">
	<MvASSIGN NAME = "l.page:title"			VALUE = "{ Pages.d.version_title }">
	<MvASSIGN NAME = "l.page:ui_id"			VALUE = "{ Pages.d.version_ui_id }">
	<MvASSIGN NAME = "l.page:cache"			VALUE = "{ Pages.d.version_cache }">
	<MvASSIGN NAME = "l.page:cacheset"		VALUE = "{ miva_array_deserialize( Pages.d.version_cacheset ) }">

	<MvCOMMENT>
	|
	| Settings are pulled in from sNN_ManagedTemplateVersions
	|
	</MvCOMMENT>

	<MvASSIGN NAME = "l.page:settings"		VALUE = "{ miva_array_deserialize( Pages.d.template_settings ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Page_Copy_PageVersion" PARAMETERS = "pageversion var, page var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.page:version_id"	VALUE = "{ l.pageversion:id }">
	<MvASSIGN NAME = "l.page:xref_id"		VALUE = "{ l.pageversion:xref_id }">
	<MvASSIGN NAME = "l.page:user_id"		VALUE = "{ l.pageversion:user_id }">
	<MvASSIGN NAME = "l.page:admin"			VALUE = "{ l.pageversion:admin }">
	<MvASSIGN NAME = "l.page:layout"		VALUE = "{ l.pageversion:layout }">
	<MvASSIGN NAME = "l.page:fragment"		VALUE = "{ l.pageversion:fragment }">
	<MvASSIGN NAME = "l.page:secure"		VALUE = "{ l.pageversion:secure }">
	<MvASSIGN NAME = "l.page:public"		VALUE = "{ l.pageversion:public }">
	<MvASSIGN NAME = "l.page:code"			VALUE = "{ l.pageversion:code }">
	<MvASSIGN NAME = "l.page:name"			VALUE = "{ l.pageversion:name }">
	<MvASSIGN NAME = "l.page:title"			VALUE = "{ l.pageversion:title }">
	<MvASSIGN NAME = "l.page:ui_id"			VALUE = "{ l.pageversion:ui_id }">
	<MvASSIGN NAME = "l.page:cache"			VALUE = "{ l.pageversion:cache }">
	<MvASSIGN NAME = "l.page:cacheset"		VALUE = "{ l.pageversion:cacheset }">
</MvFUNCTION>

<MvFUNCTION NAME = "Page_Insert" PARAMETERS = "page var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ Page_Insert_Branch( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.page ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Page_Insert_Branch" PARAMETERS = "branch_id, page var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT Page_Insert_LowLevel( l.page ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMENT>
	|
	| Insert initial PageVersion and register on the current branch
	|
	</MvCOMMENT>

	<MvASSIGN NAME = "l.pageversion" VALUE = "">

	<MvEVAL EXPR = "{ PageVersion_Copy_Page( l.page, l.pageversion ) }">

	<MvIF EXPR = "{ NOT PageVersion_Insert( l.pageversion ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvEVAL EXPR = "{ Page_Copy_PageVersion( l.pageversion, l.page ) }">

	<MvIF EXPR = "{ NOT PageBranchVersion_Insert( l.branch_id, l.page:id, l.pageversion:id ) OR
					NOT PageBranchVersion_Update_Head( l.branch_id, l.page:id, l.pageversion:id ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ NOT [ g.Feature_Filename_TUI_MGR ].TemplateManager_Changeset_Record_PageVersion( l.page:id, 0, l.pageversion:id, l.pageversion:xref_id, 'Page \'' $ l.page:code $ '\' created' ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMENT>
	|
	| Notify modules
	|
	</MvCOMMENT>

	<MvFOREACH ITERATOR = "l.module" ARRAY = "l.modules" COUNT = "{ [ g.Module_Library_DB ].StoreModuleList_Load_Features_Cached( 'not_page', l.modules ) }">
		<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Root $ l.module:module ].Module_Notify_Page_Insert( l.module, l.page ) }">
	</MvFOREACH>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Page_Insert_LowLevel" PARAMETERS = "page var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.page:id" VALUE = "{ [ g.Module_Library_DB ].StoreKey_Generate( 'Pages' ) }">

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'Pages
					      ( id, templ_id )
						  VALUES
						  ( ?, ? )' }"
			 FIELDS	= "l.page:id, l.page:templ_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00019', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Page_Update" PARAMETERS = "page var" STANDARDOUTPUTLEVEL = "">
	<MvCOMMENT>
	|
	| Update page and create new page version
	|
	</MvCOMMENT>

	<MvIF EXPR = "{ NOT Page_Update_LowLevel( l.page ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMENT>
	|
	| Update page settings, if necessary
	|
	</MvCOMMENT>

	<MvIF EXPR = "{ NOT [ g.Feature_Filename_TUI_MGR ].TemplateManager_Page_Update_Settings( l.page, 'Page Update' ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMENT>
	|
	| Notify modules
	|
	</MvCOMMENT>

	<MvFOREACH ITERATOR = "l.module" ARRAY = "l.modules" COUNT = "{ [ g.Module_Library_DB ].StoreModuleList_Load_Features_Cached( 'not_page', l.modules ) }">
		<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Root $ l.module:module ].Module_Notify_Page_Update( l.module, l.page ) }">
	</MvFOREACH>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Page_Update_LowLevel" PARAMETERS = "page var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'Pages
					      SET
							templ_id	= ?
					      WHERE
						    id			= ?' }"
			 FIELDS	= "l.page:templ_id,
					   l.page:id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00020', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| Insert new PageVersion and register on the current branch
	|
	</MvCOMMENT>

	<MvASSIGN NAME = "l.branch_id"				VALUE = "{ [ g.Module_Feature_TUI_MGR ].TemplateManager_Working_Branch_ID() }">
	<MvASSIGN NAME = "l.pageversion"			VALUE = "">
	<MvASSIGN NAME = "l.previous_version_id"	VALUE = "{ l.page:version_id }">

	<MvEVAL EXPR = "{ PageVersion_Copy_Page( l.page, l.pageversion ) }">

	<MvASSIGN NAME = "l.pageversion:user_id"	VALUE = "{ int( g.User:id ) }">

	<MvIF EXPR = "{ NOT PageVersion_Insert( l.pageversion ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvEVAL EXPR = "{ Page_Copy_PageVersion( l.pageversion, l.page ) }">

	<MvIF EXPR = "{ NOT PageBranchVersion_Insert( l.branch_id, l.page:id, l.pageversion:id ) OR
					NOT PageBranchVersion_Update_Head( l.branch_id, l.page:id, l.pageversion:id ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ NOT [ g.Feature_Filename_TUI_MGR ].TemplateManager_Page_Fields_Propagate( l.page:id, l.previous_version_id, l.pageversion:id ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = "{ [ g.Feature_Filename_TUI_MGR ].TemplateManager_Changeset_Record_PageVersion( l.page:id, l.previous_version_id, l.pageversion:id, l.pageversion:xref_id, 'Page \'' $ l.page:code $ '\' updated' ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Page_Update_CacheSettings" PARAMETERS = "page var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ Page_Update_CacheSettings_Branch( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.page ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Page_Update_CacheSettings_Branch" PARAMETERS = "branch_id, page var" STANDARDOUTPUTLEVEL = "">
	<MvCOMMENT>
	|
	| If the version being updated is the head revision on the current branch, and does not exist
	| on any other branches, directly update it.  Otherwise, create and register a new version with the updated cache settings.
	|
	| This avoids creating many page versions unnecessarily as cache settings are updated, similar to the logic used
	| for cross references.
	|
	</MvCOMMENT>

	<MvASSIGN NAME = "l.can_update_existingversion"				VALUE = 0>

	<MvIF EXPR = "{ PageBranchVersion_Load( l.branch_id, l.page:id, l.page:version_id, l.branchversion ) }">
		<MvIF EXPR = "{ l.branchversion:head }">
			<MvIF EXPR = "{ NOT PageBranchVersion_Load_OtherBranch( l.branch_id, l.page:id, l.page:version_id, l.null ) }">
				<MvIF EXPR = "{ NOT [ g.Module_Library_DB ].Error_Is_EOF() }">
					<MvFUNCTIONRETURN VALUE = 0>
				</MvIF>

				<MvASSIGN NAME = "l.can_update_existingversion"	VALUE = 1>
			</MvIF>
		</MvIF>
	</MvIF>

	<MvIF EXPR = "{ l.can_update_existingversion }">
		<MvIF EXPR = "{ NOT Page_Update_CacheSettings_LowLevel( l.page ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	<MvELSE>
		<MvCOMMENT>
		|
		| Create and register a new version of the page based on the passed-in data
		|
		</MvCOMMENT>

		<MvASSIGN NAME = "l.pageversion"						VALUE = "">
		<MvASSIGN NAME = "l.previous_version_id"				VALUE = "{ l.page:version_id }">

		<MvEVAL EXPR = "{ PageVersion_Copy_Page( l.page, l.pageversion ) }">

		<MvIF EXPR = "{ NOT PageVersion_Insert( l.pageversion ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>

		<MvEVAL EXPR = "{ Page_Copy_PageVersion( l.pageversion, l.page ) }">

		<MvIF EXPR = "{ NOT PageBranchVersion_Insert( l.branch_id, l.page:id, l.pageversion:id ) OR
						NOT PageBranchVersion_Update_Head( l.branch_id, l.page:id, l.pageversion:id ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>

		<MvIF EXPR = "{ NOT [ g.Feature_Filename_TUI_MGR ].TemplateManager_Page_Fields_Propagate( l.page:id, l.previous_version_id, l.pageversion:id ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>

		<MvIF EXPR = "{ NOT [ g.Feature_Filename_TUI_MGR ].TemplateManager_Changeset_Record_PageVersion( l.page:id, l.previous_version_id, l.pageversion:id, l.pageversion:xref_id, 'Page Cache Settings for page \'' $ l.page:code $ '\' updated' ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	</MvIF>

	<MvCOMMENT>
	|
	| Notify modules
	|
	</MvCOMMENT>

	<MvFOREACH ITERATOR = "l.module" ARRAY = "l.modules" COUNT = "{ [ g.Module_Library_DB ].StoreModuleList_Load_Features_Cached( 'not_page', l.modules ) }">
		<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Root $ l.module:module ].Module_Notify_Page_Update( l.module, l.page ) }">
	</MvFOREACH>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Page_Update_CacheSettings_LowLevel" PARAMETERS = "page var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.cacheset" VALUE = "{ miva_array_serialize( l.page:cacheset ) }">

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'PageVersions
					      SET
							cacheset	= ?
					      WHERE
						    id			= ?' }"
			 FIELDS	= "l.cacheset,
					   l.page:version_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00615', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Page_Replace_Settings" PARAMETERS = "page var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ Page_Replace_Branch_Settings( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.page ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Page_Replace_Branch_Settings" PARAMETERS = "branch_id, page var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT Page_Replace_Branch_Settings_LowLevel( l.branch_id, l.page ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFOREACH ITERATOR = "l.module" ARRAY = "l.modules" COUNT = "{ [ g.Module_Library_DB ].StoreModuleList_Load_Features_Cached( 'not_page', l.modules ) }">
		<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Root $ l.module:module ].Module_Notify_Page_Update( l.module, l.page ) }">
	</MvFOREACH>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Page_Replace_Branch_Settings_LowLevel" PARAMETERS = "branch_id, page var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.settings"	VALUE = "{ miva_array_serialize( l.page:settings ) }">

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'ManagedTemplateVersions
						  SET
							settings	= ?
						  WHERE
							id			= ( SELECT version_id FROM ' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions WHERE branch_id = ? AND templ_id = ? AND head = 1 )' }"
			 FIELDS	= "l.settings,
					   l.branch_id, l.page:templ_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00344', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Page_Delete_ID" PARAMETERS = "id" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.module_count" VALUE = "{ [ g.Module_Library_DB ].StoreModuleList_Load_Features_Cached( 'not_page', l.modules ) }">

	<MvIF EXPR = "{ l.module_count }">
		<MvASSIGN NAME = "l.page_loaded" VALUE = "{ Page_Load_ID( l.id, l.page ) }">
	</MvIF>

	<MvIF EXPR = "{ NOT Page_Delete_ID_LowLevel( l.id ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ l.module_count AND l.page_loaded }">	
		<MvFOREACH ITERATOR = "l.module" ARRAY = "l.modules" COUNT = "{ l.module_count }">
			<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Root $ l.module:module ].Module_Notify_Page_Delete( l.module, l.page ) }">
		</MvFOREACH>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Page_Delete_ID_LowLevel" PARAMETERS = "id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'Pages WHERE id = ?' }"
			 FIELDS	= "l.id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00021', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Page_Delete_All_Orphaned" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT PageVersion_Delete_All_Orphaned_Pages()			OR
					NOT PageXItem_Delete_All_Orphaned_Pages()			OR
					NOT CSSResourceXPage_Delete_All_Orphaned_Pages()	OR
					NOT JavaScriptResourceXPage_Delete_All_Orphaned_Pages() }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = "{ Page_Delete_All_Orphaned_LowLevel() }">
</MvFUNCTION>

<MvFUNCTION NAME = "Page_Delete_All_Orphaned_LowLevel" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'Pages
			 			  WHERE id NOT IN ( SELECT DISTINCT page_id FROM ' $ g.Store_Table_Prefix $ 'PageBranchVersions )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00822', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Page_Purge" PARAMETERS = "page var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT PageXItem_Delete_All_Page_LowLevel( l.page:id ) 		OR
					NOT CSSResourceXPage_Delete_All_Page( l.page:id )			OR
					NOT JavaScriptResourceXPage_Delete_All_Page( l.page:id )	OR
					NOT PageChange_Delete_All_Page( l.page:id )					OR
					NOT PageVersion_Delete_All_Page( l.page:id )				OR
					NOT PageBranchVersion_Delete_All_Page( l.page:id )			OR
					NOT [ g.Module_Feature_URI_UT ].URI_Page_Delete( l.page ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = "{ Page_Delete_ID( l.page:id ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Page_Load_ID_Cached" PARAMETERS = "page_id, page var" STANDARDOUTPUTLEVEL = "">
	<MvREFERENCEARRAY NAME = "l.cache" 					VARIABLE = "g.Session:cache:page_load_id_cached">
		<MvDIMENSION INDEX = "{ l.page_id }">
	</MvREFERENCEARRAY>

	<MvIF EXPR = "{ ISNULL l.cache:result }">
		<MvASSIGN NAME = "l.cache:result"				VALUE = "{ Page_Load_ID( l.page_id, l.cache:page ) }">

		<MvIF EXPR = "{ l.cache:result }">
			<MvREFERENCE NAME = "g.Session:cache:page_load_code_cached" MEMBER = "{ l.cache:page:code }" VARIABLE = "l.cache">
		<MvELSE>
			<MvASSIGN NAME = "l.cache:error_code"		VALUE = "{ g.Error_Code }">
			<MvASSIGN NAME = "l.cache:error_message"	VALUE = "{ g.Error_Message }">
			<MvASSIGN NAME = "l.cache:error_db_eof"		VALUE = "{ g.Error_DB_EOF }">
		</MvIF>
	</MvIF>

	<MvIF EXPR = "{ NOT l.cache:result }">
		<MvIF EXPR = "{ l.cache:error_db_eof }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( l.cache:error_code ) }">
		</MvIF>

		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( l.cache:error_code, l.cache:error_message ) }">
	</MvIF>

	<MvASSIGN NAME = "l.page"							VALUE = "{ l.cache:page }">

	<MvFUNCTIONRETURN VALUE = "{ l.cache:result }">
</MvFUNCTION>

<MvFUNCTION NAME = "Page_Load_Code_Cached" PARAMETERS = "page_code, page var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ Page_Load_Branch_Code_Cached( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.page_code, l.page ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Page_Load_Branch_Code_Cached" PARAMETERS = "branch_id, page_code, page var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.branch_id"						VALUE = "{ int( l.branch_id ) }">

	<MvIF EXPR = "{ l.branch_id LE 0 }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00961' ) }">
	</MvIF>

	<MvREFERENCEARRAY NAME = "l.cache" 					VARIABLE = "g.Session:cache:page_load_branch_code_cached">
		<MvDIMENSION INDEX = "{ l.branch_id }">
		<MvMEMBER NAME = "{ l.page_code }">
	</MvREFERENCEARRAY>

	<MvIF EXPR = "{ ISNULL l.cache:result }">
		<MvASSIGN NAME = "l.cache:result"				VALUE = "{ Page_Load_Branch_Code( l.branch_id, l.page_code, l.cache:page ) }">

		<MvIF EXPR = "{ l.cache:result }">
			<MvREFERENCE NAME = "g.Session:cache:page_load_id_cached" INDEX = "{ l.cache:page:id }" VARIABLE = "l.cache">
		<MvELSE>
			<MvASSIGN NAME = "l.cache:error_code"		VALUE = "{ g.Error_Code }">
			<MvASSIGN NAME = "l.cache:error_message"	VALUE = "{ g.Error_Message }">
			<MvASSIGN NAME = "l.cache:error_db_eof"		VALUE = "{ g.Error_DB_EOF }">
		</MvIF>
	</MvIF>

	<MvIF EXPR = "{ NOT l.cache:result }">
		<MvIF EXPR = "{ l.cache:error_db_eof }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( l.cache:error_code ) }">
		</MvIF>

		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( l.cache:error_code, l.cache:error_message ) }">
	</MvIF>

	<MvASSIGN NAME = "l.page"							VALUE = "{ l.cache:page }">

	<MvFUNCTIONRETURN VALUE = "{ l.cache:result }">
</MvFUNCTION>

<MvFUNCTION NAME = "Page_Load_ID" PARAMETERS = "id, page var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ Page_Load_Branch_ID( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.id, l.page ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Page_Load_Branch_ID" PARAMETERS = "branch_id, id, page var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "Pages"
				QUERY	= "{ 'SELECT
								p.*,
								pv.id			AS version_id,
								pv.xref_id		AS version_xref_id,
								pv.user_id		AS version_user_id,
								pv.admin		AS version_admin,
								pv.layout		AS version_layout,
								pv.fragment		AS version_fragment,
								pv.secure		AS version_secure,
								pv.public		AS version_public,
								pv.code			AS version_code,
								pv.name			AS version_name,
								pv.title		AS version_title,
								pv.ui_id		AS version_ui_id,
								pv.cache		AS version_cache,
								pv.cacheset		AS version_cacheset,
								mtv.settings	AS template_settings
							  FROM
								' $ g.Store_Table_Prefix $ 'PageBranchVersions pbv,
								' $ g.Store_Table_Prefix $ 'Pages p,
								' $ g.Store_Table_Prefix $ 'PageVersions pv,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions bv,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateVersions mtv
							  WHERE
								pbv.branch_id	= ?					AND
								pbv.page_id		= ?					AND
								pbv.head		= 1					AND
								p.id			= pbv.page_id		AND
								pv.id			= pbv.version_id	AND
								bv.branch_id	= ?					AND
								bv.templ_id		= p.templ_id		AND
								bv.head			= 1					AND
								mtv.id			= bv.version_id' }"
				FIELDS	= "l.branch_id, l.id, l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00145', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ Pages.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "Pages">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00146' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ Page_Read( l.page ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Pages">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Page_Load_Code" PARAMETERS = "code, page var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ Page_Load_Branch_Code( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.code, l.page ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Page_Load_Branch_Code" PARAMETERS = "branch_id, code, page var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "Pages"
				QUERY	= "{ 'SELECT
								p.*,
								pv.id			AS version_id,
								pv.xref_id		AS version_xref_id,
								pv.user_id		AS version_user_id,
								pv.admin		AS version_admin,
								pv.layout		AS version_layout,
								pv.fragment		AS version_fragment,
								pv.secure		AS version_secure,
								pv.public		AS version_public,
								pv.code			AS version_code,
								pv.name			AS version_name,
								pv.title		AS version_title,
								pv.ui_id		AS version_ui_id,
								pv.cache		AS version_cache,
								pv.cacheset		AS version_cacheset,
								mtv.settings	AS template_settings
							  FROM
								' $ g.Store_Table_Prefix $ 'PageBranchVersions pbv,
								' $ g.Store_Table_Prefix $ 'Pages p,
								' $ g.Store_Table_Prefix $ 'PageVersions pv,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions bv,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateVersions mtv
							  WHERE
								pbv.branch_id	= ?					AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'pbv.code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_Upper( '?' ) $ ' AND
								pbv.head		= 1					AND
								p.id			= pbv.page_id		AND
								pv.id			= pbv.version_id	AND
								bv.branch_id	= ?					AND
								bv.templ_id		= p.templ_id		AND
								bv.head			= 1					AND
								mtv.id			= bv.version_id' }"
				FIELDS	= "l.branch_id, l.code, l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00022', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ Pages.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "Pages">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00091' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ Page_Read( l.page ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Pages">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Page_Load_Code_OtherBranch" PARAMETERS = "branch_id, page_code, page var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_OPENVIEW_Range( 'Merchant',
																		     'PageBranchVersions',
																		     'SELECT
																				*
																			  FROM
																				' $ g.Store_Table_Prefix $ 'PageBranchVersions
																			  WHERE
																				head		= 1 AND
																				' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_Upper( '?' ) $ ' AND
																				branch_id	<> ?',
																		     [ g.Module_Library_DB ].SQL_Query_Field( l.page_code )		$ ',' $
																		     [ g.Module_Library_DB ].SQL_Query_Field( l.branch_id ),
																		     0, 1 ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00789', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ PageBranchVersions.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "PageBranchVersions">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00790' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ PageBranchVersion_Read( l.pagebranchversion ) }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PageBranchVersions">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Page_Load_Reuse" PARAMETERS = "existing_page var, reused_page var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ Page_Load_Branch_Reuse( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.existing_page, l.reused_page ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Page_Load_Branch_Reuse" PARAMETERS = "branch_id, existing_page var, reused_page var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ Page_Load_Branch_Code( l.branch_id, l.existing_page:code, l.null ) }">						<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00932' ) }">
	<MvELSEIF EXPR = "{ Page_Load_Reuse_Existing_OtherBranch( l.branch_id, l.existing_page, l.reused_page ) }">	<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = "{ Page_Load_Reuse_Deleted( l.existing_page, l.reused_page ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Page_Load_Reuse_Existing_OtherBranch" PARAMETERS = "branch_id, existing_page var, reused_page var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_OPENVIEW_Range( 'Merchant', 'Pages',
																			 'SELECT
																				p.*
																			  FROM
																				' $ g.Store_Table_Prefix $ 'PageBranchVersions pbv,
																				' $ g.Store_Table_Prefix $ 'PageVersions pv,
																				' $ g.Store_Table_Prefix $ 'Pages p
																			  WHERE
																				pbv.head		= 1					AND
																				pbv.branch_id	<> ?				AND
																				pv.id			= pbv.version_id	AND
																				' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'pv.code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_Upper( '?' ) $ ' AND
																				pv.admin		= ?					AND
																				pv.layout		= ?					AND
																				pv.fragment		= ?					AND
																				p.id			= pv.page_id
																			  ORDER BY
																				pv.page_id ASC',
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.branch_id )				$ ',' $
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.existing_page:code )	$ ',' $
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.existing_page:admin )	$ ',' $
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.existing_page:layout )	$ ',' $
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.existing_page:fragment ),
																			 0, 1 ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00808', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ Pages.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "Pages">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00809' ) }">
	</MvIF>

	<MvASSIGN NAME = "l.reused_page:id"			VALUE = "{ Pages.d.id }">
	<MvASSIGN NAME = "l.reused_page:templ_id"	VALUE = "{ Pages.d.templ_id }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Pages">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Page_Load_Reuse_Deleted" PARAMETERS = "existing_page var, reused_page var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_OPENVIEW_Range( 'Merchant', 'Pages',
																			 'SELECT
																				p.*
																			  FROM
																				' $ g.Store_Table_Prefix $ 'PageBranchVersions pbv,
																				' $ g.Store_Table_Prefix $ 'PageChanges pc,
																				' $ g.Store_Table_Prefix $ 'PageVersions pv,
																				' $ g.Store_Table_Prefix $ 'Pages p
																			  WHERE
																				pbv.head		= 1					AND
																				pbv.version_id	= 0					AND
																				pc.branch_id	= pbv.branch_id		AND
																				pc.page_id		= pbv.page_id		AND
																				pc.new_id		= 0					AND
																				pv.id			= pc.old_id			AND
																				' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'pv.code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_Upper( '?' ) $ ' AND
																				pv.admin		= ?					AND
																				pv.layout		= ?					AND
																				pv.fragment		= ?					AND
																				p.id			= pv.page_id
																			  ORDER BY
																				pc.page_id ASC, pc.set_id DESC',
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.existing_page:code )	$ ',' $
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.existing_page:admin )	$ ',' $
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.existing_page:layout )	$ ',' $
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.existing_page:fragment ),
																			 0, 1 ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00777', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ Pages.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "Pages">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00778' ) }">
	</MvIF>

	<MvASSIGN NAME = "l.reused_page:id"			VALUE = "{ Pages.d.id }">
	<MvASSIGN NAME = "l.reused_page:templ_id"	VALUE = "{ Pages.d.templ_id }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Pages">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PageList_Load_UI" PARAMETERS = "ui_id, pages var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ PageList_Load_Branch_UI( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.ui_id, l.pages ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PageList_Load_Branch_UI" PARAMETERS = "branch_id, ui_id, pages var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW	NAME	= "Merchant"
				VIEW	= "Pages"
				QUERY	= "{ 'SELECT
								p.*,
								pv.id			AS version_id,
								pv.xref_id		AS version_xref_id,
								pv.user_id		AS version_user_id,
								pv.admin		AS version_admin,
								pv.layout		AS version_layout,
								pv.fragment		AS version_fragment,
								pv.secure		AS version_secure,
								pv.public		AS version_public,
								pv.code			AS version_code,
								pv.name			AS version_name,
								pv.title		AS version_title,
								pv.ui_id		AS version_ui_id,
								pv.cache		AS version_cache,
								pv.cacheset		AS version_cacheset,
								mtv.settings	AS template_settings
							  FROM
								' $ g.Store_Table_Prefix $ 'PageBranchVersions pbv,
								' $ g.Store_Table_Prefix $ 'Pages p,
								' $ g.Store_Table_Prefix $ 'PageVersions pv,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions bv,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateVersions mtv
							  WHERE
								pbv.branch_id	= ?					AND
								pbv.head		= 1					AND
								p.id			= pbv.page_id		AND
								pv.id			= pbv.version_id	AND
								pv.ui_id		= ?					AND
								bv.branch_id	= ?					AND
								bv.templ_id		= p.templ_id		AND
								bv.head			= 1					AND
								mtv.id			= bv.version_id
							  ORDER BY
								p.id' }"
				FIELDS	= "l.branch_id, l.ui_id, l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00023', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.page_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT Pages.d.EOF }">
		<MvEVAL EXPR = "{ Page_Read( l.pages[ ++l.page_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "Pages" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Pages">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00092', l.page_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PageList_Load_CSSResource" PARAMETERS = "res_id, pages var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ PageList_Load_Branch_CSSResource( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.res_id, l.pages ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PageList_Load_Branch_CSSResource" PARAMETERS = "branch_id, res_id, pages var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW	NAME	= "Merchant"
				VIEW	= "Pages"
				QUERY	= "{ 'SELECT
								p.*,
								pv.id			AS version_id,
								pv.xref_id		AS version_xref_id,
								pv.user_id		AS version_user_id,
								pv.admin		AS version_admin,
								pv.layout		AS version_layout,
								pv.fragment		AS version_fragment,
								pv.secure		AS version_secure,
								pv.public		AS version_public,
								pv.code			AS version_code,
								pv.name			AS version_name,
								pv.title		AS version_title,
								pv.ui_id		AS version_ui_id,
								pv.cache		AS version_cache,
								pv.cacheset		AS version_cacheset,
								mtv.settings	AS template_settings
							  FROM
								' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions rbv,
								' $ g.Store_Table_Prefix $ 'CSSResourceVersions rv,
								' $ g.Store_Table_Prefix $ 'CSSResourceXPage rxp,
								' $ g.Store_Table_Prefix $ 'PageBranchVersions pbv,
								' $ g.Store_Table_Prefix $ 'Pages p,
								' $ g.Store_Table_Prefix $ 'PageVersions pv,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions bv,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateVersions mtv
							  WHERE
								rbv.branch_id	= ?					AND
								rbv.res_id		= ?					AND
								rbv.head		= 1					AND
								rv.id			= rbv.version_id	AND
								rxp.css_id		= rv.res_id			AND
								rxp.xref_id		= rv.xref_id		AND
								pbv.branch_id	= ?					AND
								pbv.page_id		= rxp.page_id		AND
								pbv.head		= 1					AND
								p.id			= pbv.page_id		AND
								pv.id			= pbv.version_id	AND
								bv.branch_id	= ?					AND
								bv.templ_id		= p.templ_id		AND
								bv.head			= 1					AND
								mtv.id			= bv.version_id
							  ORDER BY
								p.id' }"
				FIELDS	= "l.branch_id, l.res_id, l.branch_id, l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00467', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.page_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT Pages.d.EOF }">
		<MvEVAL EXPR = "{ Page_Read( l.pages[ ++l.page_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "Pages" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Pages">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00468', l.page_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PageList_Load_Changeset_CSSResource" PARAMETERS = "set_id, res_id, pages var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW	NAME	= "Merchant"
				VIEW	= "Pages"
				QUERY	= "{ 'SELECT
								p.*,
								pv.id			AS version_id,
								pc.xref_id		AS version_xref_id,
								pv.user_id		AS version_user_id,
								pv.admin		AS version_admin,
								pv.layout		AS version_layout,
								pv.fragment		AS version_fragment,
								pv.secure		AS version_secure,
								pv.public		AS version_public,
								pv.code			AS version_code,
								pv.name			AS version_name,
								pv.title		AS version_title,
								pv.ui_id		AS version_ui_id,
								pv.cache		AS version_cache,
								pv.cacheset		AS version_cacheset,
								mtv.settings	AS template_settings
							  FROM
								' $ g.Store_Table_Prefix $ 'Changesets c,
								' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions rbv,
								' $ g.Store_Table_Prefix $ 'CSSResourceChanges rc,
								' $ g.Store_Table_Prefix $ 'CSSResourceXPage rxp,
								' $ g.Store_Table_Prefix $ 'PageChanges pc,
								' $ g.Store_Table_Prefix $ 'Pages p,
								' $ g.Store_Table_Prefix $ 'PageVersions pv,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateChanges mtc,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateVersions mtv
							  WHERE
								c.id			= ?							AND
								rbv.branch_id	= c.branch_id				AND
								rbv.res_id		= ?							AND
								rc.new_id		= rbv.version_id			AND
								rc.branch_id	= rbv.branch_id				AND
								rc.res_id		= rbv.res_id				AND
								rc.set_id		=
								(
									SELECT
										MAX( rc2.set_id )
									FROM
										' $ g.Store_Table_Prefix $ 'CSSResourceChanges rc2
									WHERE
										rc2.branch_id	= rbv.branch_id		AND
										rc2.res_id		= rbv.res_id		AND
										rc2.set_id		<= c.id
								)											AND
								rxp.css_id		= rc.res_id					AND
								rxp.xref_id		= rc.xref_id				AND
								pc.branch_id	= c.branch_id				AND
								pc.page_id		= rxp.page_id				AND
								pc.set_id		=
								(
									SELECT
										MAX( pc2.set_id )
									FROM
										' $ g.Store_Table_Prefix $ 'PageChanges pc2
									WHERE
										pc2.branch_id	= c.branch_id		AND
										pc2.page_id		= rxp.page_id		AND
										pc2.set_id		<= c.id
								)											AND
								p.id			= pc.page_id				AND
								pv.id			= pc.new_id					AND
								mtc.branch_id	= c.branch_id				AND
								mtc.templ_id	= p.templ_id				AND
								mtc.set_id		=
								(
									SELECT
										MAX( mtc2.set_id )
									FROM
										' $ g.Store_Table_Prefix $ 'ManagedTemplateChanges mtc2
									WHERE
										mtc2.branch_id	= c.branch_id		AND
										mtc2.templ_id	= p.templ_id		AND
										mtc2.set_id		<= c.id
								)											AND
								mtv.id			= mtc.new_id
							  ORDER BY
								p.id' }"
				FIELDS	= "l.set_id, l.res_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00469', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.page_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT Pages.d.EOF }">
		<MvEVAL EXPR = "{ Page_Read( l.pages[ ++l.page_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "Pages" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Pages">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00470', l.page_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PageList_Load_JavaScriptResource" PARAMETERS = "res_id, pages var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ PageList_Load_Branch_JavaScriptResource( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.res_id, l.pages ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PageList_Load_Branch_JavaScriptResource" PARAMETERS = "branch_id, res_id, pages var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW	NAME	= "Merchant"
				VIEW	= "Pages"
				QUERY	= "{ 'SELECT
								p.*,
								pv.id			AS version_id,
								pv.xref_id		AS version_xref_id,
								pv.user_id		AS version_user_id,
								pv.admin		AS version_admin,
								pv.layout		AS version_layout,
								pv.fragment		AS version_fragment,
								pv.secure		AS version_secure,
								pv.public		AS version_public,
								pv.code			AS version_code,
								pv.name			AS version_name,
								pv.title		AS version_title,
								pv.ui_id		AS version_ui_id,
								pv.cache		AS version_cache,
								pv.cacheset		AS version_cacheset,
								mtv.settings	AS template_settings
							  FROM
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions rbv,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceVersions rv,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceXPage rxp,
								' $ g.Store_Table_Prefix $ 'PageBranchVersions pbv,
								' $ g.Store_Table_Prefix $ 'Pages p,
								' $ g.Store_Table_Prefix $ 'PageVersions pv,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions bv,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateVersions mtv
							  WHERE
								rbv.branch_id	= ?					AND
								rbv.res_id		= ?					AND
								rbv.head		= 1					AND
								rv.id			= rbv.version_id	AND
								rxp.script_id	= rv.res_id			AND
								rxp.xref_id		= rv.xref_id		AND
								pbv.branch_id	= ?					AND
								pbv.page_id		= rxp.page_id		AND
								pbv.head		= 1					AND
								p.id			= pbv.page_id		AND
								pv.id			= pbv.version_id	AND
								bv.branch_id	= ?					AND
								bv.templ_id		= p.templ_id		AND
								bv.head			= 1					AND
								mtv.id			= bv.version_id
							  ORDER BY
								p.id' }"
				FIELDS	= "l.branch_id, l.res_id, l.branch_id, l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00475', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.page_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT Pages.d.EOF }">
		<MvEVAL EXPR = "{ Page_Read( l.pages[ ++l.page_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "Pages" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Pages">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00476', l.page_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PageList_Load_Changeset_JavaScriptResource" PARAMETERS = "set_id, res_id, pages var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW	NAME	= "Merchant"
				VIEW	= "Pages"
				QUERY	= "{ 'SELECT
								p.*,
								pv.id			AS version_id,
								pc.xref_id		AS version_xref_id,
								pv.user_id		AS version_user_id,
								pv.admin		AS version_admin,
								pv.layout		AS version_layout,
								pv.fragment		AS version_fragment,
								pv.secure		AS version_secure,
								pv.public		AS version_public,
								pv.code			AS version_code,
								pv.name			AS version_name,
								pv.title		AS version_title,
								pv.ui_id		AS version_ui_id,
								pv.cache		AS version_cache,
								pv.cacheset		AS version_cacheset,
								mtv.settings	AS template_settings
							  FROM
								' $ g.Store_Table_Prefix $ 'Changesets c,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions rbv,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceChanges rc,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceXPage rxp,
								' $ g.Store_Table_Prefix $ 'PageChanges pc,
								' $ g.Store_Table_Prefix $ 'Pages p,
								' $ g.Store_Table_Prefix $ 'PageVersions pv,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateChanges mtc,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateVersions mtv
							  WHERE
								c.id			= ?							AND
								rbv.branch_id	= c.branch_id				AND
								rbv.res_id		= ?							AND
								rc.new_id		= rbv.version_id			AND
								rc.branch_id	= rbv.branch_id				AND
								rc.res_id		= rbv.res_id				AND
								rc.set_id		=
								(
									SELECT
										MAX( rc2.set_id )
									FROM
										' $ g.Store_Table_Prefix $ 'JavaScriptResourceChanges rc2
									WHERE
										rc2.branch_id	= rbv.branch_id		AND
										rc2.res_id		= rbv.res_id		AND
										rc2.set_id		<= c.id
								)											AND
								rxp.script_id	= rc.res_id					AND
								rxp.xref_id		= rc.xref_id				AND
								pc.branch_id	= c.branch_id				AND
								pc.page_id		= rxp.page_id				AND
								pc.set_id		=
								(
									SELECT
										MAX( pc2.set_id )
									FROM
										' $ g.Store_Table_Prefix $ 'PageChanges pc2
									WHERE
										pc2.branch_id	= c.branch_id		AND
										pc2.page_id		= rxp.page_id		AND
										pc2.set_id		<= c.id
								)											AND
								p.id			= pc.page_id				AND
								pv.id			= pc.new_id					AND
								mtc.branch_id	= c.branch_id				AND
								mtc.templ_id	= p.templ_id				AND
								mtc.set_id		=
								(
									SELECT
										MAX( mtc2.set_id )
									FROM
										' $ g.Store_Table_Prefix $ 'ManagedTemplateChanges mtc2
									WHERE
										mtc2.branch_id	= c.branch_id		AND
										mtc2.templ_id	= p.templ_id		AND
										mtc2.set_id		<= c.id
								)											AND
								mtv.id			= mtc.new_id
							  ORDER BY
								p.id' }"
				FIELDS	= "l.set_id, l.res_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00477', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.page_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT Pages.d.EOF }">
		<MvEVAL EXPR = "{ Page_Read( l.pages[ ++l.page_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "Pages" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Pages">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00478', l.page_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PageList_Load_All" PARAMETERS = "pages var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ PageList_Load_Branch_All( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.pages ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PageList_Load_Branch_All" PARAMETERS = "branch_id, pages var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW	NAME	= "Merchant"
				VIEW	= "Pages"
				QUERY	= "{ 'SELECT
								p.*,
								pv.id			AS version_id,
								pv.xref_id		AS version_xref_id,
								pv.user_id		AS version_user_id,
								pv.admin		AS version_admin,
								pv.layout		AS version_layout,
								pv.fragment		AS version_fragment,
								pv.secure		AS version_secure,
								pv.public		AS version_public,
								pv.code			AS version_code,
								pv.name			AS version_name,
								pv.title		AS version_title,
								pv.ui_id		AS version_ui_id,
								pv.cache		AS version_cache,
								pv.cacheset		AS version_cacheset,
								mtv.settings	AS template_settings
							  FROM
								' $ g.Store_Table_Prefix $ 'PageBranchVersions pbv,
								' $ g.Store_Table_Prefix $ 'Pages p,
								' $ g.Store_Table_Prefix $ 'PageVersions pv,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions bv,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateVersions mtv
							  WHERE
								pbv.branch_id	= ?					AND
								pbv.head		= 1					AND
								p.id			= pbv.page_id		AND
								pv.id			= pbv.version_id	AND
								bv.branch_id	= ?					AND
								bv.templ_id		= p.templ_id		AND
								bv.head			= 1					AND
								mtv.id			= bv.version_id
							  ORDER BY
								p.id' }"
				FIELDS	= "l.branch_id, l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00078', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.page_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT Pages.d.EOF }">
		<MvEVAL EXPR = "{ Page_Read( l.pages[ ++l.page_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "Pages" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Pages">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00093', l.page_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PageList_Load_All_Runtime" PARAMETERS = "pages var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ PageList_Load_Branch_All_Runtime( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.pages ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PageList_Load_Branch_All_Runtime" PARAMETERS = "branch_id, pages var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW	NAME	= "Merchant"
				VIEW	= "Pages"
				QUERY	= "{ 'SELECT
								p.*,
								pv.id			AS version_id,
								pv.xref_id		AS version_xref_id,
								pv.user_id		AS version_user_id,
								pv.admin		AS version_admin,
								pv.layout		AS version_layout,
								pv.fragment		AS version_fragment,
								pv.secure		AS version_secure,
								pv.public		AS version_public,
								pv.code			AS version_code,
								pv.name			AS version_name,
								pv.title		AS version_title,
								pv.ui_id		AS version_ui_id,
								pv.cache		AS version_cache,
								pv.cacheset		AS version_cacheset,
								mtv.settings	AS template_settings
							  FROM
								' $ g.Store_Table_Prefix $ 'PageBranchVersions pbv,
								' $ g.Store_Table_Prefix $ 'Pages p,
								' $ g.Store_Table_Prefix $ 'PageVersions pv,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions bv,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateVersions mtv
							  WHERE
								pbv.branch_id	= ?					AND
								pbv.head		= 1					AND
								p.id			= pbv.page_id		AND
								pv.id			= pbv.version_id	AND
								pv.admin		= 0					AND
								pv.layout		= 0					AND
								pv.fragment		= 0					AND
								bv.branch_id	= ?					AND
								bv.templ_id		= p.templ_id		AND
								bv.head			= 1					AND
								mtv.id			= bv.version_id
							  ORDER BY
								p.id' }"
				FIELDS	= "l.branch_id, l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00143', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.page_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT Pages.d.EOF }">
		<MvEVAL EXPR = "{ Page_Read( l.pages[ ++l.page_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "Pages" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Pages">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00147', l.page_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PageList_Load_All_Layout" PARAMETERS = "pages var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ PageList_Load_Branch_All_Layout( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.pages ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PageList_Load_Branch_All_Layout" PARAMETERS = "branch_id, pages var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW	NAME	= "Merchant"
				VIEW	= "Pages"
				QUERY	= "{ 'SELECT
								pv.id			AS version_id,
								pv.xref_id		AS version_xref_id,
								pv.user_id		AS version_user_id,
								pv.admin		AS version_admin,
								pv.layout		AS version_layout,
								pv.fragment		AS version_fragment,
								pv.secure		AS version_secure,
								pv.public		AS version_public,
								pv.code			AS version_code,
								pv.name			AS version_name,
								pv.title		AS version_title,
								pv.ui_id		AS version_ui_id,
								pv.cache		AS version_cache,
								pv.cacheset		AS version_cacheset,
								mtv.settings	AS template_settings
							  FROM
								' $ g.Store_Table_Prefix $ 'PageBranchVersions pbv,
								' $ g.Store_Table_Prefix $ 'Pages p,
								' $ g.Store_Table_Prefix $ 'PageVersions pv,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions bv,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateVersions mtv
							  WHERE
								pbv.branch_id	= ?					AND
								pbv.head		= 1					AND
								p.id			= pbv.page_id		AND
								pv.id			= pbv.version_id	AND
								pv.layout		= 1					AND
								bv.branch_id	= ?					AND
								bv.templ_id		= p.templ_id		AND
								bv.head			= 1					AND
								mtv.id			= bv.version_id
							  ORDER BY
								p.id' }"
				FIELDS	= "l.branch_id, l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00646', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.page_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT Pages.d.EOF }">
		<MvEVAL EXPR = "{ Page_Read( l.pages[ ++l.page_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "Pages" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Pages">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00647', l.page_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PageList_Load_All_Fragment" PARAMETERS = "pages var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ PageList_Load_Branch_All_Fragment( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.pages ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PageList_Load_Branch_All_Fragment" PARAMETERS = "branch_id, pages var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW	NAME	= "Merchant"
				VIEW	= "Pages"
				QUERY	= "{ 'SELECT
								pv.id			AS version_id,
								pv.xref_id		AS version_xref_id,
								pv.user_id		AS version_user_id,
								pv.admin		AS version_admin,
								pv.layout		AS version_layout,
								pv.fragment		AS version_fragment,
								pv.secure		AS version_secure,
								pv.public		AS version_public,
								pv.code			AS version_code,
								pv.name			AS version_name,
								pv.title		AS version_title,
								pv.ui_id		AS version_ui_id,
								pv.cache		AS version_cache,
								pv.cacheset		AS version_cacheset,
								mtv.settings	AS template_settings
							  FROM
								' $ g.Store_Table_Prefix $ 'PageBranchVersions pbv,
								' $ g.Store_Table_Prefix $ 'Pages p,
								' $ g.Store_Table_Prefix $ 'PageVersions pv,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions bv,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateVersions mtv
							  WHERE
								pbv.branch_id	= ?					AND
								pbv.head		= 1					AND
								p.id			= pbv.page_id		AND
								pv.id			= pbv.version_id	AND
								pv.fragment		= 1					AND
								bv.branch_id	= ?					AND
								bv.templ_id		= p.templ_id		AND
								bv.head			= 1					AND
								mtv.id			= bv.version_id
							  ORDER BY
								p.id' }"
				FIELDS	= "l.branch_id, l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00962', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.page_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT Pages.d.EOF }">
		<MvEVAL EXPR = "{ Page_Read( l.pages[ ++l.page_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "Pages" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Pages">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00963', l.page_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PageList_Load_NotOnOtherBranch" PARAMETERS = "branch_id, other_branch_id, pages var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW	NAME	= "Merchant"
				VIEW	= "Pages"
				QUERY	= "{ 'SELECT
								pv.id			AS version_id,
								pv.xref_id		AS version_xref_id,
								pv.user_id		AS version_user_id,
								pv.admin		AS version_admin,
								pv.layout		AS version_layout,
								pv.fragment		AS version_fragment,
								pv.secure		AS version_secure,
								pv.public		AS version_public,
								pv.code			AS version_code,
								pv.name			AS version_name,
								pv.title		AS version_title,
								pv.ui_id		AS version_ui_id,
								pv.cache		AS version_cache,
								pv.cacheset		AS version_cacheset,
								mtv.settings	AS template_settings
							  FROM
								' $ g.Store_Table_Prefix $ 'PageBranchVersions pbv
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'PageBranchVersions pbv2 ON pbv2.branch_id = ? AND pbv2.head = 1 AND ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_Upper( 'pbv2.code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_Upper( 'pbv.code' ) $ ',
								' $ g.Store_Table_Prefix $ 'Pages p,
								' $ g.Store_Table_Prefix $ 'PageVersions pv,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions bv,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateVersions mtv
							  WHERE
								pbv.branch_id	= ?					AND
								pbv.head		= 1					AND
								p.id			= pbv.page_id		AND
								pv.id			= pbv.version_id	AND
								pv.layout		= 0					AND
								pv.fragment		= 0					AND
								bv.branch_id	= ?					AND
								bv.templ_id		= p.templ_id		AND
								bv.head			= 1					AND
								mtv.id			= bv.version_id		AND
								pbv2.page_id IS NULL
							  ORDER BY
								p.id' }"
				FIELDS	= "l.other_branch_id, l.branch_id, l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00791', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.page_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT Pages.d.EOF }">
		<MvEVAL EXPR = "{ Page_Read( l.pages[ ++l.page_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "Pages" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Pages">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00792', l.page_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Page_Load_First" PARAMETERS = "page var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ Page_Load_Branch_First( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.page ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Page_Load_Branch_First" PARAMETERS = "branch_id, page var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_OPENVIEW_Range( 'Merchant', 'Pages',
																			 'SELECT
																				p.*,
																				pv.id			AS version_id,
																				pv.xref_id		AS version_xref_id,
																				pv.user_id		AS version_user_id,
																				pv.admin		AS version_admin,
																				pv.layout		AS version_layout,
																				pv.fragment		AS version_fragment,
																				pv.secure		AS version_secure,
																				pv.public		AS version_public,
																				pv.code			AS version_code,
																				pv.name			AS version_name,
																				pv.title		AS version_title,
																				pv.ui_id		AS version_ui_id,
																				pv.cache		AS version_cache,
																				pv.cacheset		AS version_cacheset,
																				mtv.settings	AS template_settings
																			  FROM
																				' $ g.Store_Table_Prefix $ 'PageBranchVersions pbv,
																				' $ g.Store_Table_Prefix $ 'Pages p,
																				' $ g.Store_Table_Prefix $ 'PageVersions pv,
																				' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions bv,
																				' $ g.Store_Table_Prefix $ 'ManagedTemplateVersions mtv
																			  WHERE
																				pbv.branch_id	= ?					AND
																				pbv.head		= 1					AND
																				p.id			= pbv.page_id		AND
																				pv.id			= pbv.version_id	AND
																				pv.layout		= 0					AND
																				pv.fragment		= 0					AND
																				bv.branch_id	= ?					AND
																				bv.templ_id		= p.templ_id		AND
																				bv.head			= 1					AND
																				mtv.id			= bv.version_id
																			  ORDER BY ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'pv.code' ) $ ' ASC',
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.branch_id ) $ ',' $ [ g.Module_Library_DB ].SQL_Query_Field( l.branch_id ),
																			 0, 1 ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00094', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ Pages.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "Pages">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00095' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ Page_Read( l.page ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Pages">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Page_Load_Next" PARAMETERS = "page var, next_page var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ Page_Load_Branch_Next( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.page, l.next_page ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Page_Load_Branch_Next" PARAMETERS = "branch_id, page var, next_page var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_OPENVIEW_Range( 'Merchant', 'Pages',
																			 'SELECT
																				p.*,
																				pv.id			AS version_id,
																				pv.xref_id		AS version_xref_id,
																				pv.user_id		AS version_user_id,
																				pv.admin		AS version_admin,
																				pv.layout		AS version_layout,
																				pv.fragment		AS version_fragment,
																				pv.secure		AS version_secure,
																				pv.public		AS version_public,
																				pv.code			AS version_code,
																				pv.name			AS version_name,
																				pv.title		AS version_title,
																				pv.ui_id		AS version_ui_id,
																				pv.cache		AS version_cache,
																				pv.cacheset		AS version_cacheset,
																				mtv.settings	AS template_settings
																			  FROM
																				' $ g.Store_Table_Prefix $ 'PageBranchVersions pbv,
																				' $ g.Store_Table_Prefix $ 'Pages p,
																				' $ g.Store_Table_Prefix $ 'PageVersions pv,
																				' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions bv,
																				' $ g.Store_Table_Prefix $ 'ManagedTemplateVersions mtv
																			  WHERE
																				pbv.branch_id	= ?					AND
																				pbv.head		= 1					AND
																				p.id			= pbv.page_id		AND
																				pv.id			= pbv.version_id	AND
																				pv.layout		= 0					AND
																				pv.fragment		= 0					AND
																				' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'pv.code' ) $ ' > ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_Upper( '?' ) $ ' AND
																				bv.branch_id	= ?					AND
																				bv.templ_id		= p.templ_id		AND
																				bv.head			= 1					AND
																				mtv.id			= bv.version_id
																			  ORDER BY ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'pv.code' ) $ ' ASC',
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.branch_id ) $ ',' $ [ g.Module_Library_DB ].SQL_Query_Field( l.page:code ) $ ',' $ [ g.Module_Library_DB ].SQL_Query_Field( l.branch_id ),
																			 0, 1 ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00096', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ Pages.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "Pages">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00097' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ Page_Read( l.next_page ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Pages">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Page_Load_Previous" PARAMETERS = "page var, prev_page var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ Page_Load_Branch_Previous( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.page, l.prev_page ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Page_Load_Branch_Previous" PARAMETERS = "branch_id, page var, prev_page var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_OPENVIEW_Range( 'Merchant', 'Pages',
																			 'SELECT
																				p.*,
																				pv.id			AS version_id,
																				pv.xref_id		AS version_xref_id,
																				pv.user_id		AS version_user_id,
																				pv.admin		AS version_admin,
																				pv.layout		AS version_layout,
																				pv.fragment		AS version_fragment,
																				pv.secure		AS version_secure,
																				pv.public		AS version_public,
																				pv.code			AS version_code,
																				pv.name			AS version_name,
																				pv.title		AS version_title,
																				pv.ui_id		AS version_ui_id,
																				pv.cache		AS version_cache,
																				pv.cacheset		AS version_cacheset,
																				mtv.settings	AS template_settings
																			  FROM
																				' $ g.Store_Table_Prefix $ 'PageBranchVersions pbv,
																				' $ g.Store_Table_Prefix $ 'Pages p,
																				' $ g.Store_Table_Prefix $ 'PageVersions pv,
																				' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions bv,
																				' $ g.Store_Table_Prefix $ 'ManagedTemplateVersions mtv
																			  WHERE
																				pbv.branch_id	= ?					AND
																				pbv.head		= 1					AND
																				p.id			= pbv.page_id		AND
																				pv.id			= pbv.version_id	AND
																				pv.layout		= 0					AND
																				pv.fragment		= 0					AND
																				' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'pv.code' ) $ ' < ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_Upper( '?' ) $ ' AND
																				bv.branch_id	= ?					AND
																				bv.templ_id		= p.templ_id		AND
																				bv.head			= 1					AND
																				mtv.id			= bv.version_id
																			  ORDER BY ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'pv.code' ) $ ' DESC',
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.branch_id ) $ ',' $ [ g.Module_Library_DB ].SQL_Query_Field( l.page:code ) $ ',' $ [ g.Module_Library_DB ].SQL_Query_Field( l.branch_id ),
																			 0, 1 ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00098', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ Pages.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "Pages">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00099' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ Page_Read( l.prev_page ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Pages">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Page_Load_Last" PARAMETERS = "page var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ Page_Load_Branch_Last( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.page ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Page_Load_Branch_Last" PARAMETERS = "branch_id, page var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_OPENVIEW_Range( 'Merchant', 'Pages',
																			 'SELECT
																				p.*,
																				pv.id			AS version_id,
																				pv.xref_id		AS version_xref_id,
																				pv.user_id		AS version_user_id,
																				pv.admin		AS version_admin,
																				pv.layout		AS version_layout,
																				pv.fragment		AS version_fragment,
																				pv.secure		AS version_secure,
																				pv.public		AS version_public,
																				pv.code			AS version_code,
																				pv.name			AS version_name,
																				pv.title		AS version_title,
																				pv.ui_id		AS version_ui_id,
																				pv.cache		AS version_cache,
																				pv.cacheset		AS version_cacheset,
																				mtv.settings	AS template_settings
																			  FROM
																				' $ g.Store_Table_Prefix $ 'PageBranchVersions pbv,
																				' $ g.Store_Table_Prefix $ 'Pages p,
																				' $ g.Store_Table_Prefix $ 'PageVersions pv,
																				' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions bv,
																				' $ g.Store_Table_Prefix $ 'ManagedTemplateVersions mtv
																			  WHERE
																				pbv.branch_id	= ?					AND
																				pbv.head		= 1					AND
																				p.id			= pbv.page_id		AND
																				pv.id			= pbv.version_id	AND
																				pv.layout		= 0					AND
																				pv.fragment		= 0					AND
																				bv.branch_id	= ?					AND
																				bv.templ_id		= p.templ_id		AND
																				bv.head			= 1					AND
																				mtv.id			= bv.version_id
																			  ORDER BY ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'pv.code' ) $ ' DESC',
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.branch_id ) $ ',' $ [ g.Module_Library_DB ].SQL_Query_Field( l.branch_id ),
																			 0, 1 ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00100', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ Pages.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "Pages">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00101' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ Page_Read( l.page ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Pages">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Page_Fork_CustomFields" PARAMETERS = "page var" STANDARDOUTPUTLEVEL = "">
	<MvCOMMENT>
	|
	| Insert new PageVersion and register on the current branch
	|
	</MvCOMMENT>

	<MvASSIGN NAME = "l.branch_id"				VALUE = "{ [ g.Module_Feature_TUI_MGR ].TemplateManager_Working_Branch_ID() }">
	<MvASSIGN NAME = "l.pageversion"			VALUE = "">
	<MvASSIGN NAME = "l.previous_version_id"	VALUE = "{ l.page:version_id }">

	<MvEVAL EXPR = "{ PageVersion_Copy_Page( l.page, l.pageversion ) }">

	<MvASSIGN NAME = "l.pageversion:user_id"	VALUE = "{ int( g.User:id ) }">

	<MvIF EXPR = "{ NOT PageVersion_Insert( l.pageversion ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvEVAL EXPR = "{ Page_Copy_PageVersion( l.pageversion, l.page ) }">

	<MvIF EXPR = "{ NOT PageBranchVersion_Insert( l.branch_id, l.page:id, l.pageversion:id ) OR
					NOT PageBranchVersion_Update_Head( l.branch_id, l.page:id, l.pageversion:id ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ NOT [ g.Feature_Filename_TUI_MGR ].TemplateManager_Page_Fields_Propagate( l.page:id, l.previous_version_id, l.pageversion:id ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = "{ [ g.Feature_Filename_TUI_MGR ].TemplateManager_Changeset_Record_PageVersion( l.page:id, l.previous_version_id, l.pageversion:id, l.pageversion:xref_id, 'Page \'' $ l.page:code $ '\' custom fields updated' ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PageList_Load_Item" PARAMETERS = "item_id, pages var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ PageList_Load_Branch_Item( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.item_id, l.pages ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PageList_Load_Branch_Item" PARAMETERS = "branch_id, item_id, pages var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW	NAME	= "Merchant"
				VIEW	= "Pages"
				QUERY	= "{ 'SELECT
								p.*,
								pv.id			AS version_id,
								pv.xref_id		AS version_xref_id,
								pv.user_id		AS version_user_id,
								pv.admin		AS version_admin,
								pv.layout		AS version_layout,
								pv.fragment		AS version_fragment,
								pv.secure		AS version_secure,
								pv.public		AS version_public,
								pv.code			AS version_code,
								pv.name			AS version_name,
								pv.title		AS version_title,
								pv.ui_id		AS version_ui_id,
								pv.cache		AS version_cache,
								pv.cacheset		AS version_cacheset,
								mtv.settings	AS template_settings
							  FROM
								' $ g.Store_Table_Prefix $ 'PageXItem pxi,
								' $ g.Store_Table_Prefix $ 'PageBranchVersions pbv,
								' $ g.Store_Table_Prefix $ 'Pages p,
								' $ g.Store_Table_Prefix $ 'PageVersions pv,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions bv,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateVersions mtv
							  WHERE
								pxi.item_id		= ?					AND
								pbv.branch_id	= ?					AND
								pbv.page_id		= pxi.page_id		AND
								pbv.head		= 1					AND
								p.id			= pbv.page_id		AND
								pv.id			= pbv.version_id	AND
								pv.xref_id		= pxi.xref_id		AND
								bv.branch_id	= ?					AND
								bv.templ_id		= p.templ_id		AND
								bv.head			= 1					AND
								mtv.id			= bv.version_id' }"
				FIELDS	= "l.item_id, l.branch_id, l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00024', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.page_count" VALUE = 0>
	<MvWHILE EXPR = "{ NOT Pages.d.EOF }">
		<MvASSIGN NAME = "l.page_count" VALUE = "{ l.page_count + 1 }">
		<MvEVAL EXPR = "{ Page_Read( l.pages[ l.page_count ] ) }">

		<MvSKIP NAME = "Merchant" VIEW = "Pages" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Pages">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00102', l.page_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PageList_Load_Item_Runtime" PARAMETERS = "item_id, pages var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ PageList_Load_Branch_Item_Runtime( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.item_id, l.pages ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PageList_Load_Branch_Item_Runtime" PARAMETERS = "branch_id, item_id, pages var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW	NAME	= "Merchant"
				VIEW	= "Pages"
				QUERY	= "{ 'SELECT
								p.*,
								pv.id			AS version_id,
								pv.xref_id		AS version_xref_id,
								pv.user_id		AS version_user_id,
								pv.admin		AS version_admin,
								pv.layout		AS version_layout,
								pv.fragment		AS version_fragment,
								pv.secure		AS version_secure,
								pv.public		AS version_public,
								pv.code			AS version_code,
								pv.name			AS version_name,
								pv.title		AS version_title,
								pv.ui_id		AS version_ui_id,
								pv.cache		AS version_cache,
								pv.cacheset		AS version_cacheset,
								mtv.settings	AS template_settings
							  FROM
								' $ g.Store_Table_Prefix $ 'PageXItem pxi,
								' $ g.Store_Table_Prefix $ 'PageBranchVersions pbv,
								' $ g.Store_Table_Prefix $ 'Pages p,
								' $ g.Store_Table_Prefix $ 'PageVersions pv,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions bv,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateVersions mtv
							  WHERE
								pxi.item_id		= ?					AND
								pbv.branch_id	= ?					AND
								pbv.page_id		= pxi.page_id		AND
								pbv.head		= 1					AND
								p.id			= pbv.page_id		AND
								pv.id			= pbv.version_id	AND
								pv.xref_id		= pxi.xref_id		AND
								pv.admin		= 0					AND
								pv.layout		= 0					AND
								pv.fragment		= 0					AND
								bv.branch_id	= ?					AND
								bv.templ_id		= p.templ_id		AND
								bv.head			= 1					AND
								mtv.id			= bv.version_id' }"
				FIELDS	= "l.item_id, l.branch_id, l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00144', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.page_count" VALUE = 0>
	<MvWHILE EXPR = "{ NOT Pages.d.EOF }">
		<MvASSIGN NAME = "l.page_count" VALUE = "{ l.page_count + 1 }">
		<MvEVAL EXPR = "{ Page_Read( l.pages[ l.page_count ] ) }">

		<MvSKIP NAME = "Merchant" VIEW = "Pages" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Pages">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00148', l.page_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PageList_Load_Offset" PARAMETERS = "offset, search, searchable_fields, max, nextoffset var, pages var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00345', 'Function PageList_Load_Offset has been deprecated' ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PageList_Load_Offset_Runtime" PARAMETERS = "offset, search, searchable_fields, max, nextoffset var, pages var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00346', 'Function PageList_Load_Offset_Runtime has been deprecated' ) }">
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_PageVersions
|
</MvCOMMENT>

<MvFUNCTION NAME = "PageVersion_Read" PARAMETERS = "pageversion var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.pageversion:id"			VALUE = "{ PageVersions.d.id }">
	<MvASSIGN NAME = "l.pageversion:page_id"	VALUE = "{ PageVersions.d.page_id }">
	<MvASSIGN NAME = "l.pageversion:xref_id"	VALUE = "{ PageVersions.d.xref_id }">
	<MvASSIGN NAME = "l.pageversion:user_id"	VALUE = "{ PageVersions.d.user_id }">
	<MvASSIGN NAME = "l.pageversion:admin"		VALUE = "{ PageVersions.d.admin }">
	<MvASSIGN NAME = "l.pageversion:layout"		VALUE = "{ PageVersions.d.layout }">
	<MvASSIGN NAME = "l.pageversion:fragment"	VALUE = "{ PageVersions.d.fragment }">
	<MvASSIGN NAME = "l.pageversion:secure"		VALUE = "{ PageVersions.d.secure }">
	<MvASSIGN NAME = "l.pageversion:public"		VALUE = "{ PageVersions.d.public }">
	<MvASSIGN NAME = "l.pageversion:code"		VALUE = "{ PageVersions.d.code }">
	<MvASSIGN NAME = "l.pageversion:name"		VALUE = "{ PageVersions.d.name }">
	<MvASSIGN NAME = "l.pageversion:title"		VALUE = "{ PageVersions.d.title }">
	<MvASSIGN NAME = "l.pageversion:ui_id"		VALUE = "{ PageVersions.d.ui_id }">
	<MvASSIGN NAME = "l.pageversion:cache"		VALUE = "{ PageVersions.d.cache }">
	<MvASSIGN NAME = "l.pageversion:cacheset"	VALUE = "{ miva_array_deserialize( PageVersions.d.cacheset ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PageVersion_Copy_Page" PARAMETERS = "page var, pageversion var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.pageversion:id"			VALUE = "{ l.page:version_id }">
	<MvASSIGN NAME = "l.pageversion:page_id"	VALUE = "{ l.page:id }">
	<MvASSIGN NAME = "l.pageversion:xref_id"	VALUE = "{ l.page:xref_id }">
	<MvASSIGN NAME = "l.pageversion:user_id"	VALUE = "{ l.page:user_id }">
	<MvASSIGN NAME = "l.pageversion:admin"		VALUE = "{ l.page:admin }">
	<MvASSIGN NAME = "l.pageversion:layout"		VALUE = "{ l.page:layout }">
	<MvASSIGN NAME = "l.pageversion:fragment"	VALUE = "{ l.page:fragment }">
	<MvASSIGN NAME = "l.pageversion:secure"		VALUE = "{ l.page:secure }">
	<MvASSIGN NAME = "l.pageversion:public"		VALUE = "{ l.page:public }">
	<MvASSIGN NAME = "l.pageversion:code"		VALUE = "{ l.page:code }">
	<MvASSIGN NAME = "l.pageversion:name"		VALUE = "{ l.page:name }">
	<MvASSIGN NAME = "l.pageversion:title"		VALUE = "{ l.page:title }">
	<MvASSIGN NAME = "l.pageversion:ui_id"		VALUE = "{ l.page:ui_id }">
	<MvASSIGN NAME = "l.pageversion:cache"		VALUE = "{ l.page:cache }">
	<MvASSIGN NAME = "l.pageversion:cacheset"	VALUE = "{ l.page:cacheset }">
</MvFUNCTION>

<MvFUNCTION NAME = "PageVersion_Insert" PARAMETERS = "pageversion var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.pageversion:id"				VALUE = "{ [ g.Module_Library_DB ].StoreKey_Generate( 'PageVersions' ) }">

	<MvIF EXPR = "{ ISNULL l.pageversion:xref_id }">
		<MvASSIGN NAME = "l.pageversion:xref_id"	VALUE = "{ [ g.Module_Library_DB ].StoreKey_Generate( 'PageReferences' ) }">
	</MvIF>

	<MvIF EXPR = "{ ISNULL l.pageversion:user_id }">
		<MvASSIGN NAME = "l.pageversion:user_id"	VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ ISNULL l.pageversion:admin }">
		<MvASSIGN NAME = "l.pageversion:admin"		VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ ISNULL l.pageversion:layout }">
		<MvASSIGN NAME = "l.pageversion:layout"		VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ ISNULL l.pageversion:fragment }">
		<MvASSIGN NAME = "l.pageversion:fragment"	VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ ISNULL l.pageversion:secure }">
		<MvASSIGN NAME = "l.pageversion:secure"		VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ ISNULL l.pageversion:public }">
		<MvASSIGN NAME = "l.pageversion:public"		VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ ISNULL l.pageversion:ui_id }">
		<MvASSIGN NAME = "l.pageversion:ui_id"		VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ ISNULL l.pageversion:cache }">
		<MvASSIGN NAME = "l.pageversion:cache"		VALUE = "anonempty">
	</MvIF>

	<MvASSIGN NAME = "l.cacheset"					VALUE = "{ miva_array_serialize( l.pageversion:cacheset ) }">

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'PageVersions
					      ( id, page_id, xref_id, user_id, admin, layout, fragment, secure, public, code, name, title, ui_id, cache, cacheset )
						  VALUES
						  ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )' }"
			 FIELDS	= "l.pageversion:id, l.pageversion:page_id, l.pageversion:xref_id, l.pageversion:user_id,
					   l.pageversion:admin, l.pageversion:layout, l.pageversion:fragment, l.pageversion:secure,
					   l.pageversion:public, l.pageversion:code, l.pageversion:name, l.pageversion:title, l.pageversion:ui_id,
					   l.pageversion:cache, l.cacheset">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00752', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PageVersion_Update_LowLevel" PARAMETERS = "pageversion var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'PageVersions
			 			  SET
					      	user_id		= ?,
					      	admin		= ?,
					      	layout		= ?,
					      	fragment	= ?,
					      	secure		= ?,
					      	public		= ?,
					      	code		= ?,
					      	name		= ?,
					      	title		= ?
						  WHERE
						  	id			= ?' }"
			 FIELDS	= "l.pageversion:user_id, l.pageversion:admin, l.pageversion:layout, l.pageversion:fragment,
					   l.pageversion:secure, l.pageversion:public, l.pageversion:code, l.pageversion:name, l.pageversion:title,
			 		   l.pageversion:id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00929', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PageVersion_Update_CrossReference" PARAMETERS = "pageversion var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'PageVersions SET xref_id = ? WHERE id = ?' }"
			 FIELDS	= "l.pageversion:xref_id, l.pageversion:id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00753', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PageVersion_Delete_All_Page" PARAMETERS = "page_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PageVersions WHERE page_id = ?' }"
			 FIELDS	= "l.page_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00754', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PageVersion_Delete_All_Orphaned_Pages" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PageVersions
			 			  WHERE page_id NOT IN ( SELECT DISTINCT page_id FROM ' $ g.Store_Table_Prefix $ 'PageBranchVersions )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00823', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PageVersion_Load_ID" PARAMETERS = "id, pageversion var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PageVersions"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'PageVersions WHERE id = ?' }"
				FIELDS 	= "l.id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00755', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ PageVersions.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "PageVersions">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00756' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ PageVersion_Read( l.pageversion ) }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PageVersions">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PageVersion_Load_Page_Current" PARAMETERS = "page_id, managedtemplateversion var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ PageVersion_Load_Branch_Head( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.page_id, l.managedtemplateversion ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PageVersion_Load_Branch_Head" PARAMETERS = "branch_id, page_id, pageversion var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PageVersions"
				QUERY	= "{ 'SELECT
								pv.*
							  FROM ' $
								g.Store_Table_Prefix $ 'PageBranchVersions pbv, ' $
								g.Store_Table_Prefix $ 'PageVersions pv
							  WHERE
								pbv.branch_id	= ?				AND
								pbv.page_id		= ?				AND
								pbv.head		= 1				AND
								pv.id			= pbv.version_id' }"
				FIELDS	= "l.branch_id, l.page_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00757', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ PageVersions.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "PageVersions">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00758' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ PageVersion_Read( l.pageversion ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PageVersions">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PageVersion_Fork_CrossReferences_LowLevel" PARAMETERS = "pageversion var, new_xref_id" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT PageXItem_Fork( l.pageversion, l.new_xref_id ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PageVersion_Fork_CrossReferences" PARAMETERS = "branch_id, pageversion var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ PageVersion_Fork_CrossReferences_ID( l.branch_id, l.pageversion, [ g.Module_Library_DB ].StoreKey_Generate( 'PageReferences' ) ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PageVersion_Fork_CrossReferences_ID" PARAMETERS = "branch_id, pageversion var, xref_id" STANDARDOUTPUTLEVEL = "">
	<MvCOMMENT>
	|
	| Fork the cross references
	|
	</MvCOMMENT>

	<MvIF EXPR = "{ NOT PageVersion_Fork_CrossReferences_LowLevel( l.pageversion, l.xref_id ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMENT>
	|
	| If the version exists on this branch only, we just update its xref_id.  Otherwise we need to create a new version to isolate the
	| new xref_id to this branch.
	|
	</MvCOMMENT>

	<MvASSIGN NAME = "l.old_version_id"			VALUE = "{ l.pageversion:id }">
	<MvASSIGN NAME = "l.pageversion:xref_id"	VALUE = "{ l.xref_id }">

	<MvIF EXPR = "{ NOT PageBranchVersion_Load_OtherBranch( l.branch_id, l.pageversion:page_id, l.pageversion:id, l.null ) }">
		<MvIF EXPR = "{ NOT [ g.Module_Library_DB ].Error_Is_EOF() }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>

		<MvIF EXPR = "{ NOT PageVersion_Update_CrossReference( l.pageversion ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	<MvELSE>
		<MvIF EXPR = "{ NOT PageVersion_Insert( l.pageversion ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>

		<MvIF EXPR = "{ NOT PageBranchVersion_Insert( l.branch_id, l.pageversion:page_id, l.pageversion:id ) OR
						NOT PageBranchVersion_Update_Head( l.branch_id, l.pageversion:page_id, l.pageversion:id ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>

		<MvIF EXPR = "{ NOT [ g.Feature_Filename_TUI_MGR ].TemplateManager_Page_Fields_Propagate( l.pageversion:page_id, l.old_version_id, l.pageversion:id ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = "{ [ g.Feature_Filename_TUI_MGR ].TemplateManager_Changeset_Record_PageVersion( l.pageversion:page_id, l.old_version_id, l.pageversion:id, l.pageversion:xref_id, 'Page References for page \'' $ l.pageversion:code $ '\' updated' ) }">
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_PageBranchVersions
|
</MvCOMMENT>

<MvFUNCTION NAME = "PageBranchVersion_Read" PARAMETERS = "pagebranchversion var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.pagebranchversion:branch_id"	VALUE = "{ PageBranchVersions.d.branch_id }">
	<MvASSIGN NAME = "l.pagebranchversion:page_id"		VALUE = "{ PageBranchVersions.d.page_id }">
	<MvASSIGN NAME = "l.pagebranchversion:version_id"	VALUE = "{ PageBranchVersions.d.version_id }">
	<MvASSIGN NAME = "l.pagebranchversion:code"			VALUE = "{ PageBranchVersions.d.code }">
	<MvASSIGN NAME = "l.pagebranchversion:head"			VALUE = "{ PageBranchVersions.d.head }">
</MvFUNCTION>

<MvFUNCTION NAME = "PageBranchVersion_Insert" PARAMETERS = "branch_id, page_id, version_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.version_id EQ 0 }">
		<MvQUERY NAME   = "Merchant"
				 QUERY  = "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'PageBranchVersions
							  ( branch_id, page_id, version_id, code, head )
							  VALUES
							  ( ?, ?, ?, \'\', 0 )' }"
				 FIELDS = "l.branch_id, l.page_id, l.version_id">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00739', g.MvQUERY_Error ) }">
		</MvIF>
	<MvELSE>
		<MvQUERY NAME   = "Merchant"
				 QUERY  = "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'PageBranchVersions
							  ( branch_id, page_id, version_id, code, head )
							  SELECT
								?, ?, id, code, 0
							  FROM
								' $ g.Store_Table_Prefix $ 'PageVersions
							  WHERE
								id = ?' }"
				 FIELDS = "l.branch_id, l.page_id,
				 		   l.version_id">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00740', g.MvQUERY_Error ) }">
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PageBranchVersion_Update_Head" PARAMETERS = "branch_id, page_id, version_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'PageBranchVersions
						  SET
							head		= 1
						  WHERE
							branch_id	= ? AND
							page_id		= ? AND
							version_id	= ?' }"
			 FIELDS	= "l.branch_id, l.page_id, l.version_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00741', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'PageBranchVersions
						  SET
							head		= 0
						  WHERE
							branch_id	= ? AND
							page_id		= ? AND
							version_id	<> ?' }"
			 FIELDS	= "l.branch_id, l.page_id, l.version_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00742', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PageBranchVersion_Delete_All_Page" PARAMETERS = "page_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PageBranchVersions WHERE page_id = ?' }"
			 FIELDS	= "l.page_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00743', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PageBranchVersion_Load" PARAMETERS = "branch_id, page_id, version_id, pagebranchversion var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PageBranchVersions"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'PageBranchVersions WHERE branch_id = ? AND page_id = ? AND version_id = ?' }"
				FIELDS	= "l.branch_id, l.page_id, l.version_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00759', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ PageBranchVersions.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "PageBranchVersions">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00760' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ PageBranchVersion_Read( l.pagebranchversion ) }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PageBranchVersions">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PageBranchVersion_Load_Branch_Head" PARAMETERS = "branch_id, page_id, pagebranchversion var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PageBranchVersions"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'PageBranchVersions WHERE branch_id = ? AND page_id = ? AND head = 1' }"
				FIELDS	= "l.branch_id, l.page_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00761', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ PageBranchVersions.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "PageBranchVersions">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00762' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ PageBranchVersion_Read( l.pagebranchversion ) }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PageBranchVersions">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PageBranchVersion_Load_Code_Branch_Head" PARAMETERS = "branch_id, code, pagebranchversion var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PageBranchVersions"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'PageBranchVersions WHERE branch_id = ? AND head = 1 AND ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) }"
				FIELDS	= "l.branch_id, l.code">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00806', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ PageBranchVersions.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "PageBranchVersions">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00807' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ PageBranchVersion_Read( l.pagebranchversion ) }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PageBranchVersions">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PageBranchVersion_Load_OtherBranch" PARAMETERS = "branch_id, page_id, version_id, pagebranchversion var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_OPENVIEW_Range( 'Merchant',
																		     'PageBranchVersions',
																		     'SELECT
																				*
																			  FROM
																				' $ g.Store_Table_Prefix $ 'PageBranchVersions
																			  WHERE
																				page_id		= ?		AND
																				version_id	= ?		AND
																				branch_id	<> ?',
																		     [ g.Module_Library_DB ].SQL_Query_Field( l.page_id )		$ ',' $
																		     [ g.Module_Library_DB ].SQL_Query_Field( l.version_id )	$ ',' $
																		     [ g.Module_Library_DB ].SQL_Query_Field( l.branch_id ),
																		     0, 1 ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00744', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ PageBranchVersions.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "PageBranchVersions">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00745' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ PageBranchVersion_Read( l.pagebranchversion ) }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PageBranchVersions">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PageBranchVersion_Delete_All_Branch" PARAMETERS = "branch_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PageBranchVersions WHERE branch_id = ?' }"
			 FIELDS	= "l.branch_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00746', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_PageChanges
|
</MvCOMMENT>

<MvFUNCTION NAME = "PageChange_InsertOrUpdate" PARAMETERS = "branch_id, set_id, page_id, old_id, new_id, xref_id" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ PageChange_Insert( l.branch_id, l.set_id, l.page_id, l.old_id, l.new_id, l.xref_id ) }">	<MvFUNCTIONRETURN VALUE = 1>
	<MvELSEIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_Error_IsIndexDuplicate( g.Error_Message ) }">	<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = "{ PageChange_Update_New( l.branch_id, l.set_id, l.page_id, l.new_id, l.xref_id ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PageChange_Insert" PARAMETERS = "branch_id, set_id, page_id, old_id, new_id, xref_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'PageChanges
					      ( branch_id, set_id, page_id, old_id, new_id, xref_id )
						  VALUES
						  ( ?, ?, ?, ?, ?, ? )' }"
			 FIELDS	= "l.branch_id, l.set_id, l.page_id, l.old_id, l.new_id, l.xref_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00747', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PageChange_Update_New" PARAMETERS = "branch_id, set_id, page_id, new_id, xref_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'PageChanges
						  SET
							new_id	= ?,
							xref_id	= ?
						  WHERE
							branch_id	= ?	AND
							set_id		= ? AND
							page_id		= ?' }"
			 FIELDS	= "l.new_id, l.xref_id,
					   l.branch_id, l.set_id, l.page_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00748', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PageChange_Delete_All_Changeset" PARAMETERS = "set_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PageChanges WHERE set_id = ?' }"
			 FIELDS	= "l.set_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00749', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PageChange_Delete_All_Page" PARAMETERS = "page_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PageChanges WHERE page_id = ?' }"
			 FIELDS	= "l.page_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00750', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_Items
|
</MvCOMMENT>

<MvFUNCTION NAME = "Item_Read" PARAMETERS = "item var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.item:id"			VALUE = "{ Items.d.id }">

	<MvCOMMENT>
	|
	| The following columns are pulled in via a join to sNN_ItemVersion for backwards
	| compatibility.
	|
	</MvCOMMENT>

	<MvASSIGN NAME = "l.item:version_id"	VALUE = "{ Items.d.version_id }">
	<MvASSIGN NAME = "l.item:user_id"		VALUE = "{ Items.d.version_user_id }">
	<MvASSIGN NAME = "l.item:code"			VALUE = "{ Items.d.version_code }">
	<MvASSIGN NAME = "l.item:mod_code"		VALUE = "{ Items.d.version_mod_code }">
</MvFUNCTION>

<MvFUNCTION NAME = "Item_Copy_ItemVersion" PARAMETERS = "itemversion var, item var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.item:version_id"	VALUE = "{ l.itemversion:id }">
	<MvASSIGN NAME = "l.item:user_id"		VALUE = "{ l.itemversion:user_id }">
	<MvASSIGN NAME = "l.item:code"			VALUE = "{ l.itemversion:code }">
	<MvASSIGN NAME = "l.item:mod_code"		VALUE = "{ l.itemversion:mod_code }">
</MvFUNCTION>

<MvFUNCTION NAME = "Item_Insert" PARAMETERS = "item var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ Item_Insert_Branch( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.item ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Item_Insert_Branch" PARAMETERS = "branch_id, item var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvASSIGN NAME = "g.Session:cache:itemlist_load_codes_cached"	VALUE = "">
	<MvASSIGN NAME = "l.item:id"									VALUE = "{ [ g.Module_Library_DB ].StoreKey_Generate( 'Items' ) }">

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'Items
					      ( id )
						  VALUES
						  ( ? )' }"
			 FIELDS	= "l.item:id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00026', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| Insert initial ItemVersion and register on the current branch
	|
	</MvCOMMENT>

	<MvASSIGN NAME = "l.itemversion"			VALUE = "">

	<MvEVAL EXPR = "{ ItemVersion_Copy_Item( l.item, l.itemversion ) }">

	<MvASSIGN NAME = "l.itemversion:user_id"	VALUE = "{ int( g.User:id ) }">

	<MvIF EXPR = "{ NOT ItemVersion_Insert( l.itemversion ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvEVAL EXPR = "{ Item_Copy_ItemVersion( l.itemversion, l.item ) }">

	<MvIF EXPR = "{ NOT ItemBranchVersion_Insert( l.branch_id, l.item:id, l.itemversion:id ) OR
					NOT ItemBranchVersion_Update_Head( l.branch_id, l.item:id, l.itemversion:id ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ NOT [ g.Feature_Filename_TUI_MGR ].TemplateManager_Changeset_Record_ItemVersion( l.item:id, 0, l.itemversion:id, 'Item \'' $ l.item:code $ '\' created' ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Item_Update" PARAMETERS = "item var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "g.Session:cache:itemlist_load_codes_cached" VALUE = "">

	<MvCOMMENT>
	|
	| Insert new ItemVersion and register on the current branch
	|
	</MvCOMMENT>

	<MvASSIGN NAME = "l.branch_id"				VALUE = "{ [ g.Module_Feature_TUI_MGR ].TemplateManager_Working_Branch_ID() }">
	<MvASSIGN NAME = "l.itemversion"			VALUE = "">
	<MvASSIGN NAME = "l.previous_version_id"	VALUE = "{ l.item:version_id }">

	<MvEVAL EXPR = "{ ItemVersion_Copy_Item( l.item, l.itemversion ) }">

	<MvASSIGN NAME = "l.itemversion:user_id"	VALUE = "{ int( g.User:id ) }">

	<MvIF EXPR = "{ NOT ItemVersion_Insert( l.itemversion ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvEVAL EXPR = "{ Item_Copy_ItemVersion( l.itemversion, l.item ) }">

	<MvIF EXPR = "{ NOT ItemBranchVersion_Insert( l.branch_id, l.item:id, l.itemversion:id ) OR
					NOT ItemBranchVersion_Update_Head( l.branch_id, l.item:id, l.itemversion:id ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ NOT ItemExtension_Fork( l.item:id, l.previous_version_id, l.item:version_id ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = "{ [ g.Feature_Filename_TUI_MGR ].TemplateManager_Changeset_Record_ItemVersion( l.item:id, l.previous_version_id, l.itemversion:id, 'Item \'' $ l.item:code $ '\' updated' ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Item_Increment_ReferenceCount" PARAMETERS = "id" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00793', 'Function Item_Increment_ReferenceCount has been deprecated' ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Item_Decrement_ReferenceCount" PARAMETERS = "id" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00796', 'Function Item_Decrement_ReferenceCount has been deprecated' ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Item_Delete_ID" PARAMETERS = "id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvASSIGN NAME = "g.Session:cache:itemlist_load_codes_cached"	VALUE = "">

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'Items WHERE id = ?' }"
			 FIELDS	= "l.id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00030', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Item_Delete_All_Orphaned" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT ItemVersion_Delete_All_Orphaned_Items()	OR
					NOT PageXItem_Delete_All_Orphaned_Items()	OR
					NOT ItemExtension_Delete_All_Orphaned_Items() }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = "{ Item_Delete_All_Orphaned_LowLevel() }">
</MvFUNCTION>

<MvFUNCTION NAME = "Item_Delete_All_Orphaned_LowLevel" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'Items
			 			  WHERE id NOT IN ( SELECT DISTINCT item_id FROM ' $ g.Store_Table_Prefix $ 'ItemBranchVersions )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00869', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Item_Purge" PARAMETERS = "item var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT PageXItem_Delete_All_Item_LowLevel( l.item:id ) 		OR
					NOT ItemExtension_Delete_All_Item( l.item:id )				OR
					NOT ItemChange_Delete_All_Item( l.item:id )					OR
					NOT ItemVersion_Delete_All_Item( l.item:id )				OR
					NOT ItemBranchVersion_Delete_All_Item( l.item:id ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = "{ Item_Delete_ID( l.item:id ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Item_Load_ID" PARAMETERS = "id, item var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ Item_Load_Branch_ID( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.id, l.item ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Item_Load_Branch_ID" PARAMETERS = "branch_id, id, item var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "Items"
				QUERY	= "{ 'SELECT
								i.*,
								iv.id			AS version_id,
								iv.user_id		AS version_user_id,
								iv.code			AS version_code,
								iv.mod_code		AS version_mod_code,
								' $ [ g.Module_Library_Native_DBAPI ].DB_IFNULL( 'm.id', 0 ) $ ' AS module_id
							  FROM
								' $ g.Store_Table_Prefix $ 'ItemBranchVersions ibv,
								' $ g.Store_Table_Prefix $ 'Items i,
								' $ g.Store_Table_Prefix $ 'ItemVersions iv
							  	LEFT OUTER JOIN Modules m ON ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'm.code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'iv.mod_code' ) $ '
							  WHERE
								ibv.branch_id	= ?				AND
								ibv.item_id		= ?				AND
								ibv.head		= 1				AND
								i.id			= ibv.item_id	AND
								iv.id			= ibv.version_id' }"
				FIELDS	= "l.branch_id, l.id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00870', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ Items.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "Items">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00871' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ Item_Read( l.item ) }">

	<MvCOMMENT> Retained for Backward Compatibility </MvCOMMENT>
	<MvASSIGN NAME = "l.item:module_id"	VALUE = "{ Items.d.module_id }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Items">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Item_Load_Code" PARAMETERS = "code, item var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ Item_Load_Branch_Code( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.code, l.item ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Item_Load_Branch_Code" PARAMETERS = "branch_id, code, item var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "Items"
				QUERY	= "{ 'SELECT
								i.*,
								iv.id			AS version_id,
								iv.user_id		AS version_user_id,
								iv.code			AS version_code,
								iv.mod_code		AS version_mod_code,
								' $ [ g.Module_Library_Native_DBAPI ].DB_IFNULL( 'm.id', 0 ) $ ' AS module_id
							  FROM
								' $ g.Store_Table_Prefix $ 'ItemBranchVersions ibv,
								' $ g.Store_Table_Prefix $ 'Items i,
								' $ g.Store_Table_Prefix $ 'ItemVersions iv
							  	LEFT OUTER JOIN Modules m ON ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'm.code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'iv.mod_code' ) $ '
							  WHERE
								ibv.branch_id	= ?				AND
								ibv.head		= 1				AND
							  	' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'ibv.code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) $ ' AND
								i.id			= ibv.item_id	AND
								iv.id			= ibv.version_id' }"
				FIELDS	= "l.branch_id, l.code">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00872', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ Items.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "Items">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00873' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ Item_Read( l.item ) }">

	<MvCOMMENT> Retained for Backward Compatibility </MvCOMMENT>
	<MvASSIGN NAME = "l.item:module_id"	VALUE = "{ Items.d.module_id }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Items">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Item_Load_Reuse" PARAMETERS = "code, item var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ Item_Load_Branch_Reuse( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.code, l.item ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Item_Load_Branch_Reuse" PARAMETERS = "branch_id, code, item var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ Item_Load_Branch_Code( l.branch_id, l.code, l.null ) }">					<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00953' ) }">
	<MvELSEIF EXPR = "{ Item_Load_Reuse_Existing_OtherBranch( l.branch_id, l.code, l.item ) }">	<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = "{ Item_Load_Reuse_Deleted( l.code, l.item ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Item_Load_Reuse_Existing_OtherBranch" PARAMETERS = "branch_id, code, item var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_OPENVIEW_Range( 'Merchant', 'Items',
																			 'SELECT
																				i.*
																			  FROM
																				' $ g.Store_Table_Prefix $ 'ItemBranchVersions ibv,
																				' $ g.Store_Table_Prefix $ 'ItemVersions iv,
																				' $ g.Store_Table_Prefix $ 'Items i
																			  WHERE
																				ibv.head		= 1					AND
																				ibv.branch_id	<> ?				AND
																				iv.id			= ibv.version_id	AND
																				' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'iv.code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_Upper( '?' ) $ ' AND
																				i.id			= iv.item_id
																			  ORDER BY
																				iv.item_id ASC',
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.branch_id )	$ ',' $
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.code ),
																			 0, 1 ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00954', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ Items.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "Items">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00955' ) }">
	</MvIF>

	<MvASSIGN NAME = "l.item:id" VALUE = "{ Items.d.id }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Items">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Item_Load_Reuse_Deleted" PARAMETERS = "code, item var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_OPENVIEW_Range( 'Merchant', 'Items',
																			 'SELECT
																				i.*
																			  FROM
																				' $ g.Store_Table_Prefix $ 'ItemBranchVersions ibv,
																				' $ g.Store_Table_Prefix $ 'ItemChanges ic,
																				' $ g.Store_Table_Prefix $ 'ItemVersions iv,
																				' $ g.Store_Table_Prefix $ 'Items i
																			  WHERE
																				ibv.head		= 1					AND
																				ibv.version_id	= 0					AND
																				ic.branch_id	= ibv.branch_id		AND
																				ic.item_id		= ibv.item_id		AND
																				ic.new_id		= 0					AND
																				iv.id			= ic.old_id			AND
																				' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'iv.code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_Upper( '?' ) $ ' AND
																				i.id			= iv.item_id
																			  ORDER BY
																				ic.item_id ASC, ic.set_id DESC',
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.code ),
																			 0, 1 ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00956', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ Items.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "Items">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00957' ) }">
	</MvIF>

	<MvASSIGN NAME = "l.item:id" VALUE = "{ Items.d.id }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Items">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ItemList_Load_All" PARAMETERS = "items var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ItemList_Load_Branch_All( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.items ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ItemList_Load_Branch_All" PARAMETERS = "branch_id, items var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "Items"
				QUERY	= "{ 'SELECT
								i.*,
								iv.id			AS version_id,
								iv.user_id		AS version_user_id,
								iv.code			AS version_code,
								iv.mod_code		AS version_mod_code,
								' $ [ g.Module_Library_Native_DBAPI ].DB_IFNULL( 'm.id', 0 ) $ ' AS module_id
							  FROM
								' $ g.Store_Table_Prefix $ 'ItemBranchVersions ibv,
								' $ g.Store_Table_Prefix $ 'Items i,
								' $ g.Store_Table_Prefix $ 'ItemVersions iv
							  	LEFT OUTER JOIN Modules m ON ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'm.code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'iv.mod_code' ) $ '
							  WHERE
								ibv.branch_id	= ?				AND
								ibv.head		= 1				AND
								i.id			= ibv.item_id	AND
								iv.id			= ibv.version_id' }"
				FIELDS	= "l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00874', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.item_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT Items.d.EOF }">
		<MvEVAL EXPR = "{ Item_Read( l.items[ ++l.item_count ] ) }">

		<MvCOMMENT> Retained for Backward Compatibility </MvCOMMENT>
		<MvASSIGN NAME = "l.item" INDEX = "{ l.item_count }" MEMBER = "module_id" VALUE = "{ Items.d.module_id }">

		<MvSKIP NAME = "Merchant" VIEW = "Items" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Items">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00875', l.item_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ItemList_Load_Page" PARAMETERS = "page_id, items var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ItemList_Load_Branch_Page( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.page_id, l.items ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ItemList_Load_Branch_Page" PARAMETERS = "branch_id, page_id, items var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "Items"
				QUERY	= "{ 'SELECT
								i.*,
								iv.id			AS version_id,
								iv.user_id		AS version_user_id,
								iv.code			AS version_code,
								iv.mod_code		AS version_mod_code,
								' $ [ g.Module_Library_Native_DBAPI ].DB_IFNULL( 'm.id', 0 ) $ ' AS module_id
							  FROM
								' $ g.Store_Table_Prefix $ 'PageBranchVersions pbv,
								' $ g.Store_Table_Prefix $ 'PageVersions pv,
								' $ g.Store_Table_Prefix $ 'PageXItem pxi,
								' $ g.Store_Table_Prefix $ 'ItemBranchVersions ibv,
								' $ g.Store_Table_Prefix $ 'Items i,
								' $ g.Store_Table_Prefix $ 'ItemVersions iv
							  	LEFT OUTER JOIN Modules m ON ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'm.code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'iv.mod_code' ) $ '
							  WHERE
								pbv.branch_id	= ?					AND
								pbv.page_id		= ?					AND
								pbv.head		= 1					AND
								pv.id			= pbv.version_id	AND
								pxi.page_id		= pv.page_id		AND
								pxi.xref_id		= pv.xref_id		AND
								ibv.branch_id	= pbv.branch_id		AND
								ibv.item_id		= pxi.item_id		AND
								ibv.head		= 1					AND
								i.id			= ibv.item_id		AND
								iv.id			= ibv.version_id
							  ORDER BY
								iv.code' }"
				FIELDS	= "l.branch_id, l.page_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00667', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.item_count" VALUE = 0>
	<MvWHILE EXPR = "{ NOT Items.d.EOF }">
		<MvEVAL EXPR = "{ Item_Read( l.items[ ++l.item_count ] ) }">

		<MvCOMMENT> Retained for Backward Compatibility </MvCOMMENT>
		<MvASSIGN NAME = "l.item" INDEX = "{ l.item_count }" MEMBER = "module_id" VALUE = "{ Items.d.module_id }">

		<MvSKIP NAME = "Merchant" VIEW = "Items" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Items">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00668', l.item_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Item_Load_PageList" PARAMETERS = "item var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ Item_Load_Branch_PageList( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.item ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Item_Load_Branch_PageList" PARAMETERS = "branch_id, item var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.count" VALUE = "{ PageList_Load_Branch_Item( l.branch_id, l.item:id, l.page ) }">

	<MvASSIGN NAME = "l.pos" VALUE = 1>
	<MvWHILE EXPR = "{ l.pos LE l.count }">
		<MvIF EXPR = "{ len( l.pages ) }">
			<MvASSIGN NAME = "l.pages" VALUE = "{ l.pages $ ', ' $ l.page[ l.pos ]:code }">
		<MvELSE>
			<MvASSIGN NAME = "l.pages" VALUE = "{ l.page[ l.pos ]:code }">		
		</MvIF>

		<MvASSIGN NAME = "l.pos" VALUE = "{ l.pos + 1 }">
	</MvWHILE>

	<MvFUNCTIONRETURN VALUE = "{ l.pages }">
</MvFUNCTION>

<MvFUNCTION NAME = "PageList_Load_Offset_Item_All" PARAMETERS = "item_id, offset, search, searchable_fields, max, nextoffset var, pages var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00768', 'Function PageList_Load_Offset_Item_All has been deprecated' ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PageList_Load_Offset_Item_Assigned" PARAMETERS = "item_id, offset, search, searchable_fields, max, nextoffset var, pages var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00769', 'Function PageList_Load_Offset_Item_Assigned has been deprecated' ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PageList_Load_Offset_Item_Unassigned" PARAMETERS = "item_id, offset, search, searchable_fields, max, nextoffset var, pages var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00770', 'Function PageList_Load_Offset_Item_Unassigned has been deprecated' ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Item_Load_Module" PARAMETERS = "module_id, item var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00800', 'Function Item_Load_Module has been deprecated' ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ItemList_Load_Module" PARAMETERS = "module_id, items var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ItemList_Load_Branch_Module( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.module_id, l.items ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ItemList_Load_Branch_Module" PARAMETERS = "branch_id, module_id, items var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "Items"
				QUERY	= "{ 'SELECT
								i.*,
								iv.id			AS version_id,
								iv.user_id		AS version_user_id,
								iv.code			AS version_code,
								iv.mod_code		AS version_mod_code,
								' $ [ g.Module_Library_Native_DBAPI ].DB_IFNULL( 'm.id', 0 ) $ ' AS module_id
							  FROM
								' $ g.Store_Table_Prefix $ 'ItemBranchVersions ibv,
								' $ g.Store_Table_Prefix $ 'Items i,
								' $ g.Store_Table_Prefix $ 'ItemVersions iv,
							  	Modules m
							  WHERE
								ibv.branch_id	= ?					AND
								ibv.head		= 1					AND
								i.id			= ibv.item_id		AND
								iv.id			= ibv.version_id	AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'iv.mod_code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'm.code' ) $ ' AND
								m.id			= ?' }"
				FIELDS	= "l.branch_id, l.module_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00876', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.item_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT Items.d.EOF }">
		<MvEVAL EXPR = "{ Item_Read( l.items[ ++l.item_count ] ) }">

		<MvCOMMENT> Retained for Backward Compatibility </MvCOMMENT>
		<MvASSIGN NAME = "l.item" INDEX = "{ l.item_count }" MEMBER = "module_id" VALUE = "{ Items.d.module_id }">

		<MvSKIP NAME = "Merchant" VIEW = "Items" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Items">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00877', l.item_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ItemList_Load_Module_Code" PARAMETERS = "mod_code, items var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ItemList_Load_Branch_Module_Code( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.mod_code, l.items ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ItemList_Load_Branch_Module_Code" PARAMETERS = "branch_id, mod_code, items var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "Items"
				QUERY	= "{ 'SELECT
								i.*,
								iv.id			AS version_id,
								iv.user_id		AS version_user_id,
								iv.code			AS version_code,
								iv.mod_code		AS version_mod_code,
								' $ [ g.Module_Library_Native_DBAPI ].DB_IFNULL( 'm.id', 0 ) $ ' AS module_id
							  FROM
								' $ g.Store_Table_Prefix $ 'ItemBranchVersions ibv,
								' $ g.Store_Table_Prefix $ 'Items i,
								' $ g.Store_Table_Prefix $ 'ItemVersions iv
							  	LEFT OUTER JOIN Modules m ON ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'm.code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'iv.mod_code' ) $ '
							  WHERE
								ibv.branch_id	= ?					AND
								ibv.head		= 1					AND
								i.id			= ibv.item_id		AND
								iv.id			= ibv.version_id	AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'iv.mod_code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) }"
				FIELDS	= "l.branch_id, l.mod_code">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00878', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.item_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT Items.d.EOF }">
		<MvEVAL EXPR = "{ Item_Read( l.items[ ++l.item_count ] ) }">

		<MvCOMMENT> Retained for Backward Compatibility </MvCOMMENT>
		<MvASSIGN NAME = "l.item" INDEX = "{ l.item_count }" MEMBER = "module_id" VALUE = "{ Items.d.module_id }">

		<MvSKIP NAME = "Merchant" VIEW = "Items" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Items">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00879', l.item_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ItemList_Load_Offset" PARAMETERS = "offset, search, searchable_fields, max, nextoffset var, items var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ItemList_Load_Branch_Offset( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.offset, l.search, l.searchable_fields, l.max, l.nextoffset, l.items ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ItemList_Load_Branch_Offset" PARAMETERS = "branch_id, offset, search, searchable_fields, max, nextoffset var, items var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.query"		VALUE = "{ 'SELECT
													i.*,
													iv.id			AS version_id,
													iv.user_id		AS version_user_id,
													iv.code			AS version_code,
													iv.mod_code		AS version_mod_code,
													' $ [ g.Module_Library_Native_DBAPI ].DB_IFNULL( 'm.id', 0 ) $ ' AS module_id
												FROM
													' $ g.Store_Table_Prefix $ 'ItemBranchVersions ibv,
													' $ g.Store_Table_Prefix $ 'Items i,
													' $ g.Store_Table_Prefix $ 'ItemVersions iv
													LEFT OUTER JOIN Modules m ON ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'm.code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'iv.mod_code' ) }">

	<MvIF EXPR = "{ len( l.search ) }">
		<MvASSIGN NAME = "l.query"	VALUE = "{ l.query $ ' WHERE ' $ [ g.Module_Library_DB ].SQL_Search_Clause( l.search, 'iv', l.searchable_fields, l.fields ) }">
	</MvIF>

	<MvASSIGN NAME = "l.query"		VALUE = "{ l.query $ ' ORDER BY iv.code' }">

	<MvIF EXPR = "{ l.max EQ 0 }">	<MvASSIGN NAME = "l.limit" VALUE = 0>
	<MvELSE>						<MvASSIGN NAME = "l.limit" VALUE = "{ l.max + 1 }">
	</MvIF>

	<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_OPENVIEW_Range( 'Merchant', 'Items',
																			 l.query, l.fields,
																			 l.offset, l.limit ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00880', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.item_count" VALUE = 0>

	<MvWHILE EXPR = "{ ( NOT Items.d.EOF ) AND ( ( l.max EQ 0 ) OR ( l.item_count LT l.max ) ) }">
		<MvEVAL EXPR = "{ Item_Read( l.items[ ++l.item_count ] ) }">

		<MvCOMMENT> Retained for Backward Compatibility </MvCOMMENT>
		<MvASSIGN NAME = "l.item" INDEX = "{ l.item_count }" MEMBER = "module_id" VALUE = "{ Items.d.module_id }">

		<MvSKIP NAME = "Merchant" VIEW = "Items" ROWS = 1>
	</MvWHILE>

	<MvIF EXPR = "{ Items.d.EOF }">
		<MvASSIGN NAME = "l.nextoffset"	VALUE = 0>
	<MvELSE>
		<MvASSIGN NAME = "l.nextoffset"	VALUE = "{ l.offset + l.item_count }">
	</MvIF>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Items">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00881', l.item_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ItemList_Load_Codes_Cached" PARAMETERS = "items var" STANDARDOUTPUTLEVEL = "">
	<MvREFERENCE NAME = "l.cache"						VARIABLE = "g.Session:cache:itemlist_load_codes_cached">

	<MvIF EXPR = "{ ISNULL l.cache:result }">
		<MvASSIGN NAME = "l.cache:result"				VALUE = "{ ItemList_Load_Codes( l.cache:items ) }">

		<MvIF EXPR = "{ NOT l.cache:result }">
			<MvASSIGN NAME = "l.cache:error_code"		VALUE = "{ g.Error_Code }">
			<MvASSIGN NAME = "l.cache:error_message"	VALUE = "{ g.Error_Message }">
			<MvASSIGN NAME = "l.cache:error_db_eof"		VALUE = "{ g.Error_DB_EOF }">
		</MvIF>
	</MvIF>

	<MvIF EXPR = "{ NOT l.cache:result }">
		<MvIF EXPR = "{ l.cache:error_db_eof }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( l.cache:error_code ) }">
		</MvIF>

		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( l.cache:error_code, l.cache:error_message ) }">
	</MvIF>

	<MvASSIGN NAME = "l.items"	VALUE = "{ l.cache:items }">

	<MvFUNCTIONRETURN VALUE = "{ l.cache:result }">
</MvFUNCTION>

<MvFUNCTION NAME = "ItemList_Load_Codes" PARAMETERS = "items var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ItemList_Load_Branch_Codes( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.items ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ItemList_Load_Branch_Codes" PARAMETERS = "branch_id, items var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "Items"
				QUERY	= "{ 'SELECT
								iv.code
							  FROM
								' $ g.Store_Table_Prefix $ 'ItemBranchVersions ibv,
								' $ g.Store_Table_Prefix $ 'Items i,
								' $ g.Store_Table_Prefix $ 'ItemVersions iv
							  WHERE
								ibv.branch_id	= ?					AND
								ibv.head		= 1					AND
								i.id			= ibv.item_id		AND
								iv.id			= ibv.version_id' }"
				FIELDS	= "l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00882', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.item_count" VALUE = 0>
	<MvWHILE EXPR = "{ NOT Items.d.EOF }">
		<MvASSIGN NAME = "l.items" INDEX = "{ ++l.item_count }"	VALUE = "{ Items.d.code }">

		<MvSKIP NAME = "Merchant" VIEW = "Items" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Items">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00883', l.item_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ItemCount_Load_Module" PARAMETERS = "module_id, count var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ItemCount_Load_Branch_Module( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.module_id, l.count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ItemCount_Load_Branch_Module" PARAMETERS = "branch_id, module_id, count var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "Items"
				QUERY	= "{ 'SELECT
								COUNT( * ) AS total_count
							  FROM
								' $ g.Store_Table_Prefix $ 'ItemBranchVersions ibv,
								' $ g.Store_Table_Prefix $ 'Items i,
								' $ g.Store_Table_Prefix $ 'ItemVersions iv,
							  	Modules m
							  WHERE
								ibv.branch_id	= ?					AND
								ibv.head		= 1					AND
								i.id			= ibv.item_id		AND
								iv.id			= ibv.version_id	AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'iv.mod_code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'm.code' ) $ ' AND
								m.id			= ?' }"
				FIELDS	= "l.branch_id, l.module_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00960', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ Items.d.EOF }">	<MvASSIGN NAME = "l.count" VALUE = 0>
	<MvELSE>						<MvASSIGN NAME = "l.count" VALUE = "{ Items.d.total_count }">
	</MvIF>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Items">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ItemModuleList_Load_Page" PARAMETERS = "page_id, modules var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ItemModuleList_Load_Branch_Page( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.page_id, l.modules ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ItemModuleList_Load_Branch_Page" PARAMETERS = "branch_id, page_id, modules var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "Modules"
				QUERY	= "{ 'SELECT
								i.id	AS item_id,
								iv.code	AS item_code,
								m.*
							  FROM
								' $ g.Store_Table_Prefix $ 'PageBranchVersions pbv,
								' $ g.Store_Table_Prefix $ 'PageVersions pv,
								' $ g.Store_Table_Prefix $ 'PageXItem pxi,
								' $ g.Store_Table_Prefix $ 'ItemBranchVersions ibv,
								' $ g.Store_Table_Prefix $ 'Items i,
								' $ g.Store_Table_Prefix $ 'ItemVersions iv,
								Modules m
							  WHERE
								pbv.branch_id	= ?					AND
								pbv.page_id		= ?					AND
								pbv.head		= 1					AND
								pv.id			= pbv.version_id	AND
								pxi.page_id		= pv.page_id		AND
								pxi.xref_id		= pv.xref_id		AND
								ibv.branch_id	= pbv.branch_id		AND
								ibv.item_id		= pxi.item_id		AND
								ibv.head		= 1					AND
								i.id			= ibv.item_id		AND
								iv.id			= ibv.version_id	AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'm.code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'iv.mod_code' ) $ '
							  ORDER BY
								iv.code' }"
				FIELDS	= "l.branch_id, l.page_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00037', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.module_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT Modules.d.EOF }">
		<MvEVAL EXPR = "{ [ g.Module_Library_DB ].Module_Read( l.modules[ ++l.module_count ] ) }">

		<MvASSIGN NAME = "l.modules" INDEX = "{ l.module_count }" MEMBER = "item_id"	VALUE = "{ Modules.d.item_id }">
		<MvASSIGN NAME = "l.modules" INDEX = "{ l.module_count }" MEMBER = "item_code"	VALUE = "{ Modules.d.item_code }">

		<MvSKIP NAME = "Merchant" VIEW = "Modules" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Modules">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00118', l.module_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ItemModuleList_Load_Page_Active" PARAMETERS = "page_id, modules var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ItemModuleList_Load_Branch_Page_Active( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.page_id, l.modules ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ItemModuleList_Load_Branch_Page_Active" PARAMETERS = "branch_id, page_id, modules var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "Modules"
				QUERY	= "{ 'SELECT
								i.id	AS item_id,
								iv.code	AS item_code,
								m.*
							  FROM
								' $ g.Store_Table_Prefix $ 'PageBranchVersions pbv,
								' $ g.Store_Table_Prefix $ 'PageVersions pv,
								' $ g.Store_Table_Prefix $ 'PageXItem pxi,
								' $ g.Store_Table_Prefix $ 'ItemBranchVersions ibv,
								' $ g.Store_Table_Prefix $ 'Items i,
								' $ g.Store_Table_Prefix $ 'ItemVersions iv,
								Modules m,
								' $ g.Store_Table_Prefix $ 'StoreModules sm
							  WHERE
								pbv.branch_id	= ?					AND
								pbv.page_id		= ?					AND
								pbv.head		= 1					AND
								pv.id			= pbv.version_id	AND
								pxi.page_id		= pv.page_id		AND
								pxi.xref_id		= pv.xref_id		AND
								ibv.branch_id	= pbv.branch_id		AND
								ibv.item_id		= pxi.item_id		AND
								ibv.head		= 1					AND
								i.id			= ibv.item_id		AND
								iv.id			= ibv.version_id	AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'm.code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'iv.mod_code' ) $ ' AND
								m.active		= 1					AND
								sm.module_id	= m.id				AND
								sm.feature		= \'component\'
							  ORDER BY
								iv.code' }"
				FIELDS	= "l.branch_id, l.page_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00139', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.module_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT Modules.d.EOF }">
		<MvEVAL EXPR = "{ [ g.Module_Library_DB ].Module_Read( l.modules[ ++l.module_count ] ) }">

		<MvASSIGN NAME = "l.modules" INDEX = "{ l.module_count }" MEMBER = "item_id"	VALUE = "{ Modules.d.item_id }">
		<MvASSIGN NAME = "l.modules" INDEX = "{ l.module_count }" MEMBER = "item_code"	VALUE = "{ Modules.d.item_code }">

		<MvSKIP NAME = "Merchant" VIEW = "Modules" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Modules">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00140', l.module_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ItemModuleList_Load_Page_Render" PARAMETERS = "page_id, items var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ItemModuleList_Load_Branch_Page_Render( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.page_id, l.items ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ItemModuleList_Load_Branch_Page_Render" PARAMETERS = "branch_id, page_id, items var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "Modules"
				QUERY	= "{ 'SELECT
								i.id	AS item_id,
								iv.code	AS item_code,
								m.*
							  FROM
								' $ g.Store_Table_Prefix $ 'PageBranchVersions pbv,
								' $ g.Store_Table_Prefix $ 'PageVersions pv,
								' $ g.Store_Table_Prefix $ 'PageXItem pxi,
								' $ g.Store_Table_Prefix $ 'ItemBranchVersions ibv,
								' $ g.Store_Table_Prefix $ 'Items i,
								' $ g.Store_Table_Prefix $ 'ItemVersions iv,
								Modules m,
								' $ g.Store_Table_Prefix $ 'StoreModules sm
							  WHERE
								pbv.branch_id	= ?					AND
								pbv.page_id		= ?					AND
								pbv.head		= 1					AND
								pv.id			= pbv.version_id	AND
								pxi.page_id		= pv.page_id		AND
								pxi.xref_id		= pv.xref_id		AND
								ibv.branch_id	= pbv.branch_id		AND
								ibv.item_id		= pxi.item_id		AND
								ibv.head		= 1					AND
								i.id			= ibv.item_id		AND
								iv.id			= ibv.version_id	AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'm.code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'iv.mod_code' ) $ ' AND
								m.active		= 1					AND
								sm.module_id	= m.id				AND
								sm.feature		= \'component\'
							  ORDER BY
								item_code' }"
				FIELDS	= "l.branch_id, l.page_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00038', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.item_count" VALUE = 0>
	<MvWHILE EXPR = "{ NOT Modules.d.EOF }">
		<MvASSIGN NAME = "l.item_count"			VALUE = "{ l.item_count + 1 }">

		<MvREFERENCE NAME = "l.item"											VARIABLE = "{ 'l.items:items[' $ l.item_count $ ']' }">
		<MvREFERENCE NAME = "l.items:lookup" MEMBER = "{ Modules.d.item_code }"	VARIABLE = "{ 'l.items:items[' $ l.item_count $ ']' }">

		<MvASSIGN NAME = "l.item:item_id"		VALUE = "{ Modules.d.item_id }">
		<MvASSIGN NAME = "l.item:item_code"		VALUE = "{ Modules.d.item_code }">

		<MvEVAL EXPR = "{ [ g.Module_Library_DB ].Module_Read( l.item:module ) }">

		<MvSKIP NAME = "Merchant" VIEW = "Modules" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Modules">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00119', l.item_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ItemModuleList_Load_Fragment_Render" PARAMETERS = "page_id, items var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ItemModuleList_Load_Branch_Fragment_Render( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.page_id, l.items ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ItemModuleList_Load_Branch_Fragment_Render" PARAMETERS = "branch_id, page_id, items var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "Modules"
				QUERY	= "{ 'SELECT
								i.id	AS item_id,
								iv.code	AS item_code,
								m.*
							  FROM
								' $ g.Store_Table_Prefix $ 'PageBranchVersions pbv,
								' $ g.Store_Table_Prefix $ 'PageVersions pv,
								' $ g.Store_Table_Prefix $ 'PageXItem pxi,
								' $ g.Store_Table_Prefix $ 'ItemBranchVersions ibv,
								' $ g.Store_Table_Prefix $ 'Items i,
								' $ g.Store_Table_Prefix $ 'ItemVersions iv,
								Modules m,
								ModuleXFeature mxf,
								' $ g.Store_Table_Prefix $ 'StoreModules sm
							  WHERE
								pbv.branch_id	= ?						AND
								pbv.page_id		= ?						AND
								pbv.head		= 1						AND
								pv.id			= pbv.version_id		AND
								pxi.page_id		= pv.page_id			AND
								pxi.xref_id		= pv.xref_id			AND
								ibv.branch_id	= pbv.branch_id			AND
								ibv.item_id		= pxi.item_id			AND
								ibv.head		= 1						AND
								i.id			= ibv.item_id			AND
								iv.id			= ibv.version_id		AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'm.code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'iv.mod_code' ) $ ' AND
								m.active		= 1						AND
								mxf.module_id	= m.id					AND
								mxf.feature		= \'component_frag\'	AND
								sm.module_id	= m.id					AND
								sm.feature		= \'component\'
							  ORDER BY
								item_code' }"
				FIELDS	= "l.branch_id, l.page_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00964', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.item_count" VALUE = 0>
	<MvWHILE EXPR = "{ NOT Modules.d.EOF }">
		<MvASSIGN NAME = "l.item_count"			VALUE = "{ l.item_count + 1 }">

		<MvREFERENCE NAME = "l.item"											VARIABLE = "{ 'l.items:items[' $ l.item_count $ ']' }">
		<MvREFERENCE NAME = "l.items:lookup" MEMBER = "{ Modules.d.item_code }"	VARIABLE = "{ 'l.items:items[' $ l.item_count $ ']' }">

		<MvASSIGN NAME = "l.item:item_id"		VALUE = "{ Modules.d.item_id }">
		<MvASSIGN NAME = "l.item:item_code"		VALUE = "{ Modules.d.item_code }">

		<MvEVAL EXPR = "{ [ g.Module_Library_DB ].Module_Read( l.item:module ) }">

		<MvSKIP NAME = "Merchant" VIEW = "Modules" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Modules">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00965', l.item_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ItemExtensionModuleList_Load_Page_Render" PARAMETERS = "page_id, items var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ItemExtensionModuleList_Load_Branch_Page_Render( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.page_id, l.items ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ItemExtensionModuleList_Load_Branch_Page_Render" PARAMETERS = "branch_id, page_id, items var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "Modules"
				QUERY	= "{ 'SELECT
								iv.code AS item_code,
								m.*
							  FROM
								' $ g.Store_Table_Prefix $ 'PageBranchVersions pbv,
								' $ g.Store_Table_Prefix $ 'PageVersions pv,
								' $ g.Store_Table_Prefix $ 'PageXItem pxi,
								' $ g.Store_Table_Prefix $ 'ItemBranchVersions ibv,
								' $ g.Store_Table_Prefix $ 'Items i,
								' $ g.Store_Table_Prefix $ 'ItemVersions iv,
								' $ g.Store_Table_Prefix $ 'ItemExtensions ie,
								Modules m,
								' $ g.Store_Table_Prefix $ 'StoreModules sm
							  WHERE
								pbv.branch_id	= ?					AND
								pbv.page_id		= ?					AND
								pbv.head		= 1					AND
								pv.id			= pbv.version_id	AND
								pxi.page_id		= pv.page_id		AND
								pxi.xref_id		= pv.xref_id		AND
								ibv.branch_id	= pbv.branch_id		AND
								ibv.item_id		= pxi.item_id		AND
								ibv.head		= 1					AND
								i.id			= ibv.item_id		AND
								iv.id			= ibv.version_id	AND
								ie.item_id		= iv.item_id		AND
								ie.version_id	= iv.id				AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'm.code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'ie.mod_code' ) $ ' AND
								m.active		= 1					AND
								sm.module_id	= m.id				AND
								sm.feature		= \'component\'
							  ORDER BY
								ie.item_id, ie.initord' }"
				FIELDS	= "l.branch_id, l.page_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00039', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.last_item"						VALUE = "">
	<MvASSIGN NAME = "l.item_extension_count"			VALUE = 0>

	<MvWHILE EXPR = "{ NOT Modules.d.EOF }">
		<MvIF EXPR = "{ l.last_item NE Modules.d.item_code }">
			<MvASSIGN NAME = "l.last_item"				VALUE = "{ Modules.d.item_code }">
			<MvASSIGN NAME = "l.item_extension_count"	VALUE = 0>

			<MvREFERENCE NAME = "l.item"	VARIABLE = "{ 'l.items:lookup:' $ l.last_item }">
		</MvIF>

		<MvEVAL EXPR = "{ [ g.Module_Library_DB ].Module_Read( l.item:extensions[ ++l.item_extension_count ] ) }">

		<MvSKIP NAME = "Merchant" VIEW = "Modules" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Modules">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ItemExtensionModuleList_Load_Fragment_Render" PARAMETERS = "page_id, items var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ItemExtensionModuleList_Load_Branch_Fragment_Render( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.page_id, l.items ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ItemExtensionModuleList_Load_Branch_Fragment_Render" PARAMETERS = "branch_id, page_id, items var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "Modules"
				QUERY	= "{ 'SELECT
								iv.code AS item_code,
								m.*
							  FROM
								' $ g.Store_Table_Prefix $ 'PageBranchVersions pbv,
								' $ g.Store_Table_Prefix $ 'PageVersions pv,
								' $ g.Store_Table_Prefix $ 'PageXItem pxi,
								' $ g.Store_Table_Prefix $ 'ItemBranchVersions ibv,
								' $ g.Store_Table_Prefix $ 'Items i,
								' $ g.Store_Table_Prefix $ 'ItemVersions iv,
								' $ g.Store_Table_Prefix $ 'ItemExtensions ie,
								Modules m,
								ModuleXFeature mxf,
								' $ g.Store_Table_Prefix $ 'StoreModules sm
							  WHERE
								pbv.branch_id	= ?						AND
								pbv.page_id		= ?						AND
								pbv.head		= 1						AND
								pv.id			= pbv.version_id		AND
								pxi.page_id		= pv.page_id			AND
								pxi.xref_id		= pv.xref_id			AND
								ibv.branch_id	= pbv.branch_id			AND
								ibv.item_id		= pxi.item_id			AND
								ibv.head		= 1						AND
								i.id			= ibv.item_id			AND
								iv.id			= ibv.version_id		AND
								ie.item_id		= iv.item_id			AND
								ie.version_id	= iv.id					AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'm.code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'ie.mod_code' ) $ ' AND
								m.active		= 1						AND
								mxf.module_id	= m.id					AND
								mxf.feature		= \'component_frag\'	AND
								sm.module_id	= m.id					AND
								sm.feature		= \'component\'
							  ORDER BY
								ie.item_id, ie.initord' }"
				FIELDS	= "l.branch_id, l.page_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00966', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.last_item"						VALUE = "">
	<MvASSIGN NAME = "l.item_extension_count"			VALUE = 0>

	<MvWHILE EXPR = "{ NOT Modules.d.EOF }">
		<MvIF EXPR = "{ l.last_item NE Modules.d.item_code }">
			<MvASSIGN NAME = "l.last_item"				VALUE = "{ Modules.d.item_code }">
			<MvASSIGN NAME = "l.item_extension_count"	VALUE = 0>

			<MvREFERENCE NAME = "l.item"	VARIABLE = "{ 'l.items:lookup:' $ l.last_item }">
		</MvIF>

		<MvEVAL EXPR = "{ [ g.Module_Library_DB ].Module_Read( l.item:extensions[ ++l.item_extension_count ] ) }">

		<MvSKIP NAME = "Merchant" VIEW = "Modules" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Modules">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ItemModuleList_Load_Page_Store" PARAMETERS = "page_id, modules var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ItemModuleList_Load_Branch_Page_Store( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.page_id, l.modules ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ItemModuleList_Load_Branch_Page_Store" PARAMETERS = "branch_id, page_id, modules var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "Modules"
				QUERY	= "{ 'SELECT DISTINCT
								m.*
							  FROM
								' $ g.Store_Table_Prefix $ 'PageBranchVersions pbv,
								' $ g.Store_Table_Prefix $ 'PageVersions pv,
								' $ g.Store_Table_Prefix $ 'PageXItem pxi,
								' $ g.Store_Table_Prefix $ 'ItemBranchVersions ibv,
								' $ g.Store_Table_Prefix $ 'Items i,
								' $ g.Store_Table_Prefix $ 'ItemVersions iv,
								Modules m,
								ModuleXFeature mxf
							  WHERE
								pbv.branch_id	= ?					AND
								pbv.page_id		= ?					AND
								pbv.head		= 1					AND
								pv.id			= pbv.version_id	AND
								pxi.page_id		= pv.page_id		AND
								pxi.xref_id		= pv.xref_id		AND
								ibv.branch_id	= pbv.branch_id		AND
								ibv.item_id		= pxi.item_id		AND
								ibv.head		= 1					AND
								i.id			= ibv.item_id		AND
								iv.id			= ibv.version_id	AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'm.code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'iv.mod_code' ) $ ' AND
								mxf.module_id	= m.id				AND
								mxf.feature		= \'vis_store\'' }"
				FIELDS	= "l.branch_id, l.page_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00040', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.module_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT Modules.d.EOF }">
		<MvEVAL EXPR = "{ [ g.Module_Library_DB ].Module_Read( l.modules[ ++l.module_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "Modules" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Modules">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00121', l.module_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ItemModuleList_Load_Page_Store_Active" PARAMETERS = "page_id, modules var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ItemModuleList_Load_Branch_Page_Store_Active( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.page_id, l.modules ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ItemModuleList_Load_Branch_Page_Store_Active" PARAMETERS = "branch_id, page_id, modules var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "Modules"
				QUERY	= "{ 'SELECT DISTINCT
								m.*
							  FROM
								' $ g.Store_Table_Prefix $ 'PageBranchVersions pbv,
								' $ g.Store_Table_Prefix $ 'PageVersions pv,
								' $ g.Store_Table_Prefix $ 'PageXItem pxi,
								' $ g.Store_Table_Prefix $ 'ItemBranchVersions ibv,
								' $ g.Store_Table_Prefix $ 'Items i,
								' $ g.Store_Table_Prefix $ 'ItemVersions iv,
								Modules m,
								ModuleXFeature mxf,
								' $ g.Store_Table_Prefix $ 'StoreModules sm
							  WHERE
								pbv.branch_id	= ?					AND
								pbv.page_id		= ?					AND
								pbv.head		= 1					AND
								pv.id			= pbv.version_id	AND
								pxi.page_id		= pv.page_id		AND
								pxi.xref_id		= pv.xref_id		AND
								ibv.branch_id	= pbv.branch_id		AND
								ibv.item_id		= pxi.item_id		AND
								ibv.head		= 1					AND
								i.id			= ibv.item_id		AND
								iv.id			= ibv.version_id	AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'm.code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'iv.mod_code' ) $ ' AND
								m.active		= 1					AND
								mxf.module_id	= m.id				AND
								mxf.feature		= \'vis_store\'		AND
								sm.module_id	= m.id				AND
								sm.feature		= \'component\'' }"
				FIELDS	= "l.branch_id, l.page_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00141', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.module_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT Modules.d.EOF }">
		<MvEVAL EXPR = "{ [ g.Module_Library_DB ].Module_Read( l.modules[ ++l.module_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "Modules" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Modules">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00142', l.module_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Item_Fork_Extensions" PARAMETERS = "item var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.branch_id"				VALUE = "{ [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID() }">
	<MvASSIGN NAME = "l.itemversion"			VALUE = "">
	<MvASSIGN NAME = "l.previous_version_id"	VALUE = "{ l.item:version_id }">

	<MvEVAL EXPR = "{ ItemVersion_Copy_Item( l.item, l.itemversion ) }">

	<MvASSIGN NAME = "l.itemversion:user_id"	VALUE = "{ int( g.User:id ) }">

	<MvIF EXPR = "{ NOT ItemVersion_Insert( l.itemversion ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvEVAL EXPR = "{ Item_Copy_ItemVersion( l.itemversion, l.item ) }">

	<MvIF EXPR = "{ NOT ItemBranchVersion_Insert( l.branch_id, l.item:id, l.itemversion:id ) OR
					NOT ItemBranchVersion_Update_Head( l.branch_id, l.item:id, l.itemversion:id ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ NOT ItemExtension_Fork( l.item:id, l.previous_version_id, l.item:version_id ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ NOT [ g.Feature_Filename_TUI_MGR ].TemplateManager_Changeset_Record_ItemVersion( l.item:id, l.previous_version_id, l.itemversion:id, 'Item \'' $ l.item:code $ '\' updated' ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_ItemVersions
|
</MvCOMMENT>

<MvFUNCTION NAME = "ItemVersion_Read" PARAMETERS = "itemversion var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.itemversion:id"			VALUE = "{ ItemVersions.d.id }">
	<MvASSIGN NAME = "l.itemversion:item_id"	VALUE = "{ ItemVersions.d.item_id }">
	<MvASSIGN NAME = "l.itemversion:user_id"	VALUE = "{ ItemVersions.d.user_id }">
	<MvASSIGN NAME = "l.itemversion:code"		VALUE = "{ ItemVersions.d.code }">
	<MvASSIGN NAME = "l.itemversion:mod_code"	VALUE = "{ ItemVersions.d.mod_code }">
</MvFUNCTION>

<MvFUNCTION NAME = "ItemVersion_Copy_Item" PARAMETERS = "item var, itemversion var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.itemversion:id"			VALUE = "{ l.item:version_id }">
	<MvASSIGN NAME = "l.itemversion:item_id"	VALUE = "{ l.item:id }">
	<MvASSIGN NAME = "l.itemversion:code"		VALUE = "{ l.item:code }">
	<MvASSIGN NAME = "l.itemversion:mod_code"	VALUE = "{ l.item:mod_code }">
</MvFUNCTION>

<MvFUNCTION NAME = "ItemVersion_Insert" PARAMETERS = "itemversion var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.itemversion:id"				VALUE = "{ [ g.Module_Library_DB ].StoreKey_Generate( 'ItemVersions' ) }">

	<MvIF EXPR = "{ ISNULL l.itemversion:user_id }">
		<MvASSIGN NAME = "l.itemversion:user_id"	VALUE = 0>
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'ItemVersions
					      ( id, item_id, user_id, code, mod_code )
						  VALUES
						  ( ?, ?, ?, ?, ? )' }"
			 FIELDS	= "l.itemversion:id, l.itemversion:item_id, l.itemversion:user_id, l.itemversion:code, l.itemversion:mod_code">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00884', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ItemVersion_Delete_All_Item" PARAMETERS = "item_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ItemVersions WHERE item_id = ?' }"
			 FIELDS	= "l.item_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00885', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ItemVersion_Delete_All_Orphaned_Items" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ItemVersions
			 			  WHERE item_id NOT IN ( SELECT DISTINCT item_id FROM ' $ g.Store_Table_Prefix $ 'ItemBranchVersions )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00886', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ItemVersion_Load_ID" PARAMETERS = "id, itemversion var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ItemVersions"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'ItemVersions WHERE id = ?' }"
				FIELDS 	= "l.id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00887', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ ItemVersions.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "ItemVersions">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00888' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ ItemVersion_Read( l.itemversion ) }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ItemVersions">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ItemVersion_Load_Item_Current" PARAMETERS = "item_id, managedtemplateversion var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ItemVersion_Load_Branch_Head( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.item_id, l.managedtemplateversion ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ItemVersion_Load_Branch_Head" PARAMETERS = "branch_id, item_id, itemversion var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ItemVersions"
				QUERY	= "{ 'SELECT
								iv.*
							  FROM ' $
								g.Store_Table_Prefix $ 'ItemBranchVersions ibv, ' $
								g.Store_Table_Prefix $ 'ItemVersions iv
							  WHERE
								ibv.branch_id	= ?				AND
								ibv.item_id		= ?				AND
								ibv.head		= 1				AND
								iv.id			= ibv.version_id' }"
				FIELDS	= "l.branch_id, l.item_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00889', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ ItemVersions.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "ItemVersions">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00890' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ ItemVersion_Read( l.itemversion ) }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ItemVersions">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_ItemBranchVersions
|
</MvCOMMENT>

<MvFUNCTION NAME = "ItemBranchVersion_Read" PARAMETERS = "itembranchversion var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.itembranchversion:branch_id"	VALUE = "{ ItemBranchVersions.d.branch_id }">
	<MvASSIGN NAME = "l.itembranchversion:item_id"		VALUE = "{ ItemBranchVersions.d.item_id }">
	<MvASSIGN NAME = "l.itembranchversion:version_id"	VALUE = "{ ItemBranchVersions.d.version_id }">
	<MvASSIGN NAME = "l.itembranchversion:code"			VALUE = "{ ItemBranchVersions.d.code }">
	<MvASSIGN NAME = "l.itembranchversion:head"			VALUE = "{ ItemBranchVersions.d.head }">
</MvFUNCTION>

<MvFUNCTION NAME = "ItemBranchVersion_Insert" PARAMETERS = "branch_id, item_id, version_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.version_id EQ 0 }">
		<MvQUERY NAME   = "Merchant"
				 QUERY  = "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'ItemBranchVersions
							  ( branch_id, item_id, version_id, code, head )
							  VALUES
							  ( ?, ?, ?, \'\', 0 )' }"
				 FIELDS = "l.branch_id, l.item_id, l.version_id">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00891', g.MvQUERY_Error ) }">
		</MvIF>
	<MvELSE>
		<MvQUERY NAME   = "Merchant"
				 QUERY  = "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'ItemBranchVersions
							  ( branch_id, item_id, version_id, code, head )
							  SELECT
								?, ?, id, code, 0
							  FROM
								' $ g.Store_Table_Prefix $ 'ItemVersions
							  WHERE
								id = ?' }"
				 FIELDS = "l.branch_id, l.item_id,
				 		   l.version_id">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00892', g.MvQUERY_Error ) }">
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ItemBranchVersion_Update_Head" PARAMETERS = "branch_id, item_id, version_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'ItemBranchVersions
						  SET
							head		= 1
						  WHERE
							branch_id	= ? AND
							item_id		= ? AND
							version_id	= ?' }"
			 FIELDS	= "l.branch_id, l.item_id, l.version_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00893', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'ItemBranchVersions
						  SET
							head		= 0
						  WHERE
							branch_id	= ? AND
							item_id		= ? AND
							version_id	<> ?' }"
			 FIELDS	= "l.branch_id, l.item_id, l.version_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00894', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ItemBranchVersion_Delete_All_Item" PARAMETERS = "item_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ItemBranchVersions WHERE item_id = ?' }"
			 FIELDS	= "l.item_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00895', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ItemBranchVersion_Load" PARAMETERS = "branch_id, item_id, version_id, itembranchversion var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ItemBranchVersions"
				QUERY	= "{ 'SELECT
								*
							  FROM
							  	' $ g.Store_Table_Prefix $ 'ItemBranchVersions
							  WHERE
							  	branch_id	= ? AND
							  	item_id		= ? AND
							  	version_id	= ?' }"
				FIELDS	= "l.branch_id, l.item_id, l.version_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00896', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ ItemBranchVersions.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "ItemBranchVersions">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00897' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ ItemBranchVersion_Read( l.itembranchversion ) }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ItemBranchVersions">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ItemBranchVersion_Load_Branch_Head" PARAMETERS = "branch_id, item_id, itembranchversion var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ItemBranchVersions"
				QUERY	= "{ 'SELECT
								*
							  FROM
							  	' $ g.Store_Table_Prefix $ 'ItemBranchVersions
							  WHERE
							  	branch_id	= ? AND
							  	item_id		= ? AND
							  	head		= 1' }"
				FIELDS	= "l.branch_id, l.item_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00898', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ ItemBranchVersions.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "ItemBranchVersions">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00899' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ ItemBranchVersion_Read( l.itembranchversion ) }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ItemBranchVersions">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ItemBranchVersion_Load_Code_Branch_Head" PARAMETERS = "branch_id, code, itembranchversion var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ItemBranchVersions"
				QUERY	= "{ 'SELECT
								*
							  FROM
							  	' $ g.Store_Table_Prefix $ 'ItemBranchVersions
							  WHERE
							  	branch_id	= ? AND
							  	head		= 1 AND
							  	' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) }"
				FIELDS	= "l.branch_id, l.code">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00900', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ ItemBranchVersions.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "ItemBranchVersions">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00901' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ ItemBranchVersion_Read( l.itembranchversion ) }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ItemBranchVersions">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ItemBranchVersion_Delete_All_Branch" PARAMETERS = "branch_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ItemBranchVersions WHERE branch_id = ?' }"
			 FIELDS	= "l.branch_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00904', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_ItemChanges
|
</MvCOMMENT>

<MvFUNCTION NAME = "ItemChange_InsertOrUpdate" PARAMETERS = "branch_id, set_id, item_id, old_id, new_id" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ ItemChange_Insert( l.branch_id, l.set_id, l.item_id, l.old_id, l.new_id,  ) }">				<MvFUNCTIONRETURN VALUE = 1>
	<MvELSEIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_Error_IsIndexDuplicate( g.Error_Message ) }">	<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = "{ ItemChange_Update_New( l.branch_id, l.set_id, l.item_id, l.new_id,  ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ItemChange_Insert" PARAMETERS = "branch_id, set_id, item_id, old_id, new_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'ItemChanges
					      ( branch_id, set_id, item_id, old_id, new_id )
						  VALUES
						  ( ?, ?, ?, ?, ? )' }"
			 FIELDS	= "l.branch_id, l.set_id, l.item_id, l.old_id, l.new_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00905', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ItemChange_Update_New" PARAMETERS = "branch_id, set_id, item_id, new_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'ItemChanges
						  SET
							new_id		= ?
						  WHERE
							branch_id	= ?	AND
							set_id		= ? AND
							item_id		= ?' }"
			 FIELDS	= "l.new_id,
					   l.branch_id, l.set_id, l.item_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00906', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ItemChange_Delete_All_Changeset" PARAMETERS = "set_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ItemChanges WHERE set_id = ?' }"
			 FIELDS	= "l.set_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00907', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ItemChange_Delete_All_Item" PARAMETERS = "item_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ItemChanges WHERE item_id = ?' }"
			 FIELDS	= "l.item_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00908', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_ItemExtensions
|
</MvCOMMENT>

<MvFUNCTION NAME = "ItemExtension_Read" PARAMETERS = "itemextension var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.itemextension:item_id"		VALUE = "{ ItemExtensions.d.item_id }">
	<MvASSIGN NAME = "l.itemextension:version_id"	VALUE = "{ ItemExtensions.d.version_id }">
	<MvASSIGN NAME = "l.itemextension:mod_code"		VALUE = "{ ItemExtensions.d.mod_code }">
	<MvASSIGN NAME = "l.itemextension:initord"		VALUE = "{ ItemExtensions.d.initord }">
</MvFUNCTION>

<MvFUNCTION NAME = "ItemExtension_Insert" PARAMETERS = "itemextension var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.itemextension:initord" VALUE = "{ [ g.Module_Library_DB ].StoreKey_Generate( 'ItemExtensionDisplayOrder' ) }">

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'ItemExtensions
					      ( item_id, version_id, mod_code, initord )
						  VALUES
						  ( ?, ?, ?, ? )' }"
			 FIELDS	= "l.itemextension:item_id, l.itemextension:version_id, l.itemextension:mod_code, l.itemextension:initord">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00041', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ItemExtension_Update_Order" PARAMETERS = "itemextension var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'ItemExtensions
					      SET
							initord		= ?
					      WHERE
						    item_id		= ? AND
						    version_id	= ? AND
						    ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'mod_code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) }"
			 FIELDS	= "l.itemextension:initord,
					   l.itemextension:item_id, l.itemextension:version_id, l.itemextension:mod_code">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00042', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ItemExtension_Delete_ID" PARAMETERS = "id" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00910', 'Function ItemExtension_Delete_ID has been deprecated' ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ItemExtension_Delete" PARAMETERS = "itemextension var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ItemExtensions WHERE item_id = ? AND ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'mod_code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) }"
			 FIELDS	= "l.itemextension:item_id, l.itemextension:mod_code">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00911', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ItemExtension_Delete_All_Version" PARAMETERS = "item_id, version_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ItemExtensions WHERE item_id = ? AND version_id = ?' }"
			 FIELDS	= "l.item_id, l.version_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00912', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ItemExtension_Delete_All_Item" PARAMETERS = "item_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ItemExtensions WHERE item_id = ?' }"
			 FIELDS	= "l.item_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00044', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ItemExtension_Delete_All_Module" PARAMETERS = "module_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ g.Native_DBAPI EQ 'postgresql' }">
		<MvQUERY NAME	= "Merchant"
				 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ItemExtensions ie
				 			  USING Modules m WHERE m.id = ? AND ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'ie.mod_code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'm.code' ) }"
				 FIELDS	= "l.module_id">
	<MvELSE>
		<MvQUERY NAME	= "Merchant"
				 QUERY	= "{ 'DELETE ie.* FROM ' $ g.Store_Table_Prefix $ 'ItemExtensions ie, Modules m WHERE m.id = ? AND ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'ie.mod_code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'm.code' ) }"
				 FIELDS	= "l.module_id">
	</MvIF>

	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00088', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ItemExtension_Delete_All_Module_Code" PARAMETERS = "mod_code" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ItemExtensions WHERE ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'mod_code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) }"
			 FIELDS	= "l.mod_code">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00803', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ItemExtension_Delete_All_Orphaned_Items" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ItemExtensions
			 			  WHERE item_id NOT IN ( SELECT DISTINCT item_id FROM ' $ g.Store_Table_Prefix $ 'ItemBranchVersions )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00913', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ItemExtension_Load_ID" PARAMETERS = "id, itemextension var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00914', 'Function ItemExtension_Load_ID has been deprecated' ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ItemExtension_Load_ItemModule" PARAMETERS = "item_id, module_id, itemextension var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ItemExtension_Load_Branch_ItemModule( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.item_id, l.module_id, l.itemextension ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ItemExtension_Load_Branch_ItemModule" PARAMETERS = "branch_id, item_id, module_id, itemextension var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ItemExtensions"
				QUERY	= "{ 'SELECT
								ie.*
							  FROM
							  	Modules m
							  	' $ g.Store_Table_Prefix $ 'ItemBranchVersions ibv,
							  	' $ g.Store_Table_Prefix $ 'ItemExtensions ie
							  WHERE
							  	m.id			= ?					AND
							  	ibv.branch_id	= ?					AND
							  	ibv.item_id		= ?					AND
							  	ibv.head		= 1					AND
							  	ie.item_id		= ibv.item_id		AND
							  	ie.version_id	= ibv.version_id	AND
							  	' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'ie.mod_code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'm.code' ) }"
				FIELDS	= "l.module_id, l.branch_id, l.item_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00915', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ ItemExtensions.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "ItemExtensions">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00916' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ ItemExtension_Read( l.itemextension ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ItemExtensions">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ItemExtension_Load_ItemModuleCode" PARAMETERS = "item_id, mod_code, itemextension var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ItemExtension_Load_Branch_ItemModuleCode( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.item_id, l.mod_code, l.itemextension ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ItemExtension_Load_Branch_ItemModuleCode" PARAMETERS = "branch_id, item_id, mod_code, itemextension var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ItemExtensions"
				QUERY	= "{ 'SELECT
								ie.*
							  FROM
							  	' $ g.Store_Table_Prefix $ 'ItemBranchVersions ibv,
							  	' $ g.Store_Table_Prefix $ 'ItemExtensions ie
							  WHERE
							  	ibv.branch_id	= ?					AND
							  	ibv.item_id		= ?					AND
							  	ibv.head		= 1					AND
							  	ie.item_id		= ibv.item_id		AND
							  	ie.version_id	= ibv.version_id	AND
							  	' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'ie.mod_code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) }"
				FIELDS	= "l.branch_id, l.item_id, l.mod_code">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00917', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ ItemExtensions.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "ItemExtensions">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00918' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ ItemExtension_Read( l.itemextension ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ItemExtensions">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ItemExtensionList_Load_Item" PARAMETERS = "item_id, itemextensions var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ItemExtensionList_Load_Branch_Item( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.item_id, l.itemextension ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ItemExtensionList_Load_Branch_Item" PARAMETERS = "branch_id, item_id, itemextensions var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ItemExtensions"
				QUERY	= "{ 'SELECT
								ie.*
							  FROM
							  	' $ g.Store_Table_Prefix $ 'ItemBranchVersions ibv,
							  	' $ g.Store_Table_Prefix $ 'ItemExtensions ie
							  WHERE
							  	ibv.branch_id	= ?				AND
							  	ibv.item_id		= ?				AND
							  	ibv.head		= 1				AND
							  	ie.item_id		= ibv.item_id	AND
							  	ie.version_id	= ibv.version_id
							  ORDER BY initord' }"
				FIELDS	= "l.branch_id, l.item_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00919', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.itemextension_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT ItemExtensions.d.EOF }">
		<MvEVAL EXPR = "{ ItemExtension_Read( l.itemextensions[ ++l.itemextension_count ] ) }">

		<MvSKIP NAME = "Merchant" VIEW = "ItemExtensions" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ItemExtensions">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00920', l.itemextension_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ItemExtensionList_Update_Offsets" PARAMETERS = "item, itemextensions var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ItemExtensionList_Update_Branch_Offsets( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.item, l.itemextensions ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ItemExtensionList_Update_Branch_Offsets" PARAMETERS = "branch_id, item, itemextensions var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.pastend_count"			VALUE = 0>

	<MvASSIGN NAME = "l.itemextension_pos"		VALUE = 1>
	<MvASSIGN NAME = "l.itemextension_count"	VALUE = "{ miva_array_elements( l.itemextensions ) }">

	<MvCOMMENT>
	|
	| Create a new item and fork the extensions into the new item version
	|
	</MvCOMMENT>

	<MvIF EXPR = "{ NOT Item_Fork_Extensions( l.item ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMENT>
	|
	| Process display order updates
	|
	</MvCOMMENT>

	<MvEVAL EXPR = "{ [ g.Module_Library_Utilities ].SortOffsetArray( l.itemextensions, l.itemextension_count ) }">

	<MvWHILE EXPR = "{ l.itemextension_pos LE l.itemextension_count }">
		<MvREFERENCEARRAY NAME = "l.itemextension" VARIABLE = "l.itemextensions">
			<MvDIMENSION INDEX = "{ l.itemextension_pos }">
		</MvREFERENCEARRAY>

		<MvCOMMENT>
		|
		| Determine initord of current itemextension at this offset.
		|
		</MvCOMMENT>

		<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_OPENVIEW_Range( 'Merchant',
																				 'ItemExtensions',
																				 'SELECT
																				 	initord
																				  FROM
																				  	' $ g.Store_Table_Prefix $ 'ItemExtensions ie
																				  WHERE
																				  	item_id		= ? AND
																				  	version_id	= ? AND
																				  	' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'mod_code' ) $ ' <> ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) $ '
																				  ORDER BY initord',
																				 [ g.Module_Library_DB ].SQL_Query_Field( l.item:id )			$ ', ' $
																				 [ g.Module_Library_DB ].SQL_Query_Field( l.item:version_id )	$ ', ' $
																				 [ g.Module_Library_DB ].SQL_Query_Field( l.itemextension:mod_code ),
																				 l.itemextension:offset - 1, 1 ) }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00921', g.MvOPENVIEW_Error ) }">
		</MvIF>

		<MvIF EXPR = "{ ItemExtensions.d.EOF }">
			<MvCLOSEVIEW NAME = "Merchant" VIEW = "ItemExtensions">

			<MvCOMMENT>
			|
			| Offset was higher than the last record.  This case requires specialized processing, so save this record for later.
			|
			</MvCOMMENT>

			<MvASSIGN NAME = "l.pastend" INDEX = "{ ++l.pastend_count }"	VALUE = "{ l.itemextension }">
			<MvASSIGN NAME = "l.itemextension_pos"							VALUE = "{ l.itemextension_pos + 1 }">
		<MvELSEIF EXPR = "{ l.pastend_count }">
			<MvCOMMENT>
			|
			| Process the past end records and loop back with this same itemextension so we have the correct initord
			|
			</MvCOMMENT>

			<MvCLOSEVIEW NAME = "Merchant" VIEW = "ItemExtensions">

			<MvIF EXPR = "{ NOT ItemExtensionList_Update_Offsets_PastEnd( l.item:id, l.item:version_id, l.pastend, l.pastend_count ) }">
				<MvFUNCTIONRETURN VALUE = 0>
			</MvIF>

			<MvASSIGN NAME = "l.pastend_count" VALUE = 0>
		<MvELSE>
			<MvASSIGN NAME = "l.initord" VALUE = "{ ItemExtensions.d.initord }">
			<MvCLOSEVIEW NAME = "Merchant" VIEW = "ItemExtensions">

			<MvCOMMENT>
			|
			| Make a hole by shifting itemextensions after this initord down
			|
			</MvCOMMENT>

			<MvQUERY NAME	= "Merchant"
					 QUERY	= "{ 'UPDATE '
								  	$ g.Store_Table_Prefix $ 'ItemExtensions
								  SET
								  	initord		= initord + 1
								  WHERE
								  	item_id		= ?	AND
									version_id	= ?	AND
								  	initord		>= ?' }"
					 FIELDS	= "l.item:id, l.item:version_id, l.initord">
			<MvIF EXPR = "{ g.MvQUERY_Error }">
				<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00922', g.MvQUERY_Error ) }">
			</MvIF>

			<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Library_DB ].StoreKey_Generate( 'ItemExtensionDisplayOrder' ) }">

			<MvCOMMENT>
			|
			| Put the itemextension in the newly created hole
			|
			</MvCOMMENT>

			<MvQUERY NAME	= "Merchant"
					 QUERY	= "{ 'UPDATE '
								  	$ g.Store_Table_Prefix $ 'ItemExtensions
								  SET
								  	initord		= ?
								  WHERE
									item_id		= ? AND
									version_id	= ?	AND
								  	' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'mod_code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) }"
					 FIELDS	= "l.initord, l.item:id, l.item:version_id, l.itemextension:mod_code">
			<MvIF EXPR = "{ g.MvQUERY_Error }">
				<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00923', g.MvQUERY_Error ) }">
			</MvIF>

			<MvASSIGN NAME = "l.itemextension_pos" VALUE = "{ l.itemextension_pos + 1 }">
		</MvIF>
	</MvWHILE>

	<MvCOMMENT>
	|
	| If all the downward records were past the end, they must be processed here.
	|
	</MvCOMMENT>

	<MvIF EXPR = "{ l.pastend_count }">
		<MvIF EXPR = "{ NOT ItemExtensionList_Update_Offsets_PastEnd( l.item:id, l.item:version_id, l.pastend, l.pastend_count ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ItemExtensionList_Update_Offsets_PastEnd" PARAMETERS = "item_id, version_id, pastend var, pastend_count" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvCOMMENT>
	|
	| Process records moving past the end.  These records must be sorted in ascending order.
	|
	</MvCOMMENT>

	<MvEVAL EXPR = "{ [ g.Module_Library_Utilities ].SortOffsetArray_PastEnd( l.pastend, l.pastend_count ) }">

	<MvASSIGN NAME = "l.pastend_pos"		VALUE = 1>

	<MvWHILE EXPR = "{ l.pastend_pos LE l.pastend_count }">
		<MvASSIGN NAME = "l.mod_code" 		VALUE = "{ l.pastend[ l.pastend_pos ]:mod_code }">
		<MvASSIGN NAME = "l.initord"		VALUE = "{ [ g.Module_Library_DB ].StoreKey_Generate( 'ItemExtensionDisplayOrder' ) }">

		<MvQUERY NAME	= "Merchant"
				 QUERY	= "{ 'UPDATE ' 
							  	$ g.Store_Table_Prefix $ 'ItemExtensions 
							  SET 
							  	initord		= ? 
							  WHERE 
							  	item_id		= ? AND
								version_id	= ? AND
							  	' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'mod_code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) }"
				 FIELDS	= "l.initord, l.item_id, l.version_id, l.mod_code">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00924', g.MvQUERY_Error ) }">
		</MvIF>
		
		<MvASSIGN NAME = "l.pastend_pos"	VALUE = "{ l.pastend_pos + 1 }">
	</MvWHILE>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ItemExtension_Fork" PARAMETERS = "item_id, oldver_id, newver_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'ItemExtensions
						  ( item_id, version_id, mod_code, initord )
						  SELECT item_id, ?, mod_code, initord FROM ' $ g.Store_Table_Prefix $ 'ItemExtensions WHERE item_id = ? AND version_id = ?' }"
			 FIELDS	= "l.newver_id,
					   l.item_id, l.oldver_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00925', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_PageXItem
|
</MvCOMMENT>

<MvFUNCTION NAME = "PageXItem_Read" PARAMETERS = "pagexitem var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.pagexitem:page_id"		VALUE = "{ PageXItem.d.page_id }">
	<MvASSIGN NAME = "l.pagexitem:xref_id"		VALUE = "{ PageXItem.d.xref_id }">
	<MvASSIGN NAME = "l.pagexitem:item_id"		VALUE = "{ PageXItem.d.item_id }">
</MvFUNCTION>

<MvFUNCTION NAME = "PageXItem_Insert_LowLevel" PARAMETERS = "page_id, xref_id, item_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'PageXItem
					      ( page_id, xref_id, item_id )
						  VALUES
						  ( ?, ?, ? )' }"
			 FIELDS	= "l.page_id, l.xref_id, l.item_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00048', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PageXItem_Fork" PARAMETERS = "pageversion var, new_xref_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'PageXItem
					      ( page_id, xref_id, item_id )
						  SELECT page_id, ?, item_id FROM ' $ g.Store_Table_Prefix $ 'PageXItem WHERE page_id = ? AND xref_id = ?' }"
			 FIELDS	= "l.new_xref_id,
					   l.pageversion:page_id, l.pageversion:xref_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00771', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PageXItem_Delete_LowLevel" PARAMETERS = "page_id, xref_id, item_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PageXItem
						  WHERE
							page_id	= ? AND
							xref_id	= ?	AND
							item_id	= ?' }"
			 FIELDS	= "l.page_id, l.xref_id, l.item_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00049', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PageXItem_Delete_All_Page_LowLevel" PARAMETERS = "page_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PageXItem
						  WHERE
							page_id	= ?' }"
			 FIELDS	= "l.page_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00050', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PageXItem_Delete_All_Item_LowLevel" PARAMETERS = "item_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PageXItem
						  WHERE
							item_id	= ?' }"
			 FIELDS	= "l.item_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00089', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PageXItem_Delete_All_Orphaned_Pages" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PageXItem
			 			  WHERE page_id NOT IN ( SELECT DISTINCT page_id FROM ' $ g.Store_Table_Prefix $ 'PageBranchVersions )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00825', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PageXItem_Delete_All_Orphaned_Items" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PageXItem
			 			  WHERE item_id NOT IN ( SELECT DISTINCT item_id FROM ' $ g.Store_Table_Prefix $ 'ItemBranchVersions )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00926', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PageXItem_Load" PARAMETERS = "page_id, item_id, pagexitem var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ PageXItem_Load_Branch( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.page_id, l.item_id, l.pagexitem ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PageXItem_Load_Branch" PARAMETERS = "branch_id, page_id, item_id, pagexitem var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PageXItem"
				QUERY	= "{ 'SELECT
								pxi.*
							  FROM
								' $ g.Store_Table_Prefix $ 'PageBranchVersions pbv,
								' $ g.Store_Table_Prefix $ 'PageVersions pv,
								' $ g.Store_Table_Prefix $ 'PageXItem pxi
							  WHERE
								pbv.branch_id	= ?					AND
								pbv.page_id		= ?					AND
								pbv.head		= 1					AND
								pv.id			= pbv.version_id	AND
								pxi.page_id		= pv.page_id		AND
								pxi.xref_id		= pv.xref_id		AND
								pxi.item_id		= ?' }"
				FIELDS	= "l.branch_id, l.page_id, l.item_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00051', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ PageXItem.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "PageXItem">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00125' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ PageXItem_Read( l.pagexitem ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PageXItem">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PageXItem_Load_CrossReference" PARAMETERS = "page_id, xref_id, item_id, pagexitem var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PageXItem"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'PageXItem WHERE page_id = ? AND xref_id = ? AND item_id = ?' }"
				FIELDS	= "l.page_id, l.xref_id, l.item_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00772', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ PageXItem.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "PageXItem">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00773' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ PageXItem_Read( l.pagexitem ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PageXItem">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ItemList_Load_Offset_Page_All" PARAMETERS = "page_id, offset, search, searchable_fields, max, nextoffset var, items var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00774', 'Function ItemList_Load_Offset_Page_All has been deprecated' ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ItemList_Load_Offset_Page_Assigned" PARAMETERS = "page_id, offset, search, searchable_fields, max, nextoffset var, items var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00775', 'Function ItemList_Load_Offset_Page_Assigned has been deprecated' ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ItemList_Load_Offset_Page_Unassigned" PARAMETERS = "page_id, offset, search, searchable_fields, max, nextoffset var, items var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00776', 'Function ItemList_Load_Offset_Page_Unassigned has been deprecated' ) }">
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_Branches
|
</MvCOMMENT>

<MvFUNCTION NAME = "Branch_Read" PARAMETERS = "branch var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.branch:id"			VALUE = "{ Branches.d.id }">
	<MvASSIGN NAME = "l.branch:immutable"	VALUE = "{ Branches.d.immutable }">
	<MvASSIGN NAME = "l.branch:branchkey"	VALUE = "{ Branches.d.branchkey }">
	<MvASSIGN NAME = "l.branch:name"		VALUE = "{ Branches.d.name }">
	<MvASSIGN NAME = "l.branch:color"		VALUE = "{ Branches.d.color }">
	<MvASSIGN NAME = "l.branch:framework"	VALUE = "{ Branches.d.framework }">
	<MvASSIGN NAME = "l.branch:tmpldir"		VALUE = "{ Branches.d.tmpldir }">
</MvFUNCTION>

<MvFUNCTION NAME = "Branch_Insert" PARAMETERS = "branch var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'Branches
					      ( id, immutable, branchkey, name, color, framework, tmpldir )
						  VALUES
						  ( ?, ?, ?, ?, ?, ?, ? )' }"
			 FIELDS	= "l.branch:id, l.branch:immutable, l.branch:branchkey, l.branch:name,
					   l.branch:color, l.branch:framework, l.branch:tmpldir">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00320', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Branch_Update" PARAMETERS = "branch var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'Branches
			 			  SET
			 			  	name		= ?,
			 			  	color		= ?,
							framework	= ?
			 			  WHERE
			 			  	id			= ?' }"
			 FIELDS	= "l.branch:name, l.branch:color, l.branch:framework,
					   l.branch:id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00370', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Branch_Load_ID_Cached" PARAMETERS = "id, branch var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.id"								VALUE = "{ int( l.id ) }">

	<MvIF EXPR = "{ l.id LE 0 }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00347' ) }">
	</MvIF>

	<MvREFERENCEARRAY NAME = "l.cache" 					VARIABLE = "g.Session:cache:branch_load_id_cached">
		<MvDIMENSION INDEX = "{ l.id }">
	</MvREFERENCEARRAY>

	<MvIF EXPR = "{ ISNULL l.cache:result }">
		<MvASSIGN NAME = "l.cache:result"				VALUE = "{ Branch_Load_ID( l.id, l.cache:branch ) }">

		<MvIF EXPR = "{ NOT l.cache:result }">
			<MvASSIGN NAME = "l.cache:error_code"		VALUE = "{ g.Error_Code }">
			<MvASSIGN NAME = "l.cache:error_message"	VALUE = "{ g.Error_Message }">
			<MvASSIGN NAME = "l.cache:error_db_eof"		VALUE = "{ g.Error_DB_EOF }">
		</MvIF>
	</MvIF>

	<MvIF EXPR = "{ NOT l.cache:result }">
		<MvIF EXPR = "{ l.cache:error_db_eof }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( l.cache:error_code ) }">
		</MvIF>

		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( l.cache:error_code, l.cache:error_message ) }">
	</MvIF>

	<MvASSIGN NAME = "l.branch"			VALUE = "{ l.cache:branch }">

	<MvFUNCTIONRETURN VALUE = "{ l.cache:result }">
</MvFUNCTION>

<MvFUNCTION NAME = "Branch_Load_ID" PARAMETERS = "id, branch var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "Branches"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'Branches WHERE id = ?' }"
				FIELDS	= "l.id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00322', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ Branches.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "Branches">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00336' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ Branch_Read( l.branch ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Branches">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Branch_Load_Name" PARAMETERS = "name, branch var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "Branches"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'Branches WHERE ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'name' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) }"
				FIELDS	= "l.name">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00348', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ Branches.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "Branches">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00349' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ Branch_Read( l.branch ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Branches">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Branch_Load_BranchKey_Cached" PARAMETERS = "branchkey, branch var" STANDARDOUTPUTLEVEL = "">
	<MvREFERENCEARRAY NAME = "l.cache" VARIABLE = "g.Session:cache:branch_load_branchkey_cached">
		<MvMEMBER NAME = "{ l.branchkey }">
	</MvREFERENCEARRAY>

	<MvIF EXPR = "{ ISNULL l.cache:result }">
		<MvASSIGN NAME = "l.cache:result"				VALUE = "{ Branch_Load_BranchKey( l.branchkey, l.cache:branch ) }">

		<MvIF EXPR = "{ NOT l.cache:result }">
			<MvASSIGN NAME = "l.cache:error_code"		VALUE = "{ g.Error_Code }">
			<MvASSIGN NAME = "l.cache:error_message"	VALUE = "{ g.Error_Message }">
			<MvASSIGN NAME = "l.cache:error_db_eof"		VALUE = "{ g.Error_DB_EOF }">
		</MvIF>
	</MvIF>

	<MvIF EXPR = "{ NOT l.cache:result }">
		<MvIF EXPR = "{ NOT l.cache:error_db_eof }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( l.cache:error_code, l.cache:error_message ) }">
		</MvIF>

		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( l.cache:error_code ) }">
	</MvIF>

	<MvASSIGN NAME = "l.branch"							VALUE = "{ l.cache:branch }">

	<MvFUNCTIONRETURN VALUE = "{ l.cache:result }">
</MvFUNCTION>

<MvFUNCTION NAME = "Branch_Load_BranchKey" PARAMETERS = "branchkey, branch var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "Branches"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'Branches WHERE branchkey = ?' }"
				FIELDS	= "l.branchkey">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00350', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ Branches.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "Branches">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00351' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ Branch_Read( l.branch ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Branches">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Branch_Count" PARAMETERS = "count var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "Branches"
				QUERY	= "{ 'SELECT COUNT( * ) AS branch_count FROM ' $ g.Store_Table_Prefix $ 'Branches' }">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00445', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ Branches.d.EOF }">	<MvASSIGN NAME = "l.count" VALUE = 0>
	<MvELSE>							<MvASSIGN NAME = "l.count" VALUE = "{ Branches.d.branch_count }">
	</MvIF>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Branches">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "BranchList_Load_All_Cached" PARAMETERS = "branches var" STANDARDOUTPUTLEVEL = "">
	<MvREFERENCE NAME = "l.cache"						VARIABLE = "g.Session:cache:branchlist_load_all_cached">

	<MvIF EXPR = "{ ISNULL l.cache:result }">
		<MvASSIGN NAME = "l.cache:result"				VALUE = "{ BranchList_Load_All( l.cache:branches ) }">

		<MvIF EXPR = "{ NOT l.cache:result }">
			<MvASSIGN NAME = "l.cache:error_code"		VALUE = "{ g.Error_Code }">
			<MvASSIGN NAME = "l.cache:error_message"	VALUE = "{ g.Error_Message }">
			<MvASSIGN NAME = "l.cache:error_db_eof"		VALUE = "{ g.Error_DB_EOF }">
		</MvIF>
	</MvIF>

	<MvIF EXPR = "{ NOT l.cache:result }">
		<MvIF EXPR = "{ l.cache:error_db_eof }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( l.cache:error_code ) }">
		</MvIF>

		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( l.cache:error_code, l.cache:error_message ) }">
	</MvIF>

	<MvASSIGN NAME = "l.branches"		VALUE = "{ l.cache:branches }">

	<MvFUNCTIONRETURN VALUE = "{ l.cache:result }">
</MvFUNCTION>

<MvFUNCTION NAME = "BranchList_Load_All" PARAMETERS = "branches var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "Branches"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'Branches ORDER BY id' }">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00323', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.branch_count"		VALUE = 0>
	<MvWHILE EXPR = "{ NOT Branches.d.EOF }">
		<MvEVAL EXPR = "{ Branch_Read( l.branches[ ++l.branch_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "Branches" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Branches">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00324', l.branch_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "BranchList_Load_Page_Code" PARAMETERS = "page_code, branches var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "Branches"
				QUERY	= "{ 'SELECT
								b.*
							  FROM
							  	' $ g.Store_Table_Prefix $ 'Branches b,
								' $ g.Store_Table_Prefix $ 'PageBranchVersions pbv,
								' $ g.Store_Table_Prefix $ 'PageVersions pv
							  WHERE
								pbv.branch_id	= b.id				AND
								pbv.head		= 1					AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'pbv.code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) $ ' AND
								pv.id			= pbv.version_id
							  ORDER BY
								b.id' }"
				FIELDS	= "l.page_code">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00930', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.branch_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT Branches.d.EOF }">
		<MvEVAL EXPR = "{ Branch_Read( l.branches[ ++l.branch_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "Branches" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Branches">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00931', l.branch_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "BranchList_Load_Page_Code_Admin_UI" PARAMETERS = "page_code, ui_id, branches var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "Branches"
				QUERY	= "{ 'SELECT
								b.*
							  FROM
							  	' $ g.Store_Table_Prefix $ 'Branches b,
								' $ g.Store_Table_Prefix $ 'PageBranchVersions pbv,
								' $ g.Store_Table_Prefix $ 'PageVersions pv
							  WHERE
								pbv.branch_id	= b.id				AND
								pbv.head		= 1					AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'pbv.code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) $ ' AND
								pv.id			= pbv.version_id	AND
								pv.admin		= 1					AND
								pv.ui_id		= ?
							  ORDER BY
								b.id' }"
				FIELDS	= "l.page_code, l.ui_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00937', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.branch_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT Branches.d.EOF }">
		<MvEVAL EXPR = "{ Branch_Read( l.branches[ ++l.branch_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "Branches" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Branches">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00938', l.branch_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "BranchList_Load_Item_Code" PARAMETERS = "item_code, branches var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "Branches"
				QUERY	= "{ 'SELECT
								b.*
							  FROM
							  	' $ g.Store_Table_Prefix $ 'Branches b,
								' $ g.Store_Table_Prefix $ 'ItemBranchVersions ibv,
								' $ g.Store_Table_Prefix $ 'ItemVersions iv
							  WHERE
								ibv.branch_id	= b.id				AND
								ibv.head		= 1					AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'ibv.code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) $ ' AND
								iv.id			= ibv.version_id
							  ORDER BY
								b.id' }"
				FIELDS	= "l.item_code">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00939', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.branch_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT Branches.d.EOF }">
		<MvEVAL EXPR = "{ Branch_Read( l.branches[ ++l.branch_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "Branches" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Branches">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00940', l.branch_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "BranchList_Load_Item_Module_Code" PARAMETERS = "mod_code, branches var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "Branches"
				QUERY	= "{ 'SELECT
								b.*
							  FROM
							  	' $ g.Store_Table_Prefix $ 'Branches b,
								' $ g.Store_Table_Prefix $ 'ItemBranchVersions ibv,
								' $ g.Store_Table_Prefix $ 'ItemVersions iv
							  WHERE
								ibv.branch_id	= b.id				AND
								ibv.head		= 1					AND
								iv.id			= ibv.version_id	AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'iv.mod_code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) $ '
							  ORDER BY
								b.id' }"
				FIELDS	= "l.mod_code">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00958', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.branch_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT Branches.d.EOF }">
		<MvEVAL EXPR = "{ Branch_Read( l.branches[ ++l.branch_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "Branches" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Branches">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00959', l.branch_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "BranchList_Load_CSSResource_Code" PARAMETERS = "code, branches var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "Branches"
				QUERY	= "{ 'SELECT
								b.*
							  FROM
							  	' $ g.Store_Table_Prefix $ 'Branches b,
								' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions cssbv,
								' $ g.Store_Table_Prefix $ 'CSSResourceVersions cssv
							  WHERE
								cssbv.branch_id	= b.id				AND
								cssbv.head		= 1					AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'cssbv.code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) $ ' AND
								cssv.id			= cssbv.version_id
							  ORDER BY
								b.id' }"
				FIELDS	= "l.code">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00941', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.branch_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT Branches.d.EOF }">
		<MvEVAL EXPR = "{ Branch_Read( l.branches[ ++l.branch_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "Branches" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Branches">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00942', l.branch_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "BranchList_Load_JavaScriptResource_Code" PARAMETERS = "code, branches var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "Branches"
				QUERY	= "{ 'SELECT
								b.*
							  FROM
							  	' $ g.Store_Table_Prefix $ 'Branches b,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions jsbv,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceVersions jsv
							  WHERE
								jsbv.branch_id	= b.id				AND
								jsbv.head		= 1					AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'jsbv.code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) $ ' AND
								jsv.id			= jsbv.version_id
							  ORDER BY
								b.id' }"
				FIELDS	= "l.code">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00943', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.branch_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT Branches.d.EOF }">
		<MvEVAL EXPR = "{ Branch_Read( l.branches[ ++l.branch_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "Branches" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Branches">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00944', l.branch_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "BranchList_Load_ManagedTemplate_Filename" PARAMETERS = "filename, branches var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "Branches"
				QUERY	= "{ 'SELECT
								b.*
							  FROM
							  	' $ g.Store_Table_Prefix $ 'Branches b,
								' $ g.Store_Table_Prefix $ 'ManagedTemplates mt,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions mtbv,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateVersions mtv
							  WHERE
							  	' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'mt.filename' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) $ ' AND
								mtbv.branch_id	= b.id	AND
								mtbv.templ_id	= mt.id	AND
								mtbv.head		= 1		AND
								mtv.id			= mtbv.version_id
							  ORDER BY
								b.id' }"
				FIELDS	= "l.filename">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00945', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.branch_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT Branches.d.EOF }">
		<MvEVAL EXPR = "{ Branch_Read( l.branches[ ++l.branch_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "Branches" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Branches">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00946', l.branch_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "BranchList_Load_ManagedProperty_Code" PARAMETERS = "type, code, branches var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "Branches"
				QUERY	= "{ 'SELECT
								b.*
							  FROM
							  	' $ g.Store_Table_Prefix $ 'Branches b,
								' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions mpbv,
								' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions mpv
							  WHERE
								mpbv.branch_id	= b.id				AND
								mpbv.head		= 1					AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'mpbv.type' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) $ ' AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'mpbv.code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) $ ' AND
								mpv.id			= mpbv.version_id
							  ORDER BY
								b.id' }"
				FIELDS	= "l.type, l.code">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00947', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.branch_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT Branches.d.EOF }">
		<MvEVAL EXPR = "{ Branch_Read( l.branches[ ++l.branch_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "Branches" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Branches">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00948', l.branch_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "BranchList_Load_ManagedProperty_Product" PARAMETERS = "type, product_id, branches var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "Branches"
				QUERY	= "{ 'SELECT
								b.*
							  FROM
							  	' $ g.Store_Table_Prefix $ 'Branches b,
								' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions mpbv,
								' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions mpv
							  WHERE
								mpbv.branch_id	= b.id				AND
								mpbv.head		= 1					AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'mpbv.type' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) $ ' AND
								mpbv.product_id	= ?					AND
								mpv.id			= mpbv.version_id
							  ORDER BY
								b.id' }"
				FIELDS	= "l.type, l.product_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00949', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.branch_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT Branches.d.EOF }">
		<MvEVAL EXPR = "{ Branch_Read( l.branches[ ++l.branch_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "Branches" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Branches">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00950', l.branch_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "BranchList_Load_ManagedProperty_Category" PARAMETERS = "type, cat_id, branches var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "Branches"
				QUERY	= "{ 'SELECT
								b.*
							  FROM
							  	' $ g.Store_Table_Prefix $ 'Branches b,
								' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions mpbv,
								' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions mpv
							  WHERE
								mpbv.branch_id	= b.id				AND
								mpbv.head		= 1					AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'mpbv.type' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) $ ' AND
								mpbv.cat_id		= ?					AND
								mpv.id			= mpbv.version_id
							  ORDER BY
								b.id' }"
				FIELDS	= "l.type, l.cat_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00951', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.branch_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT Branches.d.EOF }">
		<MvEVAL EXPR = "{ Branch_Read( l.branches[ ++l.branch_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "Branches" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Branches">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00952', l.branch_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Branch_Delete" PARAMETERS = "branch var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT Image_Decrement_HeadAndRefCount_All_Branch( l.branch:id )			OR
					NOT Changeset_Delete_All_Branch( l.branch:id )							OR
					NOT PageBranchVersion_Delete_All_Branch( l.branch:id )					OR
					NOT ItemBranchVersion_Delete_All_Branch( l.branch:id )					OR
					NOT ManagedTemplateBranchVersion_Delete_All_Branch( l.branch:id )		OR
					NOT JavaScriptResourceBranchVersion_Delete_All_Branch( l.branch:id )	OR
					NOT CSSResourceBranchVersion_Delete_All_Branch( l.branch:id )			OR
					NOT ManagedPropertyBranchVersion_Delete_All_Branch( l.branch:id ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ NOT Page_Delete_All_Orphaned()					OR
					NOT Item_Delete_All_Orphaned()					OR
					NOT CSSResource_Delete_All_Orphaned()			OR
					NOT JavaScriptResource_Delete_All_Orphaned()	OR
					NOT ManagedProperty_Delete_All_Orphaned()		OR
					NOT ManagedTemplate_Delete_All_Orphaned() }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = "{ Branch_Delete_LowLevel( l.branch:id ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Branch_Delete_LowLevel" PARAMETERS = "id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'Branches WHERE id = ?' }"
			 FIELDS	= "l.id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00352', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_ManagedTemplateBranchVersions
|
</MvCOMMENT>

<MvFUNCTION NAME = "ManagedTemplateBranchVersion_Insert" PARAMETERS = "branch_id, templ_id, version_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions
						  ( branch_id, templ_id, version_id, head )
						  VALUES
						  ( ?, ?, ?, 0 )' }"
			 FIELDS	= "l.branch_id, l.templ_id, l.version_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00353', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplateBranchVersion_Update_Head" PARAMETERS = "branch_id, templ_id, version_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions
						  SET
							head		= 1
						  WHERE
							branch_id	= ? AND
							templ_id	= ? AND
							version_id	= ?' }"
			 FIELDS	= "l.branch_id, l.templ_id, l.version_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00329', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions
						  SET
							head		= 0
						  WHERE
							branch_id	= ? AND
							templ_id	= ? AND
							version_id	<> ?' }"
			 FIELDS	= "l.branch_id, l.templ_id, l.version_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00330', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplateBranchVersion_Delete_All_Branch" PARAMETERS = "branch_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions WHERE branch_id = ?' }"
			 FIELDS	= "l.branch_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00354', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplateBranchVersion_Delete_All_Template" PARAMETERS = "templ_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions WHERE templ_id = ?' }"
			 FIELDS	= "l.templ_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00355', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_ChangesetTags
|
</MvCOMMENT>

<MvFUNCTION NAME = "ChangesetTag_Read" PARAMETERS = "tag var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.tag:set_id"	VALUE = "{ ChangesetTags.d.set_id }">
	<MvASSIGN NAME = "l.tag:tag"	VALUE = "{ ChangesetTags.d.tag }">
</MvFUNCTION>

<MvFUNCTION NAME = "ChangesetTag_Insert" PARAMETERS = "set_id, tag" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'ChangesetTags
					      ( set_id, tag )
						  VALUES
						  ( ?, ? )' }"
			 FIELDS	= "l.set_id, l.tag">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00356', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ChangesetTag_Delete_All_Changeset" PARAMETERS = "set_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ChangesetTags WHERE set_id = ?' }"
			 FIELDS	= "l.set_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00357', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ChangesetTagList_Load_Changeset" PARAMETERS = "set_id, tags var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ChangesetTags"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'ChangesetTags WHERE set_id = ? ORDER BY tag' }"
				FIELDS	= "l.set_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00358', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.tag_count" VALUE = 0>
	<MvWHILE EXPR = "{ NOT ChangesetTags.d.EOF }">
		<MvEVAL EXPR = "{ ChangesetTag_Read( l.tags[ ++l.tag_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "ChangesetTags" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ChangesetTags">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00359', l.tag_count ) }">
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_ManagedTemplateTags
|
</MvCOMMENT>

<MvFUNCTION NAME = "ManagedTemplateTag_Insert" PARAMETERS = "tag" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'ManagedTemplateTags
					      ( tag )
						  VALUES
						  ( ? )' }"
			 FIELDS	= "l.tag">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00360', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_Changesets
|
</MvCOMMENT>

<MvFUNCTION NAME = "Changeset_Read" PARAMETERS = "changeset var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.changeset:id"			VALUE = "{ Changesets.d.id }">
	<MvASSIGN NAME = "l.changeset:parent_id"	VALUE = "{ Changesets.d.parent_id }">
	<MvASSIGN NAME = "l.changeset:branch_id"	VALUE = "{ Changesets.d.branch_id }">
	<MvASSIGN NAME = "l.changeset:user_id"		VALUE = "{ Changesets.d.user_id }">
	<MvASSIGN NAME = "l.changeset:dtstamp"		VALUE = "{ Changesets.d.dtstamp }">
	<MvASSIGN NAME = "l.changeset:notes"		VALUE = "{ Changesets.d.notes }">
</MvFUNCTION>

<MvFUNCTION NAME = "Changeset_Insert" PARAMETERS = "changeset var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.changeset:id" VALUE = "{ [ g.Module_Library_DB ].StoreKey_Generate( 'Changesets' ) }">

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'Changesets
					      ( id, parent_id, branch_id, user_id, dtstamp, notes )
						  VALUES
						  ( ?, ?, ?, ?, ?, ? )' }"
			 FIELDS	= "l.changeset:id, l.changeset:parent_id, l.changeset:branch_id,
					   l.changeset:user_id, l.changeset:dtstamp, l.changeset:notes">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00331', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Changeset_Load_ID" PARAMETERS = "id, changeset var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "Changesets"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'Changesets WHERE id = ?' }"
				FIELDS	= "l.id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00361', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ Changesets.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "Changesets">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00362' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ Changeset_Read( l.changeset ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Changesets">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Changeset_Load_Branch_Current" PARAMETERS = "branch_id, changeset var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_OPENVIEW_Range( 'Merchant',
																			 'Changesets',
																			 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'Changesets WHERE branch_id = ? ORDER BY id DESC',
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.branch_id ),
																			 0, 1 ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00404', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ Changesets.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "Changesets">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00405' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ Changeset_Read( l.changeset ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Changesets">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ChangesetList_Load_Branch" PARAMETERS = "branch_id, changesets var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "Changesets"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'Changesets WHERE branch_id = ? ORDER BY id' }"
				FIELDS	= "l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00363', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.changeset_count" VALUE = 0>
	<MvWHILE EXPR = "{ NOT Changesets.d.EOF }">
		<MvEVAL EXPR = "{ Changeset_Read( l.changesets[ ++l.changeset_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "Changesets" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Changesets">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00364', l.changeset_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Changeset_Delete_All_Branch" PARAMETERS = "branch_id" STANDARDOUTPUTLEVEL = "">
	<MvFOREACH ITERATOR = "l.changeset" ARRAY = "l.changesets" COUNT = "{ ChangesetList_Load_Branch( l.branch_id, l.changesets ) }">
		<MvIF EXPR = "{ NOT Changeset_Delete( l.changeset ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	</MvFOREACH>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Changeset_Delete" PARAMETERS = "changeset var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT ChangesetTag_Delete_All_Changeset( l.changeset:id )				OR
					NOT PageChange_Delete_All_Changeset( l.changeset:id )				OR
					NOT ItemChange_Delete_All_Changeset( l.changeset:id )				OR
					NOT ManagedTemplateChange_Delete_All_Changeset( l.changeset:id )	OR
					NOT JavaScriptResourceChange_Delete_All_Changeset( l.changeset:id )	OR
					NOT CSSResourceChange_Delete_All_Changeset( l.changeset:id )		OR
					NOT ManagedPropertyChange_Delete_All_Changeset( l.changeset:id )	OR
					NOT Changeset_Delete_LowLevel( l.changeset:id ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Changeset_Delete_LowLevel" PARAMETERS = "id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'Changesets WHERE id = ?' }"
			 FIELDS	= "l.id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00365', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_ManagedTemplateChanges
|
</MvCOMMENT>

<MvFUNCTION NAME = "ManagedTemplateChange_InsertOrUpdate" PARAMETERS = "branch_id, set_id, templ_id, old_id, new_id" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ ManagedTemplateChange_Insert( l.branch_id, l.set_id, l.templ_id, l.old_id, l.new_id ) }">	<MvFUNCTIONRETURN VALUE = 1>
	<MvELSEIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_Error_IsIndexDuplicate( g.Error_Message ) }">	<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = "{ ManagedTemplateChange_Update_New( l.branch_id, l.set_id, l.templ_id, l.new_id ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplateChange_Insert" PARAMETERS = "branch_id, set_id, templ_id, old_id, new_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'ManagedTemplateChanges
					      ( branch_id, set_id, templ_id, old_id, new_id )
						  VALUES
						  ( ?, ?, ?, ?, ? )' }"
			 FIELDS	= "l.branch_id, l.set_id, l.templ_id, l.old_id, l.new_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00332', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplateChange_Update_New" PARAMETERS = "branch_id, set_id, templ_id, new_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'ManagedTemplateChanges
						  SET
							new_id		= ?
						  WHERE
							branch_id	= ?	AND
							set_id		= ? AND
							templ_id	= ?' }"
			 FIELDS	= "l.new_id,
					   l.branch_id, l.set_id, l.templ_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00333', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplateChange_Delete_All_Changeset" PARAMETERS = "set_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ManagedTemplateChanges WHERE set_id = ?' }"
			 FIELDS	= "l.set_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00366', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplateChange_Delete_All_Template" PARAMETERS = "templ_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ManagedTemplateChanges WHERE templ_id = ?' }"
			 FIELDS	= "l.templ_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00367', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplateChange_Delete_All_Product_Property" PARAMETERS = "product_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ g.Native_DBAPI EQ 'postgresql' }">
		<MvQUERY NAME 	= "Merchant"
				 QUERY 	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ManagedTemplateChanges mtc 
							  USING
								' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions mpv,
								' $ g.Store_Table_Prefix $ 'ManagedProperties mp
							  WHERE
								mpv.product_id	= ?				AND
								mp.id			= mpv.prop_id	AND
								mtc.templ_id	= mp.templ_id' }"
				 FIELDS	= "l.product_id">
	<MvELSE>
		<MvQUERY NAME 	= "Merchant"
				 QUERY 	= "{ 'DELETE
								mtc.*
							  FROM
								' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions mpv,
								' $ g.Store_Table_Prefix $ 'ManagedProperties mp,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateChanges mtc
							  WHERE
								mpv.product_id	= ?				AND
								mp.id			= mpv.prop_id	AND
								mtc.templ_id	= mp.templ_id' }"
				 FIELDS	= "l.product_id">
	</MvIF>

	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00546', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplateChange_Delete_All_Category_Property" PARAMETERS = "cat_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ g.Native_DBAPI EQ 'postgresql' }">
		<MvQUERY NAME 	= "Merchant"
				 QUERY 	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ManagedTemplateChanges mtc 
							  USING
								' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions mpv,
								' $ g.Store_Table_Prefix $ 'ManagedProperties mp
							  WHERE
								mpv.cat_id		= ?				AND
								mp.id			= mpv.prop_id	AND
								mtc.templ_id	= mp.templ_id' }"
				 FIELDS	= "l.cat_id">
	<MvELSE>
		<MvQUERY NAME 	= "Merchant"
				 QUERY 	= "{ 'DELETE
								mtc.*
							  FROM
								' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions mpv,
								' $ g.Store_Table_Prefix $ 'ManagedProperties mp,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateChanges mtc
							  WHERE
								mpv.cat_id		= ?				AND
								mp.id			= mpv.prop_id	AND
								mtc.templ_id	= mp.templ_id' }"
				 FIELDS	= "l.cat_id">
	</MvIF>

	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00547', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_ManagedTemplates
|
</MvCOMMENT>

<MvFUNCTION NAME = "ManagedTemplate_Read" PARAMETERS = "managedtemplate var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.managedtemplate:id"			VALUE = "{ ManagedTemplates.d.id }">
	<MvASSIGN NAME = "l.managedtemplate:parent_id"	VALUE = "{ ManagedTemplates.d.parent_id }">
	<MvASSIGN NAME = "l.managedtemplate:item_id"	VALUE = "{ ManagedTemplates.d.item_id }">
	<MvASSIGN NAME = "l.managedtemplate:prop_id"	VALUE = "{ ManagedTemplates.d.prop_id }">
	<MvASSIGN NAME = "l.managedtemplate:sync"		VALUE = "{ ManagedTemplates.d.sync }">
	<MvASSIGN NAME = "l.managedtemplate:current_id"	VALUE = "{ ManagedTemplates.d.current_id }">
	<MvASSIGN NAME = "l.managedtemplate:filename"	VALUE = "{ ManagedTemplates.d.filename }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplateAndVersion_Read" PARAMETERS = "managedtemplate var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ ManagedTemplate_Read( l.managedtemplate ) }">

	<MvASSIGN NAME = "l.managedtemplate:version:id"			VALUE = "{ ManagedTemplates.d.version_id }">
	<MvASSIGN NAME = "l.managedtemplate:version:templ_id"	VALUE = "{ ManagedTemplates.d.version_templ_id }">
	<MvASSIGN NAME = "l.managedtemplate:version:user_id"	VALUE = "{ ManagedTemplates.d.version_user_id }">
	<MvASSIGN NAME = "l.managedtemplate:version:immutable"	VALUE = "{ ManagedTemplates.d.version_immutable }">
	<MvASSIGN NAME = "l.managedtemplate:version:dtstamp"	VALUE = "{ ManagedTemplates.d.version_dtstamp }">
	<MvASSIGN NAME = "l.managedtemplate:version:notes"		VALUE = "{ ManagedTemplates.d.version_notes }">
	<MvASSIGN NAME = "l.managedtemplate:version:source"		VALUE = "{ ManagedTemplates.d.version_source }">
	<MvASSIGN NAME = "l.managedtemplate:version:settings"	VALUE = "{ miva_array_deserialize( ManagedTemplates.d.version_settings ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplate_Insert" PARAMETERS = "managedtemplate var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.managedtemplate:id"			VALUE = "{ [ g.Module_Library_DB ].StoreKey_Generate( 'ManagedTemplates' ) }">

	<MvIF EXPR = "{ ISNULL l.managedtemplate:parent_id }">	<MvASSIGN NAME = "l.managedtemplate:parent_id"	VALUE = 0>	</MvIF>
	<MvIF EXPR = "{ ISNULL l.managedtemplate:item_id }">	<MvASSIGN NAME = "l.managedtemplate:item_id"	VALUE = 0>	</MvIF>
	<MvIF EXPR = "{ ISNULL l.managedtemplate:prop_id }">	<MvASSIGN NAME = "l.managedtemplate:prop_id"	VALUE = 0>	</MvIF>
	<MvIF EXPR = "{ ISNULL l.managedtemplate:sync }">		<MvASSIGN NAME = "l.managedtemplate:sync"		VALUE = 1>	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'ManagedTemplates
					      ( id, parent_id, item_id, prop_id, sync, filename )
						  VALUES
						  ( ?, ?, ?, ?, ?, ? )' }"
			 FIELDS	= "l.managedtemplate:id, l.managedtemplate:parent_id, l.managedtemplate:item_id,
			 		   l.managedtemplate:prop_id, l.managedtemplate:sync, l.managedtemplate:filename">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00055', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplate_Update" PARAMETERS = "managedtemplate var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'ManagedTemplates
						  SET
							parent_id	= ?,
							item_id		= ?,
							prop_id		= ?,
							sync		= ?,
							filename	= ?
						  WHERE
							id			= ?' }"
			 FIELDS	= "l.managedtemplate:parent_id, l.managedtemplate:item_id, l.managedtemplate:prop_id, l.managedtemplate:sync, l.managedtemplate:filename,
					   l.managedtemplate:id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00056', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplate_Delete_Filename" PARAMETERS = "filename" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Feature_Filename_TUI_MGR ].TemplateManager_Delete_ManagedTemplate_Filename( l.filename ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplate_Delete" PARAMETERS = "managedtemplate var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Feature_Filename_TUI_MGR ].TemplateManager_Delete_ManagedTemplate_LowLevel( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.managedtemplate ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplate_Delete_ID" PARAMETERS = "id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ManagedTemplates WHERE id = ?' }"
			 FIELDS	= "l.id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00057', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplate_Purge" PARAMETERS = "managedtemplate var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT ManagedTemplateChange_Delete_All_Template( l.managedtemplate:id )			OR
					NOT ManagedTemplateBranchVersion_Delete_All_Template( l.managedtemplate:id )	OR
					NOT ManagedTemplateVersion_Delete_All_Template( l.managedtemplate:id )			OR
					NOT ManagedTemplate_Delete_Files( l.managedtemplate:filename ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = "{ ManagedTemplate_Delete_ID( l.managedtemplate:id ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplate_Purge_Filename" PARAMETERS = "filename" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT ManagedTemplate_Load_Branchless_Filename( l.filename, l.managedtemplate ) }">
		<MvIF EXPR = "{ NOT [ g.Module_Library_DB ].Error_Is_EOF() }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>

		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = "{ ManagedTemplate_Purge( l.managedtemplate ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplate_Delete_All_Product_Property" PARAMETERS = "product_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ g.Native_DBAPI EQ 'postgresql' }">
		<MvQUERY NAME 	= "Merchant"
				 QUERY 	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ManagedTemplates mt 
							  USING
								' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions mpv,
								' $ g.Store_Table_Prefix $ 'ManagedProperties mp
							  WHERE
								mpv.product_id	= ?				AND
								mp.id			= mpv.prop_id	AND
								mt.id			= mp.templ_id' }"
				 FIELDS	= "l.product_id">
	<MvELSE>
		<MvQUERY NAME 	= "Merchant"
				 QUERY 	= "{ 'DELETE
								mt.*
							  FROM
								' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions mpv,
								' $ g.Store_Table_Prefix $ 'ManagedProperties mp,
								' $ g.Store_Table_Prefix $ 'ManagedTemplates mt
							  WHERE
								mpv.product_id	= ?				AND
								mp.id			= mpv.prop_id	AND
								mt.id			= mp.templ_id' }"
				 FIELDS	= "l.product_id">
	</MvIF>

	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00548', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplate_Delete_All_Category_Property" PARAMETERS = "cat_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ g.Native_DBAPI EQ 'postgresql' }">
		<MvQUERY NAME 	= "Merchant"
				 QUERY 	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ManagedTemplates mt 
							  USING
								' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions mpv,
								' $ g.Store_Table_Prefix $ 'ManagedProperties mp
							  WHERE
								mpv.cat_id	= ?				AND
								mp.id		= mpv.prop_id	AND
								mt.id		= mp.templ_id' }"
				 FIELDS	= "l.cat_id">
	<MvELSE>
		<MvQUERY NAME 	= "Merchant"
				 QUERY 	= "{ 'DELETE
								mt.*
							  FROM
								' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions mpv,
								' $ g.Store_Table_Prefix $ 'ManagedProperties mp,
								' $ g.Store_Table_Prefix $ 'ManagedTemplates mt
							  WHERE
								mpv.cat_id	= ?				AND
								mp.id		= mpv.prop_id	AND
								mt.id		= mp.templ_id' }"
				 FIELDS	= "l.cat_id">
	</MvIF>

	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00549', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplate_Delete_All_Orphaned" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT ManagedTemplateVersion_Delete_All_Orphaned_Templates() }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = "{ ManagedTemplate_Delete_All_Orphaned_LowLevel() }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplate_Delete_All_Orphaned_LowLevel" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.branch_count" VALUE = "{ BranchList_Load_All_Cached( l.branches ) }">

	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ManagedTemplates"
				QUERY	= "{ 'SELECT
								mt.id,
								mt.filename
							  FROM
								' $ g.Store_Table_Prefix $ 'ManagedTemplates mt
							  WHERE
								id NOT IN ( SELECT DISTINCT templ_id FROM ' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions )' }">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00827', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvWHILE EXPR = "{ NOT ManagedTemplates.d.EOF }">
		<MvFOREACH ITERATOR = "l.branch" ARRAY = "l.branches" COUNT = "{ l.branch_count }">
			<MvASSIGN NAME = "l.null" VALUE = "{ sdelete( g.Module_Root $ 'templates/s' $ padl( g.Store:id, 2, '0' ) $ '/' $ l.branch:tmpldir $ ManagedTemplates.d.filename ) }">
		</MvFOREACH>

		<MvIF EXPR = "{ NOT ManagedTemplate_Delete_ID( ManagedTemplates.d.id ) }">
			<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedTemplates">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
						
		<MvSKIP NAME = "Merchant" VIEW = "ManagedTemplates" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedTemplates">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplate_Load_ID" PARAMETERS = "id, managedtemplate var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ManagedTemplate_Load_Branch_ID( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.id, l.managedtemplate ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplate_Load_Branch_ID" PARAMETERS = "branch_id, id, managedtemplate var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ManagedTemplates"
				QUERY	= "{ 'SELECT
								t.*,
								bv.version_id	AS current_id
							  FROM
								' $ g.Store_Table_Prefix $ 'ManagedTemplates t
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions bv ON bv.branch_id = ? AND bv.templ_id = t.id AND bv.head = 1
							  WHERE
								t.id = ?' }"
				FIELDS	= "l.branch_id, l.id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00058', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ ManagedTemplates.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedTemplates">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00129' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ ManagedTemplate_Read( l.managedtemplate ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedTemplates">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplate_Load_Branchless_ID" PARAMETERS = "id, managedtemplate var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ManagedTemplates"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'ManagedTemplates WHERE id = ?' }"
				FIELDS	= "l.id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00722', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ ManagedTemplates.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedTemplates">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00723' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ ManagedTemplate_Read( l.managedtemplate ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedTemplates">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplate_Load_Filename" PARAMETERS = "filename, managedtemplate var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ManagedTemplate_Load_Branch_Filename( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.filename, l.managedtemplate ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplate_Load_Branch_Filename" PARAMETERS = "branch_id, filename, managedtemplate var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ManagedTemplates"
				QUERY	= "{ 'SELECT
								t.*,
								bv.version_id AS current_id
							  FROM
								' $ g.Store_Table_Prefix $ 'ManagedTemplates t,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions bv
							  WHERE
							  	' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 't.filename' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) $ ' AND
							  	bv.branch_id	= ?		AND
							  	bv.templ_id		= t.id	AND
							  	bv.head			= 1		AND
							  	bv.version_id	<> 0' }"
				FIELDS	= "l.filename, l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00071', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ ManagedTemplates.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedTemplates">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00130' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ ManagedTemplate_Read( l.managedtemplate ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedTemplates">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplate_Load_Branchless_Filename" PARAMETERS = "filename, managedtemplate var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ManagedTemplates"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'ManagedTemplates WHERE ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'filename' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) }"
				FIELDS	= "l.filename">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00724', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ ManagedTemplates.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedTemplates">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00725' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ ManagedTemplate_Read( l.managedtemplate ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedTemplates">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplate_Load_Property_Code" PARAMETERS = "type, code, managedtemplate var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ManagedTemplate_Load_Property_Branch_Code( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.type, l.code, l.managedtemplate ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplate_Load_Property_Branch_Code" PARAMETERS = "branch_id, type, code, managedtemplate var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ManagedTemplates"
				QUERY	= "{ 'SELECT
								mt.*,
								mtbv.version_id	AS current_id
							  FROM
								' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions mpbv,
								' $ g.Store_Table_Prefix $ 'ManagedProperties mp,
								' $ g.Store_Table_Prefix $ 'ManagedTemplates mt
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions mtbv ON mtbv.branch_id = ? AND mtbv.templ_id = mt.id AND mtbv.head = 1
							  WHERE
							  	mpbv.branch_id	= ?																																AND
							  	mpbv.head		= 1																																AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'mpbv.type' )	$ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' )	$ '	AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'mpbv.code' )	$ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' )	$ '	AND
								mpbv.product_id	= 0																																AND
								mpbv.cat_id		= 0																																AND
								mp.id			= mpbv.prop_id																													AND
								mt.id			= mp.templ_id' }"
				FIELDS	= "l.branch_id, l.branch_id, l.type, l.code">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00597', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ ManagedTemplates.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedTemplates">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00598' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ ManagedTemplate_Read( l.managedtemplate ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedTemplates">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplate_Load_Property_Product" PARAMETERS = "type, product_id, managedtemplate var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ManagedTemplate_Load_Property_Branch_Product( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.type, l.product_id, l.managedtemplate ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplate_Load_Property_Branch_Product" PARAMETERS = "branch_id, type, product_id, managedtemplate var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ManagedTemplates"
				QUERY	= "{ 'SELECT
								mt.*,
								mtbv.version_id	AS current_id
							  FROM
								' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions mpbv,
								' $ g.Store_Table_Prefix $ 'ManagedProperties mp,
								' $ g.Store_Table_Prefix $ 'ManagedTemplates mt
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions mtbv ON mtbv.branch_id = ? AND mtbv.templ_id = mt.id AND mtbv.head = 1
							  WHERE
							  	mpbv.branch_id	= ?																																AND
							  	mpbv.head		= 1																																AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'mpbv.type' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) $ '	AND
								mpbv.code		= \'\'																															AND
								mpbv.product_id	= ?																																AND
								mpbv.cat_id		= 0																																AND
								mp.id			= mpbv.prop_id																													AND
								mt.id			= mp.templ_id' }"
				FIELDS	= "l.branch_id, l.branch_id, l.type, l.product_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00599', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ ManagedTemplates.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedTemplates">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00600' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ ManagedTemplate_Read( l.managedtemplate ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedTemplates">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplate_Load_Property_Category" PARAMETERS = "type, cat_id, managedtemplate var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ManagedTemplate_Load_Property_Branch_Category( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.type, l.cat_id, l.managedtemplate ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplate_Load_Property_Branch_Category" PARAMETERS = "branch_id, type, cat_id, managedtemplate var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ManagedTemplates"
				QUERY	= "{ 'SELECT
								mt.*,
								mtbv.version_id	AS current_id
							  FROM
								' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions mpbv,
								' $ g.Store_Table_Prefix $ 'ManagedProperties mp,
								' $ g.Store_Table_Prefix $ 'ManagedTemplates mt
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions mtbv ON mtbv.branch_id = ? AND mtbv.templ_id = mt.id AND mtbv.head = 1
							  WHERE
							  	mpbv.branch_id	= ?																																AND
							  	mpbv.head		= 1																																AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'mpbv.type' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) $ '	AND
								mpbv.code		= \'\'																															AND
								mpbv.product_id	= 0																																AND
								mpbv.cat_id		= ?																																AND
								mp.id			= mpbv.prop_id																													AND
								mt.id			= mp.templ_id' }"
				FIELDS	= "l.branch_id, l.branch_id, l.type, l.cat_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00601', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ ManagedTemplates.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedTemplates">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00602' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ ManagedTemplate_Read( l.managedtemplate ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedTemplates">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplate_Load_Reuse" PARAMETERS = "filename, parent_id, item_id, prop_id, sync, managedtemplate var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ManagedTemplate_Load_Branch_Reuse( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.filename, l.parent_id, l.item_id, l.prop_id, l.sync, l.managedtemplate ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplate_Load_Branch_Reuse" PARAMETERS = "branch_id, filename, parent_id, item_id, prop_id, sync, managedtemplate var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ ManagedTemplate_Load_Branch_Filename( l.branch_id, l.filename, l.null ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00933' ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = "{ ManagedTemplate_Load_Reuse_Existing( l.filename, l.parent_id, l.item_id, l.prop_id, l.sync, l.managedtemplate ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplate_Load_Reuse_Existing" PARAMETERS = "filename, parent_id, item_id, prop_id, sync, managedtemplate var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_OPENVIEW_Range( 'Merchant', 'ManagedTemplates',
																			 'SELECT
																				mt.*
																			  FROM
																				' $ g.Store_Table_Prefix $ 'ManagedTemplates mt
																				LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'Pages p ON p.templ_id = mt.id
																				LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'CSSResources css ON css.templ_id = mt.id
																				LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'JavaScriptResources js ON js.templ_id = mt.id
																				LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'ManagedProperties mp ON mp.templ_id = mt.id
																			  WHERE
																				' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'mt.filename' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) $ '	AND
																				mt.parent_id	= ?	AND
																				mt.item_id		= ?	AND
																				mt.prop_id		= ?	AND
																				mt.sync			= ?	AND
																				p.id IS NULL		AND
																				css.id IS NULL		AND
																				js.id IS NULL		AND
																				mp.id IS NULL',
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.filename )	$ ',' $
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.parent_id )	$ ',' $
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.item_id )	$ ',' $
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.prop_id )	$ ',' $
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.sync ),
																			 0, 1 ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00810', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ ManagedTemplates.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedTemplates">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00811' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ ManagedTemplate_Read( l.managedtemplate ) }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedTemplates">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplateList_Load_All" PARAMETERS = "managedtemplates var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ManagedTemplateList_Load_Branch_All( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.managedtemplates ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplateList_Load_Branch_All" PARAMETERS = "branch_id, managedtemplates var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ManagedTemplates"
				QUERY	= "{ 'SELECT
								t.*,
								bv.version_id	AS current_id
							  FROM
								' $ g.Store_Table_Prefix $ 'ManagedTemplates t,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions bv
							  WHERE
								bv.branch_id	= ?		AND
								bv.templ_id		= t.id	AND
								bv.head			= 1' }"
				FIELDS	= "l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00090', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.managedtemplate_count"		VALUE = 0>
	<MvWHILE EXPR = "{ NOT ManagedTemplates.d.EOF }">
		<MvASSIGN NAME = "l.managedtemplate_count"	VALUE = "{ l.managedtemplate_count + 1 }">
		<MvEVAL EXPR = "{ ManagedTemplate_Read( l.managedtemplates[ l.managedtemplate_count ] ) }">

		<MvSKIP NAME = "Merchant" VIEW = "ManagedTemplates" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedTemplates">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00131', l.managedtemplate_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplateList_Load_Branchless_Parent" PARAMETERS = "parent_id, managedtemplates var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ManagedTemplates"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'ManagedTemplates WHERE parent_id = ?' }"
				FIELDS	= "l.parent_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00820', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.managedtemplate_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT ManagedTemplates.d.EOF }">
		<MvEVAL EXPR = "{ ManagedTemplate_Read( l.managedtemplates[ ++l.managedtemplate_count ] ) }">

		<MvSKIP NAME = "Merchant" VIEW = "ManagedTemplates" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedTemplates">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00821', l.managedtemplate_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplateList_Load_Branchless_Item" PARAMETERS = "item_id, managedtemplates var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ManagedTemplates"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'ManagedTemplates WHERE item_id = ?' }"
				FIELDS	= "l.item_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00927', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.managedtemplate_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT ManagedTemplates.d.EOF }">
		<MvEVAL EXPR = "{ ManagedTemplate_Read( l.managedtemplates[ ++l.managedtemplate_count ] ) }">

		<MvSKIP NAME = "Merchant" VIEW = "ManagedTemplates" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedTemplates">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00928', l.managedtemplate_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplateAndVersion_Load_Filename" PARAMETERS = "filename, managedtemplate var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ManagedTemplateAndVersion_Load_Branch_Filename( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.filename, l.managedtemplate ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplateAndVersion_Load_Branch_Filename" PARAMETERS = "branch_id, filename, managedtemplate var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ManagedTemplates"
				QUERY	= "{ 'SELECT
								t.*,
								bv.version_id	AS current_id,
								v.id			AS version_id,
								v.templ_id		AS version_templ_id,
								v.user_id		AS version_user_id,
								v.immutable		AS version_immutable,
								v.dtstamp		AS version_dtstamp,
								v.notes			AS version_notes,
								v.source		AS version_source,
								v.settings		AS version_settings
							  FROM
								' $ g.Store_Table_Prefix $ 'ManagedTemplates t,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions bv,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateVersions v
							  WHERE
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 't.filename' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) $ ' AND
								bv.branch_id	= ?				AND
								bv.templ_id		= t.id			AND
								bv.head			= 1				AND
								v.id			= bv.version_id' }"
				FIELDS	= "l.filename, l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00605', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ ManagedTemplates.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedTemplates">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00606' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ ManagedTemplateAndVersion_Read( l.managedtemplate ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedTemplates">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplate_Delete_History" PARAMETERS = "templ_id" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ManagedTemplate_Delete_Branch_History( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.templ_id ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplate_Delete_Branch_History" PARAMETERS = "branch_id, templ_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ g.Native_DBAPI EQ 'postgresql' }">
		<MvQUERY NAME 	= "Merchant"
				 QUERY 	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions bv
				 			  USING
				 			  	' $ g.Store_Table_Prefix $ 'ManagedTemplateVersions v
				 			  WHERE
				 			  	bv.branch_id	= ?				AND
								bv.templ_id		= ?				AND
								bv.head			= 0				AND
								v.id			= bv.version_id AND
								v.immutable		= 0' }"
				 FIELDS = "l.branch_id, l.templ_id">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00337', g.MvQUERY_Error ) }">
		</MvIF>

		<MvQUERY NAME	= "Merchant"
				 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ManagedTemplateVersions dv
							  USING
								' $ g.Store_Table_Prefix $ 'ManagedTemplateVersions v
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions bv ON bv.version_id = v.id
							  WHERE
								bv.version_id IS NULL AND
								dv.id = v.id' }">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00465', g.MvQUERY_Error ) }">
		</MvIF>
	<MvELSE>
		<MvQUERY NAME	= "Merchant"
				 QUERY	= "{ 'DELETE
								bv
							  FROM
								' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions bv,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateVersions v
							  WHERE
								bv.branch_id	= ?				AND
								bv.templ_id		= ?				AND
								bv.head			= 0				AND
								v.id			= bv.version_id AND
								v.immutable		= 0' }"
				 FIELDS	= "l.branch_id, l.templ_id">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00059', g.MvQUERY_Error ) }">
		</MvIF>

		<MvQUERY NAME	= "Merchant"
				 QUERY	= "{ 'DELETE
								v
							  FROM
								' $ g.Store_Table_Prefix $ 'ManagedTemplateVersions v
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions bv ON bv.version_id = v.id
							  WHERE
								bv.version_id IS NULL' }">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00466', g.MvQUERY_Error ) }">
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_ManagedTemplate external files
|
</MvCOMMENT>

<MvFUNCTION NAME = "ManagedTemplate_Delete_Files" PARAMETERS = "filename" STANDARDOUTPUTLEVEL = "">
	<MvFOREACH ITERATOR = "l.branch" ARRAY = "l.branches" COUNT = "{ BranchList_Load_All_Cached( l.branches ) }">
		<MvASSIGN NAME = "l.null" VALUE = "{ sdelete( g.Module_Root $ 'templates/s' $ padl( g.Store:id, 2, '0' ) $ '/' $ l.branch:tmpldir $ l.filename ) }">
	</MvFOREACH>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplate_Delete_Files_ID" PARAMETERS = "templ_id" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT ManagedTemplate_Load_ID( l.id, l.managedtemplate ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = "{ ManagedTemplate_Delete_Files( l.managedtemplate:filename ) }">
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_ManagedTemplateVersions
|
</MvCOMMENT>

<MvFUNCTION NAME = "ManagedTemplateVersion_Read" PARAMETERS = "managedtemplateversion var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.managedtemplateversion:id"			VALUE = "{ ManagedTemplateVersions.d.id }">
	<MvASSIGN NAME = "l.managedtemplateversion:templ_id"	VALUE = "{ ManagedTemplateVersions.d.templ_id }">
	<MvASSIGN NAME = "l.managedtemplateversion:user_id"		VALUE = "{ ManagedTemplateVersions.d.user_id }">
	<MvASSIGN NAME = "l.managedtemplateversion:immutable"	VALUE = "{ ManagedTemplateVersions.d.immutable }">
	<MvASSIGN NAME = "l.managedtemplateversion:dtstamp"		VALUE = "{ ManagedTemplateVersions.d.dtstamp }">
	<MvASSIGN NAME = "l.managedtemplateversion:notes"		VALUE = "{ ManagedTemplateVersions.d.notes }">
	<MvASSIGN NAME = "l.managedtemplateversion:source"		VALUE = "{ ManagedTemplateVersions.d.source }">
	<MvASSIGN NAME = "l.managedtemplateversion:settings"	VALUE = "{ miva_array_deserialize( ManagedTemplateVersions.d.settings ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplateVersion_Insert" PARAMETERS = "managedtemplateversion var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.managedtemplateversion:id"				VALUE = "{ [ g.Module_Library_DB ].StoreKey_Generate( 'ManagedTemplateVersions' ) }">
	<MvASSIGN NAME = "l.settings"								VALUE = "{ miva_array_serialize( l.managedtemplateversion:settings ) }">

	<MvIF EXPR = "{ ISNULL l.managedtemplateversion:user_id }">	<MvASSIGN NAME = "l.managedtemplateversion:user_id"	VALUE = 0>	</MvIF>
	<MvIF EXPR = "{ ISNULL l.managedtemplateversion:dtstamp }">	<MvASSIGN NAME = "l.managedtemplateversion:dtstamp"	VALUE = 0>	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'ManagedTemplateVersions
					      ( id, templ_id, user_id, immutable, dtstamp, notes, source, settings )
						  VALUES
						  ( ?, ?, ?, ?, ?, ?, ?, ? )' }"
			 FIELDS	= "l.managedtemplateversion:id, l.managedtemplateversion:templ_id, l.managedtemplateversion:user_id,
					   l.managedtemplateversion:immutable, l.managedtemplateversion:dtstamp, l.managedtemplateversion:notes,
					   l.managedtemplateversion:source, l.settings">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00060', g.MvQUERY_Error ) }">
	</MvIF>

	<MvEVAL EXPR = "{ ManagedTemplateVersionCache_Clear() }">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplateVersion_Update" PARAMETERS = "managedtemplateversion var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.settings" VALUE = "{ miva_array_serialize( l.managedtemplateversion:settings ) }">

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'ManagedTemplateVersions
						  SET
							immutable	= ?,
							user_id		= ?,
							dtstamp		= ?,
							notes		= ?,
							source		= ?,
							settings	= ?
						  WHERE
							id			= ?' }"
			 FIELDS	= "l.managedtemplateversion:immutable, l.managedtemplateversion:user_id, l.managedtemplateversion:dtstamp,
					   l.managedtemplateversion:notes, l.managedtemplateversion:source, l.settings,
					   l.managedtemplateversion:id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00061', g.MvQUERY_Error ) }">
	</MvIF>

	<MvEVAL EXPR = "{ ManagedTemplateVersionCache_Clear() }">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplateVersion_Delete_All_Template" PARAMETERS = "templ_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ManagedTemplateVersions WHERE templ_id = ?' }"
			 FIELDS	= "l.templ_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00062', g.MvQUERY_Error ) }">
	</MvIF>

	<MvEVAL EXPR = "{ ManagedTemplateVersionCache_Clear() }">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplateVersion_Delete_All_Product_Property" PARAMETERS = "product_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ g.Native_DBAPI EQ 'postgresql' }">
		<MvQUERY NAME 	= "Merchant"
				 QUERY 	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ManagedTemplateVersions mtv 
							  USING
								' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions mpv,
								' $ g.Store_Table_Prefix $ 'ManagedProperties mp
							  WHERE
								mpv.product_id	= ?				AND
								mp.id			= mpv.prop_id	AND
								mtv.templ_id	= mp.templ_id' }"
				 FIELDS	= "l.product_id">
	<MvELSE>
		<MvQUERY NAME 	= "Merchant"
				 QUERY 	= "{ 'DELETE
								mtv.*
							  FROM
								' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions mpv,
								' $ g.Store_Table_Prefix $ 'ManagedProperties mp,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateVersions mtv
							  WHERE
								mpv.product_id	= ?				AND
								mp.id			= mpv.prop_id	AND
								mtv.templ_id	= mp.templ_id' }"
				 FIELDS	= "l.product_id">
	</MvIF>

	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00552', g.MvQUERY_Error ) }">
	</MvIF>

	<MvEVAL EXPR = "{ ManagedTemplateVersionCache_Clear() }">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplateVersion_Delete_All_Category_Property" PARAMETERS = "cat_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ g.Native_DBAPI EQ 'postgresql' }">
		<MvQUERY NAME 	= "Merchant"
				 QUERY 	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ManagedTemplateVersions mtv 
							  USING
								' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions mpv,
								' $ g.Store_Table_Prefix $ 'ManagedProperties mp
							  WHERE
								mpv.cat_id		= ?				AND
								mp.id			= mpv.prop_id	AND
								mtv.templ_id	= mp.templ_id' }"
				 FIELDS	= "l.cat_id">
	<MvELSE>
		<MvQUERY NAME 	= "Merchant"
				 QUERY 	= "{ 'DELETE
								mtv.*
							  FROM
								' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions mpv,
								' $ g.Store_Table_Prefix $ 'ManagedProperties mp,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateVersions mtv
							  WHERE
								mpv.cat_id		= ?				AND
								mp.id			= mpv.prop_id	AND
								mtv.templ_id	= mp.templ_id' }"
				 FIELDS	= "l.cat_id">
	</MvIF>

	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00553', g.MvQUERY_Error ) }">
	</MvIF>

	<MvEVAL EXPR = "{ ManagedTemplateVersionCache_Clear() }">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplateVersion_Delete_ID" PARAMETERS = "id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ManagedTemplateVersions WHERE id = ?' }"
			 FIELDS	= "l.id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00063', g.MvQUERY_Error ) }">
	</MvIF>

	<MvEVAL EXPR = "{ ManagedTemplateVersionCache_Clear() }">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplateVersion_Delete_All_Orphaned_Templates" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ManagedTemplateVersions
			 			  WHERE templ_id NOT IN ( SELECT DISTINCT templ_id FROM ' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00828', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplateVersion_Load_ID" PARAMETERS = "id, managedtemplateversion var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ManagedTemplateVersions"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'ManagedTemplateVersions WHERE id = ?' }"
				FIELDS	= "l.id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00064', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ ManagedTemplateVersions.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedTemplateVersions">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00132' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ ManagedTemplateVersion_Read( l.managedtemplateversion ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedTemplateVersions">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplateVersion_Load_Template_Current" PARAMETERS = "templ_id, managedtemplateversion var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ManagedTemplateVersion_Load_Branch_Head( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.templ_id, l.managedtemplateversion ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplateVersion_Load_Branch_Head" PARAMETERS = "branch_id, templ_id, managedtemplateversion var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ManagedTemplateVersions"
				QUERY	= "{ 'SELECT
								v.*
							  FROM ' $
								g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions bv, ' $
								g.Store_Table_Prefix $ 'ManagedTemplateVersions v
							  WHERE
								bv.branch_id	= ?				AND
								bv.templ_id		= ?				AND
								bv.head			= 1				AND
								v.id			= bv.version_id' }"
				FIELDS	= "l.branch_id, l.templ_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00065', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ ManagedTemplateVersions.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedTemplateVersions">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00133' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ ManagedTemplateVersion_Read( l.managedtemplateversion ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedTemplateVersions">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplateVersionCache_Clear" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "g.Session:cache:managedtemplateversion_load_filename_current_cached"	VALUE = "">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplateVersion_Load_Filename_Current_Cached" PARAMETERS = "filename, managedtemplateversion var" STANDARDOUTPUTLEVEL = "">
	<MvREFERENCEARRAY NAME = "l.cache" 					VARIABLE = "g.Session:cache:managedtemplateversion_load_filename_current_cached">
		<MvMEMBER NAME = "{ l.filename }">
	</MvREFERENCEARRAY>

	<MvIF EXPR = "{ ISNULL l.cache:result }">
		<MvASSIGN NAME = "l.cache:result"				VALUE = "{ ManagedTemplateVersion_Load_Filename_Current( l.filename, l.cache:managedtemplateversion ) }">

		<MvIF EXPR = "{ NOT l.cache:result }">
			<MvASSIGN NAME = "l.cache:error_code"		VALUE = "{ g.Error_Code }">
			<MvASSIGN NAME = "l.cache:error_message"	VALUE = "{ g.Error_Message }">
			<MvASSIGN NAME = "l.cache:error_db_eof"		VALUE = "{ g.Error_DB_EOF }">
		</MvIF>
	</MvIF>

	<MvIF EXPR = "{ NOT l.cache:result }">
		<MvIF EXPR = "{ l.cache:error_db_eof }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( l.cache:error_code ) }">
		</MvIF>

		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( l.cache:error_code, l.cache:error_message ) }">
	</MvIF>

	<MvASSIGN NAME = "l.managedtemplateversion"			VALUE = "{ l.cache:managedtemplateversion }">

	<MvFUNCTIONRETURN VALUE = "{ l.cache:result }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplateVersion_Load_Filename_Current" PARAMETERS = "filename, managedtemplateversion var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ManagedTemplateVersion_Load_Filename_Branch_Head( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.filename, l.managedtemplateversion ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplateVersion_Load_Filename_Branch_Head" PARAMETERS = "branch_id, filename, managedtemplateversion var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ManagedTemplateVersions"
				QUERY	= "{ 'SELECT
								v.*
							  FROM
								' $ g.Store_Table_Prefix $ 'ManagedTemplates t,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions bv,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateVersions v
							  WHERE
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 't.filename' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) $ ' AND
								bv.branch_id	= ?				AND
								bv.templ_id		= t.id			AND
								bv.head			= 1				AND
								v.id			= bv.version_id' }"
				FIELDS	= "l.filename, l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00592', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ ManagedTemplateVersions.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedTemplateVersions">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00593' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ ManagedTemplateVersion_Read( l.managedtemplateversion ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedTemplateVersions">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplateVersion_Load_Property_Current" PARAMETERS = "prop_id, managedtemplateversion var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ManagedTemplateVersion_Load_Property_Branch_Head( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.prop_id, l.managedtemplateversion ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplateVersion_Load_Property_Branch_Head" PARAMETERS = "branch_id, prop_id, managedtemplateversion var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ManagedTemplateVersions"
				QUERY	= "{ 'SELECT
								v.*
							  FROM
								' $ g.Store_Table_Prefix $ 'ManagedProperties p,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions bv,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateVersions v
							  WHERE
								p.id			= ?				AND
								bv.branch_id	= ?				AND
								bv.templ_id		= p.templ_id	AND
								bv.head			= 1				AND
								v.id			= bv.version_id' }"
				FIELDS	= "l.prop_id, l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00578', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ ManagedTemplateVersions.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedTemplateVersions">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00579' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ ManagedTemplateVersion_Read( l.managedtemplateversion ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedTemplateVersions">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplateVersion_Load_Property_Current_Code" PARAMETERS = "type, code, managedtemplateversion var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ManagedTemplateVersion_Load_Property_Branch_Code( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.type, l.code, l.managedtemplateversion ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplateVersion_Load_Property_Branch_Code" PARAMETERS = "branch_id, type, code, managedtemplateversion var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ManagedTemplateVersions"
				QUERY	= "{ 'SELECT
								mtv.*
							  FROM
								' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions mpbv,
								' $ g.Store_Table_Prefix $ 'ManagedProperties mp,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions mtbv,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateVersions mtv
							  WHERE
							  	mpbv.branch_id	= ?																																AND
							  	mpbv.head		= 1																																AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'mpbv.type' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) $ '	AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'mpbv.code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) $ '	AND
								mpbv.product_id	= 0																																AND
								mpbv.cat_id		= 0																																AND
								mp.id			= mpbv.prop_id																													AND
								mtbv.branch_id	= ?																																AND
								mtbv.templ_id	= mp.templ_id																													AND
								mtbv.head		= 1																																AND
								mtv.id			= mtbv.version_id' }"
				FIELDS	= "l.branch_id, l.type, l.code, l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00580', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ ManagedTemplateVersions.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedTemplateVersions">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00581' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ ManagedTemplateVersion_Read( l.managedtemplateversion ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedTemplateVersions">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplateVersion_Load_Property_Current_Product" PARAMETERS = "type, product_id, managedtemplateversion var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ManagedTemplateVersion_Load_Property_Branch_Product( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.type, l.product_id, l.managedtemplateversion ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplateVersion_Load_Property_Branch_Product" PARAMETERS = "branch_id, type, product_id, managedtemplateversion var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ManagedTemplateVersions"
				QUERY	= "{ 'SELECT
								mtv.*
							  FROM
								' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions mpbv,
								' $ g.Store_Table_Prefix $ 'ManagedProperties mp,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions mtbv,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateVersions mtv
							  WHERE
							  	mpbv.branch_id	= ?																																AND
							  	mpbv.head		= 1																																AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'mpbv.type' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) $ '	AND
								mpbv.code		= \'\'																															AND
								mpbv.product_id	= ?																																AND
								mpbv.cat_id		= 0																																AND
								mp.id			= mpbv.prop_id																													AND
								mtbv.branch_id	= ?																																AND
								mtbv.templ_id	= mp.templ_id																													AND
								mtbv.head		= 1																																AND
								mtv.id			= mtbv.version_id' }"
				FIELDS	= "l.branch_id, l.type, l.product_id, l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00582', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ ManagedTemplateVersions.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedTemplateVersions">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00583' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ ManagedTemplateVersion_Read( l.managedtemplateversion ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedTemplateVersions">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplateVersion_Load_Property_Current_Category" PARAMETERS = "type, cat_id, managedtemplateversion var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ManagedTemplateVersion_Load_Property_Branch_Category( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.type, l.cat_id, l.managedtemplateversion ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplateVersion_Load_Property_Branch_Category" PARAMETERS = "branch_id, type, cat_id, managedtemplateversion var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ManagedTemplateVersions"
				QUERY	= "{ 'SELECT
								mtv.*
							  FROM
								' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions mpbv,
								' $ g.Store_Table_Prefix $ 'ManagedProperties mp,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions mtbv,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateVersions mtv
							  WHERE
							  	mpbv.branch_id	= ?																																AND
							  	mpbv.head		= 1																																AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'mpbv.type' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) $ '	AND
								mpbv.code		= \'\'																															AND
								mpbv.product_id	= 0																																AND
								mpbv.cat_id		= ?																																AND
								mp.id			= mpbv.prop_id																													AND
								mtbv.branch_id	= ?																																AND
								mtbv.templ_id	= mp.templ_id																													AND
								mtbv.head		= 1																																AND
								mtv.id			= mtbv.version_id' }"
				FIELDS	= "l.branch_id, l.type, l.cat_id, l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00584', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ ManagedTemplateVersions.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedTemplateVersions">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00585' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ ManagedTemplateVersion_Read( l.managedtemplateversion ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedTemplateVersions">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplateVersionList_Load_Template" PARAMETERS = "templ_id, managedtemplateversions var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ManagedTemplateVersionList_Load_Branch_Template( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.templ_id, l.managedtemplateversions ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplateVersionList_Load_Branch_Template" PARAMETERS = "branch_id, templ_id, managedtemplateversions var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ManagedTemplateVersions"
				QUERY	= "{ 'SELECT
								v.*
							  FROM
								' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions bv,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateVersions v
							  WHERE
								bv.branch_id	= ?			AND
								bv.templ_id		= ?			AND
								v.id			= bv.version_id
							  ORDER BY
								v.id DESC' }"
				FIELDS	= "l.branch_id, l.templ_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00066', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.managedtemplateversion_count" VALUE = 0>
	<MvWHILE EXPR = "{ NOT ManagedTemplateVersions.d.EOF }">
		<MvASSIGN NAME = "l.managedtemplateversion_count" VALUE = "{ l.managedtemplateversion_count + 1 }">
		<MvEVAL EXPR = "{ ManagedTemplateVersion_Read( l.managedtemplateversions[ l.managedtemplateversion_count ] ) }">

		<MvSKIP NAME = "Merchant" VIEW = "ManagedTemplateVersions" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedTemplateVersions">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00134', l.managedtemplateversion_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplateVersionList_Load_Sync" PARAMETERS = "managedtemplateversions var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ManagedTemplateVersionList_Load_Branch_Sync( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.managedtemplateversions ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedTemplateVersionList_Load_Branch_Sync" PARAMETERS = "branch_id, managedtemplateversions var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ManagedTemplateVersions"
				QUERY	= "{ 'SELECT
								t.filename,
								v.*
							  FROM
								' $ g.Store_Table_Prefix $ 'ManagedTemplates t,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateBranchVersions bv,
								' $ g.Store_Table_Prefix $ 'ManagedTemplateVersions v
							  WHERE
								t.sync			= 1			AND
								bv.branch_id	= ?			AND
								bv.templ_id		= t.id		AND
								bv.head			= 1			AND
								v.id			= bv.version_id
							  ORDER BY
								t.id ASC' }"
				FIELDS	= "l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00334', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.managedtemplateversion_count"			VALUE = 0>

	<MvWHILE EXPR = "{ NOT ManagedTemplateVersions.d.EOF }">
		<MvREFERENCEARRAY NAME = "l.managedtemplateversion" VARIABLE = "l.managedtemplateversions">
			<MvDIMENSION INDEX = "{ ++l.managedtemplateversion_count }">
		</MvREFERENCEARRAY>

		<MvEVAL EXPR = "{ ManagedTemplateVersion_Read( l.managedtemplateversion ) }">

		<MvASSIGN NAME = "l.managedtemplateversion:filename"	VALUE = "{ ManagedTemplateVersions.d.filename }">

		<MvSKIP NAME = "Merchant" VIEW = "ManagedTemplateVersions" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedTemplateVersions">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00335', l.managedtemplateversion_count ) }">
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_SKINs
|
</MvCOMMENT>

<MvFUNCTION NAME = "SKIN_Enabled" PARAMETERS = "" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
			VIEW	= "SKIN"
			QUERY	= "{ 'SELECT COUNT(*) FROM ' $ g.Store_Table_Prefix $ 'SKIN' }">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "SKIN">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "SKIN">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "SKIN_Read" PARAMETERS = "SKIN var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.SKIN:id"		VALUE = "{ SKIN.d.id }">
	<MvASSIGN NAME = "l.SKIN:code"		VALUE = "{ SKIN.d.code }">
	<MvASSIGN NAME = "l.SKIN:version"	VALUE = "{ SKIN.d.version }">
	<MvASSIGN NAME = "l.SKIN:title"		VALUE = "{ SKIN.d.title }">
	<MvASSIGN NAME = "l.SKIN:descrip"	VALUE = "{ SKIN.d.descrip }">
	<MvASSIGN NAME = "l.SKIN:previewimg"	VALUE = "{ SKIN.d.previewimg }">
	<MvASSIGN NAME = "l.SKIN:previewurl"	VALUE = "{ SKIN.d.previewurl }">
	<MvASSIGN NAME = "l.SKIN:provider"	VALUE = "{ SKIN.d.provider }">
	<MvASSIGN NAME = "l.SKIN:created_dt"	VALUE = "{ SKIN.d.created_dt }">
	<MvASSIGN NAME = "l.SKIN:applied_dt"	VALUE = "{ SKIN.d.applied_dt }">
	<MvASSIGN NAME = "l.SKIN:has_comps"	VALUE = "{ SKIN.d.has_comps }">
</MvFUNCTION>

<MvFUNCTION NAME = "SKIN_Insert" PARAMETERS = "SKIN var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.id"	VALUE = "{ [ g.Module_Library_DB ].StoreKey_Generate( 'SKINs' ) }">

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'SKIN
							( id, code, version, title, descrip, previewurl, previewimg, provider, created_dt, applied_dt, has_comps )
						  VALUES
							  ( ?,?,?,?,?,?,?,?,?,?,? )' }"
			 FIELDS	= "l.id, l.SKIN:code, l.SKIN:version, l.SKIN:title, l.SKIN:descrip,
						l.SKIN:previewurl, l.SKIN:previewimg, l.SKIN:provider, l.SKIN:created_dt, l.SKIN:applied_dt, l.SKIN:has_comps">

	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00072', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "SKIN_Update" PARAMETERS = "SKIN var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'SKIN
					      SET
							code		= ?,
							version		= ?,
							title		= ?,
							descrip		= ?,
							previewurl	= ?,
							previewimg	= ?,
							provider	= ?,
							created_dt	= ?,
							applied_dt	= ?,
							has_comps	= ?
					      WHERE
						    id			= ?' }"
			 FIELDS	= "	l.SKIN:code,
						l.SKIN:version,
						l.SKIN:title,
						l.SKIN:descrip,
						l.SKIN:previewurl,
						l.SKIN:previewimg,
						l.SKIN:provider,
						l.SKIN:created_dt,
						l.SKIN:applied_dt,
						l.SKIN:has_comps,
						l.SKIN:id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00073', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "SKIN_Delete_ID" PARAMETERS = "id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'SKIN WHERE id = ?' }"
			 FIELDS	= "l.id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00074', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "SKIN_Load_ID" PARAMETERS = "id, skin var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "SKIN"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'SKIN WHERE id = ?' }"
				FIELDS	= "l.id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00155', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ SKIN.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "SKIN">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00156' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ SKIN_Read( l.skin ) }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "SKIN">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "SKIN_Load_Code" PARAMETERS = "code, skin var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "SKIN"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'SKIN WHERE code = ?' }"
				FIELDS	= "l.code">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00075', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ SKIN.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "SKIN">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00135' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ SKIN_Read( l.skin ) }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "SKIN">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "SKINList_Load_All_Order" PARAMETERS = "order, skins var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.order EQ 'code_asc' }">
		<MvASSIGN NAME = "l.sort" VALUE = "ORDER BY code asc">
	<MvELSEIF EXPR = "{ l.order EQ 'title_asc' }">
		<MvASSIGN NAME = "l.sort" VALUE = "ORDER BY title asc">
	<MvELSEIF EXPR = "{ l.order EQ 'created_asc' }">
		<MvASSIGN NAME = "l.sort" VALUE = "ORDER BY created_dt asc">
	<MvELSEIF EXPR = "{ l.order EQ 'applied_asc' }">
		<MvASSIGN NAME = "l.sort" VALUE = "ORDER BY applied_dt asc">
	<MvELSEIF EXPR = "{ l.order EQ 'code_dsc' }">
		<MvASSIGN NAME = "l.sort" VALUE = "ORDER BY code desc">
	<MvELSEIF EXPR = "{ l.order EQ 'title_dsc' }">
		<MvASSIGN NAME = "l.sort" VALUE = "ORDER BY title desc">
	<MvELSEIF EXPR = "{ l.order EQ 'created_dsc' }">
		<MvASSIGN NAME = "l.sort" VALUE = "ORDER BY created_dt desc">
	<MvELSEIF EXPR = "{ l.order EQ 'applied_dsc' }">
		<MvASSIGN NAME = "l.sort" VALUE = "ORDER BY applied_dt desc">

	</MvIF>

	<MvOPENVIEW	NAME	= "Merchant"
				VIEW	= "SKIN"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'SKIN ' $ l.sort }">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00076', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.last_applied" 	VALUE = 0>

	<MvASSIGN NAME = "l.last_applied_pos" 	VALUE = 0>
	<MvASSIGN NAME = "l.skin_count" 	VALUE = 0>
	<MvWHILE EXPR = "{ NOT SKIN.d.EOF }">
		<MvASSIGN NAME = "l.skin_count" VALUE = "{ l.skin_count + 1 }">
		<MvEVAL EXPR = "{ SKIN_Read( l.skins[ l.skin_count ] ) }">

		<MvIF EXPR = "{ l.skins[ l.skin_count ]:applied_dt GT l.last_applied }">
			<MvASSIGN NAME = "l.skins" INDEX = "{ l.skin_count }" 		MEMBER = "max" VALUE = 1>
			
			<MvIF EXPR = "{ l.last_applied_pos }">
				<MvASSIGN NAME = "l.skins" INDEX = "{ l.last_applied_pos }" 	MEMBER = "max" VALUE = 0>
			</MvIF>
			
			<MvASSIGN NAME = "l.last_applied" 	VALUE = "{ l.skins[ l.skin_count ]:applied_dt }">
			<MvASSIGN NAME = "l.last_applied_pos"  	VALUE = "{ l.skin_count }">
		</MvIF>

		<MvSKIP NAME = "Merchant" VIEW = "SKIN" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "SKIN">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00136', l.skin_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "SKINList_Load_All" PARAMETERS = "SKINs var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW	NAME	= "Merchant"
				VIEW	= "SKIN"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'SKIN' }">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00087', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.SKIN_count" VALUE = 0>
	<MvWHILE EXPR = "{ NOT SKIN.d.EOF }">
		<MvASSIGN NAME = "l.SKIN_count" VALUE = "{ l.SKIN_count + 1 }">
		<MvEVAL EXPR = "{ SKIN_Read( l.SKINs[ l.SKIN_count ] ) }">

		<MvSKIP NAME = "Merchant" VIEW = "SKIN" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "SKIN">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00137', l.SKIN_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "SKINList_Load_Offset" PARAMETERS = "offset, search, searchable_fields, max, nextoffset var, SKINs var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.query"		VALUE = "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'SKIN s ' }">

	<MvIF EXPR = "{ len( l.search ) }">
		<MvASSIGN NAME = "l.query"	VALUE = "{ l.query $ ' WHERE ' $ [ g.Module_Library_DB ].SQL_Search_Clause( l.search, 's', l.searchable_fields, l.fields ) }">
	</MvIF>

	<MvASSIGN NAME = "l.query"		VALUE = "{ l.query $ ' ORDER BY s.code' }">

	<MvIF EXPR = "{ l.max EQ 0 }">	<MvASSIGN NAME = "l.limit" VALUE = 0>
	<MvELSE>						<MvASSIGN NAME = "l.limit" VALUE = "{ l.max + 1 }">
	</MvIF>

	<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_OPENVIEW_Range( 'Merchant', 'SKIN',
																			 l.query, l.fields,
																			 l.offset, l.limit ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00077', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.SKIN_count" VALUE = 0>
	<MvWHILE EXPR = "{ ( NOT SKIN.d.EOF ) AND ( ( l.max EQ 0 ) OR ( l.SKIN_count LT l.max ) ) }">
		<MvASSIGN NAME = "l.SKIN_count" VALUE = "{ l.SKIN_count + 1 }">
		<MvEVAL EXPR = "{ SKIN_Read( l.SKINs[ l.SKIN_count ] ) }">

		<MvSKIP NAME = "Merchant" VIEW = "SKIN" ROWS = 1>
	</MvWHILE>

	<MvIF EXPR = "{ SKIN.d.EOF }">
		<MvASSIGN NAME = "l.nextoffset"	VALUE = 0>
	<MvELSE>
		<MvASSIGN NAME = "l.nextoffset"	VALUE = "{ l.offset + l.SKIN_count }">
	</MvIF>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "SKIN">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00138', l.SKIN_count ) }">
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_JavaScriptResources
|
</MvCOMMENT>

<MvFUNCTION NAME = "JavaScriptResource_Read" PARAMETERS = "scriptresource var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.scriptresource:id"				VALUE = "{ JavaScriptResources.d.id }">
	<MvASSIGN NAME = "l.scriptresource:code"			VALUE = "{ JavaScriptResources.d.code }">
	<MvASSIGN NAME = "l.scriptresource:templ_id"		VALUE = "{ JavaScriptResources.d.templ_id }">
	<MvASSIGN NAME = "l.scriptresource:type"			VALUE = "{ JavaScriptResources.d.type }">
	<MvASSIGN NAME = "l.scriptresource:is_global"		VALUE = "{ JavaScriptResources.d.is_global }">
	<MvASSIGN NAME = "l.scriptresource:active"			VALUE = "{ JavaScriptResources.d.active }">
	<MvASSIGN NAME = "l.scriptresource:file"			VALUE = "{ JavaScriptResources.d.file }">
	<MvASSIGN NAME = "l.scriptresource:content_id"		VALUE = "{ JavaScriptResources.d.content_id }">
	<MvASSIGN NAME = "l.scriptresource:mod_code"		VALUE = "{ JavaScriptResources.d.mod_code }">
	<MvASSIGN NAME = "l.scriptresource:mod_data"		VALUE = "{ JavaScriptResources.d.mod_data }">
	<MvASSIGN NAME = "l.scriptresource:attributes"		VALUE = "{ miva_array_deserialize( JavaScriptResources.d.attributes ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResource_Load_ID" PARAMETERS = "id, scriptresource var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ JavaScriptResource_Load_Branch_ID( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.id, l.scriptresource ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResource_Load_Branch_ID" PARAMETERS = "branch_id, id, scriptresource var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "JavaScriptResources"
				QUERY	= "{ 'SELECT
								r.id			AS id,
								v.code			AS code,
								r.templ_id		AS templ_id,
								v.type			AS type,
								v.is_global		AS is_global,
								v.active		AS active,
								v.file			AS file,
								v.content_id	AS content_id,
								v.mod_code		AS mod_code,
								v.mod_data		AS mod_data,
								v.attributes	AS attributes
							  FROM
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions rbv,
								' $ g.Store_Table_Prefix $ 'JavaScriptResources r,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceVersions v
							  WHERE
								rbv.branch_id	= ?				AND
								rbv.res_id		= ?				AND
								r.id			= rbv.res_id	AND
								rbv.head		= 1				AND
								v.id			= rbv.version_id' }"
				FIELDS 	= "l.branch_id, l.id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00178', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ JavaScriptResources.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptResources">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00179' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ JavaScriptResource_Read( l.scriptresource ) }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptResources">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResource_Load_Code" PARAMETERS = "code, scriptresource var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ JavaScriptResource_Load_Branch_Code( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.code, l.scriptresource ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResource_Load_Branch_Code" PARAMETERS = "branch_id, code, scriptresource var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "JavaScriptResources"
				QUERY	= "{ 'SELECT
								r.id			AS id,
								v.code			AS code,
								r.templ_id		AS templ_id,
								v.type			AS type,
								v.is_global		AS is_global,
								v.active		AS active,
								v.file			AS file,
								v.content_id	AS content_id,
								v.mod_code		AS mod_code,
								v.mod_data		AS mod_data,
								v.attributes	AS attributes
							  FROM
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions rbv,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceVersions v,
								' $ g.Store_Table_Prefix $ 'JavaScriptResources r
							  WHERE
								rbv.branch_id	= ?					AND
								rbv.head		= 1					AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'rbv.code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_Upper( '?' ) $ ' AND
								v.id			= rbv.version_id	AND
								r.id			= v.res_id' }"
				FIELDS 	= "l.branch_id, l.code">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00180', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ JavaScriptResources.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptResources">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00181' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ JavaScriptResource_Read( l.scriptresource ) }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptResources">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResource_Load_Reuse" PARAMETERS = "code, type, mod_code, mod_data, scriptresource var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ JavaScriptResource_Load_Branch_Reuse( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.code, l.type, l.mod_code, l.mod_data, l.scriptresource ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResource_Load_Branch_Reuse" PARAMETERS = "branch_id, code, type, mod_code, mod_data, scriptresource var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ JavaScriptResource_Load_Branch_Code( l.branch_id, l.code, l.null ) }">																<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00934' ) }">
	<MvELSEIF EXPR = "{ JavaScriptResource_Load_Reuse_Existing_OtherBranch( l.branch_id, l.code, l.type, l.mod_code, l.mod_data, l.scriptresource ) }">	<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = "{ JavaScriptResource_Load_Reuse_Deleted( l.code, l.type, l.mod_code, l.mod_data, l.scriptresource ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResource_Load_Reuse_Existing_OtherBranch" PARAMETERS = "branch_id, code, type, mod_code, mod_data, scriptresource var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_OPENVIEW_Range( 'Merchant', 'JavaScriptResources',
																			 'SELECT
																				js.*
																			  FROM
																				' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions jsbv,
																				' $ g.Store_Table_Prefix $ 'JavaScriptResourceVersions jsv,
																				' $ g.Store_Table_Prefix $ 'JavaScriptResources js
																			  WHERE
																				jsbv.head			= 1					AND
																				jsbv.branch_id		<> ?				AND
																				jsv.id				= jsbv.version_id	AND
																				' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'jsv.code' )		$ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_Upper( '?' ) $ ' AND
																				jsv.type			= ?					AND
																				' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'jsv.mod_code' )	$ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_Upper( '?' ) $ ' AND
																				' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'jsv.mod_data' )	$ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_Upper( '?' ) $ ' AND
																				js.id				= jsv.res_id
																			  ORDER BY
																				jsv.res_id ASC',
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.branch_id ) $ ',' $
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.code )		$ ',' $
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.type )		$ ',' $
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.mod_code )	$ ',' $
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.mod_data ),
																			 0, 1 ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00814', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ JavaScriptResources.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptResources">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00815' ) }">
	</MvIF>

	<MvASSIGN NAME = "l.scriptresource:id"			VALUE = "{ JavaScriptResources.d.id }">
	<MvASSIGN NAME = "l.scriptresource:templ_id"	VALUE = "{ JavaScriptResources.d.templ_id }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptResources">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResource_Load_Reuse_Deleted" PARAMETERS = "code, type, mod_code, mod_data, scriptresource var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_OPENVIEW_Range( 'Merchant', 'JavaScriptResources',
																			 'SELECT
																				js.*
																			  FROM
																				' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions jsbv,
																				' $ g.Store_Table_Prefix $ 'JavaScriptResourceChanges jsc,
																				' $ g.Store_Table_Prefix $ 'JavaScriptResourceVersions jsv,
																				' $ g.Store_Table_Prefix $ 'JavaScriptResources js
																			  WHERE
																				jsbv.head			= 1					AND
																				jsbv.version_id		= 0					AND
																				jsc.branch_id		= jsbv.branch_id	AND
																				jsc.res_id			= jsbv.res_id		AND
																				jsc.new_id			= 0					AND
																				jsv.id				= jsc.old_id		AND
																				' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'jsv.code' )		$ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_Upper( '?' ) $ ' AND
																				jsv.type			= ?					AND
																				' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'jsv.mod_code' )	$ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_Upper( '?' ) $ ' AND
																				' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'jsv.mod_data' )	$ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_Upper( '?' ) $ ' AND
																				js.id				= jsv.res_id
																			  ORDER BY
																				jsc.res_id ASC, jsc.set_id DESC',
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.code )		$ ',' $
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.type )		$ ',' $
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.mod_code )	$ ',' $
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.mod_data ),
																			 0, 1 ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00730', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ JavaScriptResources.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptResources">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00731' ) }">
	</MvIF>

	<MvASSIGN NAME = "l.scriptresource:id"			VALUE = "{ JavaScriptResources.d.id }">
	<MvASSIGN NAME = "l.scriptresource:templ_id"	VALUE = "{ JavaScriptResources.d.templ_id }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptResources">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceList_Load_Type" PARAMETERS = "type, scriptresources var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ JavaScriptResourceList_Load_Branch_Type( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.type, l.scriptresources ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceList_Load_Branch_Type" PARAMETERS = "branch_id, type, scriptresources var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "JavaScriptResources"
				QUERY	= "{ 'SELECT
								r.id			AS id,
								v.code			AS code,
								r.templ_id		AS templ_id,
								v.type			AS type,
								v.is_global		AS is_global,
								v.active		AS active,
								v.file			AS file,
								v.content_id	AS content_id,
								v.mod_code		AS mod_code,
								v.mod_data		AS mod_data,
								v.attributes	AS attributes
							  FROM
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions rbv,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceVersions v,
								' $ g.Store_Table_Prefix $ 'JavaScriptResources r
							  WHERE
								rbv.branch_id	= ?					AND
								rbv.head		= 1					AND
								v.id			= rbv.version_id	AND
								v.type			= ?					AND
								r.id			= v.res_id
							  ORDER BY
								r.id' }"
				FIELDS 	= "l.branch_id, l.type">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00182', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.scriptresource_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT JavaScriptResources.d.EOF }">
		<MvEVAL EXPR = "{ JavaScriptResource_Read( l.scriptresources[ ++l.scriptresource_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "JavaScriptResources" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptResources">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00183', l.scriptresource_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceList_Load_File" PARAMETERS = "file, scriptresources var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ JavaScriptResourceList_Load_Branch_File( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.file, l.scriptresources ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceList_Load_Branch_File" PARAMETERS = "branch_id, file, scriptresources var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "JavaScriptResources"
				QUERY	= "{ 'SELECT
								r.id			AS id,
								v.code			AS code,
								r.templ_id		AS templ_id,
								v.type			AS type,
								v.is_global		AS is_global,
								v.active		AS active,
								v.file			AS file,
								v.content_id	AS content_id,
								v.mod_code		AS mod_code,
								v.mod_data		AS mod_data,
								v.attributes	AS attributes
							  FROM
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions rbv,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceVersions v,
								' $ g.Store_Table_Prefix $ 'JavaScriptResources r
							  WHERE
								rbv.branch_id	= ?					AND
								rbv.head		= 1					AND
								v.id			= rbv.version_id	AND
								v.file			= ?					AND
								r.id			= v.res_id
							  ORDER BY
								r.id' }"
				FIELDS 	= "l.branch_id, l.file">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00184', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.scriptresource_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT JavaScriptResources.d.EOF }">
		<MvEVAL EXPR = "{ JavaScriptResource_Read( l.scriptresources[ ++l.scriptresource_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "JavaScriptResources" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptResources">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00185', l.scriptresource_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceList_Load_Module" PARAMETERS = "module_code, module_data, scriptresources var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ JavaScriptResourceList_Load_Branch_Module( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.module_code, l.module_data, l.scriptresources ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceList_Load_Branch_Module" PARAMETERS = "branch_id, module_code, module_data, scriptresources var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "JavaScriptResources"
				QUERY	= "{ 'SELECT
								r.id			AS id,
								v.code			AS code,
								r.templ_id		AS templ_id,
								v.type			AS type,
								v.is_global		AS is_global,
								v.active		AS active,
								v.file			AS file,
								v.content_id	AS content_id,
								v.mod_code		AS mod_code,
								v.mod_data		AS mod_data,
								v.attributes	AS attributes
							  FROM
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceVersions v,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions rbv,
								' $ g.Store_Table_Prefix $ 'JavaScriptResources r
							  WHERE
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'v.mod_code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_Upper( '?' ) $ ' AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'v.mod_data' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_Upper( '?' ) $ ' AND
								rbv.version_id	= v.id			AND
								rbv.branch_id	= ?				AND
								rbv.head		= 1				AND
								r.id			= rbv.res_id' }"
				FIELDS 	= "l.module_code, l.module_data, l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00677', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.scriptresource_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT JavaScriptResources.d.EOF }">
		<MvEVAL EXPR = "{ JavaScriptResource_Read( l.scriptresources[ ++l.scriptresource_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "JavaScriptResources" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptResources">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00679', l.scriptresource_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceList_Load_Group" PARAMETERS = "group_id, scriptresources var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ JavaScriptResourceList_Load_Branch_Group( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.group_id, l.scriptresources ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceList_Load_Branch_Group" PARAMETERS = "branch_id, group_id, scriptresources var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "JavaScriptResources"
				QUERY	= "{ 'SELECT
								r.id			AS id,
								v.code			AS code,
								r.templ_id		AS templ_id,
								v.type			AS type,
								v.is_global		AS is_global,
								v.active		AS active,
								v.file			AS file,
								v.content_id	AS content_id,
								v.mod_code		AS mod_code,
								v.mod_data		AS mod_data,
								v.attributes	AS attributes
							  FROM
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions rbv,
								' $ g.Store_Table_Prefix $ 'JavaScriptResources r,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceVersions v,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceXGroup jxg
							  WHERE
								rbv.branch_id	= ?					AND
								rbv.res_id		= r.id				AND
								rbv.head		= 1					AND
								v.id			= rbv.version_id	AND
								jxg.script_id	= v.res_id			AND
								jxg.xref_id		= v.xref_id			AND
								jxg.group_id	= ?
							  ORDER BY
								jxg.disp_order' }"
				FIELDS 	= "l.branch_id, l.group_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00446', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.scriptresource_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT JavaScriptResources.d.EOF }">
		<MvEVAL EXPR = "{ JavaScriptResource_Read( l.scriptresources[ ++l.scriptresource_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "JavaScriptResources" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptResources">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00447', l.scriptresource_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceList_Load_Changeset_Group" PARAMETERS = "set_id, group_id, scriptresources var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW	NAME	= "Merchant"
				VIEW	= "JavaScriptResources"
				QUERY	= "{ 'SELECT
								r.id			AS id,
								v.code			AS code,
								r.templ_id		AS templ_id,
								v.type			AS type,
								v.is_global		AS is_global,
								v.active		AS active,
								v.file			AS file,
								v.content_id	AS content_id,
								v.mod_code		AS mod_code,
								v.mod_data		AS mod_data,
								v.attributes	AS attributes
							  FROM
								' $ g.Store_Table_Prefix $ 'Changesets c,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions rbv,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceChanges rc,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceXGroup rxg,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceVersions v,
								' $ g.Store_Table_Prefix $ 'JavaScriptResources r
							  WHERE
								c.id			= ?						AND
								rbv.branch_id	= c.branch_id			AND
								rc.new_id		= rbv.version_id		AND
								rc.branch_id	= c.branch_id			AND
								rc.res_id		= rbv.res_id			AND
								rc.set_id		=
								(
									SELECT
										MAX( rc2.set_id )
									FROM
										' $ g.Store_Table_Prefix $ 'JavaScriptResourceChanges rc2
									WHERE
										rc2.branch_id	= c.branch_id	AND
										rc2.res_id		= rbv.res_id	AND
										rc2.set_id		<= ?
								)										AND
								rxg.group_id	= ?						AND
								rxg.script_id	= rc.res_id				AND
								rxg.xref_id		= rc.xref_id			AND
								v.id			= rc.new_id				AND
								r.id			= v.res_id
							  ORDER BY
								rxg.disp_order' }"
				FIELDS	= "l.set_id, l.set_id, l.group_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00491', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.scriptresource_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT JavaScriptResources.d.EOF }">
		<MvEVAL EXPR = "{ JavaScriptResource_Read( l.scriptresources[ ++l.scriptresource_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "JavaScriptResources" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptResources">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00492', l.scriptresource_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceList_Load_CombinedResource" PARAMETERS = "comb_id, scriptresources var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ JavaScriptResourceList_Load_Branch_CombinedResource( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.comb_id, l.scriptresources ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceList_Load_Branch_CombinedResource" PARAMETERS = "branch_id, comb_id, scriptresources var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "JavaScriptResources"
				QUERY	= "{ 'SELECT
								r.id			AS id,
								v.code			AS code,
								r.templ_id		AS templ_id,
								v.type			AS type,
								v.is_global		AS is_global,
								v.active		AS active,
								v.file			AS file,
								v.content_id	AS content_id,
								v.mod_code		AS mod_code,
								v.mod_data		AS mod_data,
								v.attributes	AS attributes
							  FROM
								' $ g.Store_Table_Prefix $ 'JavaScriptCombinedResourceXResource rxr,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions rbv,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceVersions v,
								' $ g.Store_Table_Prefix $ 'JavaScriptResources r
							  WHERE
								rxr.comb_id		= ?					AND
								rbv.branch_id	= ?					AND
								rbv.res_id		= rxr.res_id		AND
								rbv.head		= 1					AND
								v.id			= rbv.version_id	AND
								v.xref_id		= rxr.xref_id		AND
								r.id			= rbv.res_id
							  ORDER BY
								rxr.disp_order' }"
				FIELDS 	= "l.comb_id, l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00479', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.scriptresource_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT JavaScriptResources.d.EOF }">
		<MvEVAL EXPR = "{ JavaScriptResource_Read( l.scriptresources[ ++l.scriptresource_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "JavaScriptResources" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptResources">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00480', l.scriptresource_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceList_Load_Changeset_CombinedResource" PARAMETERS = "set_id, comb_id, scriptresources var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW	NAME	= "Merchant"
				VIEW	= "JavaScriptResources"
				QUERY	= "{ 'SELECT
								r.id			AS id,
								v.code			AS code,
								r.templ_id		AS templ_id,
								v.type			AS type,
								v.is_global		AS is_global,
								v.active		AS active,
								v.file			AS file,
								v.content_id	AS content_id,
								v.mod_code		AS mod_code,
								v.mod_data		AS mod_data,
								v.attributes	AS attributes
							  FROM
								' $ g.Store_Table_Prefix $ 'Changesets c,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions rbv,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceChanges rc,
								' $ g.Store_Table_Prefix $ 'JavaScriptCombinedResourceXResource rxr,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceVersions v,
								' $ g.Store_Table_Prefix $ 'JavaScriptResources r
							  WHERE
								c.id			= ?						AND
								rbv.branch_id	= c.branch_id			AND
								rc.new_id		= rbv.version_id		AND
								rc.branch_id	= c.branch_id			AND
								rc.res_id		= rbv.res_id			AND
								rc.set_id		=
								(
									SELECT
										MAX( rc2.set_id )
									FROM
										' $ g.Store_Table_Prefix $ 'JavaScriptResourceChanges rc2
									WHERE
										rc2.branch_id	= c.branch_id	AND
										rc2.res_id		= rbv.res_id	AND
										rc2.set_id		<= ?
								)										AND
								rxr.comb_id		= ?						AND
								rxr.res_id		= rc.res_id				AND
								rxr.xref_id		= rc.xref_id			AND
								v.id			= rc.new_id				AND
								r.id			= v.res_id
							  ORDER BY
								rxr.disp_order' }"
				FIELDS	= "l.set_id, l.set_id, l.comb_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00481', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.scriptresource_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT JavaScriptResources.d.EOF }">
		<MvEVAL EXPR = "{ JavaScriptResource_Read( l.scriptresources[ ++l.scriptresource_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "JavaScriptResources" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptResources">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00482', l.scriptresource_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceList_Load_Page" PARAMETERS = "page_id, scriptresources var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ JavaScriptResourceList_Load_Branch_Page( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.page_id, l.scriptresources ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceList_Load_Branch_Page" PARAMETERS = "branch_id, page_id, scriptresources var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "JavaScriptResources"
				QUERY	= "{ 'SELECT
								r.id			AS id,
								v.code			AS code,
								r.templ_id		AS templ_id,
								v.type			AS type,
								v.is_global		AS is_global,
								v.active		AS active,
								v.file			AS file,
								v.content_id	AS content_id,
								v.mod_code		AS mod_code,
								v.mod_data		AS mod_data,
								v.attributes	AS attributes
							  FROM
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceXPage jxp,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions bv,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceVersions v,
								' $ g.Store_Table_Prefix $ 'JavaScriptResources r
							  WHERE
								jxp.page_id		= ?					AND
								bv.branch_id	= ?					AND
								bv.res_id		= jxp.script_id		AND
								bv.head			= 1					AND
								v.id			= bv.version_id		AND
								v.xref_id		= jxp.xref_id		AND
								r.id			= bv.res_id
							  ORDER BY
								r.id' }"
				FIELDS 	= "l.page_id, l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00673', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.scriptresource_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT JavaScriptResources.d.EOF }">
		<MvEVAL EXPR = "{ JavaScriptResource_Read( l.scriptresources[ ++l.scriptresource_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "JavaScriptResources" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptResources">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00674', l.scriptresource_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceList_Load_All" PARAMETERS = "scriptresources var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ JavaScriptResourceList_Load_Branch_All( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.scriptresources ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceList_Load_Branch_All" PARAMETERS = "branch_id, scriptresources var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "JavaScriptResources"
				QUERY	= "{ 'SELECT
								r.id			AS id,
								v.code			AS code,
								r.templ_id		AS templ_id,
								v.type			AS type,
								v.is_global		AS is_global,
								v.active		AS active,
								v.file			AS file,
								v.content_id	AS content_id,
								v.mod_code		AS mod_code,
								v.mod_data		AS mod_data,
								v.attributes	AS attributes
							  FROM
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions rbv,
								' $ g.Store_Table_Prefix $ 'JavaScriptResources r,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceVersions v
							  WHERE
								rbv.branch_id	= ?				AND
								rbv.res_id		= r.id			AND
								rbv.head		= 1				AND
								v.id			= rbv.version_id
							  ORDER BY
								r.id' }"
				FIELDS 	= "l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00186', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.scriptresource_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT JavaScriptResources.d.EOF }">
		<MvEVAL EXPR = "{ JavaScriptResource_Read( l.scriptresources[ ++l.scriptresource_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "JavaScriptResources" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptResources">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00187', l.scriptresource_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Runtime_JavaScriptResource_Load_Code" PARAMETERS = "code, scriptresource var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ Runtime_JavaScriptResource_Load_Branch_Code( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.code, l.scriptresource ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Runtime_JavaScriptResource_Load_Branch_Code" PARAMETERS = "branch_id, code, scriptresource var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "JavaScriptResources"
				QUERY	= "{ 'SELECT
								r.id			AS id,
								v.code			AS code,
								r.templ_id		AS templ_id,
								v.type			AS type,
								v.is_global		AS is_global,
								v.active		AS active,
								v.file			AS file,
								v.content_id	AS content_id,
								v.mod_code		AS mod_code,
								v.mod_data		AS mod_data,
								v.attributes	AS attributes,
								mt.filename		AS template_filename
							  FROM
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions rbv,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceVersions v,
								' $ g.Store_Table_Prefix $ 'JavaScriptResources r
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'ManagedTemplates mt ON mt.id = r.templ_id
							  WHERE
								rbv.branch_id	= ?					AND
								rbv.head		= 1					AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'rbv.code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_Upper( '?' ) $ ' AND
								v.id			= rbv.version_id	AND
								v.active		= 1					AND
								r.id			= v.res_id' }"
				FIELDS 	= "l.branch_id, l.code">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00188', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ JavaScriptResources.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptResources">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00189' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ JavaScriptResource_Read( l.scriptresource ) }">
	<MvASSIGN NAME = "l.scriptresource:template_filename" VALUE = "{ JavaScriptResources.d.template_filename }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptResources">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Runtime_JavaScriptResourceList_Load_Page" PARAMETERS = "group_code, page_id, scriptresources var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ Runtime_JavaScriptResourceList_Load_Branch_Page( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.group_code, l.page_id, l.scriptresources ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Runtime_JavaScriptResourceList_Load_Branch_Page" PARAMETERS = "branch_id, group_code, page_id, scriptresources var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "JavaScriptResources"
				QUERY	= "{ 'SELECT
								r.id			AS id,
								v.code			AS code,
								r.templ_id		AS templ_id,
								v.type			AS type,
								v.is_global		AS is_global,
								v.active		AS active,
								v.file			AS file,
								v.content_id	AS content_id,
								v.mod_code		AS mod_code,
								v.mod_data		AS mod_data,
								v.attributes	AS attributes,
								mt.filename		AS template_filename
							  FROM
								' $ g.Store_Table_Prefix $ 'ResourceGroups rg,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceXGroup cxg,
								' $ g.Store_Table_Prefix $ 'JavaScriptResources r
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'ManagedTemplates mt ON mt.id = r.templ_id,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions rbv,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceVersions v
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'JavaScriptResourceXPage jxp ON jxp.script_id = v.res_id AND jxp.xref_id = v.xref_id AND jxp.page_id = ?
							  WHERE
								rg.code			= ?					AND
								cxg.group_id	= rg.id				AND
								rbv.branch_id	= ?					AND
								rbv.res_id		= cxg.script_id		AND
								rbv.head		= 1					AND
								r.id			= rbv.res_id		AND
								v.id			= rbv.version_id	AND
								v.xref_id		= cxg.xref_id		AND
								v.active		= 1					AND
								(
									v.is_global	= 1 OR
									jxp.page_id IS NOT NULL
								)
							  ORDER BY
								cxg.disp_order' }"
				FIELDS 	= "l.page_id, l.group_code, l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00190', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.scriptresource_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT JavaScriptResources.d.EOF }">
		<MvEVAL EXPR = "{ JavaScriptResource_Read( l.scriptresources[ ++l.scriptresource_count ] ) }">
		<MvASSIGN NAME = "l.scriptresources" INDEX = "{ l.scriptresource_count }" MEMBER = "template_filename" VALUE = "{ JavaScriptResources.d.template_filename }">

		<MvSKIP NAME = "Merchant" VIEW = "JavaScriptResources" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptResources">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00191', l.scriptresource_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Runtime_JavaScriptResourceList_Load_CombinedResource" PARAMETERS = "comb_id, scriptresources var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ Runtime_JavaScriptResourceList_Load_Branch_CombinedResource( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.comb_id, l.scriptresources ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Runtime_JavaScriptResourceList_Load_Branch_CombinedResource" PARAMETERS = "branch_id, comb_id, scriptresources var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "JavaScriptResources"
				QUERY	= "{ 'SELECT
								r.id			AS id,
								v.code			AS code,
								r.templ_id		AS templ_id,
								v.type			AS type,
								v.is_global		AS is_global,
								v.active		AS active,
								v.file			AS file,
								v.content_id	AS content_id,
								v.mod_code		AS mod_code,
								v.mod_data		AS mod_data,
								v.attributes	AS attributes,
								mt.filename		AS template_filename
							  FROM
								' $ g.Store_Table_Prefix $ 'JavaScriptCombinedResourceXResource rxr,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions rbv,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceVersions v,
								' $ g.Store_Table_Prefix $ 'JavaScriptResources r
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'ManagedTemplates mt ON mt.id = r.templ_id
							  WHERE
								rxr.comb_id		= ?					AND
								rbv.branch_id	= ?					AND
								rbv.res_id		= rxr.res_id		AND
								rbv.head		= 1					AND
								v.id			= rbv.version_id	AND
								v.xref_id		= rxr.xref_id		AND
								v.active		= 1					AND
								r.id			= rbv.res_id
							  ORDER BY
								rxr.disp_order' }"
				FIELDS 	= "l.comb_id, l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00274', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.scriptresource_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT JavaScriptResources.d.EOF }">
		<MvEVAL EXPR = "{ JavaScriptResource_Read( l.scriptresources[ ++l.scriptresource_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "JavaScriptResources" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptResources">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00275', l.scriptresource_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResource_Create_Type_Combined" PARAMETERS = "code, attributes, is_global, active, scriptresource var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.scriptresource:code"			VALUE = "{ l.code }">
	<MvASSIGN NAME = "l.scriptresource:type"			VALUE = "C">
	<MvASSIGN NAME = "l.scriptresource:is_global"		VALUE = "{ l.is_global }">
	<MvASSIGN NAME = "l.scriptresource:active"			VALUE = "{ l.active }">
	<MvASSIGN NAME = "l.scriptresource:file"			VALUE = "">
	<MvASSIGN NAME = "l.scriptresource:content_id"		VALUE = 0>
	<MvASSIGN NAME = "l.scriptresource:mod_code"		VALUE = "">
	<MvASSIGN NAME = "l.scriptresource:mod_data"		VALUE = "">
	<MvASSIGN NAME = "l.scriptresource:templ_id"		VALUE = 0>
	<MvASSIGN NAME = "l.scriptresource:attributes"		VALUE = "{ l.attributes }">

	<MvCOMMENT>
	|
	| Reuse Existing Resource (If Possible)
	|
	</MvCOMMENT>

	<MvIF EXPR = "{ JavaScriptResource_Load_Reuse( l.scriptresource:code, l.scriptresource:type, l.scriptresource:mod_code, l.scriptresource:mod_data, l.reuse_scriptresource ) }">
		<MvASSIGN NAME = "l.scriptresource:id"			VALUE = "{ l.reuse_scriptresource:id }">

		<MvFUNCTIONRETURN VALUE = "{ JavaScriptResource_Recreate_LowLevel( l.scriptresource ) }">
	<MvELSEIF EXPR = "{ NOT [ g.Module_Library_DB ].Error_Is_EOF() }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMENT>
	|
	| Reusable Resource Not Found, Create New Resource
	|
	</MvCOMMENT>

	<MvFUNCTIONRETURN VALUE = "{ JavaScriptResource_Create_LowLevel( l.scriptresource ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResource_Create_Type_InlineScript" PARAMETERS = "code, attributes, is_global, active, template_code var, scriptresource var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.scriptresource:code"			VALUE = "{ l.code }">
	<MvASSIGN NAME = "l.scriptresource:type"			VALUE = "I">
	<MvASSIGN NAME = "l.scriptresource:is_global"		VALUE = "{ l.is_global }">
	<MvASSIGN NAME = "l.scriptresource:active"			VALUE = "{ l.active }">
	<MvASSIGN NAME = "l.scriptresource:file"			VALUE = "">
	<MvASSIGN NAME = "l.scriptresource:content_id"		VALUE = 0>
	<MvASSIGN NAME = "l.scriptresource:mod_code"		VALUE = "">
	<MvASSIGN NAME = "l.scriptresource:mod_data"		VALUE = "">
	<MvASSIGN NAME = "l.scriptresource:templ_id"		VALUE = 0>
	<MvASSIGN NAME = "l.scriptresource:attributes"		VALUE = "{ l.attributes }">

	<MvIF EXPR = "{ [ g.Feature_Filename_TUI_MGR ].TemplateManager_Changeset_Active() }">
		<MvASSIGN NAME = "l.end_changeset"				VALUE = 0>
	<MvELSE>
		<MvASSIGN NAME = "l.end_changeset"				VALUE = 1>

		<MvIF EXPR = "{ NOT [ g.Feature_Filename_TUI_MGR ].TemplateManager_Changeset_Begin( 'JavaScript Resource \'' $ l.scriptresource:code $ '\' created' ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	</MvIF>

	<MvCOMMENT>
	|
	| Reuse Existing Resource (If Possible)
	|
	</MvCOMMENT>

	<MvIF EXPR = "{ JavaScriptResource_Load_Reuse( l.scriptresource:code, l.scriptresource:type, l.scriptresource:mod_code, l.scriptresource:mod_data, l.reuse_scriptresource ) }">
		<MvIF EXPR = "{ NOT ManagedTemplate_Load_ID( l.reuse_scriptresource:templ_id, l.managedtemplate ) }">
			<MvIF EXPR = "{ NOT [ g.Module_Library_DB ].Error_Is_EOF() }">
				<MvFUNCTIONRETURN VALUE = 0>
			</MvIF>

			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00732', 'Managed Template not found' ) }">
		</MvIF>

		<MvIF EXPR = "{ NOT [ g.Module_Feature_TUI_MGR ].TemplateManager_Create_ManagedTemplateVersion( l.managedtemplate, 'Original', l.template_code, l.null_settings, l.null ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>

		<MvASSIGN NAME = "l.scriptresource:id"			VALUE = "{ l.reuse_scriptresource:id }">
		<MvASSIGN NAME = "l.scriptresource:templ_id"	VALUE = "{ l.reuse_scriptresource:templ_id }">

		<MvIF EXPR = "{ NOT JavaScriptResource_Recreate_LowLevel( l.scriptresource ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	<MvELSEIF EXPR = "{ NOT [ g.Module_Library_DB ].Error_Is_EOF() }">
		<MvFUNCTIONRETURN VALUE = 0>
	<MvELSE>
		<MvCOMMENT>
		|
		| Reusable Resource Not Found, Create New Resource
		|
		</MvCOMMENT>

		<MvASSIGN NAME = "l.template_filename" 			VALUE = "{ [ g.Feature_Filename_TUI_UT ].GenerateBranchlessUniqueManagedTemplateFilename_FromFilename( 'scriptresource-' $ [ g.Module_Library_Utilities ].AlphaNumericOnly( l.code ) $ '.mvc' ) }">
		<MvASSIGN NAME = "l.template_id" 				VALUE = "{ [ g.Feature_Filename_TUI_MGR ].TemplateManager_Create_Unsynced_ManagedTemplate( l.template_code, l.null, l.template_filename ) }">

		<MvIF EXPR = "{ NOT l.template_id }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>

		<MvASSIGN NAME = "l.scriptresource:templ_id" 	VALUE = "{ l.template_id }">

		<MvIF EXPR = "{ NOT JavaScriptResource_Create_LowLevel( l.scriptresource ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	</MvIF>

	<MvIF EXPR = "{ l.end_changeset }">
		<MvIF EXPR = "{ NOT [ g.Feature_Filename_TUI_MGR ].TemplateManager_Changeset_End() }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResource_Create_Type_LocalFile" PARAMETERS = "code, attributes, is_global, active, file_path, scriptresource var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.scriptresource:code"			VALUE = "{ l.code }">
	<MvASSIGN NAME = "l.scriptresource:type"			VALUE = "L">
	<MvASSIGN NAME = "l.scriptresource:is_global"		VALUE = "{ l.is_global }">
	<MvASSIGN NAME = "l.scriptresource:active"			VALUE = "{ l.active }">
	<MvASSIGN NAME = "l.scriptresource:file"			VALUE = "{ l.file_path }">
	<MvASSIGN NAME = "l.scriptresource:content_id"		VALUE = 0>
	<MvASSIGN NAME = "l.scriptresource:mod_code"		VALUE = "">
	<MvASSIGN NAME = "l.scriptresource:mod_data"		VALUE = "">
	<MvASSIGN NAME = "l.scriptresource:templ_id"		VALUE = 0>
	<MvASSIGN NAME = "l.scriptresource:attributes"		VALUE = "{ l.attributes }">

	<MvIF EXPR = "{ NOT [ g.Feature_Filename_TUI_MGR ].TemplateManager_Set_ResourceManagedContent_FromFile( l.scriptresource ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMENT>
	|
	| Reuse Existing Resource (If Possible)
	|
	</MvCOMMENT>

	<MvIF EXPR = "{ JavaScriptResource_Load_Reuse( l.scriptresource:code, l.scriptresource:type, l.scriptresource:mod_code, l.scriptresource:mod_data, l.reuse_scriptresource ) }">
		<MvASSIGN NAME = "l.scriptresource:id"			VALUE = "{ l.reuse_scriptresource:id }">

		<MvFUNCTIONRETURN VALUE = "{ JavaScriptResource_Recreate_LowLevel( l.scriptresource ) }">
	<MvELSEIF EXPR = "{ NOT [ g.Module_Library_DB ].Error_Is_EOF() }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMENT>
	|
	| Reusable Resource Not Found, Create New Resource
	|
	</MvCOMMENT>

	<MvFUNCTIONRETURN VALUE = "{ JavaScriptResource_Create_LowLevel( l.scriptresource ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResource_Create_Type_ExternalFile" PARAMETERS = "code, attributes, is_global, active, file_path, scriptresource var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.scriptresource:code"			VALUE = "{ l.code }">
	<MvASSIGN NAME = "l.scriptresource:type"			VALUE = "E">
	<MvASSIGN NAME = "l.scriptresource:is_global"		VALUE = "{ l.is_global }">
	<MvASSIGN NAME = "l.scriptresource:active"			VALUE = "{ l.active }">
	<MvASSIGN NAME = "l.scriptresource:file"			VALUE = "{ l.file_path }">
	<MvASSIGN NAME = "l.scriptresource:content_id"		VALUE = 0>
	<MvASSIGN NAME = "l.scriptresource:mod_code"		VALUE = "">
	<MvASSIGN NAME = "l.scriptresource:mod_data"		VALUE = "">
	<MvASSIGN NAME = "l.scriptresource:templ_id"		VALUE = 0>
	<MvASSIGN NAME = "l.scriptresource:attributes"		VALUE = "{ l.attributes }">

	<MvCOMMENT>
	|
	| Reuse Existing Resource (If Possible)
	|
	</MvCOMMENT>

	<MvIF EXPR = "{ JavaScriptResource_Load_Reuse( l.scriptresource:code, l.scriptresource:type, l.scriptresource:mod_code, l.scriptresource:mod_data, l.reuse_scriptresource ) }">
		<MvASSIGN NAME = "l.scriptresource:id"			VALUE = "{ l.reuse_scriptresource:id }">

		<MvFUNCTIONRETURN VALUE = "{ JavaScriptResource_Recreate_LowLevel( l.scriptresource ) }">
	<MvELSEIF EXPR = "{ NOT [ g.Module_Library_DB ].Error_Is_EOF() }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMENT>
	|
	| Reusable Resource Not Found, Create New Resource
	|
	</MvCOMMENT>

	<MvFUNCTIONRETURN VALUE = "{ JavaScriptResource_Create_LowLevel( l.scriptresource ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResource_Create_Type_Module" PARAMETERS = "code, attributes, is_global, active, mod_code, mod_data, scriptresource var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.scriptresource:code"			VALUE = "{ l.code }">
	<MvASSIGN NAME = "l.scriptresource:type"			VALUE = "M">
	<MvASSIGN NAME = "l.scriptresource:is_global"		VALUE = "{ l.is_global }">
	<MvASSIGN NAME = "l.scriptresource:active"			VALUE = "{ l.active }">
	<MvASSIGN NAME = "l.scriptresource:file"			VALUE = "">
	<MvASSIGN NAME = "l.scriptresource:content_id"		VALUE = 0>
	<MvASSIGN NAME = "l.scriptresource:mod_code"		VALUE = "{ l.mod_code }">
	<MvASSIGN NAME = "l.scriptresource:mod_data"		VALUE = "{ l.mod_data }">
	<MvASSIGN NAME = "l.scriptresource:templ_id"		VALUE = 0>
	<MvASSIGN NAME = "l.scriptresource:attributes"		VALUE = "{ l.attributes }">

	<MvCOMMENT>
	|
	| Reuse Existing Resource (If Possible)
	|
	</MvCOMMENT>

	<MvIF EXPR = "{ JavaScriptResource_Load_Reuse( l.scriptresource:code, l.scriptresource:type, l.scriptresource:mod_code, l.scriptresource:mod_data, l.reuse_scriptresource ) }">
		<MvASSIGN NAME = "l.scriptresource:id"			VALUE = "{ l.reuse_scriptresource:id }">

		<MvFUNCTIONRETURN VALUE = "{ JavaScriptResource_Recreate_LowLevel( l.scriptresource ) }">
	<MvELSEIF EXPR = "{ NOT [ g.Module_Library_DB ].Error_Is_EOF() }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMENT>
	|
	| Reusable Resource Not Found, Create New Resource
	|
	</MvCOMMENT>

	<MvFUNCTIONRETURN VALUE = "{ JavaScriptResource_Create_LowLevel( l.scriptresource ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResource_Create_Type_ModuleInline" PARAMETERS = "code, attributes, is_global, active, mod_code, mod_data, scriptresource var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.scriptresource:code"			VALUE = "{ l.code }">
	<MvASSIGN NAME = "l.scriptresource:type"			VALUE = "Y">
	<MvASSIGN NAME = "l.scriptresource:is_global"		VALUE = "{ l.is_global }">
	<MvASSIGN NAME = "l.scriptresource:active"			VALUE = "{ l.active }">
	<MvASSIGN NAME = "l.scriptresource:file"			VALUE = "">
	<MvASSIGN NAME = "l.scriptresource:content_id"		VALUE = 0>
	<MvASSIGN NAME = "l.scriptresource:mod_code"		VALUE = "{ l.mod_code }">
	<MvASSIGN NAME = "l.scriptresource:mod_data"		VALUE = "{ l.mod_data }">
	<MvASSIGN NAME = "l.scriptresource:templ_id"		VALUE = 0>
	<MvASSIGN NAME = "l.scriptresource:attributes"		VALUE = "{ l.attributes }">

	<MvCOMMENT>
	|
	| Reuse Existing Resource (If Possible)
	|
	</MvCOMMENT>

	<MvIF EXPR = "{ JavaScriptResource_Load_Reuse( l.scriptresource:code, l.scriptresource:type, l.scriptresource:mod_code, l.scriptresource:mod_data, l.reuse_scriptresource ) }">
		<MvASSIGN NAME = "l.scriptresource:id"			VALUE = "{ l.reuse_scriptresource:id }">

		<MvFUNCTIONRETURN VALUE = "{ JavaScriptResource_Recreate_LowLevel( l.scriptresource ) }">
	<MvELSEIF EXPR = "{ NOT [ g.Module_Library_DB ].Error_Is_EOF() }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMENT>
	|
	| Reusable Resource Not Found, Create New Resource
	|
	</MvCOMMENT>

	<MvFUNCTIONRETURN VALUE = "{ JavaScriptResource_Create_LowLevel( l.scriptresource ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResource_Create_Type_ModuleManaged" PARAMETERS = "code, attributes, is_global, active, mod_code, content var, scriptresource var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT ManagedContent_FindOrInsert( l.content, l.managedcontent ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvASSIGN NAME = "l.scriptresource:code"			VALUE = "{ l.code }">
	<MvASSIGN NAME = "l.scriptresource:type"			VALUE = "Z">
	<MvASSIGN NAME = "l.scriptresource:is_global"		VALUE = "{ l.is_global }">
	<MvASSIGN NAME = "l.scriptresource:active"			VALUE = "{ l.active }">
	<MvASSIGN NAME = "l.scriptresource:file"			VALUE = "">
	<MvASSIGN NAME = "l.scriptresource:content_id"		VALUE = "{ l.managedcontent:id }">
	<MvASSIGN NAME = "l.scriptresource:mod_code"		VALUE = "{ l.mod_code }">
	<MvASSIGN NAME = "l.scriptresource:mod_data"		VALUE = "">
	<MvASSIGN NAME = "l.scriptresource:templ_id"		VALUE = 0>
	<MvASSIGN NAME = "l.scriptresource:attributes"		VALUE = "{ l.attributes }">

	<MvIF EXPR = "{ NOT [ g.Feature_Filename_TUI_UT ].ManagedContent_Generate_SRI_Attributes( l.scriptresource:content_id, l.scriptresource:attributes ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMENT>
	|
	| Reuse Existing Resource (If Possible)
	|
	</MvCOMMENT>

	<MvIF EXPR = "{ JavaScriptResource_Load_Reuse( l.scriptresource:code, l.scriptresource:type, l.scriptresource:mod_code, l.scriptresource:mod_data, l.reuse_scriptresource ) }">
		<MvASSIGN NAME = "l.scriptresource:id"			VALUE = "{ l.reuse_scriptresource:id }">

		<MvFUNCTIONRETURN VALUE = "{ JavaScriptResource_Recreate_LowLevel( l.scriptresource ) }">
	<MvELSEIF EXPR = "{ NOT [ g.Module_Library_DB ].Error_Is_EOF() }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMENT>
	|
	| Reusable Resource Not Found, Create New Resource
	|
	</MvCOMMENT>

	<MvFUNCTIONRETURN VALUE = "{ JavaScriptResource_Create_LowLevel( l.scriptresource ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResource_Create_LowLevel" PARAMETERS = "scriptresource var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.working_branch_id"					VALUE = "{ [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID() }">
	<MvASSIGN NAME = "l.scriptresource:id"					VALUE = "{ [ g.Module_Library_DB ].StoreKey_Generate( 'JavaScriptResources' ) }">

	<MvCOMMENT>
	|
	| Create an initial version on the working branch
	|
	</MvCOMMENT>

	<MvASSIGN NAME = "l.scriptresourceversion"				VALUE = "">
	<MvASSIGN NAME = "l.scriptresourceversion:code"			VALUE = "{ l.scriptresource:code }">
	<MvASSIGN NAME = "l.scriptresourceversion:res_id"		VALUE = "{ l.scriptresource:id }">
	<MvASSIGN NAME = "l.scriptresourceversion:user_id"		VALUE = "{ int( g.User:id ) }">
	<MvASSIGN NAME = "l.scriptresourceversion:content_id"	VALUE = "{ l.scriptresource:content_id }">
	<MvASSIGN NAME = "l.scriptresourceversion:immutable"	VALUE = 1>
	<MvASSIGN NAME = "l.scriptresourceversion:type"			VALUE = "{ l.scriptresource:type }">
	<MvASSIGN NAME = "l.scriptresourceversion:is_global"	VALUE = "{ l.scriptresource:is_global }">
	<MvASSIGN NAME = "l.scriptresourceversion:active"		VALUE = "{ l.scriptresource:active }">
	<MvASSIGN NAME = "l.scriptresourceversion:file"			VALUE = "{ l.scriptresource:file }">
	<MvASSIGN NAME = "l.scriptresourceversion:mod_code"		VALUE = "{ l.scriptresource:mod_code }">
	<MvASSIGN NAME = "l.scriptresourceversion:mod_data"		VALUE = "{ l.scriptresource:mod_data }">
	<MvASSIGN NAME = "l.scriptresourceversion:attributes"	VALUE = "{ l.scriptresource:attributes }">

	<MvIF EXPR = "{ NOT JavaScriptResourceVersion_Insert( l.scriptresourceversion ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ NOT JavaScriptResourceBranchVersion_Insert( l.working_branch_id, l.scriptresource:id, l.scriptresourceversion:id ) OR
					NOT JavaScriptResourceBranchVersion_Update_Head( l.working_branch_id, l.scriptresource:id, l.scriptresourceversion:id ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ NOT [ g.Feature_Filename_TUI_MGR ].TemplateManager_Changeset_Record_JavaScriptResourceVersion( l.scriptresource:id, 0, l.scriptresourceversion:id, l.scriptresourceversion:xref_id, 'JavaScript Resource \'' $ l.scriptresourceversion:code $ '\' created' ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = "{ JavaScriptResource_Insert_LowLevel( l.scriptresource ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResource_Recreate_LowLevel" PARAMETERS = "scriptresource var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.working_branch_id"					VALUE = "{ [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID() }">

	<MvCOMMENT>
	|
	| Create an initial version on the working branch
	|
	</MvCOMMENT>

	<MvASSIGN NAME = "l.scriptresourceversion"				VALUE = "">
	<MvASSIGN NAME = "l.scriptresourceversion:code"			VALUE = "{ l.scriptresource:code }">
	<MvASSIGN NAME = "l.scriptresourceversion:res_id"		VALUE = "{ l.scriptresource:id }">
	<MvASSIGN NAME = "l.scriptresourceversion:user_id"		VALUE = "{ int( g.User:id ) }">
	<MvASSIGN NAME = "l.scriptresourceversion:content_id"	VALUE = "{ l.scriptresource:content_id }">
	<MvASSIGN NAME = "l.scriptresourceversion:immutable"	VALUE = 1>
	<MvASSIGN NAME = "l.scriptresourceversion:type"			VALUE = "{ l.scriptresource:type }">
	<MvASSIGN NAME = "l.scriptresourceversion:is_global"	VALUE = "{ l.scriptresource:is_global }">
	<MvASSIGN NAME = "l.scriptresourceversion:active"		VALUE = "{ l.scriptresource:active }">
	<MvASSIGN NAME = "l.scriptresourceversion:file"			VALUE = "{ l.scriptresource:file }">
	<MvASSIGN NAME = "l.scriptresourceversion:mod_code"		VALUE = "{ l.scriptresource:mod_code }">
	<MvASSIGN NAME = "l.scriptresourceversion:mod_data"		VALUE = "{ l.scriptresource:mod_data }">
	<MvASSIGN NAME = "l.scriptresourceversion:attributes"	VALUE = "{ l.scriptresource:attributes }">

	<MvIF EXPR = "{ NOT JavaScriptResourceVersion_Insert( l.scriptresourceversion ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ NOT JavaScriptResourceBranchVersion_Insert( l.working_branch_id, l.scriptresource:id, l.scriptresourceversion:id ) OR
					NOT JavaScriptResourceBranchVersion_Update_Head( l.working_branch_id, l.scriptresource:id, l.scriptresourceversion:id ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ NOT [ g.Feature_Filename_TUI_MGR ].TemplateManager_Changeset_Record_JavaScriptResourceVersion( l.scriptresource:id, 0, l.scriptresourceversion:id, l.scriptresourceversion:xref_id, 'JavaScript Resource \'' $ l.scriptresourceversion:code $ '\' created' ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResource_Insert_LowLevel" PARAMETERS = "scriptresource var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ ISNULL l.scriptresource:templ_id }"> <MvASSIGN NAME = "l.scriptresource:templ_id" VALUE = 0> </MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'JavaScriptResources
						  ( id, templ_id )
						  VALUES
						  ( ?, ? )' }"
			 FIELDS	= "l.scriptresource:id, l.scriptresource:templ_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00192', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResource_Update" PARAMETERS = "scriptresource var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ JavaScriptResource_Update_Branch( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.scriptresource ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResource_Update_Branch" PARAMETERS = "branch_id, scriptresource var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.scriptresource:type EQ 'Z' }">
		<MvIF EXPR = "{ NOT [ g.Feature_Filename_TUI_UT ].ManagedContent_Generate_SRI_Attributes( l.scriptresource:content_id, l.scriptresource:attributes ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	</MvIF>

	<MvIF EXPR = "{ NOT JavaScriptResource_Update_LowLevel( l.scriptresource ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ NOT JavaScriptResourceVersion_Load_Branch_Head( l.branch_id, l.scriptresource:id, l.scriptresourceversion ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvASSIGN NAME = "l.old_version_id"						VALUE = "{ l.scriptresourceversion:id }">

	<MvASSIGN NAME = "l.scriptresourceversion:code"			VALUE = "{ l.scriptresource:code }">
	<MvASSIGN NAME = "l.scriptresourceversion:user_id"		VALUE = "{ int( g.User:id ) }">
	<MvASSIGN NAME = "l.scriptresourceversion:content_id"	VALUE = "{ l.scriptresource:content_id }">
	<MvASSIGN NAME = "l.scriptresourceversion:immutable"	VALUE = 0>
	<MvASSIGN NAME = "l.scriptresourceversion:type"			VALUE = "{ l.scriptresource:type }">
	<MvASSIGN NAME = "l.scriptresourceversion:is_global"	VALUE = "{ l.scriptresource:is_global }">
	<MvASSIGN NAME = "l.scriptresourceversion:active"		VALUE = "{ l.scriptresource:active }">
	<MvASSIGN NAME = "l.scriptresourceversion:file"			VALUE = "{ l.scriptresource:file }">
	<MvASSIGN NAME = "l.scriptresourceversion:mod_code"		VALUE = "{ l.scriptresource:mod_code }">
	<MvASSIGN NAME = "l.scriptresourceversion:mod_data"		VALUE = "{ l.scriptresource:mod_data }">
	<MvASSIGN NAME = "l.scriptresourceversion:attributes"	VALUE = "{ l.scriptresource:attributes }">

	<MvIF EXPR = "{ NOT JavaScriptResourceVersion_Insert( l.scriptresourceversion ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ NOT JavaScriptResourceBranchVersion_Insert( l.branch_id, l.scriptresource:id, l.scriptresourceversion:id ) OR
					NOT JavaScriptResourceBranchVersion_Update_Head( l.branch_id, l.scriptresource:id, l.scriptresourceversion:id ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = "{ [ g.Feature_Filename_TUI_MGR ].TemplateManager_Changeset_Record_JavaScriptResourceVersion( l.scriptresource:id, l.old_version_id, l.scriptresourceversion:id, l.scriptresourceversion:xref_id, 'JavaScript Resource \'' $ l.scriptresourceversion:code $ '\' updated' ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResource_Update_LowLevel" PARAMETERS = "scriptresource var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'JavaScriptResources
						  SET
							templ_id	= ?
						  WHERE
						  	id			= ?' }"
			 FIELDS	= "l.scriptresource:templ_id,
			 		   l.scriptresource:id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00193', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResource_Delete_ID" PARAMETERS = "id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'JavaScriptResources WHERE id = ?' }"
			 FIELDS	= "l.id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00194', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResource_Purge" PARAMETERS = "scriptresource var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT ManagedContent_Decrement_All_JavaScriptResource( l.scriptresource:id )					OR
					NOT JavaScriptResourceXGroup_Delete_All_Script( l.scriptresource:id )						OR
					NOT JavaScriptResourceXPage_Delete_All_Script( l.scriptresource:id )						OR
					NOT JavaScriptResourceVersion_Delete_All_Resource( l.scriptresource:id )					OR
					NOT JavaScriptResourceBranchVersion_Delete_All_Resource( l.scriptresource:id )				OR
					NOT JavaScriptResourceChange_Delete_All_Resource( l.scriptresource:id )						OR
					NOT JavaScriptCombinedResourceXResource_Delete_All_CombinedResource( l.scriptresource:id )	OR
					NOT JavaScriptCombinedResourceXResource_Delete_All_Resource( l.scriptresource:id ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = "{ JavaScriptResource_Delete_ID( l.scriptresource:id ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResource_Delete_All" PARAMETERS = "" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'JavaScriptResources' }"
			 FIELDS	= "">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00195', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResource_Delete_All_Orphaned" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT ManagedContent_Decrement_All_Orphaned_JavaScriptResources()					OR
					NOT JavaScriptResourceVersion_Delete_All_Orphaned_Resources()					OR
					NOT JavaScriptResourceXPage_Delete_All_Orphaned_Scripts()						OR
					NOT JavaScriptResourceXGroup_Delete_All_Orphaned_Scripts()						OR
					NOT JavaScriptCombinedResourceXResource_Delete_All_Orphaned_CombinedResources()	OR
					NOT JavaScriptCombinedResourceXResource_Delete_All_Orphaned_Resources() }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = "{ JavaScriptResource_Delete_All_Orphaned_LowLevel() }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResource_Delete_All_Orphaned_LowLevel" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'JavaScriptResources
			 			  WHERE id NOT IN ( SELECT DISTINCT res_id FROM ' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00829', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_JavaScriptResourceVersions
|
</MvCOMMENT>

<MvFUNCTION NAME = "JavaScriptResourceVersion_Read" PARAMETERS = "scriptresourceversion var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.scriptresourceversion:id"			VALUE = "{ JavaScriptResourceVersions.d.id }">
	<MvASSIGN NAME = "l.scriptresourceversion:code"			VALUE = "{ JavaScriptResourceVersions.d.code }">
	<MvASSIGN NAME = "l.scriptresourceversion:res_id"		VALUE = "{ JavaScriptResourceVersions.d.res_id }">
	<MvASSIGN NAME = "l.scriptresourceversion:xref_id"		VALUE = "{ JavaScriptResourceVersions.d.xref_id }">
	<MvASSIGN NAME = "l.scriptresourceversion:user_id"		VALUE = "{ JavaScriptResourceVersions.d.user_id }">
	<MvASSIGN NAME = "l.scriptresourceversion:content_id"	VALUE = "{ JavaScriptResourceVersions.d.content_id }">
	<MvASSIGN NAME = "l.scriptresourceversion:immutable"	VALUE = "{ JavaScriptResourceVersions.d.immutable }">
	<MvASSIGN NAME = "l.scriptresourceversion:type"			VALUE = "{ JavaScriptResourceVersions.d.type }">
	<MvASSIGN NAME = "l.scriptresourceversion:is_global"	VALUE = "{ JavaScriptResourceVersions.d.is_global }">
	<MvASSIGN NAME = "l.scriptresourceversion:active"		VALUE = "{ JavaScriptResourceVersions.d.active }">
	<MvASSIGN NAME = "l.scriptresourceversion:file"			VALUE = "{ JavaScriptResourceVersions.d.file }">
	<MvASSIGN NAME = "l.scriptresourceversion:mod_code"		VALUE = "{ JavaScriptResourceVersions.d.mod_code }">
	<MvASSIGN NAME = "l.scriptresourceversion:mod_data"		VALUE = "{ JavaScriptResourceVersions.d.mod_data }">
	<MvASSIGN NAME = "l.scriptresourceversion:attributes"	VALUE = "{ miva_array_deserialize( JavaScriptResourceVersions.d.attributes ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceVersion_Insert" PARAMETERS = "scriptresourceversion var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT JavaScriptResourceVersion_Insert_LowLevel( l.scriptresourceversion ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ l.scriptresourceversion:content_id }">
		<MvIF EXPR = "{ NOT ManagedContent_Increment_ReferenceCount( l.scriptresourceversion:content_id ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceVersion_Insert_LowLevel" PARAMETERS = "scriptresourceversion var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.scriptresourceversion:id"				VALUE = "{ [ g.Module_Library_DB ].StoreKey_Generate( 'JavaScriptResourceVersions' ) }">
	<MvASSIGN NAME = "l.attributes"								VALUE = "{ miva_array_serialize( l.scriptresourceversion:attributes ) }">

	<MvIF EXPR = "{ ISNULL l.scriptresourceversion:xref_id }">
		<MvASSIGN NAME = "l.scriptresourceversion:xref_id"		VALUE = "{ [ g.Module_Library_DB ].StoreKey_Generate( 'JavaScriptResourceReferences' ) }">
	</MvIF>

	<MvIF EXPR = "{ ISNULL l.scriptresourceversion:user_id }">
		<MvASSIGN NAME = "l.scriptresourceversion:user_id"		VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ ISNULL l.scriptresourceversion:content_id }">
		<MvASSIGN NAME = "l.scriptresourceversion:content_id"	VALUE = 0>
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'JavaScriptResourceVersions
						  ( id, code, res_id, xref_id, user_id, content_id, immutable, type, is_global, active, file, mod_code, mod_data, attributes )
						  VALUES
						  ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )' }"
			 FIELDS	= "l.scriptresourceversion:id, l.scriptresourceversion:code, l.scriptresourceversion:res_id,
			 		   l.scriptresourceversion:xref_id, l.scriptresourceversion:user_id, l.scriptresourceversion:content_id,
			 		   l.scriptresourceversion:immutable, l.scriptresourceversion:type, l.scriptresourceversion:is_global,
			 		   l.scriptresourceversion:active, l.scriptresourceversion:file, l.scriptresourceversion:mod_code,
			 		   l.scriptresourceversion:mod_data, l.attributes">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00407', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceVersion_Update_CrossReference" PARAMETERS = "scriptresourceversion var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'JavaScriptResourceVersions SET xref_id = ? WHERE id = ?' }"
			 FIELDS	= "l.scriptresourceversion:xref_id, l.scriptresourceversion:id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00408', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceVersion_Delete_All" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'JavaScriptResourceVersions' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00495', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceVersion_Delete_All_Resource" PARAMETERS = "res_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'JavaScriptResourceVersions WHERE res_id = ?' }"
			 FIELDS	= "l.res_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00496', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceVersion_Delete_All_Orphaned_Resources" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'JavaScriptResourceVersions
			 			  WHERE res_id NOT IN ( SELECT DISTINCT res_id FROM ' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00830', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceVersion_Load_ID" PARAMETERS = "id, scriptresourceversion var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "JavaScriptResourceVersions"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'JavaScriptResourceVersions WHERE id = ?' }"
				FIELDS 	= "l.id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00710', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ JavaScriptResourceVersions.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptResourceVersions">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00711' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ JavaScriptResourceVersion_Read( l.scriptresourceversion ) }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptResourceVersions">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceVersion_Load_Branch_Head" PARAMETERS = "branch_id, res_id, scriptresourceversion var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "JavaScriptResourceVersions"
				QUERY	= "{ 'SELECT
								v.*
							  FROM
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions rbv,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceVersions v
							  WHERE
								rbv.branch_id	= ?				AND
								rbv.res_id		= ?				AND
								rbv.head		= 1				AND
								v.id			= rbv.version_id' }"
				FIELDS 	= "l.branch_id, l.res_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00409', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ JavaScriptResourceVersions.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptResourceVersions">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00410' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ JavaScriptResourceVersion_Read( l.scriptresourceversion ) }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptResourceVersions">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceVersionList_Load_Branch_CombinedResource" PARAMETERS = "branch_id, comb_id, scriptresourceversions var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "JavaScriptResourceVersions"
				QUERY	= "{ 'SELECT
								v.*
							  FROM
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions rbv,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceVersions v,
								' $ g.Store_Table_Prefix $ 'JavaScriptCombinedResourceXResource rxr
							  WHERE
								rbv.branch_id	= ?					AND
								rbv.head		= 1					AND
								v.id			= rbv.version_id	AND
								rxr.res_id		= v.res_id			AND
								rxr.xref_id		= v.xref_id			AND
								rxr.comb_id		= ?' }"
				FIELDS 	= "l.branch_id, l.comb_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00411', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.scriptresourceversion_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT JavaScriptResourceVersions.d.EOF }">
		<MvEVAL EXPR = "{ JavaScriptResourceVersion_Read( l.scriptresourceversions[ ++l.scriptresourceversion_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "JavaScriptResourceVersions" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptResourceVersions">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00412', l.scriptresourceversion_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceVersionList_Load_Branch_ResourceGroup" PARAMETERS = "branch_id, group_id, scriptresourceversions var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "JavaScriptResourceVersions"
				QUERY	= "{ 'SELECT
								v.*
							  FROM
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions rbv,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceVersions v,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceXGroup rxg
							  WHERE
								rbv.branch_id	= ?					AND
								rbv.head		= 1					AND
								v.id			= rbv.version_id	AND
								rxg.script_id	= v.res_id			AND
								rxg.xref_id		= v.xref_id			AND
								rxg.group_id	= ?' }"
				FIELDS 	= "l.branch_id, l.group_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00413', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.scriptresourceversion_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT JavaScriptResourceVersions.d.EOF }">
		<MvEVAL EXPR = "{ JavaScriptResourceVersion_Read( l.scriptresourceversions[ ++l.scriptresourceversion_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "JavaScriptResourceVersions" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptResourceVersions">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00414', l.scriptresourceversion_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceVersion_Fork_CrossReferences_LowLevel" PARAMETERS = "scriptresourceversion var, new_xref_id" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT JavaScriptCombinedResourceXResource_Fork( l.scriptresourceversion, l.new_xref_id )	OR
					NOT JavaScriptResourceXGroup_Fork( l.scriptresourceversion, l.new_xref_id )				OR
					NOT JavaScriptResourceXPage_Fork( l.scriptresourceversion, l.new_xref_id ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceVersion_Fork_CrossReferences" PARAMETERS = "branch_id, scriptresourceversion var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ JavaScriptResourceVersion_Fork_CrossReferences_ID( l.branch_id, l.scriptresourceversion, [ g.Module_Library_DB ].StoreKey_Generate( 'JavaScriptResourceReferences' ) ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceVersion_Fork_CrossReferences_ID" PARAMETERS = "branch_id, scriptresourceversion var, xref_id" STANDARDOUTPUTLEVEL = "">
	<MvCOMMENT>
	|
	| Fork the cross references
	|
	</MvCOMMENT>

	<MvIF EXPR = "{ NOT JavaScriptResourceVersion_Fork_CrossReferences_LowLevel( l.scriptresourceversion, l.xref_id ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMENT>
	|
	| If the version exists on this branch only, we just update its xref_id.  Otherwise we need to create a new version to isolate the
	| new xref_id to this branch.
	|
	</MvCOMMENT>

	<MvASSIGN NAME = "l.old_version_id"					VALUE = "{ l.scriptresourceversion:id }">
	<MvASSIGN NAME = "l.scriptresourceversion:xref_id"	VALUE = "{ l.xref_id }">

	<MvIF EXPR = "{ NOT JavaScriptResourceBranchVersion_Load_OtherBranch( l.branch_id, l.scriptresourceversion:res_id, l.scriptresourceversion:id, l.null ) }">
		<MvIF EXPR = "{ NOT [ g.Module_Library_DB ].Error_Is_EOF() }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>

		<MvIF EXPR = "{ NOT JavaScriptResourceVersion_Update_CrossReference( l.scriptresourceversion ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	<MvELSE>
		<MvIF EXPR = "{ NOT JavaScriptResourceVersion_Insert( l.scriptresourceversion ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>

		<MvIF EXPR = "{ NOT JavaScriptResourceBranchVersion_Insert( l.branch_id, l.scriptresourceversion:res_id, l.scriptresourceversion:id ) OR
						NOT JavaScriptResourceBranchVersion_Update_Head( l.branch_id, l.scriptresourceversion:res_id, l.scriptresourceversion:id ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = "{ [ g.Feature_Filename_TUI_MGR ].TemplateManager_Changeset_Record_JavaScriptResourceVersion( l.scriptresourceversion:res_id, l.old_version_id, l.scriptresourceversion:id, l.scriptresourceversion:xref_id, 'JavaScript Resource \'' $ l.scriptresourceversion:code $ '\' references updated' ) }">
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_JavaScriptResourceBranchVersions
|
</MvCOMMENT>

<MvFUNCTION NAME = "JavaScriptResourceBranchVersion_Read" PARAMETERS = "scriptresourcebranchversion var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.scriptresourcebranchversion:branch_id"	VALUE = "{ JavaScriptResourceBranchVersions.d.branch_id }">
	<MvASSIGN NAME = "l.scriptresourcebranchversion:res_id"		VALUE = "{ JavaScriptResourceBranchVersions.d.res_id }">
	<MvASSIGN NAME = "l.scriptresourcebranchversion:version_id"	VALUE = "{ JavaScriptResourceBranchVersions.d.version_id }">
	<MvASSIGN NAME = "l.scriptresourcebranchversion:code"		VALUE = "{ JavaScriptResourceBranchVersions.d.code }">
	<MvASSIGN NAME = "l.scriptresourcebranchversion:head"		VALUE = "{ JavaScriptResourceBranchVersions.d.head }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceBranchVersion_Insert" PARAMETERS = "branch_id, res_id, version_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.version_id EQ 0 }">
		<MvQUERY NAME   = "Merchant"
				 QUERY  = "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions
							  ( branch_id, res_id, version_id, code, head )
							  VALUES
							  ( ?, ?, ?, \'\', 0 )' }"
				 FIELDS = "l.branch_id, l.res_id, l.version_id">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00708', g.MvQUERY_Error ) }">
		</MvIF>
	<MvELSE>
		<MvQUERY NAME   = "Merchant"
				 QUERY  = "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions
							  ( branch_id, res_id, version_id, code, head )
							  SELECT
								?, ?, id, code, 0
							  FROM
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceVersions
							  WHERE
								id = ?' }"
				 FIELDS = "l.branch_id, l.res_id,
				 		   l.version_id">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00415', g.MvQUERY_Error ) }">
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceBranchVersion_Update_Head" PARAMETERS = "branch_id, res_id, version_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions
						  SET
							head		= 1
						  WHERE
							branch_id	= ? AND
							res_id		= ? AND
							version_id	= ?' }"
			 FIELDS	= "l.branch_id, l.res_id, l.version_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00416', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions
						  SET
							head		= 0
						  WHERE
							branch_id	= ? AND
							res_id		= ? AND
							version_id	<> ?' }"
			 FIELDS	= "l.branch_id, l.res_id, l.version_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00417', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceBranchVersion_Delete_All" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00497', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceBranchVersion_Delete_All_Resource" PARAMETERS = "res_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions WHERE res_id = ?' }"
			 FIELDS	= "l.res_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00498', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceBranchVersion_Load_OtherBranch" PARAMETERS = "branch_id, res_id, version_id, scriptresourcebranchversion var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_OPENVIEW_Range( 'Merchant',
																		     'JavaScriptResourceBranchVersions',
																		     'SELECT
																				*
																			  FROM
																				' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions
																			  WHERE
																				res_id		= ?		AND
																				version_id	= ?		AND
																				branch_id	<> ?',
																		     [ g.Module_Library_DB ].SQL_Query_Field( l.res_id )		$ ',' $
																		     [ g.Module_Library_DB ].SQL_Query_Field( l.version_id )	$ ',' $
																		     [ g.Module_Library_DB ].SQL_Query_Field( l.branch_id ),
																		     0, 1 ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00418', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ JavaScriptResourceBranchVersions.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptResourceBranchVersions">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00419' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ JavaScriptResourceBranchVersion_Read( l.scriptresourcebranchversion ) }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptResourceBranchVersions">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceBranchVersion_Delete_All_Branch" PARAMETERS = "branch_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions WHERE branch_id = ?' }"
			 FIELDS	= "l.branch_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00420', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_JavaScriptResourceChanges
|
</MvCOMMENT>

<MvFUNCTION NAME = "JavaScriptResourceChange_InsertOrUpdate" PARAMETERS = "branch_id, set_id, res_id, old_id, new_id, xref_id" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ JavaScriptResourceChange_Insert( l.branch_id, l.set_id, l.res_id, l.old_id, l.new_id, l.xref_id ) }">	<MvFUNCTIONRETURN VALUE = 1>
	<MvELSEIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_Error_IsIndexDuplicate( g.Error_Message ) }">				<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = "{ JavaScriptResourceChange_Update_New( l.branch_id, l.set_id, l.res_id, l.new_id, l.xref_id ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceChange_Insert" PARAMETERS = "branch_id, set_id, res_id, old_id, new_id, xref_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'JavaScriptResourceChanges
					      ( branch_id, set_id, res_id, old_id, new_id, xref_id )
						  VALUES
						  ( ?, ?, ?, ?, ?, ? )' }"
			 FIELDS	= "l.branch_id, l.set_id, l.res_id, l.old_id, l.new_id, l.xref_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00422', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceChange_Update_New" PARAMETERS = "branch_id, set_id, res_id, new_id, xref_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'JavaScriptResourceChanges
						  SET
							new_id	= ?,
							xref_id	= ?
						  WHERE
							branch_id	= ?	AND
							set_id		= ? AND
							res_id		= ?' }"
			 FIELDS	= "l.new_id, l.xref_id,
					   l.branch_id, l.set_id, l.res_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00423', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceChange_Delete_All" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'JavaScriptResourceChanges' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00499', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceChange_Delete_All_Changeset" PARAMETERS = "set_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'JavaScriptResourceChanges WHERE set_id = ?' }"
			 FIELDS	= "l.set_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00424', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceChange_Delete_All_Resource" PARAMETERS = "res_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'JavaScriptResourceChanges WHERE res_id = ?' }"
			 FIELDS	= "l.res_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00425', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_JavaScriptCombinedResourceXResource
|
</MvCOMMENT>

<MvFUNCTION NAME = "JavaScriptCombinedResourceXResource_Read" PARAMETERS = "scriptcombinedresourcexresource var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.scriptcombinedresourcexresource:comb_id"	VALUE = "{ JavaScriptCombinedResourceXResource.d.comb_id }">
	<MvASSIGN NAME = "l.scriptcombinedresourcexresource:res_id"		VALUE = "{ JavaScriptCombinedResourceXResource.d.res_id }">
	<MvASSIGN NAME = "l.scriptcombinedresourcexresource:xref_id"	VALUE = "{ JavaScriptCombinedResourceXResource.d.xref_id }">
	<MvASSIGN NAME = "l.scriptcombinedresourcexresource:disp_order"	VALUE = "{ JavaScriptCombinedResourceXResource.d.disp_order }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptCombinedResourceXResource_Insert" PARAMETERS = "comb_id, res_id" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ JavaScriptCombinedResourceXResource_Insert_Branch( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.comb_id, l.res_id ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptCombinedResourceXResource_Insert_Branch" PARAMETERS = "branch_id, comb_id, res_id" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT JavaScriptResourceVersion_Load_Branch_Head( l.branch_id, l.res_id, l.scriptresourceversion ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ NOT JavaScriptResourceVersion_Fork_CrossReferences( l.branch_id, l.scriptresourceversion ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvASSIGN NAME = "l.scriptcombinedresourcexresource:comb_id"	VALUE = "{ l.comb_id }">
	<MvASSIGN NAME = "l.scriptcombinedresourcexresource:res_id"		VALUE = "{ l.scriptresourceversion:res_id }">
	<MvASSIGN NAME = "l.scriptcombinedresourcexresource:xref_id"	VALUE = "{ l.scriptresourceversion:xref_id }">

	<MvFUNCTIONRETURN VALUE = "{ JavaScriptCombinedResourceXResource_Insert_LowLevel( l.scriptcombinedresourcexresource ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptCombinedResourceXResource_Insert_LowLevel" PARAMETERS = "scriptcombinedresourcexresource var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.scriptcombinedresourcexresource:disp_order" VALUE = "{ [ g.Module_Library_DB ].StoreKey_Generate( 'JavaScriptCombinedResourceXResourceDisplayOrder' ) }">

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'JavaScriptCombinedResourceXResource
					      ( comb_id, res_id, xref_id, disp_order )
						  VALUES
						  ( ?, ?, ?, ? )' }"
			 FIELDS	= "l.scriptcombinedresourcexresource:comb_id, l.scriptcombinedresourcexresource:res_id,
					   l.scriptcombinedresourcexresource:xref_id, l.scriptcombinedresourcexresource:disp_order">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00196', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptCombinedResourceXResource_Fork" PARAMETERS = "scriptresourceversion var, new_xref_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'JavaScriptCombinedResourceXResource
					      ( comb_id, res_id, xref_id, disp_order )
						  SELECT comb_id, res_id, ?, disp_order FROM ' $ g.Store_Table_Prefix $ 'JavaScriptCombinedResourceXResource WHERE res_id = ? AND xref_id = ?' }"
			 FIELDS	= "l.new_xref_id,
					   l.scriptresourceversion:res_id, l.scriptresourceversion:xref_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00277', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptCombinedResourceXResource_Delete_All_CombinedResource" PARAMETERS = "comb_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'JavaScriptCombinedResourceXResource WHERE comb_id = ?' }"
			 FIELDS	= "l.comb_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00197', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptCombinedResourceXResource_Delete_All_Resource" PARAMETERS = "res_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'JavaScriptCombinedResourceXResource WHERE res_id = ?' }"
			 FIELDS	= "l.res_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00278', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptCombinedResourceXResource_Delete_All" PARAMETERS = "" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'JavaScriptCombinedResourceXResource' }"
			 FIELDS	= "">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00279', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptCombinedResourceXResource_Delete" PARAMETERS = "comb_id, res_id" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ JavaScriptCombinedResourceXResource_Delete_Branch( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.comb_id, l.res_id ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptCombinedResourceXResource_Delete_Branch" PARAMETERS = "branch_id, comb_id, res_id" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT JavaScriptResourceVersion_Load_Branch_Head( l.branch_id, l.res_id, l.scriptresourceversion ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ NOT JavaScriptResourceVersion_Fork_CrossReferences( l.branch_id, l.scriptresourceversion ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvASSIGN NAME = "l.scriptcombinedresourcexresource:comb_id"	VALUE = "{ l.comb_id }">
	<MvASSIGN NAME = "l.scriptcombinedresourcexresource:res_id"		VALUE = "{ l.scriptresourceversion:res_id }">
	<MvASSIGN NAME = "l.scriptcombinedresourcexresource:xref_id"	VALUE = "{ l.scriptresourceversion:xref_id }">

	<MvFUNCTIONRETURN VALUE = "{ JavaScriptCombinedResourceXResource_Delete_LowLevel( l.scriptcombinedresourcexresource ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptCombinedResourceXResource_Delete_LowLevel" PARAMETERS = "scriptcombinedresourcexresource var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'JavaScriptCombinedResourceXResource WHERE comb_id = ? AND res_id = ? AND xref_id = ?' }"
			 FIELDS	= "l.scriptcombinedresourcexresource:comb_id, l.scriptcombinedresourcexresource:res_id, l.scriptcombinedresourcexresource:xref_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{  [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00280', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptCombinedResourceXResource_Delete_All_Orphaned_CombinedResources" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'JavaScriptCombinedResourceXResource
			 			  WHERE comb_id NOT IN ( SELECT DISTINCT res_id FROM ' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00832', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptCombinedResourceXResource_Delete_All_Orphaned_Resources" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'JavaScriptCombinedResourceXResource
			 			  WHERE res_id NOT IN ( SELECT DISTINCT res_id FROM ' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00833', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptCombinedResourceXResource_Load" PARAMETERS = "comb_id, res_id, scriptcombinedresourcexresource var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ JavaScriptCombinedResourceXResource_Load_Branch( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.comb_id, l.res_id, l.scriptcombinedresourcexresource ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptCombinedResourceXResource_Load_Branch" PARAMETERS = "branch_id, comb_id, res_id, scriptcombinedresourcexresource var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "JavaScriptCombinedResourceXResource"
				QUERY	= "{ 'SELECT
								rxr.*
							  FROM
								' $ g.Store_Table_Prefix $ 'JavaScriptCombinedResourceXResource rxr,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceVersions v,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions bv
							  WHERE
								rxr.comb_id		= ?				AND
								rxr.res_id		= ?				AND
								v.res_id		= rxr.res_id	AND
								v.xref_id		= rxr.xref_id	AND
								bv.version_id	= v.id			AND
								bv.branch_id	= ?				AND
								bv.head			= 1' }"
				FIELDS	= "l.comb_id, l.res_id, l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00281', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ JavaScriptCombinedResourceXResource.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptCombinedResourceXResource">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00282' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ JavaScriptCombinedResourceXResource_Read( l.scriptcombinedresourcexresource ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptCombinedResourceXResource">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptCombinedResourceXResourceList_Load_Resource" PARAMETERS = "res_id, scriptcombinedresourcexresources var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ JavaScriptCombinedResourceXResourceList_Load_Branch_Resource( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.res_id, l.scriptcombinedresourcexresources ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptCombinedResourceXResourceList_Load_Branch_Resource" PARAMETERS = "branch_id, res_id, scriptcombinedresourcexresources var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "JavaScriptCombinedResourceXResource"
				QUERY	= "{ 'SELECT
								rxr.*
							  FROM
								' $ g.Store_Table_Prefix $ 'JavaScriptCombinedResourceXResource rxr,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceVersions v,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions bv
							  WHERE
								v.res_id		= ?			AND
								rxr.xref_id		= v.xref_id	AND
								bv.version_id	= v.id		AND
								bv.branch_id	= ?			AND
								bv.head			= 1' }"
				FIELDS	= "l.res_id, l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00448', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.scriptcombinedresourcexresource_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT JavaScriptCombinedResourceXResource.d.EOF }">
		<MvEVAL EXPR = "{ JavaScriptCombinedResourceXResource_Read( l.scriptcombinedresourcexresources[ ++l.scriptcombinedresourcexresource_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "JavaScriptCombinedResourceXResource" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptCombinedResourceXResource">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00449', l.scriptcombinedresourcexresource_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptCombinedResourceXResourceList_Load_CombinedResource" PARAMETERS = "comb_id, scriptcombinedresourcexresources var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ JavaScriptCombinedResourceXResourceList_Load_Branch_CombinedResource( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.comb_id, l.scriptcombinedresourcexresources ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptCombinedResourceXResourceList_Load_Branch_CombinedResource" PARAMETERS = "branch_id, comb_id, scriptcombinedresourcexresources var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "JavaScriptCombinedResourceXResource"
				QUERY	= "{ 'SELECT
								rxr.*
							  FROM
								' $ g.Store_Table_Prefix $ 'JavaScriptCombinedResourceXResource rxr,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceVersions v,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions bv
							  WHERE
								rxr.comb_id		= ?				AND
								v.res_id		= rxr.res_id	AND
								v.xref_id		= rxr.xref_id	AND
								bv.version_id	= v.id			AND
								bv.branch_id	= ?				AND
								bv.head			= 1' }"
				FIELDS	= "l.comb_id, l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00483', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.scriptcombinedresourcexresource_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT JavaScriptCombinedResourceXResource.d.EOF }">
		<MvEVAL EXPR = "{ JavaScriptCombinedResourceXResource_Read( l.scriptcombinedresourcexresources[ ++l.scriptcombinedresourcexresource_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "JavaScriptCombinedResourceXResource" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptCombinedResourceXResource">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00484', l.scriptcombinedresourcexresource_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptCombinedResourceXResourceList_Load_All" PARAMETERS = "scriptcombinedresourcexresources var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ JavaScriptCombinedResourceXResourceList_Load_Branch_All( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.scriptcombinedresourcexresources ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptCombinedResourceXResourceList_Load_Branch_All" PARAMETERS = "branch_id, scriptcombinedresourcexresources var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "JavaScriptCombinedResourceXResource"
				QUERY	= "{ 'SELECT
								rxr.*
							  FROM
								' $ g.Store_Table_Prefix $ 'JavaScriptCombinedResourceXResource rxr,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceVersions v,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions bv
							  WHERE
								v.res_id		= rxr.res_id	AND
								v.xref_id		= rxr.xref_id	AND
								bv.version_id	= v.id			AND
								bv.branch_id	= ?				AND
								bv.head			= 1
							  ORDER BY
								rxr.comb_id, rxr.disp_order' }"
				FIELDS	= "l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00285', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.scriptcombinedresourcexresource_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT JavaScriptCombinedResourceXResource.d.EOF }">
		<MvEVAL EXPR = "{ JavaScriptCombinedResourceXResource_Read( l.scriptcombinedresourcexresources[ ++l.scriptcombinedresourcexresource_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "JavaScriptCombinedResourceXResource" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptCombinedResourceXResource">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00286', l.scriptcombinedresourcexresource_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptCombinedResourceXResource_Update_Offsets_PastEnd" PARAMETERS = "comb_id, xref_id, pastend var, pastend_count" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvCOMMENT>
	|
	| Process records moving past the end.  These records must be sorted in ascending order.
	|
	</MvCOMMENT>

	<MvEVAL EXPR = "{ [ g.Module_Library_Utilities ].SortOffsetArray_PastEnd( l.pastend, l.pastend_count ) }">

	<MvASSIGN NAME = "l.pastend_pos" VALUE = 1>
	<MvWHILE EXPR = "{ l.pastend_pos LE l.pastend_count }">
		<MvASSIGN NAME = "l.res_id" 		VALUE = "{ l.pastend[ l.pastend_pos ]:res_id }">
		<MvASSIGN NAME = "l.disp_order"		VALUE = "{ [ g.Module_Library_DB ].StoreKey_Generate( 'JavaScriptCombinedResourceXResourceDisplayOrder' ) }">

		<MvQUERY NAME	= "Merchant"
				 QUERY	= "{ 'UPDATE ' 
							  	$ g.Store_Table_Prefix $ 'JavaScriptCombinedResourceXResource 
							  SET 
							  	disp_order	= ? 
							  WHERE 
							  	comb_id		= ? AND
							  	res_id		= ? AND
								xref_id		= ?' }"
				 FIELDS	= "l.disp_order, l.comb_id, l.res_id, l.xref_id">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00287', g.MvQUERY_Error ) }">
		</MvIF>
		
		<MvASSIGN NAME = "l.pastend_pos" VALUE = "{ l.pastend_pos + 1 }">
	</MvWHILE>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptCombinedResourceXResource_Update_Offsets" PARAMETERS = "comb_id, scriptcombinedresourcexresources var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ JavaScriptCombinedResourceXResource_Update_Branch_Offsets( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.comb_id, l.scriptcombinedresourcexresources ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptCombinedResourceXResource_Update_Branch_Offsets" PARAMETERS = "branch_id, comb_id, scriptcombinedresourcexresources var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.pastend_count"													VALUE = 0>

	<MvASSIGN NAME = "l.scriptcombinedresourcexresource_pos"							VALUE = 1>
	<MvASSIGN NAME = "l.scriptcombinedresourcexresource_count"							VALUE = "{ miva_array_elements( l.scriptcombinedresourcexresources ) }">
	<MvASSIGN NAME = "g.JavaScriptCombinedResourceXResource_Order_CombinedResourceID" 	VALUE = "{ l.comb_id }">

	<MvCOMMENT>
	|
	| Fork all resources assigned to this combined resource into a specific xref_id
	|
	</MvCOMMENT>

	<MvASSIGN NAME = "l.xref_id"														VALUE = "{ [ g.Module_Library_DB ].StoreKey_Generate( 'JavaScriptResourceReferences' ) }">
	<MvASSIGN NAME = "g.JavaScriptCombinedResourceXResource_Order_XRefID"				VALUE = "{ l.xref_id }">

	<MvFOREACH ITERATOR = "l.scriptresourceversion" ARRAY = "l.scriptresourceversions" COUNT = "{ JavaScriptResourceVersionList_Load_Branch_CombinedResource( l.branch_id, l.comb_id, l.scriptresourceversions ) }">
		<MvIF EXPR = "{ NOT JavaScriptResourceVersion_Fork_CrossReferences_ID( l.branch_id, l.scriptresourceversion, l.xref_id ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	</MvFOREACH>

	<MvCOMMENT>
	|
	| Process display order updates
	|
	</MvCOMMENT>

	<MvEVAL EXPR = "{ [ g.Module_Library_Utilities ].SortOffsetArray( l.scriptcombinedresourcexresources, l.scriptcombinedresourcexresource_count ) }">

	<MvWHILE EXPR = "{ l.scriptcombinedresourcexresource_pos LE l.scriptcombinedresourcexresource_count }">
		<MvASSIGN NAME = "g.JavaScriptCombinedResourceXResource_Order_ResourceID" VALUE = "{ l.scriptcombinedresourcexresources[ l.scriptcombinedresourcexresource_pos ]:res_id }">

		<MvCOMMENT>
		|
		| Determine disp_order of current scriptcombinedresourcexresource at this offset.
		|
		</MvCOMMENT>

		<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_OPENVIEW_Range( 'Merchant',
																				 'JavaScriptCombinedResourceXResource',
																				 'SELECT res_id, disp_order FROM ' $ g.Store_Table_Prefix $ 'JavaScriptCombinedResourceXResource WHERE res_id <> ? AND comb_id = ? AND xref_id = ? ORDER BY disp_order',
																				 'g.JavaScriptCombinedResourceXResource_Order_ResourceID, g.JavaScriptCombinedResourceXResource_Order_CombinedResourceID, g.JavaScriptCombinedResourceXResource_Order_XRefID',
																				 l.scriptcombinedresourcexresources[ l.scriptcombinedresourcexresource_pos ]:offset - 1,
																				 1 ) }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00288', g.MvOPENVIEW_Error ) }">
		</MvIF>

		<MvIF EXPR = "{ JavaScriptCombinedResourceXResource.d.EOF }">
			<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptCombinedResourceXResource">

			<MvCOMMENT>
			|
			| Offset was higher than the last record.  This case requires specialized processing, so save this record for later.
			|
			</MvCOMMENT>

			<MvASSIGN NAME = "l.pastend_count"							VALUE = "{ l.pastend_count + 1 }">
			<MvASSIGN NAME = "l.pastend" INDEX = "{ l.pastend_count }"	VALUE = "{ l.scriptcombinedresourcexresources[ l.scriptcombinedresourcexresource_pos ] }">

			<MvASSIGN NAME = "l.scriptcombinedresourcexresource_pos"	VALUE = "{ l.scriptcombinedresourcexresource_pos + 1 }">
		<MvELSEIF EXPR = "{ l.pastend_count }">
			<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptCombinedResourceXResource">

			<MvIF EXPR = "{ NOT JavaScriptCombinedResourceXResource_Update_Offsets_PastEnd( l.comb_id, l.xref_id, l.pastend, l.pastend_count ) }">
				<MvFUNCTIONRETURN VALUE = 0>
			</MvIF>

			<MvASSIGN NAME = "l.pastend_count" VALUE = 0>
		<MvELSE>
			<MvASSIGN NAME = "l.disp_order" VALUE = "{ JavaScriptCombinedResourceXResource.d.disp_order }">
			<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptCombinedResourceXResource">

			<MvCOMMENT>
			|
			| Make a hole by shifting scriptcombinedresourcexresources after this disp_order down
			|
			</MvCOMMENT>

			<MvQUERY NAME	= "Merchant"
					 QUERY	= "{ 'UPDATE ' 
								  	$ g.Store_Table_Prefix $ 'JavaScriptCombinedResourceXResource 
								  SET 
								  	disp_order	= disp_order + 1 
								  WHERE 
								  	disp_order	>= ?	AND
								  	comb_id		= ?		AND
									xref_id		= ?' }" 
					 FIELDS	= "l.disp_order, l.comb_id, l.xref_id">
			<MvIF EXPR = "{ g.MvQUERY_Error }">
				<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00289', g.MvQUERY_Error ) }">
			</MvIF>

			<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Library_DB ].StoreKey_Generate( 'JavaScriptCombinedResourceXResourceDisplayOrder' ) }">

			<MvCOMMENT>
			|
			| Put the scriptcombinedresourcexresource in the newly created hole
			|
			</MvCOMMENT>

			<MvQUERY NAME	= "Merchant"
					 QUERY	= "{ 'UPDATE ' 
								  	$ g.Store_Table_Prefix $ 'JavaScriptCombinedResourceXResource 
								  SET 
								  	disp_order	= ? 
								  WHERE 
									comb_id		= ?	AND
								  	res_id		= ? AND
									xref_id		= ?' }"
					 FIELDS	= "l.disp_order, l.comb_id, g.JavaScriptCombinedResourceXResource_Order_ResourceID, l.xref_id">
			<MvIF EXPR = "{ g.MvQUERY_Error }">
				<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00290', g.MvQUERY_Error ) }">
			</MvIF>

			<MvASSIGN NAME = "l.scriptcombinedresourcexresource_pos" VALUE = "{ l.scriptcombinedresourcexresource_pos + 1 }">
		</MvIF>
	</MvWHILE>

	<MvCOMMENT>
	|
	| If all the downward records were past the end, they must be processed here.
	|
	</MvCOMMENT>

	<MvIF EXPR = "{ l.pastend_count }">
		<MvIF EXPR = "{ NOT JavaScriptCombinedResourceXResource_Update_Offsets_PastEnd( l.comb_id, l.xref_id, l.pastend, l.pastend_count ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_JavaScriptResourceXGroup
|
</MvCOMMENT>

<MvFUNCTION NAME = "JavaScriptResourceXGroup_Read" PARAMETERS = "scriptresourcexgroup var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.scriptresourcexgroup:script_id"		VALUE = "{ JavaScriptResourceXGroup.d.script_id }">
	<MvASSIGN NAME = "l.scriptresourcexgroup:xref_id"		VALUE = "{ JavaScriptResourceXGroup.d.xref_id }">
	<MvASSIGN NAME = "l.scriptresourcexgroup:group_id"		VALUE = "{ JavaScriptResourceXGroup.d.group_id }">
	<MvASSIGN NAME = "l.scriptresourcexgroup:disp_order"	VALUE = "{ JavaScriptResourceXGroup.d.disp_order }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceXGroup_Insert" PARAMETERS = "script_id, group_id" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ JavaScriptResourceXGroup_Insert_Branch( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.script_id, l.group_id ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceXGroup_Insert_Branch" PARAMETERS = "branch_id, script_id, group_id" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT JavaScriptResourceVersion_Load_Branch_Head( l.branch_id, l.script_id, l.scriptresourceversion ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ NOT JavaScriptResourceVersion_Fork_CrossReferences( l.branch_id, l.scriptresourceversion ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvASSIGN NAME = "l.scriptresourcexgroup:script_id"	VALUE = "{ l.scriptresourceversion:res_id }">
	<MvASSIGN NAME = "l.scriptresourcexgroup:xref_id"	VALUE = "{ l.scriptresourceversion:xref_id }">
	<MvASSIGN NAME = "l.scriptresourcexgroup:group_id"	VALUE = "{ l.group_id }">

	<MvFUNCTIONRETURN VALUE = "{ JavaScriptResourceXGroup_Insert_LowLevel( l.scriptresourcexgroup ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceXGroup_Insert_LowLevel" PARAMETERS = "scriptresourcexgroup var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.scriptresourcexgroup:disp_order" VALUE = "{ [ g.Module_Library_DB ].StoreKey_Generate( 'JavaScriptResourceXGroupDisplayOrder' ) }">

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'JavaScriptResourceXGroup
					      ( script_id, xref_id, group_id, disp_order )
						  VALUES
						  ( ?, ?, ?, ? )' }"
			 FIELDS	= "l.scriptresourcexgroup:script_id, l.scriptresourcexgroup:xref_id, l.scriptresourcexgroup:group_id,
					   l.scriptresourcexgroup:disp_order">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00450', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceXGroup_Fork" PARAMETERS = "scriptresourceversion var, new_xref_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'JavaScriptResourceXGroup
					      ( script_id, xref_id, group_id, disp_order )
						  SELECT script_id, ?, group_id, disp_order FROM ' $ g.Store_Table_Prefix $ 'JavaScriptResourceXGroup WHERE script_id = ? AND xref_id = ?' }"
			 FIELDS	= "l.new_xref_id,
					   l.scriptresourceversion:res_id, l.scriptresourceversion:xref_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00426', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceXGroup_Delete_All_Script" PARAMETERS = "script_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'JavaScriptResourceXGroup WHERE script_id = ?' }"
			 FIELDS	= "l.script_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00451', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceXGroup_Delete_All_Group" PARAMETERS = "group_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'JavaScriptResourceXGroup WHERE group_id = ?' }"
			 FIELDS	= "l.group_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00198', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceXGroup_Delete_All" PARAMETERS = "" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'JavaScriptResourceXGroup' }"
			 FIELDS	= "">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00199', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceXGroup_Delete" PARAMETERS = "script_id, group_id" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ JavaScriptResourceXGroup_Delete_Branch( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.script_id, l.group_id ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceXGroup_Delete_Branch" PARAMETERS = "branch_id, script_id, group_id" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT JavaScriptResourceVersion_Load_Branch_Head( l.branch_id, l.script_id, l.scriptresourceversion ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ NOT JavaScriptResourceVersion_Fork_CrossReferences( l.branch_id, l.scriptresourceversion ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvASSIGN NAME = "l.scriptresourcexgroup:script_id"	VALUE = "{ l.scriptresourceversion:res_id }">
	<MvASSIGN NAME = "l.scriptresourcexgroup:xref_id"	VALUE = "{ l.scriptresourceversion:xref_id }">
	<MvASSIGN NAME = "l.scriptresourcexgroup:group_id"	VALUE = "{ l.group_id }">

	<MvFUNCTIONRETURN VALUE = "{ JavaScriptResourceXGroup_Delete_LowLevel( l.scriptresourcexgroup ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceXGroup_Delete_LowLevel" PARAMETERS = "scriptresourcexgroup var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'JavaScriptResourceXGroup WHERE script_id = ? AND xref_id = ? AND group_id = ?' }"
			 FIELDS	= "l.scriptresourcexgroup:script_id, l.scriptresourcexgroup:xref_id, l.scriptresourcexgroup:group_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{  [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00200', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceXGroup_Delete_All_Orphaned_Scripts" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'JavaScriptResourceXGroup
			 			  WHERE script_id NOT IN ( SELECT DISTINCT res_id FROM ' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00834', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceXGroup_Load" PARAMETERS = "script_id, group_id, scriptresourcexgroup var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ JavaScriptResourceXGroup_Load_Branch( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.script_id, l.group_id, l.scriptresourcexgroup ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceXGroup_Load_Branch" PARAMETERS = "branch_id, script_id, group_id, scriptresourcexgroup var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "JavaScriptResourceXGroup"
				QUERY	= "{ 'SELECT
								jxg.*
							  FROM
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceXGroup jxg,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceVersions v,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions bv
							  WHERE
								jxg.script_id	= ?				AND
								jxg.group_id	= ?				AND
								v.res_id		= jxg.script_id	AND
								v.xref_id		= jxg.xref_id	AND
								bv.version_id	= v.id			AND
								bv.branch_id	= ?				AND
								bv.head			= 1' }"
				FIELDS	= "l.script_id, l.group_id, l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00201', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ JavaScriptResourceXGroup.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptResourceXGroup">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00202' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ JavaScriptResourceXGroup_Read( l.scriptresourcexgroup ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptResourceXGroup">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceXGroupList_Load_Resource" PARAMETERS = "script_id, scriptresourcexgroups var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ JavaScriptResourceXGroupList_Load_Branch_Resource( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.script_id, l.scriptresourcexgroups ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceXGroupList_Load_Branch_Resource" PARAMETERS = "branch_id, script_id, scriptresourcexgroups var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "JavaScriptResourceXGroup"
				QUERY	= "{ 'SELECT
								jxg.*
							  FROM
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceXGroup jxg,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceVersions v,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions bv
							  WHERE
								v.res_id		= ?			AND
								jxg.script_id	= v.res_id	AND
								jxg.xref_id		= v.xref_id	AND
								bv.version_id	= v.id		AND
								bv.branch_id	= ?			AND
								bv.head			= 1' }"
				FIELDS	= "l.script_id, l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00452', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.scriptresourcexgroup_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT JavaScriptResourceXGroup.d.EOF }">
		<MvEVAL EXPR = "{ JavaScriptResourceXGroup_Read( l.scriptresourcexgroups[ ++l.scriptresourcexgroup_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "JavaScriptResourceXGroup" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptResourceXGroup">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00453', l.scriptresourcexgroup_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceXGroupList_Load_Group" PARAMETERS = "group_id, scriptresourcexgroups var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ JavaScriptResourceXGroupList_Load_Branch_Group( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.group_id, l.scriptresourcexgroups ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceXGroupList_Load_Branch_Group" PARAMETERS = "branch_id, group_id, scriptresourcexgroups var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "JavaScriptResourceXGroup"
				QUERY	= "{ 'SELECT
								jxg.*
							  FROM
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceXGroup jxg,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceVersions v,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions bv
							  WHERE
								jxg.group_id	= ?				AND
								v.res_id		= jxg.script_id	AND
								v.xref_id		= jxg.xref_id	AND
								bv.version_id	= v.id			AND
								bv.branch_id	= ?				AND
								bv.head			= 1
							  ORDER BY
								jxg.disp_order' }"
				FIELDS	= "l.group_id, l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00485', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.scriptresourcexgroup_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT JavaScriptResourceXGroup.d.EOF }">
		<MvEVAL EXPR = "{ JavaScriptResourceXGroup_Read( l.scriptresourcexgroups[ ++l.scriptresourcexgroup_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "JavaScriptResourceXGroup" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptResourceXGroup">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00486', l.scriptresourcexgroup_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceXGroupList_Load_All" PARAMETERS = "scriptresourcexgroups var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ JavaScriptResourceXGroupList_Load_Branch_All( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.scriptresourcexgroups ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceXGroupList_Load_Branch_All" PARAMETERS = "branch_id, scriptresourcexgroups var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "JavaScriptResourceXGroup"
				QUERY	= "{ 'SELECT
								jxg.*
							  FROM
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceXGroup jxg,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceVersions v,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions bv
							  WHERE
								v.res_id		= jxg.script_id	AND
								v.xref_id		= jxg.xref_id	AND
								bv.version_id	= v.id			AND
								bv.branch_id	= ?				AND
								bv.head			= 1
							  ORDER BY
								jxg.group_id, jxg.disp_order' }"
				FIELDS	= "l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00203', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.scriptresourcexgroup_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT JavaScriptResourceXGroup.d.EOF }">
		<MvEVAL EXPR = "{ JavaScriptResourceXGroup_Read( l.scriptresourcexgroups[ ++l.scriptresourcexgroup_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "JavaScriptResourceXGroup" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptResourceXGroup">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00204', l.scriptresourcexgroup_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceXGroup_Update_Offsets_PastEnd" PARAMETERS = "group_id, xref_id, pastend var, pastend_count" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvCOMMENT>
	|
	| Process records moving past the end.  These records must be sorted in ascending order.
	|
	</MvCOMMENT>

	<MvEVAL EXPR = "{ [ g.Module_Library_Utilities ].SortOffsetArray_PastEnd( l.pastend, l.pastend_count ) }">

	<MvASSIGN NAME = "l.pastend_pos"		VALUE = 1>
	<MvWHILE EXPR = "{ l.pastend_pos LE l.pastend_count }">
		<MvASSIGN NAME = "l.script_id"		VALUE = "{ l.pastend[ l.pastend_pos ]:script_id }">
		<MvASSIGN NAME = "l.disp_order"		VALUE = "{ [ g.Module_Library_DB ].StoreKey_Generate( 'JavaScriptResourceXGroupDisplayOrder' ) }">

		<MvQUERY NAME	= "Merchant"
				 QUERY	= "{ 'UPDATE ' 
							  	$ g.Store_Table_Prefix $ 'JavaScriptResourceXGroup 
							  SET 
							  	disp_order	= ? 
							  WHERE 
							  	script_id	= ? AND
								xref_id		= ? AND
								group_id	= ?' }" 
				 FIELDS	= "l.disp_order,
						   l.script_id, l.xref_id, l.group_id">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00205', g.MvQUERY_Error ) }">
		</MvIF>
		
		<MvASSIGN NAME = "l.pastend_pos"	VALUE = "{ l.pastend_pos + 1 }">
	</MvWHILE>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceXGroup_Update_Offsets" PARAMETERS = "group_id, scriptxgroups var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ JavaScriptResourceXGroup_Update_Branch_Offsets( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.group_id, l.scriptxgroups ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceXGroup_Update_Branch_Offsets" PARAMETERS = "branch_id, group_id, scriptxgroups var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.pastend_count"												VALUE = 0>

	<MvASSIGN NAME = "l.scriptxgroup_pos"											VALUE = 1>
	<MvASSIGN NAME = "l.scriptxgroup_count"											VALUE = "{ miva_array_elements( l.scriptxgroups ) }">
	<MvASSIGN NAME = "g.JavaScriptResourceXGroup_Order_GroupID" 					VALUE = "{ l.group_id }">

	<MvCOMMENT>
	|
	| Fork all resources assigned to this group into a specific xref_id
	|
	</MvCOMMENT>

	<MvASSIGN NAME = "l.xref_id"													VALUE = "{ [ g.Module_Library_DB ].StoreKey_Generate( 'JavaScriptResourceReferences' ) }">
	<MvASSIGN NAME = "g.JavaScriptResourceXGroup_Order_XRefID"						VALUE = "{ l.xref_id }">

	<MvFOREACH ITERATOR = "l.scriptresourceversion" ARRAY = "l.scriptresourceversions" COUNT = "{ JavaScriptResourceVersionList_Load_Branch_ResourceGroup( l.branch_id, l.group_id, l.scriptresourceversions ) }">
		<MvIF EXPR = "{ NOT JavaScriptResourceVersion_Fork_CrossReferences_ID( l.branch_id, l.scriptresourceversion, l.xref_id ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	</MvFOREACH>

	<MvCOMMENT>
	|
	| Process display order updates
	|
	</MvCOMMENT>

	<MvEVAL EXPR = "{ [ g.Module_Library_Utilities ].SortOffsetArray( l.scriptxgroups, l.scriptxgroup_count ) }">

	<MvWHILE EXPR = "{ l.scriptxgroup_pos LE l.scriptxgroup_count }">
		<MvASSIGN NAME = "g.JavaScriptResourceXGroup_Order_JavaScriptResource_ID" 	VALUE = "{ l.scriptxgroups[ l.scriptxgroup_pos ]:script_id }">

		<MvCOMMENT>
		|
		| Determine disp_order of current scriptxgroup at this offset.
		|
		</MvCOMMENT>

		<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_OPENVIEW_Range( 'Merchant',
																				 'JavaScriptResourceXGroup',
																				 'SELECT script_id, disp_order FROM ' $ g.Store_Table_Prefix $ 'JavaScriptResourceXGroup WHERE script_id <> ? AND group_id = ? AND xref_id = ? ORDER BY disp_order',
																				 'g.JavaScriptResourceXGroup_Order_JavaScriptResource_ID, g.JavaScriptResourceXGroup_Order_GroupID, g.JavaScriptResourceXGroup_Order_XRefID',
																				 l.scriptxgroups[ l.scriptxgroup_pos ]:offset - 1,
																				 1 ) }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00206', g.MvOPENVIEW_Error ) }">
		</MvIF>

		<MvIF EXPR = "{ JavaScriptResourceXGroup.d.EOF }">
			<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptResourceXGroup">

			<MvCOMMENT>
			|
			| Offset was higher than the last record.  This case requires specialized processing, so save this record for later.
			|
			</MvCOMMENT>

			<MvASSIGN NAME = "l.pastend_count"							VALUE = "{ l.pastend_count + 1 }">
			<MvASSIGN NAME = "l.pastend" INDEX = "{ l.pastend_count }"	VALUE = "{ l.scriptxgroups[ l.scriptxgroup_pos ] }">

			<MvASSIGN NAME = "l.scriptxgroup_pos"						VALUE = "{ l.scriptxgroup_pos + 1 }">
		<MvELSEIF EXPR = "{ l.pastend_count }">
			<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptResourceXGroup">

			<MvIF EXPR = "{ NOT JavaScriptResourceXGroup_Update_Offsets_PastEnd( l.group_id, l.xref_id, l.pastend, l.pastend_count ) }">
				<MvFUNCTIONRETURN VALUE = 0>
			</MvIF>

			<MvASSIGN NAME = "l.pastend_count" VALUE = 0>
		<MvELSE>
			<MvASSIGN NAME = "l.disp_order" VALUE = "{ JavaScriptResourceXGroup.d.disp_order }">
			<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptResourceXGroup">

			<MvCOMMENT>
			|
			| Make a hole by shifting scriptxgroups after this disp_order down
			|
			</MvCOMMENT>

			<MvQUERY NAME	= "Merchant"
					 QUERY	= "{ 'UPDATE ' 
								  	$ g.Store_Table_Prefix $ 'JavaScriptResourceXGroup 
								  SET 
								  	disp_order	= disp_order + 1 
								  WHERE 
								  	disp_order	>= ?	AND
									group_id	= ?		AND
									xref_id		= ?' }" 
					 FIELDS	= "l.disp_order, l.group_id, l.xref_id">
			<MvIF EXPR = "{ g.MvQUERY_Error }">
				<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00207', g.MvQUERY_Error ) }">
			</MvIF>

			<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Library_DB ].StoreKey_Generate( 'JavaScriptResourceXGroupDisplayOrder' ) }">

			<MvCOMMENT>
			|
			| Put the scriptxgroup in the newly created hole
			|
			</MvCOMMENT>

			<MvQUERY NAME	= "Merchant"
					 QUERY	= "{ 'UPDATE ' 
								  	$ g.Store_Table_Prefix $ 'JavaScriptResourceXGroup 
								  SET 
								  	disp_order	= ? 
								  WHERE 
								  	script_id	= ?	AND
									xref_id		= ? AND
									group_id	= ?' }" 
					 FIELDS	= "l.disp_order,
							   g.JavaScriptResourceXGroup_Order_JavaScriptResource_ID, l.xref_id, l.group_id">
			<MvIF EXPR = "{ g.MvQUERY_Error }">
				<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00208', g.MvQUERY_Error ) }">
			</MvIF>

			<MvASSIGN NAME = "l.scriptxgroup_pos" VALUE = "{ l.scriptxgroup_pos + 1 }">
		</MvIF>
	</MvWHILE>

	<MvCOMMENT>
	|
	| If all the downward records were past the end, they must be processed here.
	|
	</MvCOMMENT>

	<MvIF EXPR = "{ l.pastend_count }">
		<MvIF EXPR = "{ NOT JavaScriptResourceXGroup_Update_Offsets_PastEnd( l.group_id, l.xref_id, l.pastend, l.pastend_count ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_JavaScriptResourceXPage
|
</MvCOMMENT>

<MvFUNCTION NAME = "JavaScriptResourceXPage_Read" PARAMETERS = "scriptresourcexpage var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.scriptresourcexpage:script_id"	VALUE = "{ JavaScriptResourceXPage.d.script_id }">
	<MvASSIGN NAME = "l.scriptresourcexpage:xref_id"	VALUE = "{ JavaScriptResourceXPage.d.xref_id }">
	<MvASSIGN NAME = "l.scriptresourcexpage:page_id"	VALUE = "{ JavaScriptResourceXPage.d.page_id }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceXPage_Insert" PARAMETERS = "script_id, page_id" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ JavaScriptResourceXPage_Insert_Branch( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.script_id, l.page_id ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceXPage_Insert_Branch" PARAMETERS = "branch_id, script_id, page_id" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT JavaScriptResourceVersion_Load_Branch_Head( l.branch_id, l.script_id, l.scriptresourceversion ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ NOT JavaScriptResourceVersion_Fork_CrossReferences( l.branch_id, l.scriptresourceversion ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvASSIGN NAME = "l.scriptresourcexpage:script_id"	VALUE = "{ l.scriptresourceversion:res_id }">
	<MvASSIGN NAME = "l.scriptresourcexpage:xref_id"	VALUE = "{ l.scriptresourceversion:xref_id }">
	<MvASSIGN NAME = "l.scriptresourcexpage:page_id"	VALUE = "{ l.page_id }">

	<MvFUNCTIONRETURN VALUE = "{ JavaScriptResourceXPage_Insert_LowLevel( l.scriptresourcexpage ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceXPage_Insert_LowLevel" PARAMETERS = "scriptresourcexpage var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'JavaScriptResourceXPage
					      ( script_id, xref_id, page_id )
						  VALUES
						  ( ?, ?, ? )' }"
			 FIELDS	= "l.scriptresourcexpage:script_id, l.scriptresourcexpage:xref_id, l.scriptresourcexpage:page_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00209', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceXPage_Fork" PARAMETERS = "scriptresourceversion var, new_xref_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'JavaScriptResourceXPage
					      ( script_id, xref_id, page_id )
						  SELECT script_id, ?, page_id FROM ' $ g.Store_Table_Prefix $ 'JavaScriptResourceXPage WHERE script_id = ? AND xref_id = ?' }"
			 FIELDS	= "l.new_xref_id,
					   l.scriptresourceversion:res_id, l.scriptresourceversion:xref_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00427', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceXPage_Delete_All_Script" PARAMETERS = "script_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'JavaScriptResourceXPage WHERE script_id = ?' }"
			 FIELDS	= "l.script_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00210', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceXPage_Delete_All_Page" PARAMETERS = "page_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'JavaScriptResourceXPage WHERE page_id = ?' }"
			 FIELDS	= "l.page_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00266', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceXPage_Delete_All" PARAMETERS = "" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'JavaScriptResourceXPage' }"
			 FIELDS	= "">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00211', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceXPage_Delete" PARAMETERS = "script_id, page_id" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ JavaScriptResourceXPage_Delete_Branch( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.script_id, l.page_id ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceXPage_Delete_Branch" PARAMETERS = "branch_id, script_id, page_id" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT JavaScriptResourceVersion_Load_Branch_Head( l.branch_id, l.script_id, l.scriptresourceversion ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ NOT JavaScriptResourceVersion_Fork_CrossReferences( l.branch_id, l.scriptresourceversion ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvASSIGN NAME = "l.scriptresourcexpage:script_id"	VALUE = "{ l.scriptresourceversion:res_id }">
	<MvASSIGN NAME = "l.scriptresourcexpage:xref_id"	VALUE = "{ l.scriptresourceversion:xref_id }">
	<MvASSIGN NAME = "l.scriptresourcexpage:page_id"	VALUE = "{ l.page_id }">

	<MvFUNCTIONRETURN VALUE = "{ JavaScriptResourceXPage_Delete_LowLevel( l.scriptresourcexpage ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceXPage_Delete_LowLevel" PARAMETERS = "scriptresourcexpage var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'JavaScriptResourceXPage WHERE script_id = ? AND xref_id = ? AND page_id = ?' }"
			 FIELDS	= "l.scriptresourcexpage:script_id, l.scriptresourcexpage:xref_id, l.scriptresourcexpage:page_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{  [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00212', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceXPage_Delete_All_Orphaned_Pages" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'JavaScriptResourceXPage
			 			  WHERE page_id NOT IN ( SELECT DISTINCT page_id FROM ' $ g.Store_Table_Prefix $ 'PageBranchVersions )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00835', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceXPage_Delete_All_Orphaned_Scripts" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'JavaScriptResourceXPage
			 			  WHERE script_id NOT IN ( SELECT DISTINCT res_id FROM ' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00836', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceXPage_Load" PARAMETERS = "script_id, page_id, scriptresourcexpage var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ JavaScriptResourceXPage_Load_Branch( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.script_id, l.page_id, l.scriptresourcexpage ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceXPage_Load_Branch" PARAMETERS = "branch_id, script_id, page_id, scriptresourcexpage var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "JavaScriptResourceXPage"
				QUERY	= "{ 'SELECT
								jxp.*
							  FROM
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceXPage jxp,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceVersions v,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions bv
							  WHERE
								jxp.script_id	= ?				AND
								jxp.page_id		= ?				AND
								v.res_id		= jxp.script_id	AND
								v.xref_id		= jxp.xref_id	AND
								bv.version_id	= v.id			AND
								bv.branch_id	= ?				AND
								bv.head			= 1' }"
				FIELDS	= "l.script_id, l.page_id, l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00213', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ JavaScriptResourceXPage.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptResourceXPage">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00214' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ JavaScriptResourceXPage_Read( l.scriptresourcexpage ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptResourceXPage">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceXPageList_Load_Resource" PARAMETERS = "res_id, scriptresourcexpages var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ JavaScriptResourceXPageList_Load_Branch_Resource( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.res_id, l.scriptresourcexpages ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceXPageList_Load_Branch_Resource" PARAMETERS = "branch_id, res_id, scriptresourcexpages var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "JavaScriptResourceXPage"
				QUERY	= "{ 'SELECT
								jxp.*
							  FROM
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceXPage jxp,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceVersions v,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions bv
							  WHERE
								v.res_id		= ?			AND
								jxp.xref_id		= v.xref_id	AND
								bv.version_id	= v.id		AND
								bv.branch_id	= ?			AND
								bv.head			= 1' }"
				FIELDS	= "l.res_id, l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00454', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.scriptresourcexpage_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT JavaScriptResourceXPage.d.EOF }">
		<MvEVAL EXPR = "{ JavaScriptResourceXPage_Read( l.scriptresourcexpages[ ++l.scriptresourcexpage_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "JavaScriptResourceXPage" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptResourceXPage">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00455', l.scriptresourcexpage_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceXPageList_Load_All" PARAMETERS = "scriptresourcexpages var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ JavaScriptResourceXPageList_Load_Branch_All( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.scriptresourcexpages ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JavaScriptResourceXPageList_Load_Branch_All" PARAMETERS = "branch_id, scriptresourcexpages var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "JavaScriptResourceXPage"
				QUERY	= "{ 'SELECT
								jxp.*
							  FROM
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceXPage jxp,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceVersions v,
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions bv
							  WHERE
								v.res_id		= jxp.script_id	AND
								v.xref_id		= jxp.xref_id	AND
								bv.version_id	= v.id			AND
								bv.branch_id	= ?				AND
								bv.head			= 1' }"
				FIELDS	= "l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00215', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.scriptresourcexpage_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT JavaScriptResourceXPage.d.EOF }">
		<MvEVAL EXPR = "{ JavaScriptResourceXPage_Read( l.scriptresourcexpages[ ++l.scriptresourcexpage_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "JavaScriptResourceXPage" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptResourceXPage">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00216', l.scriptresourcexpage_count ) }">
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_CSSResources
|
</MvCOMMENT>

<MvFUNCTION NAME = "CSSResource_Read" PARAMETERS = "cssresource var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.cssresource:id"			VALUE = "{ CSSResources.d.id }">
	<MvASSIGN NAME = "l.cssresource:code"		VALUE = "{ CSSResources.d.code }">
	<MvASSIGN NAME = "l.cssresource:templ_id"	VALUE = "{ CSSResources.d.templ_id }">
	<MvASSIGN NAME = "l.cssresource:type"		VALUE = "{ CSSResources.d.type }">
	<MvASSIGN NAME = "l.cssresource:is_global"	VALUE = "{ CSSResources.d.is_global }">
	<MvASSIGN NAME = "l.cssresource:active"		VALUE = "{ CSSResources.d.active }">
	<MvASSIGN NAME = "l.cssresource:file"		VALUE = "{ CSSResources.d.file }">
	<MvASSIGN NAME = "l.cssresource:content_id"	VALUE = "{ CSSResources.d.content_id }">
	<MvASSIGN NAME = "l.cssresource:mod_code"	VALUE = "{ CSSResources.d.mod_code }">
	<MvASSIGN NAME = "l.cssresource:mod_data"	VALUE = "{ CSSResources.d.mod_data }">
	<MvASSIGN NAME = "l.cssresource:attributes"	VALUE = "{ miva_array_deserialize( CSSResources.d.attributes ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResource_Load_ID" PARAMETERS = "id, cssresource var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ CSSResource_Load_Branch_ID( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.id, l.cssresource ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResource_Load_Branch_ID" PARAMETERS = "branch_id, id, cssresource var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "CSSResources"
				QUERY	= "{ 'SELECT
								r.id			AS id,
								v.code			AS code,
								r.templ_id		AS templ_id,
								v.type			AS type,
								v.is_global		AS is_global,
								v.active		AS active,
								v.file			AS file,
								v.content_id	AS content_id,
								v.mod_code		AS mod_code,
								v.mod_data		AS mod_data,
								v.attributes	AS attributes
							  FROM
								' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions rbv,
								' $ g.Store_Table_Prefix $ 'CSSResources r,
								' $ g.Store_Table_Prefix $ 'CSSResourceVersions v
							  WHERE
								rbv.branch_id	= ?				AND
								rbv.res_id		= ?				AND
								r.id			= rbv.res_id	AND
								rbv.head		= 1				AND
								v.id			= rbv.version_id' }"
				FIELDS 	= "l.branch_id, l.id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00217', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ CSSResources.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSResources">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00218' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ CSSResource_Read( l.cssresource ) }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSResources">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResource_Load_Code" PARAMETERS = "code, cssresource var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ CSSResource_Load_Branch_Code( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.code, l.cssresource ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResource_Load_Branch_Code" PARAMETERS = "branch_id, code, cssresource var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "CSSResources"
				QUERY	= "{ 'SELECT
								r.id			AS id,
								v.code			AS code,
								r.templ_id		AS templ_id,
								v.type			AS type,
								v.is_global		AS is_global,
								v.active		AS active,
								v.file			AS file,
								v.content_id	AS content_id,
								v.mod_code		AS mod_code,
								v.mod_data		AS mod_data,
								v.attributes	AS attributes
							  FROM
								' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions rbv,
								' $ g.Store_Table_Prefix $ 'CSSResourceVersions v,
								' $ g.Store_Table_Prefix $ 'CSSResources r
							  WHERE
								rbv.branch_id	= ?					AND
								rbv.head		= 1					AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'rbv.code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_Upper( '?' ) $ ' AND
								v.id			= rbv.version_id	AND
								r.id			= v.res_id' }"
				FIELDS 	= "l.branch_id, l.code">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00219', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ CSSResources.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSResources">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00220' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ CSSResource_Read( l.cssresource ) }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSResources">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResource_Load_Reuse" PARAMETERS = "code, type, mod_code, mod_data, cssresource var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ CSSResource_Load_Branch_Reuse( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.code, l.type, l.mod_code, l.mod_data, l.cssresource ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResource_Load_Branch_Reuse" PARAMETERS = "branch_id, code, type, mod_code, mod_data, cssresource var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ CSSResource_Load_Branch_Code( l.branch_id, l.code, l.null ) }">																<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00935' ) }">
	<MvELSEIF EXPR = "{ CSSResource_Load_Reuse_Existing_OtherBranch( l.branch_id, l.code, l.type, l.mod_code, l.mod_data, l.cssresource ) }">	<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = "{ CSSResource_Load_Reuse_Deleted( l.code, l.type, l.mod_code, l.mod_data, l.cssresource ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResource_Load_Reuse_Existing_OtherBranch" PARAMETERS = "branch_id, code, type, mod_code, mod_data, cssresource var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_OPENVIEW_Range( 'Merchant', 'CSSResources',
																			 'SELECT
																				css.*
																			  FROM
																				' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions cssbv,
																				' $ g.Store_Table_Prefix $ 'CSSResourceVersions cssv,
																				' $ g.Store_Table_Prefix $ 'CSSResources css
																			  WHERE
																				cssbv.head			= 1					AND
																				cssbv.branch_id		<> ?				AND
																				cssv.id				= cssbv.version_id	AND
																				' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'cssv.code' )		$ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_Upper( '?' ) $ ' AND
																				cssv.type			= ?					AND
																				' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'cssv.mod_code' )	$ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_Upper( '?' ) $ ' AND
																				' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'cssv.mod_data' )	$ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_Upper( '?' ) $ ' AND
																				css.id				= cssv.res_id
																			  ORDER BY
																				cssv.res_id ASC',
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.branch_id ) $ ',' $
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.code )		$ ',' $
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.type )		$ ',' $
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.mod_code )	$ ',' $
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.mod_data ),
																			 0, 1 ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00816', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ CSSResources.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSResources">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00817' ) }">
	</MvIF>

	<MvASSIGN NAME = "l.cssresource:id"			VALUE = "{ CSSResources.d.id }">
	<MvASSIGN NAME = "l.cssresource:templ_id"	VALUE = "{ CSSResources.d.templ_id }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSResources">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResource_Load_Reuse_Deleted" PARAMETERS = "code, type, mod_code, mod_data, cssresource var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_OPENVIEW_Range( 'Merchant', 'CSSResources',
																			 'SELECT
																				css.*
																			  FROM
																				' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions cssbv,
																				' $ g.Store_Table_Prefix $ 'CSSResourceChanges cssc,
																				' $ g.Store_Table_Prefix $ 'CSSResourceVersions cssv,
																				' $ g.Store_Table_Prefix $ 'CSSResources css
																			  WHERE
																				cssbv.head			= 1					AND
																				cssbv.version_id	= 0					AND
																				cssc.branch_id		= cssbv.branch_id	AND
																				cssc.res_id			= cssbv.res_id		AND
																				cssc.new_id			= 0					AND
																				cssv.id				= cssc.old_id		AND
																				' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'cssv.code' )		$ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_Upper( '?' ) $ ' AND
																				cssv.type			= ?					AND
																				' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'cssv.mod_code' )	$ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_Upper( '?' ) $ ' AND
																				' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'cssv.mod_data' )	$ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_Upper( '?' ) $ ' AND
																				css.id				= cssv.res_id
																			  ORDER BY
																				cssc.res_id ASC, cssc.set_id DESC',
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.code )		$ ',' $
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.type )		$ ',' $
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.mod_code )	$ ',' $
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.mod_data ),
																			 0, 1 ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00727', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ CSSResources.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSResources">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00728' ) }">
	</MvIF>

	<MvASSIGN NAME = "l.cssresource:id"			VALUE = "{ CSSResources.d.id }">
	<MvASSIGN NAME = "l.cssresource:templ_id"	VALUE = "{ CSSResources.d.templ_id }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSResources">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceList_Load_File" PARAMETERS = "file, cssresources var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ CSSResourceList_Load_Branch_File( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.file, l.cssresources ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceList_Load_Branch_File" PARAMETERS = "branch_id, file, cssresources var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "CSSResources"
				QUERY	= "{ 'SELECT
								r.id			AS id,
								v.code			AS code,
								r.templ_id		AS templ_id,
								v.type			AS type,
								v.is_global		AS is_global,
								v.active		AS active,
								v.file			AS file,
								v.content_id	AS content_id,
								v.mod_code		AS mod_code,
								v.mod_data		AS mod_data,
								v.attributes	AS attributes
							  FROM
								' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions rbv,
								' $ g.Store_Table_Prefix $ 'CSSResourceVersions v,
								' $ g.Store_Table_Prefix $ 'CSSResources r
							  WHERE
								rbv.branch_id	= ?					AND
								rbv.head		= 1					AND
								v.id			= rbv.version_id	AND
								v.file			= ?					AND
								r.id			= v.res_id
							  ORDER BY
								r.id' }"
				FIELDS 	= "l.branch_id, l.file">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00221', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.cssresource_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT CSSResources.d.EOF }">
		<MvEVAL EXPR = "{ CSSResource_Read( l.cssresources[ ++l.cssresource_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "CSSResources" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSResources">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00222', l.cssresource_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceList_Load_Module" PARAMETERS = "module_code, module_data, cssresources var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ CSSResourceList_Load_Branch_Module( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.module_code, l.module_data, l.cssresources ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceList_Load_Branch_Module" PARAMETERS = "branch_id, module_code, module_data, cssresources var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "CSSResources"
				QUERY	= "{ 'SELECT
								r.id			AS id,
								v.code			AS code,
								r.templ_id		AS templ_id,
								v.type			AS type,
								v.is_global		AS is_global,
								v.active		AS active,
								v.file			AS file,
								v.content_id	AS content_id,
								v.mod_code		AS mod_code,
								v.mod_data		AS mod_data,
								v.attributes	AS attributes
							  FROM
								' $ g.Store_Table_Prefix $ 'CSSResources r,
								' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions rbv,
								' $ g.Store_Table_Prefix $ 'CSSResourceVersions v
							  WHERE
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'v.mod_code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_Upper( '?' ) $ ' AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'v.mod_data' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_Upper( '?' ) $ ' AND
								rbv.version_id	= v.id			AND
								rbv.branch_id	= ?				AND
								rbv.head		= 1				AND
								r.id			= rbv.res_id' }"
				FIELDS 	= "l.module_code, l.module_data, l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00681', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.cssresource_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT CSSResources.d.EOF }">
		<MvEVAL EXPR = "{ CSSResource_Read( l.cssresources[ ++l.cssresource_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "CSSResources" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSResources">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00680', l.cssresource_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceList_Load_Type" PARAMETERS = "type, cssresources var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ CSSResourceList_Load_Branch_Type( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.type, l.cssresources ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceList_Load_Branch_Type" PARAMETERS = "branch_id, type, cssresources var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "CSSResources"
				QUERY	= "{ 'SELECT
								r.id			AS id,
								v.code			AS code,
								r.templ_id		AS templ_id,
								v.type			AS type,
								v.is_global		AS is_global,
								v.active		AS active,
								v.file			AS file,
								v.content_id	AS content_id,
								v.mod_code		AS mod_code,
								v.mod_data		AS mod_data,
								v.attributes	AS attributes
							  FROM
								' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions rbv,
								' $ g.Store_Table_Prefix $ 'CSSResourceVersions v,
								' $ g.Store_Table_Prefix $ 'CSSResources r
							  WHERE
								rbv.branch_id	= ?					AND
								rbv.head		= 1					AND
								v.id			= rbv.version_id	AND
								v.type			= ?					AND
								r.id			= v.res_id
							  ORDER BY
								r.id' }"
				FIELDS 	= "l.branch_id, l.type">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00223', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.cssresource_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT CSSResources.d.EOF }">
		<MvEVAL EXPR = "{ CSSResource_Read( l.cssresources[ ++l.cssresource_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "CSSResources" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSResources">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00224', l.cssresource_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceList_Load_Group" PARAMETERS = "group_id, cssresources var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ CSSResourceList_Load_Branch_Group( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.group_id, l.cssresources ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceList_Load_Branch_Group" PARAMETERS = "branch_id, group_id, cssresources var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "CSSResources"
				QUERY	= "{ 'SELECT
								r.id			AS id,
								v.code			AS code,
								r.templ_id		AS templ_id,
								v.type			AS type,
								v.is_global		AS is_global,
								v.active		AS active,
								v.file			AS file,
								v.content_id	AS content_id,
								v.mod_code		AS mod_code,
								v.mod_data		AS mod_data,
								v.attributes	AS attributes
							  FROM
								' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions rbv,
								' $ g.Store_Table_Prefix $ 'CSSResources r,
								' $ g.Store_Table_Prefix $ 'CSSResourceVersions v,
								' $ g.Store_Table_Prefix $ 'CSSResourceXGroup rxg
							  WHERE
								rbv.branch_id	= ?					AND
								rbv.res_id		= r.id				AND
								rbv.head		= 1					AND
								v.id			= rbv.version_id	AND
								rxg.css_id		= v.res_id			AND
								rxg.xref_id		= v.xref_id			AND
								rxg.group_id	= ?
							  ORDER BY
								rxg.disp_order' }"
				FIELDS 	= "l.branch_id, l.group_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00456', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.cssresource_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT CSSResources.d.EOF }">
		<MvEVAL EXPR = "{ CSSResource_Read( l.cssresources[ ++l.cssresource_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "CSSResources" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSResources">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00457', l.cssresource_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceList_Load_Changeset_Group" PARAMETERS = "set_id, group_id, cssresources var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW	NAME	= "Merchant"
				VIEW	= "CSSResources"
				QUERY	= "{ 'SELECT
								r.id			AS id,
								v.code			AS code,
								r.templ_id		AS templ_id,
								v.type			AS type,
								v.is_global		AS is_global,
								v.active		AS active,
								v.file			AS file,
								v.content_id	AS content_id,
								v.mod_code		AS mod_code,
								v.mod_data		AS mod_data,
								v.attributes	AS attributes
							  FROM
								' $ g.Store_Table_Prefix $ 'Changesets c,
								' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions rbv,
								' $ g.Store_Table_Prefix $ 'CSSResourceChanges rc,
								' $ g.Store_Table_Prefix $ 'CSSResourceXGroup rxg,
								' $ g.Store_Table_Prefix $ 'CSSResourceVersions v,
								' $ g.Store_Table_Prefix $ 'CSSResources r
							  WHERE
								c.id			= ?						AND
								rbv.branch_id	= c.branch_id			AND
								rc.new_id		= rbv.version_id		AND
								rc.branch_id	= c.branch_id			AND
								rc.res_id		= rbv.res_id			AND
								rc.set_id		=
								(
									SELECT
										MAX( rc2.set_id )
									FROM
										' $ g.Store_Table_Prefix $ 'CSSResourceChanges rc2
									WHERE
										rc2.branch_id	= rbv.branch_id	AND
										rc2.res_id		= rbv.res_id	AND
										rc2.set_id		<= c.id
								)										AND
								rxg.group_id	= ?						AND
								rxg.css_id		= rc.res_id				AND
								rxg.xref_id		= rc.xref_id			AND
								v.id			= rc.new_id				AND
								r.id			= v.res_id
							  ORDER BY
								rxg.disp_order' }"
				FIELDS	= "l.set_id, l.group_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00493', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.cssresource_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT CSSResources.d.EOF }">
		<MvEVAL EXPR = "{ CSSResource_Read( l.cssresources[ ++l.cssresource_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "CSSResources" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSResources">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00494', l.cssresource_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceList_Load_CombinedResource" PARAMETERS = "comb_id, cssresources var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ CSSResourceList_Load_Branch_CombinedResource( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.comb_id, l.cssresources ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceList_Load_Branch_CombinedResource" PARAMETERS = "branch_id, comb_id, cssresources var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "CSSResources"
				QUERY	= "{ 'SELECT
								r.id			AS id,
								v.code			AS code,
								r.templ_id		AS templ_id,
								v.type			AS type,
								v.is_global		AS is_global,
								v.active		AS active,
								v.file			AS file,
								v.content_id	AS content_id,
								v.mod_code		AS mod_code,
								v.mod_data		AS mod_data,
								v.attributes	AS attributes
							  FROM
								' $ g.Store_Table_Prefix $ 'CSSCombinedResourceXResource rxr,
								' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions rbv,
								' $ g.Store_Table_Prefix $ 'CSSResourceVersions v,
								' $ g.Store_Table_Prefix $ 'CSSResources r
							  WHERE
								rxr.comb_id		= ?					AND
								rbv.branch_id	= ?					AND
								rbv.res_id		= rxr.res_id		AND
								rbv.head		= 1					AND
								v.id			= rbv.version_id	AND
								v.xref_id		= rxr.xref_id		AND
								r.id			= rbv.res_id
							  ORDER BY
								rxr.disp_order' }"
				FIELDS 	= "l.comb_id, l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00471', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.cssresource_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT CSSResources.d.EOF }">
		<MvEVAL EXPR = "{ CSSResource_Read( l.cssresources[ ++l.cssresource_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "CSSResources" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSResources">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00472', l.cssresource_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceList_Load_Changeset_CombinedResource" PARAMETERS = "set_id, comb_id, cssresources var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW	NAME	= "Merchant"
				VIEW	= "CSSResources"
				QUERY	= "{ 'SELECT
								r.id			AS id,
								v.code			AS code,
								r.templ_id		AS templ_id,
								v.type			AS type,
								v.is_global		AS is_global,
								v.active		AS active,
								v.file			AS file,
								v.content_id	AS content_id,
								v.mod_code		AS mod_code,
								v.mod_data		AS mod_data,
								v.attributes	AS attributes
							  FROM
								' $ g.Store_Table_Prefix $ 'Changesets c,
								' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions rbv,
								' $ g.Store_Table_Prefix $ 'CSSResourceChanges rc,
								' $ g.Store_Table_Prefix $ 'CSSCombinedResourceXResource rxr,
								' $ g.Store_Table_Prefix $ 'CSSResourceVersions v,
								' $ g.Store_Table_Prefix $ 'CSSResources r
							  WHERE
								c.id			= ?						AND
								rbv.branch_id	= c.branch_id			AND
								rc.new_id		= rbv.version_id		AND
								rc.branch_id	= c.branch_id			AND
								rc.res_id		= rbv.res_id			AND
								rc.set_id		=
								(
									SELECT
										MAX( rc2.set_id )
									FROM
										' $ g.Store_Table_Prefix $ 'CSSResourceChanges rc2
									WHERE
										rc2.branch_id	= rbv.branch_id	AND
										rc2.res_id		= rbv.res_id	AND
										rc2.set_id		<= c.id
								)										AND
								rxr.comb_id		= ?						AND
								rxr.res_id		= rc.res_id				AND
								rxr.xref_id		= rc.xref_id			AND
								v.id			= rc.new_id				AND
								r.id			= v.res_id
							  ORDER BY
								rxr.disp_order' }"
				FIELDS	= "l.set_id, l.comb_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00473', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.cssresource_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT CSSResources.d.EOF }">
		<MvEVAL EXPR = "{ CSSResource_Read( l.cssresources[ ++l.cssresource_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "CSSResources" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSResources">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00474', l.cssresource_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceList_Load_Page" PARAMETERS = "page_id, cssresources var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ CSSResourceList_Load_Branch_Page( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.page_id, l.cssresources ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceList_Load_Branch_Page" PARAMETERS = "branch_id, page_id, cssresources var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "CSSResources"
				QUERY	= "{ 'SELECT
								r.id			AS id,
								v.code			AS code,
								r.templ_id		AS templ_id,
								v.type			AS type,
								v.is_global		AS is_global,
								v.active		AS active,
								v.file			AS file,
								v.content_id	AS content_id,
								v.mod_code		AS mod_code,
								v.mod_data		AS mod_data,
								v.attributes	AS attributes
							  FROM
								' $ g.Store_Table_Prefix $ 'CSSResourceXPage cxp,
								' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions bv,
								' $ g.Store_Table_Prefix $ 'CSSResourceVersions v,
								' $ g.Store_Table_Prefix $ 'CSSResources r
							  WHERE
								cxp.page_id		= ?				AND
								bv.branch_id	= ?				AND
								bv.res_id		= cxp.css_id	AND
								bv.head			= 1				AND
								v.id			= bv.version_id	AND
								v.xref_id		= cxp.xref_id	AND
								r.id			= bv.res_id
							  ORDER BY
								r.id' }"
				FIELDS 	= "l.page_id, l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00675', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.cssresource_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT CSSResources.d.EOF }">
		<MvEVAL EXPR = "{ CSSResource_Read( l.cssresources[ ++l.cssresource_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "CSSResources" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSResources">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00676', l.cssresource_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceList_Load_All" PARAMETERS = "cssresources var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ CSSResourceList_Load_Branch_All( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.cssresources ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceList_Load_Branch_All" PARAMETERS = "branch_id, cssresources var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "CSSResources"
				QUERY	= "{ 'SELECT
								r.id			AS id,
								v.code			AS code,
								r.templ_id		AS templ_id,
								v.type			AS type,
								v.is_global		AS is_global,
								v.active		AS active,
								v.file			AS file,
								v.content_id	AS content_id,
								v.mod_code		AS mod_code,
								v.mod_data		AS mod_data,
								v.attributes	AS attributes
							  FROM
								' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions rbv,
								' $ g.Store_Table_Prefix $ 'CSSResources r,
								' $ g.Store_Table_Prefix $ 'CSSResourceVersions v
							  WHERE
								rbv.branch_id	= ?				AND
								rbv.res_id		= r.id			AND
								rbv.head		= 1				AND
								v.id			= rbv.version_id
							  ORDER BY
								r.id' }"
				FIELDS 	= "l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00225', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.cssresource_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT CSSResources.d.EOF }">
		<MvEVAL EXPR = "{ CSSResource_Read( l.cssresources[ ++l.cssresource_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "CSSResources" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSResources">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00226', l.cssresource_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Runtime_CSSResource_Load_Code" PARAMETERS = "code, cssresource var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ Runtime_CSSResource_Load_Branch_Code( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.code, l.cssresource ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Runtime_CSSResource_Load_Branch_Code" PARAMETERS = "branch_id, code, cssresource var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "CSSResources"
				QUERY	= "{ 'SELECT
								r.id			AS id,
								v.code			AS code,
								r.templ_id		AS templ_id,
								v.type			AS type,
								v.is_global		AS is_global,
								v.active		AS active,
								v.file			AS file,
								v.content_id	AS content_id,
								v.mod_code		AS mod_code,
								v.mod_data		AS mod_data,
								v.attributes	AS attributes,
								mt.filename		AS template_filename
							  FROM
								' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions rbv,
								' $ g.Store_Table_Prefix $ 'CSSResourceVersions v,
								' $ g.Store_Table_Prefix $ 'CSSResources r
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'ManagedTemplates mt ON mt.id = r.templ_id
							  WHERE
								rbv.branch_id	= ?					AND
								rbv.head		= 1					AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'rbv.code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_Upper( '?' ) $ ' AND
								v.id			= rbv.version_id	AND
								r.id			= v.res_id			AND
								v.active		= 1' }"
				FIELDS 	= "l.branch_id, l.code">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00227', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ CSSResources.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSResources">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00228' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ CSSResource_Read( l.cssresource ) }">
	<MvASSIGN NAME = "l.cssresource:template_filename" VALUE = "{ CSSResources.d.template_filename }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSResources">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Runtime_CSSResourceList_Load_Page" PARAMETERS = "group_code, page_id, cssresources var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ Runtime_CSSResourceList_Load_Branch_Page( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.group_code, l.page_id, l.cssresources ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Runtime_CSSResourceList_Load_Branch_Page" PARAMETERS = "branch_id, group_code, page_id, cssresources var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "CSSResources"
				QUERY	= "{ 'SELECT
								r.id			AS id,
								v.code			AS code,
								r.templ_id		AS templ_id,
								v.type			AS type,
								v.is_global		AS is_global,
								v.active		AS active,
								v.file			AS file,
								v.content_id	AS content_id,
								v.mod_code		AS mod_code,
								v.mod_data		AS mod_data,
								v.attributes	AS attributes,
								mt.filename		AS template_filename
							  FROM
								' $ g.Store_Table_Prefix $ 'ResourceGroups rg,
								' $ g.Store_Table_Prefix $ 'CSSResourceXGroup cxg,
								' $ g.Store_Table_Prefix $ 'CSSResources r
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'ManagedTemplates mt ON mt.id = r.templ_id,
								' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions rbv,
								' $ g.Store_Table_Prefix $ 'CSSResourceVersions v
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'CSSResourceXPage cxp ON cxp.css_id = v.res_id AND cxp.xref_id = v.xref_id AND cxp.page_id = ?
							  WHERE
								rg.code			= ?					AND
								cxg.group_id	= rg.id				AND
								rbv.branch_id	= ?					AND
								rbv.res_id		= cxg.css_id		AND
								rbv.head		= 1					AND
								r.id			= rbv.res_id		AND
								v.id			= rbv.version_id	AND
								v.xref_id		= cxg.xref_id		AND
								v.active		= 1					AND
								(
									v.is_global	= 1 OR
									cxp.page_id IS NOT NULL
								)
							  ORDER BY
								cxg.disp_order' }"
				FIELDS 	= "l.page_id, l.group_code, l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00229', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.cssresource_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT CSSResources.d.EOF }">
		<MvEVAL EXPR = "{ CSSResource_Read( l.cssresources[ ++l.cssresource_count ] ) }">
		<MvASSIGN NAME = "l.cssresources" INDEX = "{ l.cssresource_count }" MEMBER = "template_filename" VALUE = "{ CSSResources.d.template_filename }">

		<MvSKIP NAME = "Merchant" VIEW = "CSSResources" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSResources">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00230', l.cssresource_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Runtime_CSSResourceList_Load_CombinedResource" PARAMETERS = "comb_id, cssresources var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ Runtime_CSSResourceList_Load_Branch_CombinedResource( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.comb_id, l.cssresources ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Runtime_CSSResourceList_Load_Branch_CombinedResource" PARAMETERS = "branch_id, comb_id, cssresources var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "CSSResources"
				QUERY	= "{ 'SELECT
								r.id			AS id,
								v.code			AS code,
								r.templ_id		AS templ_id,
								v.type			AS type,
								v.is_global		AS is_global,
								v.active		AS active,
								v.file			AS file,
								v.content_id	AS content_id,
								v.mod_code		AS mod_code,
								v.mod_data		AS mod_data,
								v.attributes	AS attributes,
								mt.filename		AS template_filename
							  FROM
								' $ g.Store_Table_Prefix $ 'CSSCombinedResourceXResource rxr,
								' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions rbv,
								' $ g.Store_Table_Prefix $ 'CSSResourceVersions v,
								' $ g.Store_Table_Prefix $ 'CSSResources r
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'ManagedTemplates mt ON mt.id = r.templ_id
							  WHERE
								rxr.comb_id		= ?					AND
								rbv.branch_id	= ?					AND
								rbv.res_id		= rxr.res_id		AND
								rbv.head		= 1					AND
								v.id			= rbv.version_id	AND
								v.xref_id		= rxr.xref_id		AND
								v.active		= 1					AND
								r.id			= rbv.res_id
							  ORDER BY
								rxr.disp_order' }"
				FIELDS 	= "l.comb_id, l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00291', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.cssresource_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT CSSResources.d.EOF }">
		<MvEVAL EXPR = "{ CSSResource_Read( l.cssresources[ ++l.cssresource_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "CSSResources" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSResources">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00292', l.cssresource_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResource_Create_Type_Combined" PARAMETERS = "code, attributes, is_global, active, cssresource var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.cssresource:code"			VALUE = "{ l.code }">
	<MvASSIGN NAME = "l.cssresource:type"			VALUE = "C">
	<MvASSIGN NAME = "l.cssresource:is_global"		VALUE = "{ l.is_global }">
	<MvASSIGN NAME = "l.cssresource:active"			VALUE = "{ l.active }">
	<MvASSIGN NAME = "l.cssresource:file"			VALUE = "">
	<MvASSIGN NAME = "l.cssresource:content_id"		VALUE = 0>
	<MvASSIGN NAME = "l.cssresource:mod_code"		VALUE = "">
	<MvASSIGN NAME = "l.cssresource:mod_data"		VALUE = "">
	<MvASSIGN NAME = "l.cssresource:templ_id"		VALUE = 0>
	<MvASSIGN NAME = "l.cssresource:attributes"		VALUE = "{ l.attributes }">

	<MvCOMMENT>
	|
	| Reuse Existing Resource (If Possible)
	|
	</MvCOMMENT>

	<MvIF EXPR = "{ CSSResource_Load_Reuse( l.cssresource:code, l.cssresource:type, l.cssresource:mod_code, l.cssresource:mod_data, l.reuse_cssresource ) }">
		<MvASSIGN NAME = "l.cssresource:id"			VALUE = "{ l.reuse_cssresource:id }">

		<MvFUNCTIONRETURN VALUE = "{ CSSResource_Recreate_LowLevel( l.cssresource ) }">
	<MvELSEIF EXPR = "{ NOT [ g.Module_Library_DB ].Error_Is_EOF() }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMENT>
	|
	| Reusable Resource Not Found, Create New Resource
	|
	</MvCOMMENT>

	<MvFUNCTIONRETURN VALUE = "{ CSSResource_Create_LowLevel( l.cssresource ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResource_Create_Type_InlineCSS" PARAMETERS = "code, attributes, is_global, active, template_code var, cssresource var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.cssresource:code"			VALUE = "{ l.code }">
	<MvASSIGN NAME = "l.cssresource:type"			VALUE = "I">
	<MvASSIGN NAME = "l.cssresource:is_global"		VALUE = "{ l.is_global }">
	<MvASSIGN NAME = "l.cssresource:active"			VALUE = "{ l.active }">
	<MvASSIGN NAME = "l.cssresource:file"			VALUE = "">
	<MvASSIGN NAME = "l.cssresource:content_id"		VALUE = 0>
	<MvASSIGN NAME = "l.cssresource:mod_code"		VALUE = "">
	<MvASSIGN NAME = "l.cssresource:mod_data"		VALUE = "">
	<MvASSIGN NAME = "l.cssresource:templ_id"		VALUE = 0>
	<MvASSIGN NAME = "l.cssresource:attributes"		VALUE = "{ l.attributes }">

	<MvIF EXPR = "{ [ g.Feature_Filename_TUI_MGR ].TemplateManager_Changeset_Active() }">
		<MvASSIGN NAME = "l.end_changeset"			VALUE = 0>
	<MvELSE>
		<MvASSIGN NAME = "l.end_changeset"			VALUE = 1>

		<MvIF EXPR = "{ NOT [ g.Feature_Filename_TUI_MGR ].TemplateManager_Changeset_Begin( 'CSS Resource \'' $ l.cssresource:code $ '\' created' ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	</MvIF>

	<MvIF EXPR = "{ CSSResource_Load_Reuse( l.cssresource:code, l.cssresource:type, l.cssresource:mod_code, l.cssresource:mod_data, l.reuse_cssresource ) }">
		<MvCOMMENT>
		|
		| Reuse Existing Resource
		|
		</MvCOMMENT>

		<MvIF EXPR = "{ NOT ManagedTemplate_Load_ID( l.reuse_cssresource:templ_id, l.managedtemplate ) }">
			<MvIF EXPR = "{ NOT [ g.Module_Library_DB ].Error_Is_EOF() }">
				<MvFUNCTIONRETURN VALUE = 0>
			</MvIF>

			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00729', 'Managed Template not found' ) }">
		</MvIF>

		<MvIF EXPR = "{ NOT [ g.Module_Feature_TUI_MGR ].TemplateManager_Create_ManagedTemplateVersion( l.managedtemplate, 'Original', l.template_code, l.null_settings, l.null ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>

		<MvASSIGN NAME = "l.cssresource:id"			VALUE = "{ l.reuse_cssresource:id }">
		<MvASSIGN NAME = "l.cssresource:templ_id"	VALUE = "{ l.reuse_cssresource:templ_id }">

		<MvIF EXPR = "{ NOT CSSResource_Recreate_LowLevel( l.cssresource ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	<MvELSEIF EXPR = "{ NOT [ g.Module_Library_DB ].Error_Is_EOF() }">
		<MvFUNCTIONRETURN VALUE = 0>
	<MvELSE>
		<MvCOMMENT>
		|
		| Reusable Resource Not Found, Create New Resource
		|
		</MvCOMMENT>

		<MvASSIGN NAME = "l.template_filename" 		VALUE = "{ [ g.Feature_Filename_TUI_UT ].GenerateBranchlessUniqueManagedTemplateFilename_FromFilename( 'cssresource-' $ [ g.Module_Library_Utilities ].AlphaNumericOnly( l.code ) $ '.mvc' ) }">
		<MvASSIGN NAME = "l.template_id" 			VALUE = "{ [ g.Feature_Filename_TUI_MGR ].TemplateManager_Create_Unsynced_ManagedTemplate( l.template_code, l.null, l.template_filename ) }">

		<MvIF EXPR = "{ NOT l.template_id }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>

		<MvASSIGN NAME = "l.cssresource:templ_id" 	VALUE = "{ l.template_id }">

		<MvIF EXPR = "{ NOT CSSResource_Create_LowLevel( l.cssresource ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	</MvIF>

	<MvIF EXPR = "{ l.end_changeset }">
		<MvIF EXPR = "{ NOT [ g.Feature_Filename_TUI_MGR ].TemplateManager_Changeset_End() }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResource_Create_Type_LocalFile" PARAMETERS = "code, attributes, is_global, active, file_path, cssresource var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.cssresource:code"			VALUE = "{ l.code }">
	<MvASSIGN NAME = "l.cssresource:type"			VALUE = "L">
	<MvASSIGN NAME = "l.cssresource:is_global"		VALUE = "{ l.is_global }">
	<MvASSIGN NAME = "l.cssresource:active"			VALUE = "{ l.active }">
	<MvASSIGN NAME = "l.cssresource:file"			VALUE = "{ l.file_path }">
	<MvASSIGN NAME = "l.cssresource:content_id"		VALUE = 0>
	<MvASSIGN NAME = "l.cssresource:mod_code"		VALUE = "">
	<MvASSIGN NAME = "l.cssresource:mod_data"		VALUE = "">
	<MvASSIGN NAME = "l.cssresource:templ_id"		VALUE = 0>
	<MvASSIGN NAME = "l.cssresource:attributes"		VALUE = "{ l.attributes }">

	<MvIF EXPR = "{ NOT [ g.Feature_Filename_TUI_MGR ].TemplateManager_Set_ResourceManagedContent_FromFile( l.cssresource ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMENT>
	|
	| Reuse Existing Resource (If Possible)
	|
	</MvCOMMENT>

	<MvIF EXPR = "{ CSSResource_Load_Reuse( l.cssresource:code, l.cssresource:type, l.cssresource:mod_code, l.cssresource:mod_data, l.reuse_cssresource ) }">
		<MvASSIGN NAME = "l.cssresource:id"			VALUE = "{ l.reuse_cssresource:id }">

		<MvFUNCTIONRETURN VALUE = "{ CSSResource_Recreate_LowLevel( l.cssresource ) }">
	<MvELSEIF EXPR = "{ NOT [ g.Module_Library_DB ].Error_Is_EOF() }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMENT>
	|
	| Reusable Resource Not Found, Create New Resource
	|
	</MvCOMMENT>

	<MvFUNCTIONRETURN VALUE = "{ CSSResource_Create_LowLevel( l.cssresource ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResource_Create_Type_ExternalFile" PARAMETERS = "code, attributes, is_global, active, file_path, cssresource var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.cssresource:code"			VALUE = "{ l.code }">
	<MvASSIGN NAME = "l.cssresource:type"			VALUE = "E">
	<MvASSIGN NAME = "l.cssresource:is_global"		VALUE = "{ l.is_global }">
	<MvASSIGN NAME = "l.cssresource:active"			VALUE = "{ l.active }">
	<MvASSIGN NAME = "l.cssresource:file"			VALUE = "{ l.file_path }">
	<MvASSIGN NAME = "l.cssresource:content_id"		VALUE = 0>
	<MvASSIGN NAME = "l.cssresource:mod_code"		VALUE = "">
	<MvASSIGN NAME = "l.cssresource:mod_data"		VALUE = "">
	<MvASSIGN NAME = "l.cssresource:templ_id"		VALUE = 0>
	<MvASSIGN NAME = "l.cssresource:attributes"		VALUE = "{ l.attributes }">

	<MvCOMMENT>
	|
	| Reuse Existing Resource (If Possible)
	|
	</MvCOMMENT>

	<MvIF EXPR = "{ CSSResource_Load_Reuse( l.cssresource:code, l.cssresource:type, l.cssresource:mod_code, l.cssresource:mod_data, l.reuse_cssresource ) }">
		<MvASSIGN NAME = "l.cssresource:id"			VALUE = "{ l.reuse_cssresource:id }">

		<MvFUNCTIONRETURN VALUE = "{ CSSResource_Recreate_LowLevel( l.cssresource ) }">
	<MvELSEIF EXPR = "{ NOT [ g.Module_Library_DB ].Error_Is_EOF() }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMENT>
	|
	| Reusable Resource Not Found, Create New Resource
	|
	</MvCOMMENT>

	<MvFUNCTIONRETURN VALUE = "{ CSSResource_Create_LowLevel( l.cssresource ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResource_Create_Type_Module" PARAMETERS = "code, attributes, is_global, active, mod_code, mod_data, cssresource var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.cssresource:code"			VALUE = "{ l.code }">
	<MvASSIGN NAME = "l.cssresource:type"			VALUE = "M">
	<MvASSIGN NAME = "l.cssresource:is_global"		VALUE = "{ l.is_global }">
	<MvASSIGN NAME = "l.cssresource:active"			VALUE = "{ l.active }">
	<MvASSIGN NAME = "l.cssresource:file"			VALUE = "">
	<MvASSIGN NAME = "l.cssresource:content_id"		VALUE = 0>
	<MvASSIGN NAME = "l.cssresource:mod_code"		VALUE = "{ l.mod_code }">
	<MvASSIGN NAME = "l.cssresource:mod_data"		VALUE = "{ l.mod_data }">
	<MvASSIGN NAME = "l.cssresource:templ_id"		VALUE = 0>
	<MvASSIGN NAME = "l.cssresource:attributes"		VALUE = "{ l.attributes }">

	<MvCOMMENT>
	|
	| Reuse Existing Resource (If Possible)
	|
	</MvCOMMENT>

	<MvIF EXPR = "{ CSSResource_Load_Reuse( l.cssresource:code, l.cssresource:type, l.cssresource:mod_code, l.cssresource:mod_data, l.reuse_cssresource ) }">
		<MvASSIGN NAME = "l.cssresource:id"			VALUE = "{ l.reuse_cssresource:id }">

		<MvFUNCTIONRETURN VALUE = "{ CSSResource_Recreate_LowLevel( l.cssresource ) }">
	<MvELSEIF EXPR = "{ NOT [ g.Module_Library_DB ].Error_Is_EOF() }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMENT>
	|
	| Reusable Resource Not Found, Create New Resource
	|
	</MvCOMMENT>

	<MvFUNCTIONRETURN VALUE = "{ CSSResource_Create_LowLevel( l.cssresource ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResource_Create_Type_ModuleInline" PARAMETERS = "code, attributes, is_global, active, mod_code, mod_data, cssresource var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.cssresource:code"			VALUE = "{ l.code }">
	<MvASSIGN NAME = "l.cssresource:type"			VALUE = "Y">
	<MvASSIGN NAME = "l.cssresource:is_global"		VALUE = "{ l.is_global }">
	<MvASSIGN NAME = "l.cssresource:active"			VALUE = "{ l.active }">
	<MvASSIGN NAME = "l.cssresource:file"			VALUE = "">
	<MvASSIGN NAME = "l.cssresource:content_id"		VALUE = 0>
	<MvASSIGN NAME = "l.cssresource:mod_code"		VALUE = "{ l.mod_code }">
	<MvASSIGN NAME = "l.cssresource:mod_data"		VALUE = "{ l.mod_data }">
	<MvASSIGN NAME = "l.cssresource:templ_id"		VALUE = 0>
	<MvASSIGN NAME = "l.cssresource:attributes"		VALUE = "{ l.attributes }">

	<MvCOMMENT>
	|
	| Reuse Existing Resource (If Possible)
	|
	</MvCOMMENT>

	<MvIF EXPR = "{ CSSResource_Load_Reuse( l.cssresource:code, l.cssresource:type, l.cssresource:mod_code, l.cssresource:mod_data, l.reuse_cssresource ) }">
		<MvASSIGN NAME = "l.cssresource:id"			VALUE = "{ l.reuse_cssresource:id }">

		<MvFUNCTIONRETURN VALUE = "{ CSSResource_Recreate_LowLevel( l.cssresource ) }">
	<MvELSEIF EXPR = "{ NOT [ g.Module_Library_DB ].Error_Is_EOF() }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMENT>
	|
	| Reusable Resource Not Found, Create New Resource
	|
	</MvCOMMENT>

	<MvFUNCTIONRETURN VALUE = "{ CSSResource_Create_LowLevel( l.cssresource ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResource_Create_Type_ModuleManaged" PARAMETERS = "code, attributes, is_global, active, mod_code, content var, cssresource var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT ManagedContent_FindOrInsert( l.content, l.managedcontent ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvASSIGN NAME = "l.cssresource:code"			VALUE = "{ l.code }">
	<MvASSIGN NAME = "l.cssresource:type"			VALUE = "Z">
	<MvASSIGN NAME = "l.cssresource:is_global"		VALUE = "{ l.is_global }">
	<MvASSIGN NAME = "l.cssresource:active"			VALUE = "{ l.active }">
	<MvASSIGN NAME = "l.cssresource:file"			VALUE = "">
	<MvASSIGN NAME = "l.cssresource:content_id"		VALUE = "{ l.managedcontent:id }">
	<MvASSIGN NAME = "l.cssresource:mod_code"		VALUE = "{ l.mod_code }">
	<MvASSIGN NAME = "l.cssresource:mod_data"		VALUE = "">
	<MvASSIGN NAME = "l.cssresource:templ_id"		VALUE = 0>
	<MvASSIGN NAME = "l.cssresource:attributes"		VALUE = "{ l.attributes }">

	<MvIF EXPR = "{ NOT [ g.Feature_Filename_TUI_UT ].ManagedContent_Generate_SRI_Attributes( l.cssresource:content_id, l.cssresource:attributes ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMENT>
	|
	| Reuse Existing Resource (If Possible)
	|
	</MvCOMMENT>

	<MvIF EXPR = "{ CSSResource_Load_Reuse( l.cssresource:code, l.cssresource:type, l.cssresource:mod_code, l.cssresource:mod_data, l.reuse_cssresource ) }">
		<MvASSIGN NAME = "l.cssresource:id"			VALUE = "{ l.reuse_cssresource:id }">

		<MvFUNCTIONRETURN VALUE = "{ CSSResource_Recreate_LowLevel( l.cssresource ) }">
	<MvELSEIF EXPR = "{ NOT [ g.Module_Library_DB ].Error_Is_EOF() }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMENT>
	|
	| Reusable Resource Not Found, Create New Resource
	|
	</MvCOMMENT>

	<MvFUNCTIONRETURN VALUE = "{ CSSResource_Create_LowLevel( l.cssresource ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResource_Create_LowLevel" PARAMETERS = "cssresource var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.working_branch_id"				VALUE = "{ [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID() }">
	<MvASSIGN NAME = "l.cssresource:id"					VALUE = "{ [ g.Module_Library_DB ].StoreKey_Generate( 'CSSResources' ) }">

	<MvCOMMENT>
	|
	| Create an initial version on the working branch
	|
	</MvCOMMENT>

	<MvASSIGN NAME = "l.cssresourceversion"				VALUE = "">
	<MvASSIGN NAME = "l.cssresourceversion:code"		VALUE = "{ l.cssresource:code }">
	<MvASSIGN NAME = "l.cssresourceversion:res_id"		VALUE = "{ l.cssresource:id }">
	<MvASSIGN NAME = "l.cssresourceversion:user_id"		VALUE = "{ int( g.User:id ) }">
	<MvASSIGN NAME = "l.cssresourceversion:content_id"	VALUE = "{ l.cssresource:content_id }">
	<MvASSIGN NAME = "l.cssresourceversion:immutable"	VALUE = 1>
	<MvASSIGN NAME = "l.cssresourceversion:type"		VALUE = "{ l.cssresource:type }">
	<MvASSIGN NAME = "l.cssresourceversion:is_global"	VALUE = "{ l.cssresource:is_global }">
	<MvASSIGN NAME = "l.cssresourceversion:active"		VALUE = "{ l.cssresource:active }">
	<MvASSIGN NAME = "l.cssresourceversion:file"		VALUE = "{ l.cssresource:file }">
	<MvASSIGN NAME = "l.cssresourceversion:mod_code"	VALUE = "{ l.cssresource:mod_code }">
	<MvASSIGN NAME = "l.cssresourceversion:mod_data"	VALUE = "{ l.cssresource:mod_data }">
	<MvASSIGN NAME = "l.cssresourceversion:attributes"	VALUE = "{ l.cssresource:attributes }">

	<MvIF EXPR = "{ NOT CSSResourceVersion_Insert( l.cssresourceversion ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ NOT CSSResourceBranchVersion_Insert( l.working_branch_id, l.cssresource:id, l.cssresourceversion:id ) OR
					NOT CSSResourceBranchVersion_Update_Head( l.working_branch_id, l.cssresource:id, l.cssresourceversion:id ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ NOT [ g.Feature_Filename_TUI_MGR ].TemplateManager_Changeset_Record_CSSResourceVersion( l.cssresource:id, 0, l.cssresourceversion:id, l.cssresourceversion:xref_id, 'CSS Resource \'' $ l.cssresourceversion:code $ '\' created' ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = "{ CSSResource_Insert_LowLevel( l.cssresource ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResource_Recreate_LowLevel" PARAMETERS = "cssresource var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.working_branch_id"				VALUE = "{ [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID() }">

	<MvCOMMENT>
	|
	| Create an initial version on the working branch
	|
	</MvCOMMENT>

	<MvASSIGN NAME = "l.cssresourceversion"				VALUE = "">
	<MvASSIGN NAME = "l.cssresourceversion:code"		VALUE = "{ l.cssresource:code }">
	<MvASSIGN NAME = "l.cssresourceversion:res_id"		VALUE = "{ l.cssresource:id }">
	<MvASSIGN NAME = "l.cssresourceversion:user_id"		VALUE = "{ int( g.User:id ) }">
	<MvASSIGN NAME = "l.cssresourceversion:content_id"	VALUE = "{ l.cssresource:content_id }">
	<MvASSIGN NAME = "l.cssresourceversion:immutable"	VALUE = 1>
	<MvASSIGN NAME = "l.cssresourceversion:type"		VALUE = "{ l.cssresource:type }">
	<MvASSIGN NAME = "l.cssresourceversion:is_global"	VALUE = "{ l.cssresource:is_global }">
	<MvASSIGN NAME = "l.cssresourceversion:active"		VALUE = "{ l.cssresource:active }">
	<MvASSIGN NAME = "l.cssresourceversion:file"		VALUE = "{ l.cssresource:file }">
	<MvASSIGN NAME = "l.cssresourceversion:mod_code"	VALUE = "{ l.cssresource:mod_code }">
	<MvASSIGN NAME = "l.cssresourceversion:mod_data"	VALUE = "{ l.cssresource:mod_data }">
	<MvASSIGN NAME = "l.cssresourceversion:attributes"	VALUE = "{ l.cssresource:attributes }">

	<MvIF EXPR = "{ NOT CSSResourceVersion_Insert( l.cssresourceversion ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ NOT CSSResourceBranchVersion_Insert( l.working_branch_id, l.cssresource:id, l.cssresourceversion:id ) OR
					NOT CSSResourceBranchVersion_Update_Head( l.working_branch_id, l.cssresource:id, l.cssresourceversion:id ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ NOT [ g.Feature_Filename_TUI_MGR ].TemplateManager_Changeset_Record_CSSResourceVersion( l.cssresource:id, 0, l.cssresourceversion:id, l.cssresourceversion:xref_id, 'CSS Resource \'' $ l.cssresourceversion:code $ '\' created' ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResource_Insert_LowLevel" PARAMETERS = "cssresource var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ ISNULL l.cssresource:templ_id }"> <MvASSIGN NAME = "l.cssresource:templ_id" VALUE = 0> </MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'CSSResources
						  ( id, templ_id )
						  VALUES
						  ( ?, ? )' }"
			 FIELDS	= "l.cssresource:id, l.cssresource:templ_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00231', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResource_Update" PARAMETERS = "cssresource var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ CSSResource_Update_Branch( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.cssresource ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResource_Update_Branch" PARAMETERS = "branch_id, cssresource var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.cssresource:type EQ 'Z' }">
		<MvIF EXPR = "{ NOT [ g.Feature_Filename_TUI_UT ].ManagedContent_Generate_SRI_Attributes( l.cssresource:content_id, l.cssresource:attributes ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	</MvIF>

	<MvIF EXPR = "{ NOT CSSResource_Update_LowLevel( l.cssresource ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ NOT CSSResourceVersion_Load_Branch_Head( l.branch_id, l.cssresource:id, l.cssresourceversion ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvASSIGN NAME = "l.old_version_id"					VALUE = "{ l.cssresourceversion:id }">

	<MvASSIGN NAME = "l.cssresourceversion:code"		VALUE = "{ l.cssresource:code }">
	<MvASSIGN NAME = "l.cssresourceversion:user_id"		VALUE = "{ int( g.User:id ) }">
	<MvASSIGN NAME = "l.cssresourceversion:content_id"	VALUE = "{ l.cssresource:content_id }">
	<MvASSIGN NAME = "l.cssresourceversion:immutable"	VALUE = 0>
	<MvASSIGN NAME = "l.cssresourceversion:type"		VALUE = "{ l.cssresource:type }">
	<MvASSIGN NAME = "l.cssresourceversion:is_global"	VALUE = "{ l.cssresource:is_global }">
	<MvASSIGN NAME = "l.cssresourceversion:active"		VALUE = "{ l.cssresource:active }">
	<MvASSIGN NAME = "l.cssresourceversion:file"		VALUE = "{ l.cssresource:file }">
	<MvASSIGN NAME = "l.cssresourceversion:mod_code"	VALUE = "{ l.cssresource:mod_code }">
	<MvASSIGN NAME = "l.cssresourceversion:mod_data"	VALUE = "{ l.cssresource:mod_data }">
	<MvASSIGN NAME = "l.cssresourceversion:attributes"	VALUE = "{ l.cssresource:attributes }">

	<MvIF EXPR = "{ NOT CSSResourceVersion_Insert( l.cssresourceversion ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ NOT CSSResourceBranchVersion_Insert( l.branch_id, l.cssresource:id, l.cssresourceversion:id ) OR
					NOT CSSResourceBranchVersion_Update_Head( l.branch_id, l.cssresource:id, l.cssresourceversion:id ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = "{ [ g.Feature_Filename_TUI_MGR ].TemplateManager_Changeset_Record_CSSResourceVersion( l.cssresource:id, l.old_version_id, l.cssresourceversion:id, l.cssresourceversion:xref_id, 'CSS Resource \'' $ l.cssresourceversion:code $ '\' updated' ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResource_Update_LowLevel" PARAMETERS = "cssresource var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'CSSResources
						  SET
							templ_id	= ?
						  WHERE
						  	id			= ?' }"
			 FIELDS	= "l.cssresource:templ_id,
			 		   l.cssresource:id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00232', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResource_Delete_ID" PARAMETERS = "id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'CSSResources WHERE id = ?' }"
			 FIELDS	= "l.id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00233', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResource_Purge" PARAMETERS = "cssresource var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT ManagedContent_Decrement_All_CSSResource( l.cssresource:id )					OR
					NOT CSSResourceXGroup_Delete_All_Style( l.cssresource:id )							OR
					NOT CSSResourceXPage_Delete_All_Style( l.cssresource:id )							OR
					NOT CSSResourceVersion_Delete_All_Resource( l.cssresource:id )						OR
					NOT CSSResourceBranchVersion_Delete_All_Resource( l.cssresource:id )				OR
					NOT CSSResourceChange_Delete_All_Resource( l.cssresource:id )						OR
					NOT CSSCombinedResourceXResource_Delete_All_CombinedResource( l.cssresource:id )	OR
					NOT CSSCombinedResourceXResource_Delete_All_Resource( l.cssresource:id ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = "{ CSSResource_Delete_ID( l.cssresource:id ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResource_Delete_All" PARAMETERS = "" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'CSSResources' }"
			 FIELDS	= "">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00234', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResource_Delete_All_Orphaned" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT ManagedContent_Decrement_All_Orphaned_CSSResources()					OR
					NOT CSSResourceVersion_Delete_All_Orphaned_Resources()						OR
					NOT CSSResourceXPage_Delete_All_Orphaned_Styles()							OR
					NOT CSSResourceXGroup_Delete_All_Orphaned_Styles()							OR
					NOT CSSCombinedResourceXResource_Delete_All_Orphaned_CombinedResources()	OR
					NOT CSSCombinedResourceXResource_Delete_All_Orphaned_Resources() }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = "{ CSSResource_Delete_All_Orphaned_LowLevel() }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResource_Delete_All_Orphaned_LowLevel" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'CSSResources
			 			  WHERE id NOT IN ( SELECT DISTINCT res_id FROM ' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00837', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_CSSResourceVersions
|
</MvCOMMENT>

<MvFUNCTION NAME = "CSSResourceVersion_Read" PARAMETERS = "cssresourceversion var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.cssresourceversion:id"			VALUE = "{ CSSResourceVersions.d.id }">
	<MvASSIGN NAME = "l.cssresourceversion:code"		VALUE = "{ CSSResourceVersions.d.code }">
	<MvASSIGN NAME = "l.cssresourceversion:res_id"		VALUE = "{ CSSResourceVersions.d.res_id }">
	<MvASSIGN NAME = "l.cssresourceversion:xref_id"		VALUE = "{ CSSResourceVersions.d.xref_id }">
	<MvASSIGN NAME = "l.cssresourceversion:user_id"		VALUE = "{ CSSResourceVersions.d.user_id }">
	<MvASSIGN NAME = "l.cssresourceversion:content_id"	VALUE = "{ CSSResourceVersions.d.content_id }">
	<MvASSIGN NAME = "l.cssresourceversion:immutable"	VALUE = "{ CSSResourceVersions.d.immutable }">
	<MvASSIGN NAME = "l.cssresourceversion:type"		VALUE = "{ CSSResourceVersions.d.type }">
	<MvASSIGN NAME = "l.cssresourceversion:is_global"	VALUE = "{ CSSResourceVersions.d.is_global }">
	<MvASSIGN NAME = "l.cssresourceversion:active"		VALUE = "{ CSSResourceVersions.d.active }">
	<MvASSIGN NAME = "l.cssresourceversion:file"		VALUE = "{ CSSResourceVersions.d.file }">
	<MvASSIGN NAME = "l.cssresourceversion:mod_code"	VALUE = "{ CSSResourceVersions.d.mod_code }">
	<MvASSIGN NAME = "l.cssresourceversion:mod_data"	VALUE = "{ CSSResourceVersions.d.mod_data }">
	<MvASSIGN NAME = "l.cssresourceversion:attributes"	VALUE = "{ miva_array_deserialize( CSSResourceVersions.d.attributes ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceVersion_Insert" PARAMETERS = "cssresourceversion var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT CSSResourceVersion_Insert_LowLevel( l.cssresourceversion ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ l.cssresourceversion:content_id }">
		<MvIF EXPR = "{ NOT ManagedContent_Increment_ReferenceCount( l.cssresourceversion:content_id ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceVersion_Insert_LowLevel" PARAMETERS = "cssresourceversion var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.cssresourceversion:id"				VALUE = "{ [ g.Module_Library_DB ].StoreKey_Generate( 'CSSResourceVersions' ) }">
	<MvASSIGN NAME = "l.attributes"							VALUE = "{ miva_array_serialize( l.cssresourceversion:attributes ) }">

	<MvIF EXPR = "{ ISNULL l.cssresourceversion:xref_id }">
		<MvASSIGN NAME = "l.cssresourceversion:xref_id"		VALUE = "{ [ g.Module_Library_DB ].StoreKey_Generate( 'CSSResourceReferences' ) }">
	</MvIF>

	<MvIF EXPR = "{ ISNULL l.cssresourceversion:user_id }">
		<MvASSIGN NAME = "l.cssresourceversion:user_id"		VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ ISNULL l.cssresourceversion:content_id }">
		<MvASSIGN NAME = "l.cssresourceversion:content_id"	VALUE = 0>
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'CSSResourceVersions
						  ( id, code, res_id, xref_id, user_id, content_id, immutable, type, is_global, active, file, mod_code, mod_data, attributes )
						  VALUES
						  ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )' }"
			 FIELDS	= "l.cssresourceversion:id, l.cssresourceversion:code, l.cssresourceversion:res_id,
			 		   l.cssresourceversion:xref_id, l.cssresourceversion:user_id, l.cssresourceversion:content_id,
			 		   l.cssresourceversion:immutable, l.cssresourceversion:type, l.cssresourceversion:is_global,
			 		   l.cssresourceversion:active, l.cssresourceversion:file, l.cssresourceversion:mod_code,
			 		   l.cssresourceversion:mod_data, l.attributes">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00385', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceVersion_Update_CrossReference" PARAMETERS = "cssresourceversion var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'CSSResourceVersions SET xref_id = ? WHERE id = ?' }"
			 FIELDS	= "l.cssresourceversion:xref_id, l.cssresourceversion:id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00429', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceVersion_Delete_All" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'CSSResourceVersions' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00500', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceVersion_Delete_All_Resource" PARAMETERS = "res_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'CSSResourceVersions WHERE res_id = ?' }"
			 FIELDS	= "l.res_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00501', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceVersion_Delete_All_Orphaned_Resources" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'CSSResourceVersions
			 			  WHERE res_id NOT IN ( SELECT DISTINCT res_id FROM ' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00838', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceVersion_Load_ID" PARAMETERS = "id, cssresourceversion var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "CSSResourceVersions"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'CSSResourceVersions WHERE id = ?' }"
				FIELDS 	= "l.id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00712', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ CSSResourceVersions.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSResourceVersions">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00713' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ CSSResourceVersion_Read( l.cssresourceversion ) }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSResourceVersions">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceVersion_Load_Branch_Head" PARAMETERS = "branch_id, res_id, cssresourceversion var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "CSSResourceVersions"
				QUERY	= "{ 'SELECT
								v.*
							  FROM
								' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions rbv,
								' $ g.Store_Table_Prefix $ 'CSSResourceVersions v
							  WHERE
								rbv.branch_id	= ?	AND
								rbv.res_id		= ?	AND
								rbv.head		= 1	AND
								v.id			= rbv.version_id' }"
				FIELDS 	= "l.branch_id, l.res_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00386', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ CSSResourceVersions.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSResourceVersions">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00387' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ CSSResourceVersion_Read( l.cssresourceversion ) }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSResourceVersions">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceVersionList_Load_Branch_CombinedResource" PARAMETERS = "branch_id, comb_id, cssresourceversions var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "CSSResourceVersions"
				QUERY	= "{ 'SELECT
								v.*
							  FROM
								' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions rbv,
								' $ g.Store_Table_Prefix $ 'CSSResourceVersions v,
								' $ g.Store_Table_Prefix $ 'CSSCombinedResourceXResource rxr
							  WHERE
								rbv.branch_id	= ?					AND
								rbv.head		= 1					AND
								v.id			= rbv.version_id	AND
								rxr.res_id		= v.res_id			AND
								rxr.xref_id		= v.xref_id			AND
								rxr.comb_id		= ?' }"
				FIELDS 	= "l.branch_id, l.comb_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00430', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.cssresourceversion_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT CSSResourceVersions.d.EOF }">
		<MvEVAL EXPR = "{ CSSResourceVersion_Read( l.cssresourceversions[ ++l.cssresourceversion_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "CSSResourceVersions" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSResourceVersions">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00431', l.cssresourceversion_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceVersionList_Load_Branch_ResourceGroup" PARAMETERS = "branch_id, group_id, cssresourceversions var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "CSSResourceVersions"
				QUERY	= "{ 'SELECT
								v.*
							  FROM
								' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions rbv,
								' $ g.Store_Table_Prefix $ 'CSSResourceVersions v,
								' $ g.Store_Table_Prefix $ 'CSSResourceXGroup rxg
							  WHERE
								rbv.branch_id	= ?					AND
								rbv.head		= 1					AND
								v.id			= rbv.version_id	AND
								rxg.css_id		= v.res_id			AND
								rxg.xref_id		= v.xref_id			AND
								rxg.group_id	= ?' }"
				FIELDS 	= "l.branch_id, l.group_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00432', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.cssresourceversion_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT CSSResourceVersions.d.EOF }">
		<MvEVAL EXPR = "{ CSSResourceVersion_Read( l.cssresourceversions[ ++l.cssresourceversion_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "CSSResourceVersions" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSResourceVersions">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00433', l.cssresourceversion_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceVersion_Fork_CrossReferences_LowLevel" PARAMETERS = "cssresourceversion var, new_xref_id" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT CSSCombinedResourceXResource_Fork( l.cssresourceversion, l.new_xref_id )	OR
					NOT CSSResourceXGroup_Fork( l.cssresourceversion, l.new_xref_id )				OR
					NOT CSSResourceXPage_Fork( l.cssresourceversion, l.new_xref_id ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceVersion_Fork_CrossReferences" PARAMETERS = "branch_id, cssresourceversion var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ CSSResourceVersion_Fork_CrossReferences_ID( l.branch_id, l.cssresourceversion, [ g.Module_Library_DB ].StoreKey_Generate( 'CSSResourceReferences' ) ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceVersion_Fork_CrossReferences_ID" PARAMETERS = "branch_id, cssresourceversion var, xref_id" STANDARDOUTPUTLEVEL = "">
	<MvCOMMENT>
	|
	| Fork the cross references
	|
	</MvCOMMENT>

	<MvIF EXPR = "{ NOT CSSResourceVersion_Fork_CrossReferences_LowLevel( l.cssresourceversion, l.xref_id ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMENT>
	|
	| If the version exists on this branch only, we just update its xref_id.  Otherwise we need to create a new version to isolate the
	| new xref_id to this branch.
	|
	</MvCOMMENT>

	<MvASSIGN NAME = "l.old_version_id"				VALUE = "{ l.cssresourceversion:id }">
	<MvASSIGN NAME = "l.cssresourceversion:xref_id"	VALUE = "{ l.xref_id }">

	<MvIF EXPR = "{ NOT CSSResourceBranchVersion_Load_OtherBranch( l.branch_id, l.cssresourceversion:res_id, l.cssresourceversion:id, l.null ) }">
		<MvIF EXPR = "{ NOT [ g.Module_Library_DB ].Error_Is_EOF() }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>

		<MvIF EXPR = "{ NOT CSSResourceVersion_Update_CrossReference( l.cssresourceversion ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	<MvELSE>
		<MvIF EXPR = "{ NOT CSSResourceVersion_Insert( l.cssresourceversion ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>

		<MvIF EXPR = "{ NOT CSSResourceBranchVersion_Insert( l.branch_id, l.cssresourceversion:res_id, l.cssresourceversion:id ) OR
						NOT CSSResourceBranchVersion_Update_Head( l.branch_id, l.cssresourceversion:res_id, l.cssresourceversion:id ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = "{ [ g.Feature_Filename_TUI_MGR ].TemplateManager_Changeset_Record_CSSResourceVersion( l.cssresourceversion:res_id, l.old_version_id, l.cssresourceversion:id, l.cssresourceversion:xref_id, 'CSS Resource \'' $ l.cssresourceversion:code $ '\' references updated' ) }">
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_CSSResourceBranchVersions
|
</MvCOMMENT>

<MvFUNCTION NAME = "CSSResourceBranchVersion_Read" PARAMETERS = "cssresourcebranchversion var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.cssresourcebranchversion:branch_id"		VALUE = "{ CSSResourceBranchVersions.d.branch_id }">
	<MvASSIGN NAME = "l.cssresourcebranchversion:res_id"		VALUE = "{ CSSResourceBranchVersions.d.res_id }">
	<MvASSIGN NAME = "l.cssresourcebranchversion:version_id"	VALUE = "{ CSSResourceBranchVersions.d.version_id }">
	<MvASSIGN NAME = "l.cssresourcebranchversion:code"			VALUE = "{ CSSResourceBranchVersions.d.code }">
	<MvASSIGN NAME = "l.cssresourcebranchversion:head"			VALUE = "{ CSSResourceBranchVersions.d.head }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceBranchVersion_Insert" PARAMETERS = "branch_id, res_id, version_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.version_id EQ 0 }">
		<MvQUERY NAME   = "Merchant"
				 QUERY  = "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions
							  ( branch_id, res_id, version_id, code, head )
							  VALUES
							  ( ?, ?, ?, \'\', 0 )' }"
				 FIELDS = "l.branch_id, l.res_id, l.version_id">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00709', g.MvQUERY_Error ) }">
		</MvIF>
	<MvELSE>
		<MvQUERY NAME   = "Merchant"
				 QUERY  = "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions
							  ( branch_id, res_id, version_id, code, head )
							  SELECT
								?, ?, id, code, 0
							  FROM
								' $ g.Store_Table_Prefix $ 'CSSResourceVersions
							  WHERE
								id = ?' }"
				 FIELDS = "l.branch_id, l.res_id,
				 		   l.version_id">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00388', g.MvQUERY_Error ) }">
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceBranchVersion_Update_Head" PARAMETERS = "branch_id, res_id, version_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions
						  SET
							head		= 1
						  WHERE
							branch_id	= ? AND
							res_id		= ? AND
							version_id	= ?' }"
			 FIELDS	= "l.branch_id, l.res_id, l.version_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00389', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions
						  SET
							head		= 0
						  WHERE
							branch_id	= ? AND
							res_id		= ? AND
							version_id	<> ?' }"
			 FIELDS	= "l.branch_id, l.res_id, l.version_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00390', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceBranchVersion_Delete_All" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00502', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceBranchVersion_Delete_All_Resource" PARAMETERS = "res_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions WHERE res_id = ?' }"
			 FIELDS	= "l.res_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00503', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceBranchVersion_Load_OtherBranch" PARAMETERS = "branch_id, res_id, version_id, cssresourcebranchversion var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_OPENVIEW_Range( 'Merchant',
																		     'CSSResourceBranchVersions',
																		     'SELECT
																				*
																			  FROM
																				' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions
																			  WHERE
																				res_id		= ?		AND
																				version_id	= ?		AND
																				branch_id	<> ?',
																		     [ g.Module_Library_DB ].SQL_Query_Field( l.res_id )		$ ',' $
																		     [ g.Module_Library_DB ].SQL_Query_Field( l.version_id )	$ ',' $
																		     [ g.Module_Library_DB ].SQL_Query_Field( l.branch_id ),
																		     0, 1 ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00434', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ CSSResourceBranchVersions.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSResourceBranchVersions">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00435' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ CSSResourceBranchVersion_Read( l.cssresourcebranchversion ) }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSResourceBranchVersions">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceBranchVersion_Delete_All_Branch" PARAMETERS = "branch_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions WHERE branch_id = ?' }"
			 FIELDS	= "l.branch_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00436', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_CSSResourceChanges
|
</MvCOMMENT>

<MvFUNCTION NAME = "CSSResourceChange_InsertOrUpdate" PARAMETERS = "branch_id, set_id, res_id, old_id, new_id, xref_id" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ CSSResourceChange_Insert( l.branch_id, l.set_id, l.res_id, l.old_id, l.new_id, l.xref_id ) }">			<MvFUNCTIONRETURN VALUE = 1>
	<MvELSEIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_Error_IsIndexDuplicate( g.Error_Message ) }">				<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = "{ CSSResourceChange_Update_New( l.branch_id, l.set_id, l.res_id, l.new_id, l.xref_id ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceChange_Insert" PARAMETERS = "branch_id, set_id, res_id, old_id, new_id, xref_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'CSSResourceChanges
					      ( branch_id, set_id, res_id, old_id, new_id, xref_id )
						  VALUES
						  ( ?, ?, ?, ?, ?, ? )' }"
			 FIELDS	= "l.branch_id, l.set_id, l.res_id, l.old_id, l.new_id, l.xref_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00438', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceChange_Update_New" PARAMETERS = "branch_id, set_id, res_id, new_id, xref_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'CSSResourceChanges
						  SET
							new_id	= ?,
							xref_id	= ?
						  WHERE
							branch_id	= ?	AND
							set_id		= ? AND
							res_id		= ?' }"
			 FIELDS	= "l.new_id, l.xref_id,
					   l.branch_id, l.set_id, l.res_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00439', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceChange_Delete_All" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'CSSResourceChanges' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00504', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceChange_Delete_All_Changeset" PARAMETERS = "set_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'CSSResourceChanges WHERE set_id = ?' }"
			 FIELDS	= "l.set_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00440', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceChange_Delete_All_Resource" PARAMETERS = "res_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'CSSResourceChanges WHERE res_id = ?' }"
			 FIELDS	= "l.res_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00441', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_CSSCombinedResourceXResource
|
</MvCOMMENT>

<MvFUNCTION NAME = "CSSCombinedResourceXResource_Read" PARAMETERS = "csscombinedresourcexresource var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.csscombinedresourcexresource:comb_id"		VALUE = "{ CSSCombinedResourceXResource.d.comb_id }">
	<MvASSIGN NAME = "l.csscombinedresourcexresource:res_id"		VALUE = "{ CSSCombinedResourceXResource.d.res_id }">
	<MvASSIGN NAME = "l.csscombinedresourcexresource:xref_id"		VALUE = "{ CSSCombinedResourceXResource.d.xref_id }">
	<MvASSIGN NAME = "l.csscombinedresourcexresource:disp_order"	VALUE = "{ CSSCombinedResourceXResource.d.disp_order }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSCombinedResourceXResource_Insert" PARAMETERS = "comb_id, res_id" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ CSSCombinedResourceXResource_Insert_Branch( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.comb_id, l.res_id ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSCombinedResourceXResource_Insert_Branch" PARAMETERS = "branch_id, comb_id, res_id" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT CSSResourceVersion_Load_Branch_Head( l.branch_id, l.res_id, l.cssresourceversion ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ NOT CSSResourceVersion_Fork_CrossReferences( l.branch_id, l.cssresourceversion ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvASSIGN NAME = "l.csscombinedresourcexresource:comb_id"	VALUE = "{ l.comb_id }">
	<MvASSIGN NAME = "l.csscombinedresourcexresource:res_id"	VALUE = "{ l.cssresourceversion:res_id }">
	<MvASSIGN NAME = "l.csscombinedresourcexresource:xref_id"	VALUE = "{ l.cssresourceversion:xref_id }">

	<MvFUNCTIONRETURN VALUE = "{ CSSCombinedResourceXResource_Insert_LowLevel( l.csscombinedresourcexresource ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSCombinedResourceXResource_Insert_LowLevel" PARAMETERS = "csscombinedresourcexresource var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.csscombinedresourcexresource:disp_order" VALUE = "{ [ g.Module_Library_DB ].StoreKey_Generate( 'CSSCombinedResourceXResourceDisplayOrder' ) }">

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'CSSCombinedResourceXResource
					      ( comb_id, res_id, xref_id, disp_order )
						  VALUES
						  ( ?, ?, ?, ? )' }"
			 FIELDS	= "l.csscombinedresourcexresource:comb_id, l.csscombinedresourcexresource:res_id,
					   l.csscombinedresourcexresource:xref_id, l.csscombinedresourcexresource:disp_order">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00293', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSCombinedResourceXResource_Fork" PARAMETERS = "cssresourceversion var, new_xref_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'CSSCombinedResourceXResource
					      ( comb_id, res_id, xref_id, disp_order )
						  SELECT comb_id, res_id, ?, disp_order FROM ' $ g.Store_Table_Prefix $ 'CSSCombinedResourceXResource WHERE res_id = ? AND xref_id = ?' }"
			 FIELDS	= "l.new_xref_id,
					   l.cssresourceversion:res_id, l.cssresourceversion:xref_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00442', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSCombinedResourceXResource_Delete_All_CombinedResource" PARAMETERS = "comb_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'CSSCombinedResourceXResource WHERE comb_id = ?' }"
			 FIELDS	= "l.comb_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00294', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSCombinedResourceXResource_Delete_All_Resource" PARAMETERS = "res_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'CSSCombinedResourceXResource WHERE res_id = ?' }"
			 FIELDS	= "l.res_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00295', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSCombinedResourceXResource_Delete_All" PARAMETERS = "" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'CSSCombinedResourceXResource' }"
			 FIELDS	= "">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00296', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSCombinedResourceXResource_Delete" PARAMETERS = "comb_id, res_id" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ CSSCombinedResourceXResource_Delete_Branch( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.comb_id, l.res_id ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSCombinedResourceXResource_Delete_Branch" PARAMETERS = "branch_id, comb_id, res_id" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT CSSResourceVersion_Load_Branch_Head( l.branch_id, l.res_id, l.cssresourceversion ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ NOT CSSResourceVersion_Fork_CrossReferences( l.branch_id, l.cssresourceversion ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvASSIGN NAME = "l.csscombinedresourcexresource:comb_id"	VALUE = "{ l.comb_id }">
	<MvASSIGN NAME = "l.csscombinedresourcexresource:res_id"	VALUE = "{ l.cssresourceversion:res_id }">
	<MvASSIGN NAME = "l.csscombinedresourcexresource:xref_id"	VALUE = "{ l.cssresourceversion:xref_id }">

	<MvFUNCTIONRETURN VALUE = "{ CSSCombinedResourceXResource_Delete_LowLevel( l.csscombinedresourcexresource ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSCombinedResourceXResource_Delete_LowLevel" PARAMETERS = "csscombinedresourcexresource var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'CSSCombinedResourceXResource WHERE comb_id = ? AND res_id = ? AND xref_id = ?' }"
			 FIELDS	= "l.csscombinedresourcexresource:comb_id, l.csscombinedresourcexresource:res_id, l.csscombinedresourcexresource:xref_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{  [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00297', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSCombinedResourceXResource_Delete_All_Orphaned_CombinedResources" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'CSSCombinedResourceXResource
			 			  WHERE comb_id NOT IN ( SELECT DISTINCT res_id FROM ' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00840', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSCombinedResourceXResource_Delete_All_Orphaned_Resources" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'CSSCombinedResourceXResource
			 			  WHERE res_id NOT IN ( SELECT DISTINCT res_id FROM ' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00841', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSCombinedResourceXResource_Load" PARAMETERS = "comb_id, res_id, csscombinedresourcexresource var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ CSSCombinedResourceXResource_Load_Branch( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.comb_id, l.res_id, l.csscombinedresourcexresource ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSCombinedResourceXResource_Load_Branch" PARAMETERS = "branch_id, comb_id, res_id, csscombinedresourcexresource var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "CSSCombinedResourceXResource"
				QUERY	= "{ 'SELECT
								rxr.*
							  FROM
								' $ g.Store_Table_Prefix $ 'CSSCombinedResourceXResource rxr,
								' $ g.Store_Table_Prefix $ 'CSSResourceVersions v,
								' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions bv
							  WHERE
								rxr.comb_id		= ?				AND
								rxr.res_id		= ?				AND
								v.res_id		= rxr.res_id	AND
								v.xref_id		= rxr.xref_id	AND
								bv.version_id	= v.id			AND
								bv.branch_id	= ?				AND
								bv.head			= 1' }"
				FIELDS	= "l.comb_id, l.res_id, l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00298', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ CSSCombinedResourceXResource.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSCombinedResourceXResource">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00299' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ CSSCombinedResourceXResource_Read( l.csscombinedresourcexresource ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSCombinedResourceXResource">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSCombinedResourceXResourceList_Load_Resource" PARAMETERS = "res_id, csscombinedresourcexresources var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ CSSCombinedResourceXResourceList_Load_Branch_Resource( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.res_id, l.csscombinedresourcexresources ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSCombinedResourceXResourceList_Load_Branch_Resource" PARAMETERS = "branch_id, res_id, csscombinedresourcexresources var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "CSSCombinedResourceXResource"
				QUERY	= "{ 'SELECT
								rxr.*
							  FROM
								' $ g.Store_Table_Prefix $ 'CSSCombinedResourceXResource rxr,
								' $ g.Store_Table_Prefix $ 'CSSResourceVersions v,
								' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions bv
							  WHERE
								v.res_id		= ?			AND
								rxr.xref_id		= v.xref_id	AND
								bv.version_id	= v.id		AND
								bv.branch_id	= ?			AND
								bv.head			= 1' }"
				FIELDS	= "l.res_id, l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00458', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.csscombinedresourcexresource_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT CSSCombinedResourceXResource.d.EOF }">
		<MvEVAL EXPR = "{ CSSCombinedResourceXResource_Read( l.csscombinedresourcexresources[ ++l.csscombinedresourcexresource_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "CSSCombinedResourceXResource" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSCombinedResourceXResource">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00459', l.csscombinedresourcexresource_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSCombinedResourceXResourceList_Load_CombinedResource" PARAMETERS = "comb_id, csscombinedresourcexresources var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ CSSCombinedResourceXResourceList_Load_Branch_CombinedResource( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.comb_id, l.csscombinedresourcexresources ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSCombinedResourceXResourceList_Load_Branch_CombinedResource" PARAMETERS = "branch_id, comb_id, csscombinedresourcexresources var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "CSSCombinedResourceXResource"
				QUERY	= "{ 'SELECT
								rxr.*
							  FROM
								' $ g.Store_Table_Prefix $ 'CSSCombinedResourceXResource rxr,
								' $ g.Store_Table_Prefix $ 'CSSResourceVersions v,
								' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions bv
							  WHERE
								rxr.comb_id		= ?				AND
								v.res_id		= rxr.res_id	AND
								v.xref_id		= rxr.xref_id	AND
								bv.version_id	= v.id			AND
								bv.branch_id	= ?				AND
								bv.head			= 1' }"
				FIELDS	= "l.comb_id, l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00487', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.csscombinedresourcexresource_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT CSSCombinedResourceXResource.d.EOF }">
		<MvEVAL EXPR = "{ CSSCombinedResourceXResource_Read( l.csscombinedresourcexresources[ ++l.csscombinedresourcexresource_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "CSSCombinedResourceXResource" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSCombinedResourceXResource">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00488', l.csscombinedresourcexresource_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSCombinedResourceXResourceList_Load_All" PARAMETERS = "csscombinedresourcexresources var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ CSSCombinedResourceXResourceList_Load_Branch_All( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.csscombinedresourcexresources ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSCombinedResourceXResourceList_Load_Branch_All" PARAMETERS = "branch_id, csscombinedresourcexresources var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "CSSCombinedResourceXResource"
				QUERY	= "{ 'SELECT
								rxr.*
							  FROM
								' $ g.Store_Table_Prefix $ 'CSSCombinedResourceXResource rxr,
								' $ g.Store_Table_Prefix $ 'CSSResourceVersions v,
								' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions bv
							  WHERE
								v.res_id		= rxr.res_id	AND
								v.xref_id		= rxr.xref_id	AND
								bv.version_id	= v.id			AND
								bv.branch_id	= ?				AND
								bv.head			= 1
							  ORDER BY
								rxr.comb_id, rxr.disp_order' }"
				FIELDS	= "l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00302', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.csscombinedresourcexresource_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT CSSCombinedResourceXResource.d.EOF }">
		<MvEVAL EXPR = "{ CSSCombinedResourceXResource_Read( l.csscombinedresourcexresources[ ++l.csscombinedresourcexresource_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "CSSCombinedResourceXResource" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSCombinedResourceXResource">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00303', l.csscombinedresourcexresource_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSCombinedResourceXResource_Update_Offsets_PastEnd" PARAMETERS = "comb_id, xref_id, pastend var, pastend_count" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvCOMMENT>
	|
	| Process records moving past the end.  These records must be sorted in ascending order.
	|
	</MvCOMMENT>

	<MvEVAL EXPR = "{ [ g.Module_Library_Utilities ].SortOffsetArray_PastEnd( l.pastend, l.pastend_count ) }">

	<MvASSIGN NAME = "l.pastend_pos" VALUE = 1>
	<MvWHILE EXPR = "{ l.pastend_pos LE l.pastend_count }">
		<MvASSIGN NAME = "l.res_id" 		VALUE = "{ l.pastend[ l.pastend_pos ]:res_id }">
		<MvASSIGN NAME = "l.disp_order"		VALUE = "{ [ g.Module_Library_DB ].StoreKey_Generate( 'CSSCombinedResourceXResourceDisplayOrder' ) }">

		<MvQUERY NAME	= "Merchant"
				 QUERY	= "{ 'UPDATE ' 
							  	$ g.Store_Table_Prefix $ 'CSSCombinedResourceXResource 
							  SET 
							  	disp_order	= ? 
							  WHERE 
							  	comb_id		= ? AND
							  	res_id		= ? AND
								xref_id		= ?' }" 
				 FIELDS	= "l.disp_order, l.comb_id, l.res_id, l.xref_id">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00304', g.MvQUERY_Error ) }">
		</MvIF>
		
		<MvASSIGN NAME = "l.pastend_pos" VALUE = "{ l.pastend_pos + 1 }">
	</MvWHILE>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSCombinedResourceXResource_Update_Offsets" PARAMETERS = "comb_id, csscombinedresourcexresources var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ CSSCombinedResourceXResource_Update_Branch_Offsets( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.comb_id, l.csscombinedresourcexresources ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSCombinedResourceXResource_Update_Branch_Offsets" PARAMETERS = "branch_id, comb_id, csscombinedresourcexresources var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.pastend_count"												VALUE = 0>

	<MvASSIGN NAME = "l.csscombinedresourcexresource_pos"							VALUE = 1>
	<MvASSIGN NAME = "l.csscombinedresourcexresource_count"							VALUE = "{ miva_array_elements( l.csscombinedresourcexresources ) }">
	<MvASSIGN NAME = "g.CSSCombinedResourceXResource_Order_CombinedResourceID" 		VALUE = "{ l.comb_id }">

	<MvCOMMENT>
	|
	| Fork all resources assigned to this combined resource into a specific xref_id
	|
	</MvCOMMENT>

	<MvASSIGN NAME = "l.xref_id"													VALUE = "{ [ g.Module_Library_DB ].StoreKey_Generate( 'CSSResourceReferences' ) }">
	<MvASSIGN NAME = "g.CSSCombinedResourceXResource_Order_XRefID"					VALUE = "{ l.xref_id }">

	<MvFOREACH ITERATOR = "l.cssresourceversion" ARRAY = "l.cssresourceversions" COUNT = "{ CSSResourceVersionList_Load_Branch_CombinedResource( l.branch_id, l.comb_id, l.cssresourceversions ) }">
		<MvIF EXPR = "{ NOT CSSResourceVersion_Fork_CrossReferences_ID( l.branch_id, l.cssresourceversion, l.xref_id ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	</MvFOREACH>

	<MvCOMMENT>
	|
	| Process display order updates
	|
	</MvCOMMENT>

	<MvEVAL EXPR = "{ [ g.Module_Library_Utilities ].SortOffsetArray( l.csscombinedresourcexresources, l.csscombinedresourcexresource_count ) }">

	<MvWHILE EXPR = "{ l.csscombinedresourcexresource_pos LE l.csscombinedresourcexresource_count }">
		<MvASSIGN NAME = "g.CSSCombinedResourceXResource_Order_ResourceID"			VALUE = "{ l.csscombinedresourcexresources[ l.csscombinedresourcexresource_pos ]:res_id }">

		<MvCOMMENT>
		|
		| Determine disp_order of current csscombinedresourcexresource at this offset.
		|
		</MvCOMMENT>

		<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_OPENVIEW_Range( 'Merchant',
																				 'CSSCombinedResourceXResource',
																				 'SELECT res_id, disp_order FROM ' $ g.Store_Table_Prefix $ 'CSSCombinedResourceXResource WHERE res_id <> ? AND comb_id = ? AND xref_id = ? ORDER BY disp_order',
																				 'g.CSSCombinedResourceXResource_Order_ResourceID, g.CSSCombinedResourceXResource_Order_CombinedResourceID, g.CSSCombinedResourceXResource_Order_XRefID',
																				 l.csscombinedresourcexresources[ l.csscombinedresourcexresource_pos ]:offset - 1,
																				 1 ) }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00305', g.MvOPENVIEW_Error ) }">
		</MvIF>

		<MvIF EXPR = "{ CSSCombinedResourceXResource.d.EOF }">
			<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSCombinedResourceXResource">

			<MvCOMMENT>
			|
			| Offset was higher than the last record.  This case requires specialized processing, so save this record for later.
			|
			</MvCOMMENT>

			<MvASSIGN NAME = "l.pastend_count"							VALUE = "{ l.pastend_count + 1 }">
			<MvASSIGN NAME = "l.pastend" INDEX = "{ l.pastend_count }"	VALUE = "{ l.csscombinedresourcexresources[ l.csscombinedresourcexresource_pos ] }">

			<MvASSIGN NAME = "l.csscombinedresourcexresource_pos"		VALUE = "{ l.csscombinedresourcexresource_pos + 1 }">
		<MvELSEIF EXPR = "{ l.pastend_count }">
			<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSCombinedResourceXResource">

			<MvIF EXPR = "{ NOT CSSCombinedResourceXResource_Update_Offsets_PastEnd( l.comb_id, l.xref_id, l.pastend, l.pastend_count ) }">
				<MvFUNCTIONRETURN VALUE = 0>
			</MvIF>

			<MvASSIGN NAME = "l.pastend_count" VALUE = 0>
		<MvELSE>
			<MvASSIGN NAME = "l.disp_order" VALUE = "{ CSSCombinedResourceXResource.d.disp_order }">
			<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSCombinedResourceXResource">

			<MvCOMMENT>
			|
			| Make a hole by shifting csscombinedresourcexresources after this disp_order down
			|
			</MvCOMMENT>

			<MvQUERY NAME	= "Merchant"
					 QUERY	= "{ 'UPDATE ' 
								  	$ g.Store_Table_Prefix $ 'CSSCombinedResourceXResource 
								  SET 
								  	disp_order	= disp_order + 1 
								  WHERE 
								  	disp_order	>= ?	AND
								  	comb_id		= ?		AND
									xref_id		= ?' }" 
					 FIELDS	= "l.disp_order, l.comb_id, l.xref_id">
			<MvIF EXPR = "{ g.MvQUERY_Error }">
				<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00306', g.MvQUERY_Error ) }">
			</MvIF>

			<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Library_DB ].StoreKey_Generate( 'CSSCombinedResourceXResourceDisplayOrder' ) }">

			<MvCOMMENT>
			|
			| Put the csscombinedresourcexresource in the newly created hole
			|
			</MvCOMMENT>

			<MvQUERY NAME	= "Merchant"
					 QUERY	= "{ 'UPDATE ' 
								  	$ g.Store_Table_Prefix $ 'CSSCombinedResourceXResource 
								  SET 
								  	disp_order	= ? 
								  WHERE 
								  	comb_id		= ?	AND
								  	res_id		= ? AND
									xref_id		= ?' }" 
					 FIELDS	= "l.disp_order, l.comb_id, g.CSSCombinedResourceXResource_Order_ResourceID, l.xref_id">
			<MvIF EXPR = "{ g.MvQUERY_Error }">
				<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00307', g.MvQUERY_Error ) }">
			</MvIF>

			<MvASSIGN NAME = "l.csscombinedresourcexresource_pos" VALUE = "{ l.csscombinedresourcexresource_pos + 1 }">
		</MvIF>
	</MvWHILE>

	<MvCOMMENT>
	|
	| If all the downward records were past the end, they must be processed here.
	|
	</MvCOMMENT>

	<MvIF EXPR = "{ l.pastend_count }">
		<MvIF EXPR = "{ NOT CSSCombinedResourceXResource_Update_Offsets_PastEnd( l.comb_id, l.xref_id, l.pastend, l.pastend_count ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_CSSResourceXGroup
|
</MvCOMMENT>

<MvFUNCTION NAME = "CSSResourceXGroup_Read" PARAMETERS = "cssresourcexgroup var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.cssresourcexgroup:css_id"		VALUE = "{ CSSResourceXGroup.d.css_id }">
	<MvASSIGN NAME = "l.cssresourcexgroup:xref_id"		VALUE = "{ CSSResourceXGroup.d.xref_id }">
	<MvASSIGN NAME = "l.cssresourcexgroup:group_id"		VALUE = "{ CSSResourceXGroup.d.group_id }">
	<MvASSIGN NAME = "l.cssresourcexgroup:disp_order"	VALUE = "{ CSSResourceXGroup.d.disp_order }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceXGroup_Insert" PARAMETERS = "css_id, group_id" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ CSSResourceXGroup_Insert_Branch( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.css_id, l.group_id ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceXGroup_Insert_Branch" PARAMETERS = "branch_id, css_id, group_id" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT CSSResourceVersion_Load_Branch_Head( l.branch_id, l.css_id, l.cssresourceversion ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ NOT CSSResourceVersion_Fork_CrossReferences( l.branch_id, l.cssresourceversion ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvASSIGN NAME = "l.cssresourcexgroup:css_id"	VALUE = "{ l.cssresourceversion:res_id }">
	<MvASSIGN NAME = "l.cssresourcexgroup:xref_id"	VALUE = "{ l.cssresourceversion:xref_id }">
	<MvASSIGN NAME = "l.cssresourcexgroup:group_id"	VALUE = "{ l.group_id }">

	<MvFUNCTIONRETURN VALUE = "{ CSSResourceXGroup_Insert_LowLevel( l.cssresourcexgroup ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceXGroup_Insert_LowLevel" PARAMETERS = "cssresourcexgroup var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.cssresourcexgroup:disp_order" VALUE = "{ [ g.Module_Library_DB ].StoreKey_Generate( 'CSSResourceXGroupDisplayOrder' ) }">

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'CSSResourceXGroup
					      ( css_id, xref_id, group_id, disp_order )
						  VALUES
						  ( ?, ?, ?, ? )' }"
			 FIELDS	= "l.cssresourcexgroup:css_id, l.cssresourcexgroup:xref_id, l.cssresourcexgroup:group_id,
					   l.cssresourcexgroup:disp_order">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00235', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceXGroup_Fork" PARAMETERS = "cssresourceversion var, new_xref_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'CSSResourceXGroup
					      ( css_id, xref_id, group_id, disp_order )
						  SELECT css_id, ?, group_id, disp_order FROM ' $ g.Store_Table_Prefix $ 'CSSResourceXGroup WHERE css_id = ? AND xref_id = ?' }"
			 FIELDS	= "l.new_xref_id,
					   l.cssresourceversion:res_id, l.cssresourceversion:xref_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00443', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceXGroup_Delete_All_Style" PARAMETERS = "css_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'CSSResourceXGroup WHERE css_id = ?' }"
			 FIELDS	= "l.css_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00236', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceXGroup_Delete_All_Group" PARAMETERS = "group_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'CSSResourceXGroup WHERE group_id = ?' }"
			 FIELDS	= "l.group_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00237', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceXGroup_Delete_All" PARAMETERS = "" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'CSSResourceXGroup' }"
			 FIELDS	= "">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00238', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceXGroup_Delete" PARAMETERS = "css_id, group_id" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ CSSResourceXGroup_Delete_Branch( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.css_id, l.group_id ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceXGroup_Delete_Branch" PARAMETERS = "branch_id, css_id, group_id" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT CSSResourceVersion_Load_Branch_Head( l.branch_id, l.css_id, l.cssresourceversion ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ NOT CSSResourceVersion_Fork_CrossReferences( l.branch_id, l.cssresourceversion ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvASSIGN NAME = "l.cssresourcexgroup:css_id"	VALUE = "{ l.cssresourceversion:res_id }">
	<MvASSIGN NAME = "l.cssresourcexgroup:xref_id"	VALUE = "{ l.cssresourceversion:xref_id }">
	<MvASSIGN NAME = "l.cssresourcexgroup:group_id"	VALUE = "{ l.group_id }">

	<MvFUNCTIONRETURN VALUE = "{ CSSResourceXGroup_Delete_LowLevel( l.cssresourcexgroup ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceXGroup_Delete_LowLevel" PARAMETERS = "cssresourcexgroup var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'CSSResourceXGroup WHERE css_id = ? AND xref_id = ? AND group_id = ?' }"
			 FIELDS	= "l.cssresourcexgroup:css_id, l.cssresourcexgroup:xref_id, l.cssresourcexgroup:group_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{  [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00239', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceXGroup_Delete_All_Orphaned_Styles" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'CSSResourceXGroup
			 			  WHERE css_id NOT IN ( SELECT DISTINCT res_id FROM ' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00842', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceXGroup_Load" PARAMETERS = "css_id, group_id, cssresourcexgroup var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ CSSResourceXGroup_Load_Branch( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.css_id, l.group_id, l.cssresourcexgroup ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceXGroup_Load_Branch" PARAMETERS = "branch_id, css_id, group_id, cssresourcexgroup var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "CSSResourceXGroup"
				QUERY	= "{ 'SELECT
								cxg.*
							  FROM
								' $ g.Store_Table_Prefix $ 'CSSResourceXGroup cxg,
								' $ g.Store_Table_Prefix $ 'CSSResourceVersions v,
								' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions bv
							  WHERE
								cxg.css_id		= ?				AND
								cxg.group_id	= ?				AND
								v.res_id		= cxg.css_id	AND
								v.xref_id		= cxg.xref_id	AND
								bv.version_id	= v.id			AND
								bv.branch_id	= ?				AND
								bv.head			= 1' }"
				FIELDS	= "l.css_id, l.group_id, l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00240', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ CSSResourceXGroup.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSResourceXGroup">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00241' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ CSSResourceXGroup_Read( l.cssresourcexgroup ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSResourceXGroup">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceXGroupList_Load_Resource" PARAMETERS = "css_id, cssresourcexgroups var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ CSSResourceXGroupList_Load_Branch_Resource( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.css_id, l.cssresourcexgroups ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceXGroupList_Load_Branch_Resource" PARAMETERS = "branch_id, css_id, cssresourcexgroups var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "CSSResourceXGroup"
				QUERY	= "{ 'SELECT
								cxg.*
							  FROM
								' $ g.Store_Table_Prefix $ 'CSSResourceXGroup cxg,
								' $ g.Store_Table_Prefix $ 'CSSResourceVersions v,
								' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions bv
							  WHERE
								v.res_id		= ?			AND
								cxg.css_id		= v.res_id	AND
								cxg.xref_id		= v.xref_id	AND
								bv.version_id	= v.id		AND
								bv.branch_id	= ?			AND
								bv.head			= 1' }"
				FIELDS	= "l.css_id, l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00460', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.cssresourcexgroup_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT CSSResourceXGroup.d.EOF }">
		<MvEVAL EXPR = "{ CSSResourceXGroup_Read( l.cssresourcexgroups[ ++l.cssresourcexgroup_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "CSSResourceXGroup" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSResourceXGroup">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00461', l.cssresourcexgroup_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceXGroupList_Load_Group" PARAMETERS = "group_id, cssresourcexgroups var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ CSSResourceXGroupList_Load_Branch_Group( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.group_id, l.cssresourcexgroups ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceXGroupList_Load_Branch_Group" PARAMETERS = "branch_id, group_id, cssresourcexgroups var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "CSSResourceXGroup"
				QUERY	= "{ 'SELECT
								cxg.*
							  FROM
								' $ g.Store_Table_Prefix $ 'CSSResourceXGroup cxg,
								' $ g.Store_Table_Prefix $ 'CSSResourceVersions v,
								' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions bv
							  WHERE
								cxg.group_id	= ?				AND
								v.res_id		= cxg.css_id	AND
								v.xref_id		= cxg.xref_id	AND
								bv.version_id	= v.id			AND
								bv.branch_id	= ?				AND
								bv.head			= 1
							  ORDER BY
								cxg.disp_order' }"
				FIELDS	= "l.group_id, l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00489', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.cssresourcexgroup_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT CSSResourceXGroup.d.EOF }">
		<MvEVAL EXPR = "{ CSSResourceXGroup_Read( l.cssresourcexgroups[ ++l.cssresourcexgroup_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "CSSResourceXGroup" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSResourceXGroup">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00490', l.cssresourcexgroup_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceXGroupList_Load_All" PARAMETERS = "cssresourcexgroups var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ CSSResourceXGroupList_Load_Branch_All( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.cssresourcexgroups ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceXGroupList_Load_Branch_All" PARAMETERS = "branch_id, cssresourcexgroups var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "CSSResourceXGroup"
				QUERY	= "{ 'SELECT
								cxg.*
							  FROM
								' $ g.Store_Table_Prefix $ 'CSSResourceXGroup cxg,
								' $ g.Store_Table_Prefix $ 'CSSResourceVersions v,
								' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions bv
							  WHERE
								v.res_id		= cxg.css_id	AND
								v.xref_id		= cxg.xref_id	AND
								bv.version_id	= v.id			AND
								bv.branch_id	= ?				AND
								bv.head			= 1
							  ORDER BY
								cxg.group_id, cxg.disp_order' }"
				FIELDS	= "l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00242', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.cssresourcexgroup_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT CSSResourceXGroup.d.EOF }">
		<MvEVAL EXPR = "{ CSSResourceXGroup_Read( l.cssresourcexgroups[ ++l.cssresourcexgroup_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "CSSResourceXGroup" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSResourceXGroup">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00243', l.cssresourcexgroup_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceXGroup_Update_Offsets_PastEnd" PARAMETERS = "group_id, xref_id, pastend var, pastend_count" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvCOMMENT>
	|
	| Process records moving past the end.  These records must be sorted in ascending order.
	|
	</MvCOMMENT>

	<MvEVAL EXPR = "{ [ g.Module_Library_Utilities ].SortOffsetArray_PastEnd( l.pastend, l.pastend_count ) }">

	<MvASSIGN NAME = "l.pastend_pos" VALUE = 1>
	<MvWHILE EXPR = "{ l.pastend_pos LE l.pastend_count }">
		<MvASSIGN NAME = "l.css_id"			VALUE = "{ l.pastend[ l.pastend_pos ]:css_id }">
		<MvASSIGN NAME = "l.disp_order"		VALUE = "{ [ g.Module_Library_DB ].StoreKey_Generate( 'CSSResourceXGroupDisplayOrder' ) }">

		<MvQUERY NAME	= "Merchant"
				 QUERY	= "{ 'UPDATE ' 
							  	$ g.Store_Table_Prefix $ 'CSSResourceXGroup 
							  SET 
							  	disp_order	= ? 
							  WHERE 
							  	css_id		= ? AND
								xref_id		= ?	AND
								group_id	= ?' }"
				 FIELDS	= "l.disp_order,
						   l.css_id, l.xref_id, l.group_id">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00244', g.MvQUERY_Error ) }">
		</MvIF>
		
		<MvASSIGN NAME = "l.pastend_pos" VALUE = "{ l.pastend_pos + 1 }">
	</MvWHILE>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceXGroup_Update_Offsets" PARAMETERS = "group_id, cssxgroups var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ CSSResourceXGroup_Update_Branch_Offsets( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.group_id, l.cssxgroups ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceXGroup_Update_Branch_Offsets" PARAMETERS = "branch_id, group_id, cssxgroups var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.pastend_count"										VALUE = 0>

	<MvASSIGN NAME = "l.cssxgroup_pos"										VALUE = 1>
	<MvASSIGN NAME = "l.cssxgroup_count"									VALUE = "{ miva_array_elements( l.cssxgroups ) }">
	<MvASSIGN NAME = "g.CSSResourceXGroup_Order_GroupID" 					VALUE = "{ l.group_id }">

	<MvCOMMENT>
	|
	| Fork all resources assigned to this group into a specific xref_id
	|
	</MvCOMMENT>

	<MvASSIGN NAME = "l.xref_id"											VALUE = "{ [ g.Module_Library_DB ].StoreKey_Generate( 'CSSResourceReferences' ) }">
	<MvASSIGN NAME = "g.CSSResourceXGroup_Order_XRefID"						VALUE = "{ l.xref_id }">

	<MvFOREACH ITERATOR = "l.cssresourceversion" ARRAY = "l.cssresourceversions" COUNT = "{ CSSResourceVersionList_Load_Branch_ResourceGroup( l.branch_id, l.group_id, l.cssresourceversions ) }">
		<MvIF EXPR = "{ NOT CSSResourceVersion_Fork_CrossReferences_ID( l.branch_id, l.cssresourceversion, l.xref_id ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	</MvFOREACH>

	<MvCOMMENT>
	|
	| Process display order updates
	|
	</MvCOMMENT>

	<MvEVAL EXPR = "{ [ g.Module_Library_Utilities ].SortOffsetArray( l.cssxgroups, l.cssxgroup_count ) }">

	<MvWHILE EXPR = "{ l.cssxgroup_pos LE l.cssxgroup_count }">
		<MvASSIGN NAME = "g.CSSResourceXGroup_Order_CSSResource_ID" 		VALUE = "{ l.cssxgroups[ l.cssxgroup_pos ]:css_id }">

		<MvCOMMENT>
		|
		| Determine disp_order of current cssxgroup at this offset.
		|
		</MvCOMMENT>

		<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_OPENVIEW_Range( 'Merchant',
																				 'CSSResourceXGroup',
																				 'SELECT css_id, disp_order FROM ' $ g.Store_Table_Prefix $ 'CSSResourceXGroup WHERE css_id <> ? AND group_id = ? AND xref_id = ? ORDER BY disp_order',
																				 'g.CSSResourceXGroup_Order_CSSResource_ID, g.CSSResourceXGroup_Order_GroupID, g.CSSResourceXGroup_Order_XRefID',
																				 l.cssxgroups[ l.cssxgroup_pos ]:offset - 1,
																				 1 ) }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00245', g.MvOPENVIEW_Error ) }">
		</MvIF>

		<MvIF EXPR = "{ CSSResourceXGroup.d.EOF }">
			<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSResourceXGroup">

			<MvCOMMENT>
			|
			| Offset was higher than the last record.  This case requires specialized processing, so save this record for later.
			|
			</MvCOMMENT>

			<MvASSIGN NAME = "l.pastend_count"								VALUE = "{ l.pastend_count + 1 }">
			<MvASSIGN NAME = "l.pastend" INDEX = "{ l.pastend_count }"		VALUE = "{ l.cssxgroups[ l.cssxgroup_pos ] }">

			<MvASSIGN NAME = "l.cssxgroup_pos"								VALUE = "{ l.cssxgroup_pos + 1 }">
		<MvELSEIF EXPR = "{ l.pastend_count }">
			<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSResourceXGroup">

			<MvIF EXPR = "{ NOT CSSResourceXGroup_Update_Offsets_PastEnd( l.group_id, l.xref_id, l.pastend, l.pastend_count ) }">
				<MvFUNCTIONRETURN VALUE = 0>
			</MvIF>

			<MvASSIGN NAME = "l.pastend_count" VALUE = 0>
		<MvELSE>
			<MvASSIGN NAME = "l.disp_order" VALUE = "{ CSSResourceXGroup.d.disp_order }">
			<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSResourceXGroup">

			<MvCOMMENT>
			|
			| Make a hole by shifting cssxgroups after this disp_order down
			|
			</MvCOMMENT>

			<MvQUERY NAME	= "Merchant"
					 QUERY	= "{ 'UPDATE ' 
								  	$ g.Store_Table_Prefix $ 'CSSResourceXGroup 
								  SET 
								  	disp_order = disp_order + 1 
								  WHERE 
								  	disp_order	>= ?	AND
									group_id	= ?		AND
									xref_id		= ?' }" 
					 FIELDS	= "l.disp_order, l.group_id, l.xref_id">
			<MvIF EXPR = "{ g.MvQUERY_Error }">
				<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00246', g.MvQUERY_Error ) }">
			</MvIF>

			<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Library_DB ].StoreKey_Generate( 'CSSResourceXGroupDisplayOrder' ) }">

			<MvCOMMENT>
			|
			| Put the cssxgroup in the newly created hole
			|
			</MvCOMMENT>

			<MvQUERY NAME	= "Merchant"
					 QUERY	= "{ 'UPDATE ' 
								  	$ g.Store_Table_Prefix $ 'CSSResourceXGroup 
								  SET 
								  	disp_order	= ? 
								  WHERE 
								  	css_id		= ? AND
									xref_id		= ? AND
									group_id	= ?' }"
					 FIELDS	= "l.disp_order,
							   g.CSSResourceXGroup_Order_CSSResource_ID, l.xref_id, l.group_id">
			<MvIF EXPR = "{ g.MvQUERY_Error }">
				<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00247', g.MvQUERY_Error ) }">
			</MvIF>

			<MvASSIGN NAME = "l.cssxgroup_pos" VALUE = "{ l.cssxgroup_pos + 1 }">
		</MvIF>
	</MvWHILE>

	<MvCOMMENT>
	|
	| If all the downward records were past the end, they must be processed here.
	|
	</MvCOMMENT>

	<MvIF EXPR = "{ l.pastend_count }">
		<MvIF EXPR = "{ NOT CSSResourceXGroup_Update_Offsets_PastEnd( l.group_id, l.xref_id, l.pastend, l.pastend_count ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_CSSResourceXPage
|
</MvCOMMENT>

<MvFUNCTION NAME = "CSSResourceXPage_Read" PARAMETERS = "cssresourcexpage var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.cssresourcexpage:css_id"	VALUE = "{ CSSResourceXPage.d.css_id }">
	<MvASSIGN NAME = "l.cssresourcexpage:xref_id"	VALUE = "{ CSSResourceXPage.d.xref_id }">
	<MvASSIGN NAME = "l.cssresourcexpage:page_id"	VALUE = "{ CSSResourceXPage.d.page_id }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceXPage_Insert" PARAMETERS = "css_id, page_id" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ CSSResourceXPage_Insert_Branch( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.css_id, l.page_id ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceXPage_Insert_Branch" PARAMETERS = "branch_id, css_id, page_id" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT CSSResourceVersion_Load_Branch_Head( l.branch_id, l.css_id, l.cssresourceversion ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ NOT CSSResourceVersion_Fork_CrossReferences( l.branch_id, l.cssresourceversion ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvASSIGN NAME = "l.cssresourcexpage:css_id"	VALUE = "{ l.cssresourceversion:res_id }">
	<MvASSIGN NAME = "l.cssresourcexpage:xref_id"	VALUE = "{ l.cssresourceversion:xref_id }">
	<MvASSIGN NAME = "l.cssresourcexpage:page_id"	VALUE = "{ l.page_id }">

	<MvFUNCTIONRETURN VALUE = "{ CSSResourceXPage_Insert_LowLevel( l.cssresourcexpage ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceXPage_Insert_LowLevel" PARAMETERS = "cssresourcexpage var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'CSSResourceXPage
					      ( css_id, xref_id, page_id )
						  VALUES
						  ( ?, ?, ? )' }"
			 FIELDS	= "l.cssresourcexpage:css_id, l.cssresourcexpage:xref_id, l.cssresourcexpage:page_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00248', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceXPage_Fork" PARAMETERS = "cssresourceversion var, new_xref_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'CSSResourceXPage
					      ( css_id, xref_id, page_id )
						  SELECT css_id, ?, page_id FROM ' $ g.Store_Table_Prefix $ 'CSSResourceXPage WHERE css_id = ? AND xref_id = ?' }"
			 FIELDS	= "l.new_xref_id,
					   l.cssresourceversion:res_id, l.cssresourceversion:xref_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00444', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceXPage_Delete_All_Style" PARAMETERS = "css_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'CSSResourceXPage WHERE css_id = ?' }"
			 FIELDS	= "l.css_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00249', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceXPage_Delete_All_Page" PARAMETERS = "page_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'CSSResourceXPage WHERE page_id = ?' }"
			 FIELDS	= "l.page_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00267', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceXPage_Delete_All" PARAMETERS = "" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'CSSResourceXPage' }"
			 FIELDS	= "">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00250', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceXPage_Delete" PARAMETERS = "css_id, page_id" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ CSSResourceXPage_Delete_Branch( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.css_id, l.page_id ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceXPage_Delete_Branch" PARAMETERS = "branch_id, css_id, page_id" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT CSSResourceVersion_Load_Branch_Head( l.branch_id, l.css_id, l.cssresourceversion ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ NOT CSSResourceVersion_Fork_CrossReferences( l.branch_id, l.cssresourceversion ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvASSIGN NAME = "l.cssresourcexpage:css_id"	VALUE = "{ l.cssresourceversion:res_id }">
	<MvASSIGN NAME = "l.cssresourcexpage:xref_id"	VALUE = "{ l.cssresourceversion:xref_id }">
	<MvASSIGN NAME = "l.cssresourcexpage:page_id"	VALUE = "{ l.page_id }">

	<MvFUNCTIONRETURN VALUE = "{ CSSResourceXPage_Delete_LowLevel( l.cssresourcexpage ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceXPage_Delete_LowLevel" PARAMETERS = "cssresourcexpage var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'CSSResourceXPage WHERE css_id = ? AND xref_id = ? AND page_id = ?' }"
			 FIELDS	= "l.cssresourcexpage:css_id, l.cssresourcexpage:xref_id, l.cssresourcexpage:page_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{  [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00251', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceXPage_Delete_All_Orphaned_Styles" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'CSSResourceXPage
			 			  WHERE css_id NOT IN ( SELECT DISTINCT res_id FROM ' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00843', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceXPage_Delete_All_Orphaned_Pages" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'CSSResourceXPage
			 			  WHERE page_id NOT IN ( SELECT DISTINCT page_id FROM ' $ g.Store_Table_Prefix $ 'PageBranchVersions )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00844', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceXPage_Load" PARAMETERS = "css_id, page_id, cssresourcexpage var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ CSSResourceXPage_Load_Branch( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.css_id, l.page_id, l.cssresourcexpage ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceXPage_Load_Branch" PARAMETERS = "branch_id, css_id, page_id, cssresourcexpage var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "CSSResourceXPage"
				QUERY	= "{ 'SELECT
								cxp.*
							  FROM
								' $ g.Store_Table_Prefix $ 'CSSResourceXPage cxp,
								' $ g.Store_Table_Prefix $ 'CSSResourceVersions v,
								' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions bv
							  WHERE
								cxp.css_id		= ?				AND
								cxp.page_id		= ?				AND
								v.res_id		= cxp.css_id	AND
								v.xref_id		= cxp.xref_id	AND
								bv.version_id	= v.id			AND
								bv.branch_id	= ?				AND
								bv.head			= 1' }"
				FIELDS	= "l.css_id, l.page_id, l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00252', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ CSSResourceXPage.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSResourceXPage">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00253' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ CSSResourceXPage_Read( l.cssresourcexpage ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSResourceXPage">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceXPageList_Load_Resource" PARAMETERS = "res_id, cssresourcexpages var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ CSSResourceXPageList_Load_Branch_Resource( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.res_id, l.cssresourcexpages ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceXPageList_Load_Branch_Resource" PARAMETERS = "branch_id, res_id, cssresourcexpages var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "CSSResourceXPage"
				QUERY	= "{ 'SELECT
								cxp.*
							  FROM
								' $ g.Store_Table_Prefix $ 'CSSResourceXPage cxp,
								' $ g.Store_Table_Prefix $ 'CSSResourceVersions v,
								' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions bv
							  WHERE
								v.res_id		= ?			AND
								cxp.xref_id		= v.xref_id	AND
								bv.version_id	= v.id		AND
								bv.branch_id	= ?			AND
								bv.head			= 1' }"
				FIELDS	= "l.res_id, l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00462', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.cssresourcexpage_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT CSSResourceXPage.d.EOF }">
		<MvEVAL EXPR = "{ CSSResourceXPage_Read( l.cssresourcexpages[ ++l.cssresourcexpage_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "CSSResourceXPage" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSResourceXPage">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00463', l.cssresourcexpage_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceXPageList_Load_All" PARAMETERS = "cssresourcexpages var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ CSSResourceXPageList_Load_Branch_All( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.cssresourcexpages ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CSSResourceXPageList_Load_Branch_All" PARAMETERS = "branch_id, cssresourcexpages var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "CSSResourceXPage"
				QUERY	= "{ 'SELECT
								cxp.*
							  FROM
								' $ g.Store_Table_Prefix $ 'CSSResourceXPage cxp,
								' $ g.Store_Table_Prefix $ 'CSSResourceVersions v,
								' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions bv
							  WHERE
								v.res_id		= cxp.css_id	AND
								v.xref_id		= cxp.xref_id	AND
								bv.version_id	= v.id			AND
								bv.branch_id	= ?				AND
								bv.head			= 1' }"
				FIELDS	= "l.branch_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00254', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.cssresourcexpage_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT CSSResourceXPage.d.EOF }">
		<MvEVAL EXPR = "{ CSSResourceXPage_Read( l.cssresourcexpages[ ++l.cssresourcexpage_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "CSSResourceXPage" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSResourceXPage">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00255', l.cssresourcexpage_count ) }">
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_ResourceGroups
|
</MvCOMMENT>

<MvFUNCTION NAME = "ResourceGroup_Read" PARAMETERS = "resourcegroup var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.resourcegroup:id"	VALUE = "{ ResourceGroups.d.id }">
	<MvASSIGN NAME = "l.resourcegroup:code"	VALUE = "{ ResourceGroups.d.code }">
</MvFUNCTION>

<MvFUNCTION NAME = "ResourceGroup_Load_ID" PARAMETERS = "id, resourcegroup var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ResourceGroups"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'ResourceGroups WHERE id = ?' }"
				FIELDS 	= "l.id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00256', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ ResourceGroups.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "ResourceGroups">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00257' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ ResourceGroup_Read( l.resourcegroup ) }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ResourceGroups">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ResourceGroup_Load_Code" PARAMETERS = "code, resourcegroup var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ResourceGroups"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'ResourceGroups WHERE ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_Upper( '?' ) }"
				FIELDS 	= "l.code">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00258', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ ResourceGroups.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "ResourceGroups">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00259' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ ResourceGroup_Read( l.resourcegroup ) }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ResourceGroups">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ResourceGroup_Load_All" PARAMETERS = "resourcegroups var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ResourceGroups"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'ResourceGroups ORDER BY id' }"
				FIELDS 	= "">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00260', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.resourcegroup_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT ResourceGroups.d.EOF }">
		<MvEVAL EXPR = "{ ResourceGroup_Read( l.resourcegroups[ ++l.resourcegroup_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "ResourceGroups" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ResourceGroups">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00261', l.resourcegroup_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ResourceGroup_Insert" PARAMETERS = "resourcegroup var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.resourcegroup:id" VALUE = "{ [ g.Module_Library_DB ].StoreKey_Generate( 'ResourceGroups' ) }">

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'ResourceGroups
						  ( id, code )
						  VALUES
						  ( ?, ? )' }"
			 FIELDS	= "l.resourcegroup:id, l.resourcegroup:code">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00262', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ResourceGroup_Update" PARAMETERS = "resourcegroup var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'ResourceGroups
						  SET
						  	code		= ?
						  WHERE
						  	id			= ?' }"
			 FIELDS	= "l.resourcegroup:code,
			 		   l.resourcegroup:id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00263', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ResourceGroup_Delete" PARAMETERS = "resourcegroup var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT JavaScriptResourceXGroup_Delete_All_Group( l.resourcegroup:id ) OR
					NOT CSSResourceXGroup_Delete_All_Group( l.resourcegroup:id ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = "{ ResourceGroup_Delete_LowLevel( l.resourcegroup:id ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ResourceGroup_Delete_LowLevel" PARAMETERS = "id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ResourceGroups WHERE id = ?' }"
			 FIELDS	= "l.id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00264', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ResourceGroup_Delete_All" PARAMETERS = "" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT JavaScriptResourceXGroup_Delete_All() OR
					NOT CSSResourceXGroup_Delete_All() }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = "{ ResourceGroup_Delete_All_LowLevel() }">
</MvFUNCTION>

<MvFUNCTION NAME = "ResourceGroup_Delete_All_LowLevel" PARAMETERS = "" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ResourceGroups' }"
			 FIELDS	= "">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00265', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_ManagedProperties
|
</MvCOMMENT>

<MvFUNCTION NAME = "ManagedProperty_Read" PARAMETERS = "managedproperty var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.managedproperty:id"						VALUE = "{ ManagedProperties.d.id }">
	<MvASSIGN NAME = "l.managedproperty:type"					VALUE = "{ ManagedProperties.d.type }">
	<MvASSIGN NAME = "l.managedproperty:code"					VALUE = "{ ManagedProperties.d.code }">
	<MvASSIGN NAME = "l.managedproperty:product_id"				VALUE = "{ ManagedProperties.d.product_id }">
	<MvASSIGN NAME = "l.managedproperty:cat_id"					VALUE = "{ ManagedProperties.d.cat_id }">
	<MvASSIGN NAME = "l.managedproperty:current_id"				VALUE = "{ ManagedProperties.d.current_id }">
	<MvASSIGN NAME = "l.managedproperty:sync"					VALUE = "{ ManagedProperties.d.sync }">
	<MvASSIGN NAME = "l.managedproperty:templ_id"				VALUE = "{ ManagedProperties.d.templ_id }">

	<MvASSIGN NAME = "l.managedproperty:original_type"			VALUE = "{ ManagedProperties.d.type }">
	<MvASSIGN NAME = "l.managedproperty:original_code"			VALUE = "{ ManagedProperties.d.code }">
	<MvASSIGN NAME = "l.managedproperty:original_product_id"	VALUE = "{ ManagedProperties.d.product_id }">
	<MvASSIGN NAME = "l.managedproperty:original_cat_id"		VALUE = "{ ManagedProperties.d.cat_id }">
</MvFUNCTION>

<MvFUNCTION NAME = "Runtime_ManagedProperty_Read" PARAMETERS = "managedproperty var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ ManagedProperty_Read( l.managedproperty ) }">

	<MvASSIGN NAME = "l.managedproperty:template_filename"		VALUE = "{ ManagedProperties.d.template_filename }">
	<MvASSIGN NAME = "l.managedproperty:settings"				VALUE = "{ miva_array_deserialize( ManagedProperties.d.settings ) }">
	<MvASSIGN NAME = "l.managedproperty:image_id"				VALUE = "{ ManagedProperties.d.image_id }">
	<MvASSIGN NAME = "l.managedproperty:original_image_id"		VALUE = "{ ManagedProperties.d.image_id }">
	<MvASSIGN NAME = "l.managedproperty:content_id"				VALUE = "{ ManagedProperties.d.content_id }">

	<MvASSIGN NAME = "l.managedproperty:image:id"				VALUE = "{ ManagedProperties.d.image_loaded_id }">
	<MvASSIGN NAME = "l.managedproperty:image:image"			VALUE = "{ ManagedProperties.d.image_image }">
	<MvASSIGN NAME = "l.managedproperty:image:image_md5"		VALUE = "{ ManagedProperties.d.image_md5 }">
	<MvASSIGN NAME = "l.managedproperty:image:width"			VALUE = "{ ManagedProperties.d.image_width }">
	<MvASSIGN NAME = "l.managedproperty:image:height"			VALUE = "{ ManagedProperties.d.image_height }">
	<MvASSIGN NAME = "l.managedproperty:image:refcount"			VALUE = "{ ManagedProperties.d.image_refcount }">

	<MvASSIGN NAME = "l.managedproperty:content:id"				VALUE = "{ ManagedProperties.d.content_loaded_id }">
	<MvASSIGN NAME = "l.managedproperty:content:refcount"		VALUE = "{ ManagedProperties.d.content_refcount }">
	<MvASSIGN NAME = "l.managedproperty:content:md5"			VALUE = "{ ManagedProperties.d.content_md5 }">
	<MvASSIGN NAME = "l.managedproperty:content:encoding"		VALUE = "{ ManagedProperties.d.content_encoding }">

	<MvIF EXPR = "{ ManagedProperties.d.content_encoding EQ 'base64' }">
		<MvASSIGN NAME = "l.managedproperty:content:content"	VALUE = "{ crypto_base64_decode( ManagedProperties.d.content_content ) }">
	<MvELSE>
		<MvASSIGN NAME = "l.managedproperty:content:content"	VALUE = "{ ManagedProperties.d.content_content }">
	</MvIF>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedPropertyAndVersion_Read" PARAMETERS = "managedproperty var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ ManagedProperty_Read( l.managedproperty ) }">

	<MvASSIGN NAME = "l.managedproperty:version:id"						VALUE = "{ ManagedProperties.d.version_id }">
	<MvASSIGN NAME = "l.managedproperty:version:prop_id"				VALUE = "{ ManagedProperties.d.version_prop_id }">
	<MvASSIGN NAME = "l.managedproperty:version:immutable"				VALUE = "{ ManagedProperties.d.version_immutable }">
	<MvASSIGN NAME = "l.managedproperty:version:type"					VALUE = "{ ManagedProperties.d.type }">
	<MvASSIGN NAME = "l.managedproperty:version:code"					VALUE = "{ ManagedProperties.d.code }">
	<MvASSIGN NAME = "l.managedproperty:version:product_id"				VALUE = "{ ManagedProperties.d.product_id }">
	<MvASSIGN NAME = "l.managedproperty:version:cat_id"					VALUE = "{ ManagedProperties.d.cat_id }">
	<MvASSIGN NAME = "l.managedproperty:version:image_id"				VALUE = "{ ManagedProperties.d.version_image_id }">
	<MvASSIGN NAME = "l.managedproperty:version:original_image_id"		VALUE = "{ ManagedProperties.d.version_image_id }">
	<MvASSIGN NAME = "l.managedproperty:version:content_id"				VALUE = "{ ManagedProperties.d.version_content_id }">
	<MvASSIGN NAME = "l.managedproperty:version:settings"				VALUE = "{ miva_array_deserialize( ManagedProperties.d.version_settings ) }">

	<MvASSIGN NAME = "l.managedproperty:version:image:id"				VALUE = "{ ManagedProperties.d.image_loaded_id }">
	<MvASSIGN NAME = "l.managedproperty:version:image:image"			VALUE = "{ ManagedProperties.d.image_image }">
	<MvASSIGN NAME = "l.managedproperty:version:image:image_md5"		VALUE = "{ ManagedProperties.d.image_md5 }">
	<MvASSIGN NAME = "l.managedproperty:version:image:width"			VALUE = "{ ManagedProperties.d.image_width }">
	<MvASSIGN NAME = "l.managedproperty:version:image:height"			VALUE = "{ ManagedProperties.d.image_height }">
	<MvASSIGN NAME = "l.managedproperty:version:image:refcount"			VALUE = "{ ManagedProperties.d.image_refcount }">
	<MvASSIGN NAME = "l.managedproperty:version:image:head_count"		VALUE = "{ ManagedProperties.d.image_head_count }">

	<MvASSIGN NAME = "l.managedproperty:version:content:id"				VALUE = "{ ManagedProperties.d.content_loaded_id }">
	<MvASSIGN NAME = "l.managedproperty:version:content:refcount"		VALUE = "{ ManagedProperties.d.content_refcount }">
	<MvASSIGN NAME = "l.managedproperty:version:content:md5"			VALUE = "{ ManagedProperties.d.content_md5 }">
	<MvASSIGN NAME = "l.managedproperty:version:content:encoding"		VALUE = "{ ManagedProperties.d.content_encoding }">
	
	<MvIF EXPR = "{ ManagedProperties.d.content_encoding EQ 'base64' }">
		<MvASSIGN NAME = "l.managedproperty:version:content:content"	VALUE = "{ crypto_base64_decode( ManagedProperties.d.content_content ) }">
	<MvELSE>
		<MvASSIGN NAME = "l.managedproperty:version:content:content"	VALUE = "{ ManagedProperties.d.content_content }">
	</MvIF>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedProperty_Insert" PARAMETERS = "managedproperty var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT ManagedProperty_Insert_LowLevel( l.managedproperty ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvASSIGN NAME = "l.managedproperty:original_type"			VALUE = "{ l.managedproperty:type }">
	<MvASSIGN NAME = "l.managedproperty:original_code"			VALUE = "{ l.managedproperty:code }">
	<MvASSIGN NAME = "l.managedproperty:original_product_id"	VALUE = "{ l.managedproperty:product_id }">
	<MvASSIGN NAME = "l.managedproperty:original_cat_id"		VALUE = "{ l.managedproperty:cat_id }">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedProperty_Insert_LowLevel" PARAMETERS = "managedproperty var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.managedproperty:id"	VALUE = "{ [ g.Module_Library_DB ].StoreKey_Generate( 'ManagedProperties' ) }">

	<MvIF EXPR = "{ ISNULL l.managedproperty:sync }">		<MvASSIGN NAME = "l.managedproperty:sync"		VALUE = 0>	</MvIF>
	<MvIF EXPR = "{ ISNULL l.managedproperty:templ_id }">	<MvASSIGN NAME = "l.managedproperty:templ_id"	VALUE = 0>	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'ManagedProperties
					      ( id, sync, templ_id )
						  VALUES
						  ( ?, ?, ? )' }"
			 FIELDS	= "l.managedproperty:id, l.managedproperty:sync, l.managedproperty:templ_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00519', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedProperty_Update" PARAMETERS = "managedproperty var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ ManagedProperty_Load( l.managedproperty:type, l.managedproperty:code, l.managedproperty:product_id, l.managedproperty:cat_id, l.existing_managedproperty ) AND
					l.managedproperty:id NE l.existing_managedproperty:id }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Native_DBAPI ].DB_Error_IndexDuplicate( 'MER-TUI-DTB-00685', 'Managed property already exists' ) }">
	</MvIF>

	<MvIF EXPR = "{ NOT ManagedProperty_Update_LowLevel( l.managedproperty ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ l.managedproperty:type			NE l.managedproperty:original_type			OR
					l.managedproperty:code			NE l.managedproperty:original_code			OR
					l.managedproperty:product_id	NE l.managedproperty:original_product_id	OR
					l.managedproperty:cat_id		NE l.managedproperty:original_cat_id }">
		<MvIF EXPR = "{ NOT ManagedPropertyVersion_Load_Property_Current( l.managedproperty:id, l.managedpropertyversion ) }">
			<MvIF EXPR = "{ NOT [ g.Module_Library_DB ].Error_Is_EOF() }">
				<MvFUNCTIONRETURN VALUE = 0>
			</MvIF>

			<MvCOMMENT>
			|
			| Ignore EOF errors here to simulate an attempt to update a record that does not exist in the database
			|
			</MvCOMMENT>
		<MvELSEIF EXPR = "{ NOT [ g.Feature_Filename_TUI_MGR ].TemplateManager_Create_ManagedPropertyVersion( l.managedproperty, l.managedpropertyversion:settings ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	</MvIF>

	<MvASSIGN NAME = "l.managedproperty:original_type"			VALUE = "{ l.managedproperty:type }">
	<MvASSIGN NAME = "l.managedproperty:original_code"			VALUE = "{ l.managedproperty:code }">
	<MvASSIGN NAME = "l.managedproperty:original_product_id"	VALUE = "{ l.managedproperty:product_id }">
	<MvASSIGN NAME = "l.managedproperty:original_cat_id"		VALUE = "{ l.managedproperty:cat_id }">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedProperty_Update_LowLevel" PARAMETERS = "managedproperty var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'ManagedProperties
						  SET
							sync		= ?,
							templ_id	= ?
						  WHERE
							id			= ?' }"
			 FIELDS	= "l.managedproperty:sync, l.managedproperty:templ_id,
					   l.managedproperty:id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00520', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Image_Decrement_RefCount_All_Property" PARAMETERS = "managedproperty_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ManagedPropertyVersions"
			 	QUERY	= "{ 'SELECT
								DISTINCT v.id,
								v.image_id,
								r.head_count
							  FROM
								' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions bv,
								' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions v
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersionImageReferences r ON r.version_id = v.id AND 
																													   r.image_id = v.image_id
							  WHERE
								bv.prop_id		= ?				AND
								bv.head			= 1				AND
								v.id			= bv.version_id AND
								v.image_id > 0' }"
			 FIELDS	= "l.managedproperty_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00622', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvWHILE EXPR = "{ NOT ManagedPropertyVersions.d.EOF }">
		<MvIF EXPR = "{ NOT [ g.Module_Library_DB ].Image_Decrement_RefCount( ManagedPropertyVersions.d.image_id ) }">
			<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedPropertyVersions">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>

		<MvSKIP NAME = "Merchant" VIEW = "ManagedPropertyVersions" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedPropertyVersions">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Image_Decrement_RefCount_All_Product_Property" PARAMETERS = "product_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ManagedPropertyVersions"
			 	QUERY	= "{ 'SELECT
								DISTINCT mpv.id,
								mpv.image_id,
								mpvir.head_count
							  FROM
								' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions mpv
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersionImageReferences mpvir ON mpvir.version_id = mpv.id AND mpvir.image_id = mpv.image_id,
								' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions mpbv
							  WHERE
								mpv.code		= \'\'	AND
								mpv.product_id	= ?		AND
								mpv.cat_id		= 0		AND
								mpv.image_id	> 0		AND
								mpbv.head		= 1		AND
								mpbv.version_id	= mpv.id' }"
			 FIELDS	= "l.product_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00623', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvWHILE EXPR = "{ NOT ManagedPropertyVersions.d.EOF }">
		<MvIF EXPR = "{ ManagedPropertyVersions.d.head_count GT 0 }">
			<MvIF EXPR = "{ NOT [ g.Module_Library_DB ].Image_Decrement_RefCount( ManagedPropertyVersions.d.image_id ) }">
				<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedPropertyVersions">
				<MvFUNCTIONRETURN VALUE = 0>
			</MvIF>
		</MvIF>

		<MvSKIP NAME = "Merchant" VIEW = "ManagedPropertyVersions" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedPropertyVersions">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Image_Decrement_RefCount_All_Category_Property" PARAMETERS = "cat_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ManagedPropertyVersions"
			 	QUERY	= "{ 'SELECT
								DISTINCT mpv.id,
								mpv.image_id,
								mpvir.head_count
							  FROM
								' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions mpv
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersionImageReferences mpvir ON mpvir.version_id = mpv.id AND mpvir.image_id = mpv.image_id,
								' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions mpbv
							  WHERE
								mpv.code		= \'\'	AND
								mpv.product_id	= 0		AND
								mpv.cat_id		= ?		AND
								mpv.image_id	> 0		AND
								mpbv.head		= 1		AND
								mpbv.version_id	= mpv.id' }"
			 FIELDS	= "l.cat_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00624', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvWHILE EXPR = "{ NOT ManagedPropertyVersions.d.EOF }">
		<MvIF EXPR = "{ ManagedPropertyVersions.d.head_count GT 0 }">
			<MvIF EXPR = "{ NOT [ g.Module_Library_DB ].Image_Decrement_RefCount( ManagedPropertyVersions.d.image_id ) }">
				<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedPropertyVersions">
				<MvFUNCTIONRETURN VALUE = 0>
			</MvIF>
		</MvIF>

		<MvSKIP NAME = "Merchant" VIEW = "ManagedPropertyVersions" ROWS = 1>
	</MvWHILE>
	
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedPropertyVersions">	
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Image_Decrement_HeadAndRefCount_All_Branch" PARAMETERS = "branch_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ManagedPropertyBranchVersions"
				QUERY	= "{ 'SELECT DISTINCT
						    	mpv.id,
						    	mpv.image_id,
						    	mpvir.head_count
						  	  FROM
								' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions mpbv,
							    ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions mpv
							    LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersionImageReferences mpvir ON mpvir.version_id = mpv.id AND mpvir.image_id = mpv.image_id
							  WHERE
								mpbv.branch_id	= ?					AND
							    mpbv.head 		= 1					AND
							    mpv.id 			= mpbv.version_id	AND
							  	mpv.image_id	> 0' }"
				FIELDS	= "l.branch_id">

	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00627', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvWHILE EXPR = "{ NOT ManagedPropertyBranchVersions.d.EOF }">
		<MvIF EXPR = "{ ManagedPropertyBranchVersions.d.head_count EQ 1 }">
			<MvIF EXPR = "{ NOT [ g.Module_Library_DB ].Image_Decrement_RefCount( ManagedPropertyBranchVersions.d.image_id ) }">
				<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedPropertyBranchVersions">
				<MvFUNCTIONRETURN VALUE = 0>
			</MvIF>
		</MvIF>

		<MvIF EXPR = "{ NOT ManagedPropertyImageReference_Decrement_HeadCount( ManagedPropertyBranchVersions.d.id, ManagedPropertyBranchVersions.d.image_id ) }">
			<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedPropertyBranchVersions">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>

		<MvSKIP NAME = "Merchant" VIEW = "ManagedPropertyBranchVersions" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedPropertyBranchVersions">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedProperty_Delete" PARAMETERS = "managedproperty var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Feature_Filename_TUI_MGR ].TemplateManager_Delete_ManagedProperty( l.managedproperty ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedProperty_Delete_Branch" PARAMETERS = "branch_id, managedproperty var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Feature_Filename_TUI_MGR ].TemplateManager_Delete_ManagedProperty_Branch( l.branch_id, l.managedproperty ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedProperty_Delete_ID" PARAMETERS = "id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ManagedProperties WHERE id = ?' }"
			 FIELDS	= "l.id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00521', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedProperty_Purge" PARAMETERS = "managedproperty var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT Image_Decrement_RefCount_All_Property( l.managedproperty:id )				OR
					NOT ManagedContent_Decrement_All_ManagedProperty( l.managedproperty:id )		OR
					NOT ManagedPropertyImageReference_Delete_All_Property( l.managedproperty:id )	OR
					NOT ManagedPropertyChange_Delete_All_Property( l.managedproperty:id )			OR
					NOT ManagedPropertyBranchVersion_Delete_All_Property( l.managedproperty:id )	OR
					NOT ManagedPropertyVersion_Delete_All_Property( l.managedproperty:id ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = "{ ManagedProperty_Delete_ID( l.managedproperty:id ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedProperty_Delete_All_Product" PARAMETERS = "product_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT Image_Decrement_RefCount_All_Product_Property( l.product_id )	OR
					NOT ManagedPropertyBranchVersion_Delete_All_Product( l.product_id )	OR
					NOT ManagedPropertyImageReference_Delete_All_Product( l.product_id ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ManagedProperties"
				QUERY	= "{ 'SELECT DISTINCT
								mp.id		AS id,
								mt.id		AS template_id,
								mt.filename	AS template_filename
							  FROM
								' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions mpv,
								' $ g.Store_Table_Prefix $ 'ManagedProperties mp
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'ManagedTemplates mt ON mt.id = mp.templ_id
							  WHERE
								mpv.product_id	= ? AND
								mp.id			= mpv.prop_id' }"
				FIELDS	= "l.product_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00687', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvWHILE EXPR = "{ NOT ManagedProperties.d.EOF }">
		<MvASSIGN NAME = "l.managedproperty_id" 				VALUE = "{ ManagedProperties.d.id }">
		<MvASSIGN NAME = "l.managedproperty_template_id" 		VALUE = "{ ManagedProperties.d.template_id }">
		<MvASSIGN NAME = "l.managedproperty_template_filename" 	VALUE = "{ ManagedProperties.d.template_filename }">

		<MvSKIP NAME = "Merchant" VIEW = "ManagedProperties" ROWS = 1>

		<MvIF EXPR = "{ NOT ManagedPropertyVersion_Delete_All_ManagedProperty_Product( l.managedproperty_id, l.product_id ) OR
						NOT ManagedPropertyVersion_Count_ManagedProperty( l.managedproperty_id, l.count ) }">
			<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedProperties">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>

		<MvCOMMENT>
		|
		| If no managed property versions exist for the current managed property
		| after deleting the product records, delete the managed property and
		| its dependencies.
		|
		</MvCOMMENT>

		<MvIF EXPR = "{ l.count EQ 0 }">
			<MvIF EXPR = "{ NOT ManagedPropertyImageReference_Delete_All_Property( l.managedproperty_id )	OR
							NOT ManagedPropertyChange_Delete_All_Property( l.managedproperty_id )			OR
							NOT ManagedPropertyBranchVersion_Delete_All_Property( l.managedproperty_id )	OR
							NOT ManagedProperty_Delete_ID( l.managedproperty_id ) }">
				<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedProperties">
				<MvFUNCTIONRETURN VALUE = 0>
			</MvIF>

			<MvIF EXPR = "{ l.managedproperty_template_id }">
				<MvCOMMENT>
				|
				| Deleting a product is an unbranched, unversioned action that cannot be restored. Therefore, we
				| delete and discard all history on the linked managed template for this managed property record.
				|
				</MvCOMMENT>

				<MvIF EXPR = "{ NOT ManagedTemplateChange_Delete_All_Template( l.managedproperty_template_id )			OR
								NOT ManagedTemplateBranchVersion_Delete_All_Template( l.managedproperty_template_id )	OR
								NOT ManagedTemplateVersion_Delete_All_Template( l.managedproperty_template_id )			OR
								NOT ManagedTemplate_Delete_Files( l.managedproperty_template_filename )					OR
								NOT ManagedTemplate_Delete_ID( l.managedproperty_template_id ) }">
					<MvFUNCTIONRETURN VALUE = 0>
				</MvIF>
			</MvIF>
		</MvIF>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedProperties">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedProperty_Delete_All_Category" PARAMETERS = "cat_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT Image_Decrement_RefCount_All_Category_Property( l.cat_id )		OR
					NOT ManagedPropertyBranchVersion_Delete_All_Category( l.cat_id )	OR
					NOT ManagedPropertyImageReference_Delete_All_Category( l.cat_id ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ManagedProperties"
				QUERY	= "{ 'SELECT DISTINCT
								mp.id		AS id,
								mt.id		AS template_id,
								mt.filename	AS template_filename
							  FROM
								' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions mpv,
								' $ g.Store_Table_Prefix $ 'ManagedProperties mp
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'ManagedTemplates mt ON mt.id = mp.templ_id
							  WHERE
								mpv.cat_id	= ? AND
								mp.id		= mpv.prop_id' }"
				FIELDS	= "l.cat_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00688', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvWHILE EXPR = "{ NOT ManagedProperties.d.EOF }">
		<MvASSIGN NAME = "l.managedproperty_id" 				VALUE = "{ ManagedProperties.d.id }">
		<MvASSIGN NAME = "l.managedproperty_template_id" 		VALUE = "{ ManagedProperties.d.template_id }">
		<MvASSIGN NAME = "l.managedproperty_template_filename" 	VALUE = "{ ManagedProperties.d.template_filename }">

		<MvSKIP NAME = "Merchant" VIEW = "ManagedProperties" ROWS = 1>

		<MvIF EXPR = "{ NOT ManagedPropertyVersion_Delete_All_ManagedProperty_Category( l.managedproperty_id, l.cat_id ) OR
						NOT ManagedPropertyVersion_Count_ManagedProperty( l.managedproperty_id, l.count ) }">
			<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedProperties">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>

		<MvCOMMENT>
		|
		| If no managed property versions exist for the current managed property
		| after deleting the category records, delete the managed property and
		| its dependencies.
		|
		</MvCOMMENT>

		<MvIF EXPR = "{ l.count EQ 0 }">
			<MvIF EXPR = "{ NOT ManagedPropertyImageReference_Delete_All_Property( l.managedproperty_id )	OR
							NOT ManagedPropertyChange_Delete_All_Property( l.managedproperty_id )			OR
							NOT ManagedPropertyBranchVersion_Delete_All_Property( l.managedproperty_id )	OR
							NOT ManagedProperty_Delete_ID( l.managedproperty_id ) }">
				<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedProperties">
				<MvFUNCTIONRETURN VALUE = 0>
			</MvIF>

			<MvIF EXPR = "{ l.managedproperty_template_id }">
				<MvCOMMENT>
				|
				| Deleting a category is an unbranched, unversioned action that cannot be restored. Therefore, we
				| delete and discard all history on the linked managed template for this managed property record.
				|
				</MvCOMMENT>

				<MvIF EXPR = "{ NOT ManagedTemplateChange_Delete_All_Template( l.managedproperty_template_id )			OR
								NOT ManagedTemplateBranchVersion_Delete_All_Template( l.managedproperty_template_id )	OR
								NOT ManagedTemplateVersion_Delete_All_Template( l.managedproperty_template_id )			OR
								NOT ManagedTemplate_Delete_Files( l.managedproperty_template_filename )					OR
								NOT ManagedTemplate_Delete_ID( l.managedproperty_template_id ) }">
					<MvFUNCTIONRETURN VALUE = 0>
				</MvIF>
			</MvIF>
		</MvIF>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedProperties">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedProperty_Delete_All_Orphaned" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT ManagedContent_Decrement_All_Orphaned_ManagedProperties()	OR
					NOT ManagedPropertyVersion_Delete_All_Orphaned_Properties()		OR
					NOT ManagedPropertyImageReference_Delete_All_Orphaned_Properties() }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = "{ ManagedProperty_Delete_All_Orphaned_LowLevel() }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedProperty_Delete_All_Orphaned_LowLevel" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ManagedProperties
			 			  WHERE id NOT IN ( SELECT DISTINCT prop_id FROM ' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00845', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedProperty_Load_ID" PARAMETERS = "id, managedproperty var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ManagedProperty_Load_Branch_ID( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.id, l.managedproperty ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedProperty_Load_Branch_ID" PARAMETERS = "branch_id, id, managedproperty var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ManagedProperties"
				QUERY	= "{ 'SELECT
								mp.*,
								mpv.type		AS type,
								mpv.code		AS code,
								mpv.product_id	AS product_id,
								mpv.cat_id		AS cat_id,
								mpbv.version_id	AS current_id
							  FROM
								' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions mpbv,
								' $ g.Store_Table_Prefix $ 'ManagedProperties mp,
								' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions mpv
							  WHERE
							  	mpbv.branch_id	= ?					AND
							  	mpbv.head		= 1					AND
							  	mpv.id			= mpbv.version_id	AND
							  	mp.id			= mpv.prop_id		AND
								mp.id			= ?' }"
				FIELDS	= "l.branch_id, l.id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00522', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ ManagedProperties.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedProperties">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00523' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ ManagedProperty_Read( l.managedproperty ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedProperties">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedPropertyList_Load_Type" PARAMETERS = "type, managedproperties var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ManagedPropertyList_Load_Branch_Type( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.type, l.managedproperties ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedPropertyList_Load_Branch_Type" PARAMETERS = "branch_id, type, managedproperties var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ManagedProperties"
				QUERY	= "{ 'SELECT
								mp.*,
								mpv.type		AS type,
								mpv.code		AS code,
								mpv.product_id	AS product_id,
								mpv.cat_id		AS cat_id,
								mpbv.version_id	AS current_id
							  FROM
								' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions mpbv,
								' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions mpv,
								' $ g.Store_Table_Prefix $ 'ManagedProperties mp
							  WHERE
							  	mpbv.branch_id	= ?																																AND
							  	mpbv.head		= 1																																AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'mpbv.type' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) $ '	AND
							  	mpv.id			= mpbv.version_id																												AND
								mp.id			= mpv.prop_id
							  ORDER BY
								mp.id' }"
				FIELDS	= "l.branch_id, l.type">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00524', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.managedproperty_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT ManagedProperties.d.EOF }">
		<MvEVAL EXPR = "{ ManagedProperty_Read( l.managedproperties[ ++l.managedproperty_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "ManagedProperties" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedProperties">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00525', l.managedproperty_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedProperty_Load_Code" PARAMETERS = "type, code, managedproperty var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ManagedProperty_Load_Branch_Code( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.type, l.code, l.managedproperty ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedProperty_Load_Branch_Code" PARAMETERS = "branch_id, type, code, managedproperty var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ManagedProperties"
				QUERY	= "{ 'SELECT
								mp.*,
								mpbv.type		AS type,
								mpbv.code		AS code,
								mpbv.product_id	AS product_id,
								mpbv.cat_id		AS cat_id,
								mpbv.version_id	AS current_id
							  FROM
								' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions mpbv,
								' $ g.Store_Table_Prefix $ 'ManagedProperties mp
							  WHERE
							  	mpbv.branch_id	= ?																																AND
							  	mpbv.head		= 1																																AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'mpbv.type' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) $ '	AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'mpbv.code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) $ '	AND
								mpbv.product_id	= 0																																AND
								mpbv.cat_id		= 0																																AND
								mp.id			= mpbv.prop_id' }"
				FIELDS	= "l.branch_id, l.type, l.code">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00526', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ ManagedProperties.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedProperties">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00527' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ ManagedProperty_Read( l.managedproperty ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedProperties">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedProperty_Load_Product" PARAMETERS = "type, product_id, managedproperty var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ManagedProperty_Load_Branch_Product( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.type, l.product_id, l.managedproperty ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedProperty_Load_Branch_Product" PARAMETERS = "branch_id, type, product_id, managedproperty var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ManagedProperties"
				QUERY	= "{ 'SELECT
								mp.*,
								mpbv.type		AS type,
								mpbv.code		AS code,
								mpbv.product_id	AS product_id,
								mpbv.cat_id		AS cat_id,
								mpbv.version_id	AS current_id
							  FROM
								' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions mpbv,
								' $ g.Store_Table_Prefix $ 'ManagedProperties mp
							  WHERE
							  	mpbv.branch_id	= ?																																AND
							  	mpbv.head		= 1																																AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'mpbv.type' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) $ '	AND
								mpbv.code		= \'\'																															AND
								mpbv.product_id	= ?																																AND
								mpbv.cat_id		= 0																																AND
								mp.id			= mpbv.prop_id' }"
				FIELDS	= "l.branch_id, l.type, l.product_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00528', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ ManagedProperties.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedProperties">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00529' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ ManagedProperty_Read( l.managedproperty ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedProperties">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedProperty_Load_Category" PARAMETERS = "type, cat_id, managedproperty var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ManagedProperty_Load_Branch_Category( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.type, l.cat_id, l.managedproperty ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedProperty_Load_Branch_Category" PARAMETERS = "branch_id, type, cat_id, managedproperty var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ManagedProperties"
				QUERY	= "{ 'SELECT
								mp.*,
								mpbv.type		AS type,
								mpbv.code		AS code,
								mpbv.product_id	AS product_id,
								mpbv.cat_id		AS cat_id,
								mpbv.version_id	AS current_id
							  FROM
								' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions mpbv,
								' $ g.Store_Table_Prefix $ 'ManagedProperties mp
							  WHERE
							  	mpbv.branch_id	= ?																																AND
							  	mpbv.head		= 1																																AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'mpbv.type' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) $ '	AND
								mpbv.code		= \'\'																															AND
								mpbv.product_id	= 0																																AND
								mpbv.cat_id		= ?																																AND
								mp.id			= mpbv.prop_id' }"
				FIELDS	= "l.branch_id, l.type, l.cat_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00530', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ ManagedProperties.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedProperties">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00531' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ ManagedProperty_Read( l.managedproperty ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedProperties">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedProperty_Load" PARAMETERS = "type, code, product_id, cat_id, managedproperty var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ManagedProperty_Load_Branch( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.type, l.code, l.product_id, l.cat_id, l.managedproperty ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedProperty_Load_Branch" PARAMETERS = "branch_id, type, code, product_id, cat_id, managedproperty var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ManagedProperties"
				QUERY	= "{ 'SELECT
								mp.*,
								mpbv.type		AS type,
								mpbv.code		AS code,
								mpbv.product_id	AS product_id,
								mpbv.cat_id		AS cat_id,
								mpbv.version_id	AS current_id
							  FROM
								' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions mpbv,
								' $ g.Store_Table_Prefix $ 'ManagedProperties mp
							  WHERE
							  	mpbv.branch_id	= ?																																AND
							  	mpbv.head		= 1																																AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'mpbv.type' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) $ '	AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'mpbv.code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) $ '	AND
								mpbv.product_id	= ?																																AND
								mpbv.cat_id		= ?																																AND
								mp.id			= mpbv.prop_id' }"
				FIELDS	= "l.branch_id, l.type, l.code, l.product_id, l.cat_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00689', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ ManagedProperties.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedProperties">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00690' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ ManagedProperty_Read( l.managedproperty ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedProperties">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedProperty_Load_Reuse" PARAMETERS = "type, code, product_id, cat_id, sync, has_template, managedproperty var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ManagedProperty_Load_Branch_Reuse( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.type, l.code, l.product_id, l.cat_id, l.sync, l.has_template, l.managedproperty ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedProperty_Load_Branch_Reuse" PARAMETERS = "branch_id, type, code, product_id, cat_id, sync, has_template, managedproperty var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ ManagedProperty_Load_Branch( l.branch_id, l.type, l.code, l.product_id, l.cat_id, l.null ) }">																<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00936' ) }">
	<MvELSEIF EXPR = "{ ManagedProperty_Load_Reuse_Existing_OtherBranch( l.branch_id, l.type, l.code, l.product_id, l.cat_id, l.sync, l.has_template, l.managedproperty ) }">	<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = "{ ManagedProperty_Load_Reuse_Deleted( l.type, l.code, l.product_id, l.cat_id, l.sync, l.has_template, l.managedproperty ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedProperty_Load_Reuse_Existing_OtherBranch" PARAMETERS = "branch_id, type, code, product_id, cat_id, sync, has_template, managedproperty var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.has_template }">	<MvASSIGN NAME = "l.where_template" VALUE = "mp.templ_id <> 0">
	<MvELSE>							<MvASSIGN NAME = "l.where_template" VALUE = "mp.templ_id = 0">
	</MvIF>

	<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_OPENVIEW_Range( 'Merchant', 'ManagedProperties',
																			 'SELECT
																				mp.*
																			  FROM
																				' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions mpbv,
																				' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions mpv,
																				' $ g.Store_Table_Prefix $ 'ManagedProperties mp
																			  WHERE
																				mpbv.head			= 1					AND
																				mpbv.branch_id		<> ?				AND
																				mpv.id				= mpbv.version_id	AND
																				' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'mpv.type' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) $ '	AND
																				' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'mpv.code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) $ '	AND
																				mpv.product_id		= ?					AND
																				mpv.cat_id			= ?					AND
																				mp.id				= mpv.prop_id		AND
																				mp.sync				= ?					AND
																				' $ l.where_template $ '
																			  ORDER BY
																				mpv.prop_id ASC',
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.branch_id ) 	$ ',' $
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.type )			$ ',' $
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.code )			$ ',' $
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.product_id )	$ ',' $
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.cat_id )		$ ',' $
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.sync ),
																			 0, 1 ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00818', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ ManagedProperties.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedProperties">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00819' ) }">
	</MvIF>

	<MvASSIGN NAME = "l.managedproperty:id"			VALUE = "{ ManagedProperties.d.id }">
	<MvASSIGN NAME = "l.managedproperty:sync"		VALUE = "{ ManagedProperties.d.sync }">
	<MvASSIGN NAME = "l.managedproperty:templ_id"	VALUE = "{ ManagedProperties.d.templ_id }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedProperties">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedProperty_Load_Reuse_Deleted" PARAMETERS = "type, code, product_id, cat_id, sync, has_template, managedproperty var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.has_template }">	<MvASSIGN NAME = "l.where_template" VALUE = "mp.templ_id <> 0">
	<MvELSE>							<MvASSIGN NAME = "l.where_template" VALUE = "mp.templ_id = 0">
	</MvIF>

	<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_OPENVIEW_Range( 'Merchant', 'ManagedProperties',
																			 'SELECT
																				mp.*
																			  FROM
																				' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions mpbv,
																				' $ g.Store_Table_Prefix $ 'ManagedPropertyChanges mpc,
																				' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions mpv,
																				' $ g.Store_Table_Prefix $ 'ManagedProperties mp
																			  WHERE
																				mpbv.head			= 1					AND
																				mpbv.version_id		= 0					AND
																				mpc.branch_id		= mpbv.branch_id	AND
																				mpc.prop_id			= mpbv.prop_id		AND
																				mpc.new_id			= 0					AND
																				mpv.id				= mpc.old_id		AND
																				' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'mpv.type' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) $ '	AND
																				' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'mpv.code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) $ '	AND
																				mpv.product_id		= ?					AND
																				mpv.cat_id			= ?					AND
																				mp.id				= mpv.prop_id		AND
																				mp.sync				= ?					AND
																				' $ l.where_template $ '
																			  ORDER BY
																				mpc.prop_id ASC, mpc.set_id DESC',
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.type )			$ ',' $
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.code )			$ ',' $
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.product_id )	$ ',' $
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.cat_id )		$ ',' $
																			 [ g.Module_Library_DB ].SQL_Query_Field( l.sync ),
																			 0, 1 ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00733', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ ManagedProperties.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedProperties">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00734' ) }">
	</MvIF>

	<MvASSIGN NAME = "l.managedproperty:id"			VALUE = "{ ManagedProperties.d.id }">
	<MvASSIGN NAME = "l.managedproperty:sync"		VALUE = "{ ManagedProperties.d.sync }">
	<MvASSIGN NAME = "l.managedproperty:templ_id"	VALUE = "{ ManagedProperties.d.templ_id }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedProperties">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Runtime_ManagedProperty_Load_Code" PARAMETERS = "type, code, managedproperty var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.branch_id" VALUE = "{ [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID() }">

	<MvOPENVIEW NAME    = "Merchant"
				VIEW    = "ManagedProperties"
				QUERY   = "{ 'SELECT
								mp.*,
								mpbv.type			AS type,
								mpbv.code			AS code,
								mpbv.product_id		AS product_id,
								mpbv.cat_id			AS cat_id,
								mpbv.version_id		AS current_id,
								mt.filename			AS template_filename,
								mpv.image_id		AS image_id,
								mpv.content_id		AS content_id,
								mpv.settings		AS settings,
								i.id				AS image_loaded_id,
								i.image				AS image_image,
								i.image_md5			AS image_md5,
								i.width				AS image_width,
								i.height			AS image_height,
								i.refcount			AS image_refcount,
								c.id				AS content_loaded_id,
	                            c.refcount			AS content_refcount,
	                            c.md5				AS content_md5,
	                            c.encoding			AS content_encoding,
	                            c.content			AS content_content,
								mpvir.head_count	AS image_head_count
							  FROM
								' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions mpbv,
								' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions mpv
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersionImageReferences mpvir ON mpvir.image_id = mpv.image_id AND mpvir.version_id = mpv.id
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'Images i ON i.id = mpv.image_id
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'ManagedContent c ON c.id = mpv.content_id,
								' $ g.Store_Table_Prefix $ 'ManagedProperties mp
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'ManagedTemplates mt ON mt.id = mp.templ_id
							  WHERE
								mpbv.branch_id	= ?																																AND
								mpbv.head		= 1																																AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'mpbv.type' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) $ '	AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'mpbv.code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) $ '	AND
								mpbv.product_id	= 0																																AND
								mpbv.cat_id		= 0																																AND
								mpv.id			= mpbv.version_id																												AND
								mp.id			= mpv.prop_id' }"
				FIELDS  = "l.branch_id, l.type, l.code">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00556', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ ManagedProperties.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedProperties">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00557' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ Runtime_ManagedProperty_Read( l.managedproperty ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedProperties">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Runtime_ManagedProperty_Load_Product" PARAMETERS = "type, product_id, managedproperty var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.branch_id" VALUE = "{ [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID() }">
	
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ManagedProperties"
				QUERY	= "{ 'SELECT
								mp.*,
								mpbv.type			AS type,
								mpbv.code			AS code,
								mpbv.product_id		AS product_id,
								mpbv.cat_id			AS cat_id,
								mpbv.version_id		AS current_id,
								mt.filename			AS template_filename,
								mpv.image_id		AS image_id,
								mpv.content_id		AS content_id,
								mpv.settings		AS settings,
								i.id				AS image_loaded_id,
								i.image				AS image_image,
								i.image_md5			AS image_md5,
								i.width				AS image_width,
								i.height			AS image_height,
								i.refcount			AS image_refcount,
								c.id				AS content_loaded_id,
	                            c.refcount			AS content_refcount,
	                            c.md5				AS content_md5,
	                            c.encoding			AS content_encoding,
	                            c.content			AS content_content,
								mpvir.head_count  	AS image_head_count
							  FROM
								' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions mpbv,
								' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions mpv
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersionImageReferences mpvir ON mpvir.image_id = mpv.image_id AND mpvir.version_id = mpv.id
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'Images i ON i.id = mpv.image_id
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'ManagedContent c ON c.id = mpv.content_id,
								' $ g.Store_Table_Prefix $ 'ManagedProperties mp
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'ManagedTemplates mt ON mt.id = mp.templ_id
							  WHERE
								mpbv.branch_id	= ?																																AND
								mpbv.head		= 1																																AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'mpbv.type' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) $ '	AND
								mpbv.code		= \'\'																															AND
								mpbv.product_id	= ?																																AND
								mpbv.cat_id		= 0																																AND
								mpv.id			= mpbv.version_id																												AND
								mp.id			= mpv.prop_id' }"
				FIELDS	= "l.branch_id, l.type, l.product_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00558', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ ManagedProperties.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedProperties">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00559' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ Runtime_ManagedProperty_Read( l.managedproperty ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedProperties">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Runtime_ManagedProperty_Load_Category" PARAMETERS = "type, cat_id, managedproperty var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.branch_id" VALUE = "{ [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID() }">
	
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ManagedProperties"
				QUERY	= "{ 'SELECT
								mp.*,
								mpbv.type			AS type,
								mpbv.code			AS code,
								mpbv.product_id		AS product_id,
								mpbv.cat_id			AS cat_id,
								mpbv.version_id		AS current_id,
								mt.filename			AS template_filename,
								mpv.image_id		AS image_id,
								mpv.content_id		AS content_id,
								mpv.settings		AS settings,
								i.id				AS image_loaded_id,
								i.image				AS image_image,
								i.image_md5			AS image_md5,
								i.width				AS image_width,
								i.height			AS image_height,
								i.refcount			AS image_refcount,
								c.id				AS content_loaded_id,
	                            c.refcount			AS content_refcount,
	                            c.md5				AS content_md5,
	                            c.encoding			AS content_encoding,
	                            c.content			AS content_content,
								mpvir.head_count  	AS image_head_count
							  FROM
								' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions mpbv,
								' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions mpv
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersionImageReferences mpvir ON mpvir.image_id = mpv.image_id AND mpvir.version_id = mpv.id
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'Images i ON i.id = mpv.image_id
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'ManagedContent c ON c.id = mpv.content_id,
								' $ g.Store_Table_Prefix $ 'ManagedProperties mp
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'ManagedTemplates mt ON mt.id = mp.templ_id
							  WHERE
								mpbv.branch_id	= ?																																AND
								mpbv.head		= 1																																AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'mpbv.type' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) $ '	AND
								mpbv.code		= \'\'																															AND
								mpbv.product_id	= 0																																AND
								mpbv.cat_id		= ?																																AND
								mpv.id			= mpbv.version_id																												AND
								mp.id			= mpv.prop_id' }"
				FIELDS	= "l.branch_id, l.type, l.cat_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00560', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ ManagedProperties.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedProperties">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00561' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ Runtime_ManagedProperty_Read( l.managedproperty ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedProperties">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedPropertyAndVersion_Load_Code_Current" PARAMETERS = "type, code, managedpropertyversion var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ManagedPropertyAndVersion_Load_Branch_Code( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.type, l.code, l.managedpropertyversion ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedPropertyAndVersion_Load_Branch_Code" PARAMETERS = "branch_id, type, code, managedproperty var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ManagedProperties"
				QUERY	= "{ 'SELECT
								mp.*,
								mpbv.type			AS type,
								mpbv.code			AS code,
								mpbv.product_id		AS product_id,
								mpbv.cat_id			AS cat_id,
								mpbv.version_id		AS current_id,
								mpv.id				AS version_id,
								mpv.prop_id			AS version_prop_id,
								mpv.immutable		AS version_immutable,
								mpv.image_id		AS version_image_id,
								mpv.content_id		AS version_content_id,
								mpv.settings		AS version_settings,
								i.id				AS image_loaded_id,
								i.image				AS image_image,
								i.image_md5			AS image_md5,
								i.width				AS image_width,
								i.height			AS image_height,
								i.refcount			AS image_refcount,
								c.id				AS content_loaded_id,
	                            c.refcount			AS content_refcount,
	                            c.md5				AS content_md5,
	                            c.encoding			AS content_encoding,
	                            c.content			AS content_content,
								mpvir.head_count  	AS image_head_count
							  FROM
								' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions mpbv,
								' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions mpv
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersionImageReferences mpvir ON mpvir.image_id = mpv.image_id AND mpvir.version_id = mpv.id
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'Images i ON i.id = mpv.image_id
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'ManagedContent c ON c.id = mpv.content_id,
								' $ g.Store_Table_Prefix $ 'ManagedProperties mp
							  WHERE
								mpbv.branch_id	= ?																																AND
								mpbv.head		= 1																																AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'mpbv.type' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) $ '	AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'mpbv.code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) $ '	AND
								mpbv.product_id	= 0																																AND
								mpbv.cat_id		= 0																																AND
								mpv.id			= mpbv.version_id																												AND
								mp.id			= mpv.prop_id' }"
				FIELDS	= "l.branch_id, l.type, l.code">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00566', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ ManagedProperties.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedProperties">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00567' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ ManagedPropertyAndVersion_Read( l.managedproperty ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedProperties">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedPropertyAndVersion_Load_Product_Current" PARAMETERS = "type, product_id, managedproperty var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ManagedPropertyAndVersion_Load_Branch_Product( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.type, l.product_id, l.managedproperty ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedPropertyAndVersion_Load_Branch_Product" PARAMETERS = "branch_id, type, product_id, managedproperty var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ManagedProperties"
				QUERY	= "{ 'SELECT
								mp.*,
								mpbv.type			AS type,
								mpbv.code			AS code,
								mpbv.product_id		AS product_id,
								mpbv.cat_id			AS cat_id,
								mpbv.version_id		AS current_id,
								mpv.id				AS version_id,
								mpv.prop_id			AS version_prop_id,
								mpv.immutable		AS version_immutable,
								mpv.image_id		AS version_image_id,
								mpv.content_id		AS version_content_id,
								mpv.settings		AS version_settings,
								i.id				AS image_loaded_id,
								i.image				AS image_image,
								i.image_md5			AS image_md5,
								i.width				AS image_width,
								i.height			AS image_height,
								i.refcount			AS image_refcount,
								c.id				AS content_loaded_id,
	                            c.refcount			AS content_refcount,
	                            c.md5				AS content_md5,
	                            c.encoding			AS content_encoding,
	                            c.content			AS content_content,
								mpvir.head_count  	AS image_head_count
							  FROM
								' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions mpbv,
								' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions mpv
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersionImageReferences mpvir ON mpvir.image_id = mpv.image_id AND mpvir.version_id = mpv.id
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'Images i ON i.id = mpv.image_id
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'ManagedContent c ON c.id = mpv.content_id,
								' $ g.Store_Table_Prefix $ 'ManagedProperties mp
							  WHERE
								mpbv.branch_id	= ?																																AND
								mpbv.head		= 1																																AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'mpbv.type' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) $ '	AND
								mpbv.code		= \'\'																															AND
								mpbv.product_id	= ?																																AND
								mpbv.cat_id		= 0																																AND
								mpv.id			= mpbv.version_id																												AND
								mp.id			= mpv.prop_id' }"
				FIELDS	= "l.branch_id, l.type, l.product_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00568', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ ManagedProperties.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedProperties">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00569' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ ManagedPropertyAndVersion_Read( l.managedproperty ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedProperties">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedPropertyAndVersion_Load_Category_Current" PARAMETERS = "type, cat_id, managedproperty var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ManagedPropertyAndVersion_Load_Branch_Category( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.type, l.cat_id, l.managedproperty ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedPropertyAndVersion_Load_Branch_Category" PARAMETERS = "branch_id, type, cat_id, managedproperty var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ManagedProperties"
				QUERY	= "{ 'SELECT
								mp.*,
								mpbv.type			AS type,
								mpbv.code			AS code,
								mpbv.product_id		AS product_id,
								mpbv.cat_id			AS cat_id,
								mpbv.version_id		AS current_id,
								mpv.id				AS version_id,
								mpv.prop_id			AS version_prop_id,
								mpv.immutable		AS version_immutable,
								mpv.image_id		AS version_image_id,
								mpv.content_id		AS version_content_id,
								mpv.settings		AS version_settings,
								i.id				AS image_loaded_id,
								i.image				AS image_image,
								i.image_md5			AS image_md5,
								i.width				AS image_width,
								i.height			AS image_height,
								i.refcount			AS image_refcount,
								c.id				AS content_loaded_id,
	                            c.refcount			AS content_refcount,
	                            c.md5				AS content_md5,
	                            c.encoding			AS content_encoding,
	                            c.content			AS content_content,
								mpvir.head_count  	AS image_head_count
							  FROM
								' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions mpbv,
								' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions mpv
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersionImageReferences mpvir ON mpvir.image_id = mpv.image_id AND mpvir.version_id = mpv.id
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'Images i ON i.id = mpv.image_id
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'ManagedContent c ON c.id = mpv.content_id,
								' $ g.Store_Table_Prefix $ 'ManagedProperties mp
							  WHERE
								mpbv.branch_id	= ?																																AND
								mpbv.head		= 1																																AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'mpbv.type' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) $ '	AND
								mpbv.code		= \'\'																															AND
								mpbv.product_id	= 0																																AND
								mpbv.cat_id		= ?																																AND
								mpv.id			= mpbv.version_id																												AND
								mp.id			= mpv.prop_id' }"
				FIELDS	= "l.branch_id, l.type, l.cat_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00570', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ ManagedProperties.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedProperties">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00571' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ ManagedPropertyAndVersion_Read( l.managedproperty ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedProperties">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedPropertyAndVersionList_Load_Type_Current" PARAMETERS = "type, managedproperties var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ManagedPropertyAndVersionList_Load_Branch_Type( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.type, l.managedproperties ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedPropertyAndVersionList_Load_Branch_Type" PARAMETERS = "branch_id, type, managedproperties var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ManagedProperties"
				QUERY	= "{ 'SELECT
								mp.*,
								mpbv.type			AS type,
								mpbv.code			AS code,
								mpbv.product_id		AS product_id,
								mpbv.cat_id			AS cat_id,
								mpbv.version_id		AS current_id,
								mpv.id				AS version_id,
								mpv.prop_id			AS version_prop_id,
								mpv.immutable		AS version_immutable,
								mpv.image_id		AS version_image_id,
								mpv.content_id		AS version_content_id,
								mpv.settings		AS version_settings,
								i.id				AS image_loaded_id,
								i.image				AS image_image,
								i.image_md5			AS image_md5,
								i.width				AS image_width,
								i.height			AS image_height,
								i.refcount			AS image_refcount,
								c.id				AS content_loaded_id,
	                            c.refcount			AS content_refcount,
	                            c.md5				AS content_md5,
	                            c.encoding			AS content_encoding,
	                            c.content			AS content_content,
								mpvir.head_count  	AS image_head_count
							  FROM
								' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions mpbv,
								' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions mpv
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersionImageReferences mpvir ON mpvir.image_id = mpv.image_id AND mpvir.version_id = mpv.id
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'Images i ON i.id = mpv.image_id
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'ManagedContent c ON c.id = mpv.content_id,
								' $ g.Store_Table_Prefix $ 'ManagedProperties mp
							  WHERE
								mpbv.branch_id	= ?																																AND
								mpbv.head		= 1																																AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'mpbv.type' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) $ '	AND
								mpv.id			= mpbv.version_id																												AND
								mp.id			= mpv.prop_id
							  ORDER BY
								mp.id' }"
				FIELDS	= "l.branch_id, l.type">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00594', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.managedproperty_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT ManagedProperties.d.EOF }">
		<MvEVAL EXPR = "{ ManagedPropertyAndVersion_Read( l.managedproperties[ ++l.managedproperty_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "ManagedProperties" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedProperties">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00595', l.managedproperty_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedPropertyVersionAndImage_Load_Branch" PARAMETERS = "branch_id, prop_id, managedpropertyversion var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ManagedPropertyVersions"
				QUERY	= "{ 'SELECT
								v.*,
								i.id			AS image_id,
								i.image			AS image_image,
								i.image_md5		AS image_md5,
								i.width			AS image_width,
								i.height		AS image_height,
								i.refcount		AS image_refcount,
								r.head_count  	AS image_head_count
							  FROM
								' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions bv,
								' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions v
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersionImageReferences r ON r.image_id = v.image_id AND r.version_id = v.id
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'Images i ON i.id = v.image_id
							  WHERE
								bv.branch_id	= ?	AND
								bv.prop_id		= ?	AND
								bv.head			= 1	AND
								bv.version_id	= v.id' }"
				FIELDS	= "l.branch_id, l.prop_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00643', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ ManagedPropertyVersions.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedPropertyVersions">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00644' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ ManagedPropertyVersion_Read( l.managedpropertyversion ) }">

	<MvASSIGN NAME = "l.managedpropertyversion:image:id"			VALUE = "{ ManagedPropertyVersions.d.image_id }">
	<MvASSIGN NAME = "l.managedpropertyversion:image:image"			VALUE = "{ ManagedPropertyVersions.d.image_image }">
	<MvASSIGN NAME = "l.managedpropertyversion:image:image_md5"		VALUE = "{ ManagedPropertyVersions.d.image_md5 }">
	<MvASSIGN NAME = "l.managedpropertyversion:image:width"			VALUE = "{ ManagedPropertyVersions.d.image_width }">
	<MvASSIGN NAME = "l.managedpropertyversion:image:height"		VALUE = "{ ManagedPropertyVersions.d.image_height }">
	<MvASSIGN NAME = "l.managedpropertyversion:image:refcount"		VALUE = "{ ManagedPropertyVersions.d.image_refcount }">
	<MvASSIGN NAME = "l.managedpropertyversion:image:head_count"	VALUE = "{ ManagedPropertyVersions.d.image_head_count }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedPropertyVersions">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_ManagedPropertyVersions
|
</MvCOMMENT>

<MvFUNCTION NAME = "ManagedPropertyVersion_Read" PARAMETERS = "managedpropertyversion var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.managedpropertyversion:id"					VALUE = "{ ManagedPropertyVersions.d.id }">
	<MvASSIGN NAME = "l.managedpropertyversion:prop_id"				VALUE = "{ ManagedPropertyVersions.d.prop_id }">
	<MvASSIGN NAME = "l.managedpropertyversion:user_id"				VALUE = "{ ManagedPropertyVersions.d.user_id }">
	<MvASSIGN NAME = "l.managedpropertyversion:type"				VALUE = "{ ManagedPropertyVersions.d.type }">
	<MvASSIGN NAME = "l.managedpropertyversion:code"				VALUE = "{ ManagedPropertyVersions.d.code }">
	<MvASSIGN NAME = "l.managedpropertyversion:product_id"			VALUE = "{ ManagedPropertyVersions.d.product_id }">
	<MvASSIGN NAME = "l.managedpropertyversion:cat_id"				VALUE = "{ ManagedPropertyVersions.d.cat_id }">
	<MvASSIGN NAME = "l.managedpropertyversion:image_id"			VALUE = "{ ManagedPropertyVersions.d.image_id }">
	<MvASSIGN NAME = "l.managedpropertyversion:content_id"			VALUE = "{ ManagedPropertyVersions.d.content_id }">
	<MvASSIGN NAME = "l.managedpropertyversion:immutable"			VALUE = "{ ManagedPropertyVersions.d.immutable }">
	<MvASSIGN NAME = "l.managedpropertyversion:settings"			VALUE = "{ miva_array_deserialize( ManagedPropertyVersions.d.settings ) }">
	<MvASSIGN NAME = "l.managedpropertyversion:original_image_id"	VALUE = "{ ManagedPropertyVersions.d.image_id }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedPropertyVersion_Load_ID" PARAMETERS = "id, managedpropertyversion var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ManagedPropertyVersions"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions WHERE id = ?' }"
				FIELDS	= "l.id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00562', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ ManagedPropertyVersions.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedPropertyVersions">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00563' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ ManagedPropertyVersion_Read( l.managedpropertyversion ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedPropertyVersions">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedPropertyVersion_Load_Property_Current" PARAMETERS = "prop_id, managedpropertyversion var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ManagedPropertyVersion_Load_Branch_Head( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.prop_id, l.managedpropertyversion ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedPropertyVersion_Load_Branch_Head" PARAMETERS = "branch_id, prop_id, managedpropertyversion var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ManagedPropertyVersions"
				QUERY	= "{ 'SELECT
								mpv.*,
								i.id				AS image_loaded_id,
								i.image				AS image_image,
								i.image_md5			AS image_md5,
								i.width				AS image_width,
								i.height			AS image_height,
								i.refcount			AS image_refcount,
								c.id				AS content_loaded_id,
	                            c.refcount			AS content_refcount,
	                            c.md5				AS content_md5,
	                            c.encoding			AS content_encoding,
	                            c.content			AS content_content,
								mpvir.head_count  	AS image_head_count
							  FROM
								' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions mpbv,
								' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions mpv
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersionImageReferences mpvir ON mpvir.version_id = mpv.id AND mpvir.image_id = mpv.image_id
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'Images i ON i.id = mpv.image_id
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'ManagedContent c ON c.id = mpv.content_id
							  WHERE
								mpbv.branch_id	= ?	AND
								mpbv.prop_id	= ?	AND
								mpbv.head		= 1	AND
								mpv.id			= mpbv.version_id' }"
				FIELDS	= "l.branch_id, l.prop_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00564', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ ManagedPropertyVersions.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedPropertyVersions">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00565' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ ManagedPropertyVersion_Read( l.managedpropertyversion ) }">
	
	<MvASSIGN NAME = "l.managedpropertyversion:image:id" 			VALUE = "{ ManagedPropertyVersions.d.image_loaded_id }">
	<MvASSIGN NAME = "l.managedpropertyversion:image:image" 		VALUE = "{ ManagedPropertyVersions.d.image_image }">
	<MvASSIGN NAME = "l.managedpropertyversion:image:image_md5" 	VALUE = "{ ManagedPropertyVersions.d.image_md5 }">
	<MvASSIGN NAME = "l.managedpropertyversion:image:width" 		VALUE = "{ ManagedPropertyVersions.d.image_width }">
	<MvASSIGN NAME = "l.managedpropertyversion:image:height" 		VALUE = "{ ManagedPropertyVersions.d.image_height }">
	<MvASSIGN NAME = "l.managedpropertyversion:image:refcount" 		VALUE = "{ ManagedPropertyVersions.d.image_refcount }">
	<MvASSIGN NAME = "l.managedpropertyversion:image:head_count" 	VALUE = "{ ManagedPropertyVersions.d.image_head_count }">

	<MvASSIGN NAME = "l.managedpropertyversion:content:id"			VALUE = "{ ManagedPropertyVersions.d.content_loaded_id }">
	<MvASSIGN NAME = "l.managedpropertyversion:content:refcount"	VALUE = "{ ManagedPropertyVersions.d.content_refcount }">
	<MvASSIGN NAME = "l.managedpropertyversion:content:md5"			VALUE = "{ ManagedPropertyVersions.d.content_md5 }">
	<MvASSIGN NAME = "l.managedpropertyversion:content:encoding"	VALUE = "{ ManagedPropertyVersions.d.content_encoding }">
	
	<MvIF EXPR = "{ ManagedPropertyVersions.d.content_encoding EQ 'base64' }">
		<MvASSIGN NAME = "l.managedpropertyversion:content:content"	VALUE = "{ crypto_base64_decode( ManagedPropertyVersions.d.content_content ) }">
	<MvELSE>
		<MvASSIGN NAME = "l.managedpropertyversion:content:content"	VALUE = "{ ManagedPropertyVersions.d.content_content }">
	</MvIF>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedPropertyVersions">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedPropertyVersion_Count_ManagedProperty" PARAMETERS = "prop_id, count var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ManagedPropertyVersions"
				QUERY	= "{ 'SELECT COUNT( * ) AS total_count FROM ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions mpv WHERE mpv.prop_id = ?' }"
				FIELDS	= "l.prop_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00691', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.count" VALUE = "{ ManagedPropertyVersions.d.total_count }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedPropertyVersions">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedPropertyVersion_Insert" PARAMETERS = "managedpropertyversion var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ ManagedProperty_Load( l.managedpropertyversion:type, l.managedpropertyversion:code, l.managedpropertyversion:product_id, l.managedpropertyversion:cat_id, l.existing_managedproperty ) AND
					l.managedpropertyversion:prop_id NE l.existing_managedproperty:id }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Native_DBAPI ].DB_Error_IndexDuplicate( 'MER-TUI-DTB-00692', 'Managed property already exists' ) }">
	</MvIF>

	<MvIF EXPR = "{ l.managedpropertyversion:content_id }">
		<MvIF EXPR = "{ NOT ManagedContent_Increment_ReferenceCount( l.managedpropertyversion:content_id ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = "{ ManagedPropertyVersion_Insert_LowLevel( l.managedpropertyversion ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedPropertyVersion_Insert_LowLevel" PARAMETERS = "managedpropertyversion var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.managedpropertyversion:id"				VALUE = "{ [ g.Module_Library_DB ].StoreKey_Generate( 'ManagedPropertyVersions' ) }">
	<MvASSIGN NAME = "l.settings"								VALUE = "{ miva_array_serialize( l.managedpropertyversion:settings ) }">

	<MvIF EXPR = "{ ISNULL l.managedpropertyversion:user_id }">		<MvASSIGN NAME = "l.managedpropertyversion:user_id"		VALUE = 0>	</MvIF>
	<MvIF EXPR = "{ ISNULL l.managedpropertyversion:immutable }">	<MvASSIGN NAME = "l.managedpropertyversion:immutable"	VALUE = 0>	</MvIF>
	<MvIF EXPR = "{ ISNULL l.managedpropertyversion:product_id }">	<MvASSIGN NAME = "l.managedpropertyversion:product_id"	VALUE = 0>	</MvIF>
	<MvIF EXPR = "{ ISNULL l.managedpropertyversion:cat_id }">		<MvASSIGN NAME = "l.managedpropertyversion:cat_id"		VALUE = 0>	</MvIF>
	<MvIF EXPR = "{ ISNULL l.managedpropertyversion:image_id }">	<MvASSIGN NAME = "l.managedpropertyversion:image_id"	VALUE = 0>	</MvIF>
	<MvIF EXPR = "{ ISNULL l.managedpropertyversion:content_id }">	<MvASSIGN NAME = "l.managedpropertyversion:content_id"	VALUE = 0>	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions
					      ( id, prop_id, user_id, type, code, product_id, cat_id, image_id, content_id, immutable, settings )
						  VALUES
						  ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )' }"
			 FIELDS	= "l.managedpropertyversion:id, l.managedpropertyversion:prop_id, l.managedpropertyversion:user_id,
					   l.managedpropertyversion:type, l.managedpropertyversion:code, l.managedpropertyversion:product_id,
					   l.managedpropertyversion:cat_id, l.managedpropertyversion:image_id, l.managedpropertyversion:content_id,
					   l.managedpropertyversion:immutable, l.settings">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00532', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedPropertyVersion_Update" PARAMETERS = "managedpropertyversion var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.settings" VALUE = "{ miva_array_serialize( l.managedpropertyversion:settings ) }">

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions
						  SET
							user_id		= ?,
							type		= ?,
							code		= ?,
							product_id	= ?,
							cat_id		= ?,
							image_id	= ?,
							content_id	= ?,
							immutable	= ?,
							settings	= ?
						  WHERE
							id			= ?' }"
			 FIELDS	= "l.managedpropertyversion:user_id, l.managedpropertyversion:type, l.managedpropertyversion:code,
			 		   l.managedpropertyversion:product_id, l.managedpropertyversion:cat_id, l.managedpropertyversion:image_id,
			 		   l.managedpropertyversion:content_id, l.managedpropertyversion:immutable, l.settings,
					   l.managedpropertyversion:id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00533', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedPropertyVersion_Delete_All_Property" PARAMETERS = "prop_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions WHERE prop_id = ?' }"
			 FIELDS	= "l.prop_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00534', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedPropertyVersion_Delete_All_Product" PARAMETERS = "product_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions WHERE product_id = ?' }"
			 FIELDS	= "l.product_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00572', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedPropertyVersion_Delete_All_Category" PARAMETERS = "cat_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions WHERE cat_id = ?' }"
			 FIELDS	= "l.cat_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00573', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedPropertyVersion_Delete_All_ManagedProperty_Product" PARAMETERS = "prop_id, product_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions
						  WHERE
							prop_id		= ?	AND
							product_id	= ?' }"
			 FIELDS	= "l.prop_id, l.product_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00693', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedPropertyVersion_Delete_All_ManagedProperty_Category" PARAMETERS = "prop_id, cat_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions
						  WHERE
							prop_id		= ?	AND
							cat_id		= ?' }"
			 FIELDS	= "l.prop_id, l.cat_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00694', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedPropertyVersion_Delete_All_Orphaned_Properties" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions
			 			  WHERE prop_id NOT IN ( SELECT DISTINCT prop_id FROM ' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00846', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_ManagedPropertyBranchVersions
|
</MvCOMMENT>

<MvFUNCTION NAME = "ManagedPropertyBranchVersion_Insert" PARAMETERS = "branch_id, prop_id, version_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
    <MvIF EXPR = "{ l.version_id EQ 0 }">
        <MvQUERY NAME   = "Merchant"
                 QUERY  = "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions
                                ( branch_id, prop_id, version_id, type, code, product_id, cat_id, head )
                              VALUES
                                ( ?, ?, 0, \'\', \'\', 0, 0, 0 )' }"
                 FIELDS = "l.branch_id, l.prop_id">
        <MvIF EXPR = "{ g.MvQUERY_Error }">
            <MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00696', g.MvQUERY_Error ) }">
        </MvIF>
    <MvELSE>
        <MvQUERY NAME   = "Merchant"
                 QUERY  = "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions
                                ( branch_id, prop_id, version_id, type, code, product_id, cat_id, head )
                              SELECT
                                ?, ?, id, type, code, product_id, cat_id, 0
                              FROM
                                ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions
                              WHERE
                                id = ?' }"
                 FIELDS = "l.branch_id, l.prop_id, l.version_id">
            <MvIF EXPR = "{ g.MvQUERY_Error }">
                <MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00535', g.MvQUERY_Error ) }">
            </MvIF>
    </MvIF>
    
    <MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedPropertyBranchVersion_Update_Head" PARAMETERS = "branch_id, prop_id, version_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions
						  SET
							head		= 1
						  WHERE
							branch_id	= ? AND
							prop_id		= ? AND
							version_id	= ?' }"
			 FIELDS	= "l.branch_id, l.prop_id, l.version_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00536', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions
						  SET
							head		= 0
						  WHERE
							branch_id	= ? AND
							prop_id		= ? AND
							version_id	<> ?' }"
			 FIELDS	= "l.branch_id, l.prop_id, l.version_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00537', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedPropertyBranchVersion_Delete_All_Branch" PARAMETERS = "branch_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions WHERE branch_id = ?' }"
			 FIELDS	= "l.branch_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00538', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedPropertyBranchVersion_Delete_All_Property" PARAMETERS = "prop_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions WHERE prop_id = ?' }"
			 FIELDS	= "l.prop_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00539', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedPropertyBranchVersion_Delete_All_Product" PARAMETERS = "product_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions WHERE product_id = ?' }"
			 FIELDS	= "l.product_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00574', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedPropertyBranchVersion_Delete_All_Category" PARAMETERS = "cat_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions WHERE cat_id = ?' }"
			 FIELDS	= "l.cat_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00575', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_ManagedPropertyChanges
|
</MvCOMMENT>

<MvFUNCTION NAME = "ManagedPropertyChange_InsertOrUpdate" PARAMETERS = "branch_id, set_id, prop_id, old_id, new_id" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ ManagedPropertyChange_Insert( l.branch_id, l.set_id, l.prop_id, l.old_id, l.new_id ) }">	<MvFUNCTIONRETURN VALUE = 1>
	<MvELSEIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_Error_IsIndexDuplicate( g.Error_Message ) }">	<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = "{ ManagedPropertyChange_Update_New( l.branch_id, l.set_id, l.prop_id, l.new_id ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedPropertyChange_Insert" PARAMETERS = "branch_id, set_id, prop_id, old_id, new_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'ManagedPropertyChanges
					      ( branch_id, set_id, prop_id, old_id, new_id )
						  VALUES
						  ( ?, ?, ?, ?, ? )' }"
			 FIELDS	= "l.branch_id, l.set_id, l.prop_id, l.old_id, l.new_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00540', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedPropertyChange_Update_New" PARAMETERS = "branch_id, set_id, prop_id, new_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'ManagedPropertyChanges
						  SET
							new_id		= ?
						  WHERE
							branch_id	= ?	AND
							set_id		= ? AND
							prop_id		= ?' }"
			 FIELDS	= "l.new_id,
					   l.branch_id, l.set_id, l.prop_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00541', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedPropertyChange_Delete_All_Changeset" PARAMETERS = "set_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ManagedPropertyChanges WHERE set_id = ?' }"
			 FIELDS	= "l.set_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00542', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedPropertyChange_Delete_All_Property" PARAMETERS = "prop_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ManagedPropertyChanges WHERE prop_id = ?' }"
			 FIELDS	= "l.prop_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00543', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedPropertyChange_Delete_All_Product" PARAMETERS = "product_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ g.Native_DBAPI EQ 'postgresql' }">
		<MvQUERY NAME 	= "Merchant"
				 QUERY 	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ManagedPropertyChanges mpc
							  USING
								' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions mpv
							  WHERE
								mpv.product_id	= ? AND
								mpc.version_id	= mpv.id' }"
				 FIELDS	= "l.product_id">
	<MvELSE>
		<MvQUERY NAME 	= "Merchant"
				 QUERY 	= "{ 'DELETE
								mpc.*
							  FROM
								' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions mpv,
								' $ g.Store_Table_Prefix $ 'ManagedPropertyChanges mpc
							  WHERE
								mpv.product_id	= ? AND
								mpc.version_id	= mpv.id' }"
				 FIELDS	= "l.product_id">
	</MvIF>

	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00576', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedPropertyChange_Delete_All_Category" PARAMETERS = "cat_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ g.Native_DBAPI EQ 'postgresql' }">
		<MvQUERY NAME 	= "Merchant"
				 QUERY 	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ManagedPropertyChanges mpc
							  USING
								' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions mpv
							  WHERE
								mpv.cat_id		= ? AND
								mpc.version_id	= mpv.id' }"
				 FIELDS	= "l.cat_id">
	<MvELSE>
		<MvQUERY NAME 	= "Merchant"
				 QUERY 	= "{ 'DELETE
								mpc.*
							  FROM
								' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions mpv,
								' $ g.Store_Table_Prefix $ 'ManagedPropertyChanges mpc
							  WHERE
								mpv.cat_id		= ? AND
								mpc.version_id	= mpv.id' }"
				 FIELDS	= "l.cat_id">
	</MvIF>

	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00577', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_ManagedPropertyVersionImageReferences
|
</MvCOMMENT>

<MvFUNCTION NAME = "ManagedPropertyImageReference_InsertOrIncrement" PARAMETERS = "prop_id, version_id, image_id" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ManagedPropertyImageReference_InsertOrIncrementBy( l.prop_id, l.version_id, l.image_id, 1 ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedPropertyImageReference_InsertOrIncrementBy" PARAMETERS = "prop_id, version_id, image_id, head_count" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.managedpropertyversionimagereference:prop_id" 		VALUE = "{ l.prop_id }">
	<MvASSIGN NAME = "l.managedpropertyversionimagereference:version_id" 	VALUE = "{ l.version_id }">
	<MvASSIGN NAME = "l.managedpropertyversionimagereference:image_id" 		VALUE = "{ l.image_id }">
	<MvASSIGN NAME = "l.managedpropertyversionimagereference:head_count" 	VALUE = "{ l.head_count }">

	<MvIF EXPR = "{ NOT ManagedPropertyImageReference_Insert( l.managedpropertyversionimagereference ) }">
		<MvIF EXPR = "{ [ g.Module_Library_Native_DBAPI ].DB_Error_IsIndexDuplicate( g.Error_Message ) }">
			<MvFUNCTIONRETURN VALUE = "{ ManagedPropertyImageReference_Increment_HeadCountBy( l.version_id, l.image_id, l.head_count ) }">
		</MvIF>

		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedPropertyImageReference_Insert" PARAMETERS = "managedpropertyversionimagereference var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersionImageReferences
					      ( prop_id, version_id, image_id, head_count )
						  VALUES
						  ( ?, ?, ?, ? )' }"
			 FIELDS	= "l.managedpropertyversionimagereference:prop_id,
			 		   l.managedpropertyversionimagereference:version_id,
			 		   l.managedpropertyversionimagereference:image_id,
			 		   l.managedpropertyversionimagereference:head_count">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00629', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedPropertyImageReference_Decrement_HeadCount" PARAMETERS = "version_id, image_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersionImageReferences
					      SET
					      	head_count = head_count - 1
						  WHERE
						  	version_id	= ? AND
						  	image_id	= ?' }"
			 FIELDS	= "l.version_id, l.image_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00630', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedPropertyImageReference_Increment_HeadCount" PARAMETERS = "version_id, image_id" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ ManagedPropertyImageReference_Increment_HeadCountBy( l.version_id, l.image_id, 1 ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedPropertyImageReference_Increment_HeadCountBy" PARAMETERS = "version_id, image_id, head_count_increment" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersionImageReferences
					      SET
					      	head_count	= head_count + ?
						  WHERE
						  	version_id	= ? AND
						  	image_id	= ?' }"
			 FIELDS	= "l.head_count_increment,
			 		   l.version_id, l.image_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00631', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedPropertyImageReference_Delete_All_Property" PARAMETERS = "prop_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersionImageReferences WHERE prop_id = ?' }"
			 FIELDS	= "l.prop_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00632', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedPropertyImageReference_Delete_All_Version" PARAMETERS = "version_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersionImageReferences WHERE version_id = ?' }"
			 FIELDS	= "l.version_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00633', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedPropertyImageReference_Delete_All_Product" PARAMETERS = "product_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ g.Native_DBAPI EQ 'postgresql' }">
		<MvQUERY NAME 	= "Merchant"
				 QUERY 	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersionImageReferences mpvir
							  USING
								' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions mpv
							  WHERE
								mpv.product_id		= ? AND
								mpvir.version_id	= mpv.id' }"
				 FIELDS	= "l.product_id">
	<MvELSE>
		<MvQUERY NAME 	= "Merchant"
				 QUERY 	= "{ 'DELETE
								mpvir.*
							  FROM
								' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions mpv,
								' $ g.Store_Table_Prefix $ 'ManagedPropertyVersionImageReferences mpvir
							  WHERE
								mpv.product_id		= ? AND
								mpvir.version_id	= mpv.id' }"
				 FIELDS	= "l.product_id">
	</MvIF>

	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00634', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedPropertyImageReference_Delete_All_Category" PARAMETERS = "cat_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ g.Native_DBAPI EQ 'postgresql' }">
		<MvQUERY NAME 	= "Merchant"
				 QUERY 	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersionImageReferences mpvir
							  USING
								' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions mpv
							  WHERE
								mpv.cat_id			= ? AND
								mpvir.version_id	= mpv.id' }"
				 FIELDS	= "l.cat_id">
	<MvELSE>
		<MvQUERY NAME 	= "Merchant"
				 QUERY 	= "{ 'DELETE
								mpvir.*
							  FROM
								' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions mpv,
								' $ g.Store_Table_Prefix $ 'ManagedPropertyVersionImageReferences mpvir
							  WHERE
								mpv.cat_id			= ? AND
								mpvir.version_id	= mpv.id' }"
				 FIELDS	= "l.cat_id">
	</MvIF>

	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00635', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedPropertyImageReference_Delete_All_Image" PARAMETERS = "image_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME 	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersionImageReferences WHERE image_id = ?' }"
			 FIELDS	= "l.image_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00645', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedPropertyImageReference_Delete_All_Orphaned_Properties" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'ManagedPropertyVersionImageReferences
			 			  WHERE prop_id NOT IN ( SELECT DISTINCT prop_id FROM ' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00848', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_CopyPageRules
|
</MvCOMMENT>

<MvFUNCTION NAME = "CopyPageRules_Default" PARAMETERS = "copyproductrules var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.copyproductrules"				VALUE = "">
	<MvASSIGN NAME = "l.copyproductrules:id"			VALUE = 0>
	<MvASSIGN NAME = "l.copyproductrules:name"			VALUE = "<Copy All Page Data>">
	<MvASSIGN NAME = "l.copyproductrules:secure"		VALUE = 1>
	<MvASSIGN NAME = "l.copyproductrules:title"			VALUE = 1>
	<MvASSIGN NAME = "l.copyproductrules:template"		VALUE = 1>
	<MvASSIGN NAME = "l.copyproductrules:items"			VALUE = 1>
	<MvASSIGN NAME = "l.copyproductrules:settings"		VALUE = "all">
	<MvASSIGN NAME = "l.copyproductrules:jsres"			VALUE = 1>
	<MvASSIGN NAME = "l.copyproductrules:cssres"		VALUE = 1>
	<MvASSIGN NAME = "l.copyproductrules:cacheset"		VALUE = 1>
	<MvASSIGN NAME = "l.copyproductrules:public"		VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CopyPageRules_Read" PARAMETERS = "copypagerules var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.copypagerules"				VALUE = "">
	<MvASSIGN NAME = "l.copypagerules:id"			VALUE = "{ CopyPageRules.d.id }">
	<MvASSIGN NAME = "l.copypagerules:name"			VALUE = "{ CopyPageRules.d.name }">
	<MvASSIGN NAME = "l.copypagerules:secure"		VALUE = "{ CopyPageRules.d.secure }">
	<MvASSIGN NAME = "l.copypagerules:title"		VALUE = "{ CopyPageRules.d.title }">
	<MvASSIGN NAME = "l.copypagerules:template"		VALUE = "{ CopyPageRules.d.template }">
	<MvASSIGN NAME = "l.copypagerules:items"		VALUE = "{ CopyPageRules.d.items }">
	<MvASSIGN NAME = "l.copypagerules:settings"		VALUE = "{ CopyPageRules.d.settings }">
	<MvASSIGN NAME = "l.copypagerules:jsres"		VALUE = "{ CopyPageRules.d.jsres }">
	<MvASSIGN NAME = "l.copypagerules:cssres"		VALUE = "{ CopyPageRules.d.cssres }">
	<MvASSIGN NAME = "l.copypagerules:cacheset"		VALUE = "{ CopyPageRules.d.cacheset }">
	<MvASSIGN NAME = "l.copypagerules:public"		VALUE = "{ CopyPageRules.d.public }">
</MvFUNCTION>

<MvFUNCTION NAME = "CopyPageRules_Load_ID" PARAMETERS = "id, copypagerules var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW 	= "CopyPageRules"
				QUERY 	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'CopyPageRules WHERE id = ?' }"
				FIELDS	= "l.id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00653', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ CopyPageRules.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "CopyPageRules">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00654' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ CopyPageRules_Read( l.copypagerules ) }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "CopyPageRules">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CopyPageRules_Load_Name" PARAMETERS = "name, copypagerules var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW 	= "CopyPageRules"
				QUERY 	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'CopyPageRules WHERE ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'name' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) }"
				FIELDS	= "l.name">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00655', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ CopyPageRules.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "CopyPageRules">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00656' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ CopyPageRules_Read( l.copypagerules ) }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "CopyPageRules">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CopyPageRule_Insert" PARAMETERS = "copypagerules var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.copypagerules:id" VALUE = "{ [ g.Module_Library_DB ].StoreKey_Generate( 'CopyPageRules' ) }">

	<MvIF EXPR = "{ ISNULL l.copypagerules:public }">
		<MvASSIGN NAME = "l.copypagerules:public" VALUE = 0>
	</MvIF>

	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'CopyPageRules
			 			  ( id, name, secure, title, template, items, settings, jsres, cssres, cacheset, public )
			 			  VALUES
			 			  ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )' }"
			 FIELDS = "l.copypagerules:id, l.copypagerules:name, l.copypagerules:secure, l.copypagerules:title, l.copypagerules:template,
			 		   l.copypagerules:items, l.copypagerules:settings, l.copypagerules:jsres, l.copypagerules:cssres, l.copypagerules:cacheset,
			 		   l.copypagerules:public">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00657', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CopyPageRule_Update" PARAMETERS = "copypagerules var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'CopyPageRules
			 			  SET
			 			  	name		= ?,
			 			  	secure		= ?,
			 			  	title		= ?,
			 			  	template	= ?,
			 			  	items		= ?,
			 			  	settings	= ?,
			 			  	jsres		= ?,
			 			  	cssres		= ?,
			 			  	cacheset	= ?,
			 			  	public		= ?
			 			  WHERE
			 			  	id			= ?' }"
			 FIELDS = "l.copypagerules:name, l.copypagerules:secure, l.copypagerules:title, l.copypagerules:template, l.copypagerules:items,
			 		   l.copypagerules:settings, l.copypagerules:jsres, l.copypagerules:cssres, l.copypagerules:cacheset, l.copypagerules:public,
			 		   l.copypagerules:id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00658', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CopyPageRules_Delete" PARAMETERS = "copypagerules var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT CopyPageRulesXSettings_Delete_All_RulesID( l.copypagerules:id )	OR
					NOT CopyPageRules_Delete_ID( l.copypagerules:id ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CopyPageRules_Delete_ID" PARAMETERS = "id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'CopyPageRules WHERE id = ?' }"
			 FIELDS = "l.id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00659', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_CopyPageRulesXSettings
|
</MvCOMMENT>

<MvFUNCTION NAME = "CopyPageRulesXSettings_Read" PARAMETERS = "copypagerulesxsettings var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.copypagerulesxsettings"				VALUE = "">
	<MvASSIGN NAME = "l.copypagerulesxsettings:rules_id"	VALUE = "{ CopyPageRulesXSettings.d.rules_id }">
	<MvASSIGN NAME = "l.copypagerulesxsettings:item_code"	VALUE = "{ CopyPageRulesXSettings.d.item_code }">
</MvFUNCTION>

<MvFUNCTION NAME = "CopyPageRulesXSettings_Insert" PARAMETERS = "rules_id, item_code" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'CopyPageRulesXSettings
			 			  ( rules_id, item_code )
			 			  VALUES
			 			  ( ?, ? )' }"
			 FIELDS = "l.rules_id, l.item_code">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00660', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CopyPageRulesXSettings_Load" PARAMETERS = "rules_id, item_code, copypagerulesxsettings var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW 	= "CopyPageRulesXSettings"
				QUERY 	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'CopyPageRulesXSettings WHERE rules_id = ? AND ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'item_code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) }"
				FIELDS	= "l.rules_id, l.item_code">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00661', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ CopyPageRulesXSettings.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "CopyPageRulesXSettings">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00662' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ CopyPageRulesXSettings_Read( l.copypagerulesxsettings ) }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "CopyPageRulesXSettings">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CopyPageRulesXSettingsList_Load_RulesID" PARAMETERS = "rules_id, copypagerulesxsettingslist var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW 	= "CopyPageRulesXSettings"
				QUERY 	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'CopyPageRulesXSettings WHERE rules_id = ?' }"
				FIELDS	= "l.rules_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00663', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT CopyPageRulesXSettings.d.EOF }">
		<MvEVAL EXPR = "{ CopyPageRulesXSettings_Read( l.copypagerulesxsettingslist[ ++l.count ] ) }">

		<MvSKIP NAME = "Merchant" VIEW = "CopyPageRulesXSettings" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "CopyPageRulesXSettings">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00664', l.count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CopyPageRulesXSettings_Delete" PARAMETERS = "rules_id, item_code" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'CopyPageRulesXSettings WHERE rules_id = ? AND ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'item_code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) }"
			 FIELDS = "l.rules_id, l.item_code">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00665', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CopyPageRulesXSettings_Delete_All_RulesID" PARAMETERS = "rules_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'CopyPageRulesXSettings WHERE rules_id = ?' }"
			 FIELDS = "l.rules_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00666', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_ManagedContent
|
</MvCOMMENT>

<MvFUNCTION NAME = "ManagedContent_Read" PARAMETERS = "managedcontent var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.managedcontent"				VALUE = "">
	<MvASSIGN NAME = "l.managedcontent:id"			VALUE = "{ ManagedContent.d.id }">
	<MvASSIGN NAME = "l.managedcontent:refcount"	VALUE = "{ ManagedContent.d.refcount }">
	<MvASSIGN NAME = "l.managedcontent:md5"			VALUE = "{ ManagedContent.d.md5 }">
	<MvASSIGN NAME = "l.managedcontent:encoding"	VALUE = "{ ManagedContent.d.encoding }">

	<MvIF EXPR = "{ ManagedContent.d.encoding EQ 'base64' }">
		<MvASSIGN NAME = "l.managedcontent:content" VALUE = "{ crypto_base64_decode( ManagedContent.d.content ) }">
	<MvELSE>
		<MvASSIGN NAME = "l.managedcontent:content" VALUE = "{ ManagedContent.d.content }">
	</MvIF>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedContent_FindOrInsert" PARAMETERS = "content var, managedcontent var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ asciichar( 0 ) IN l.content }">		<MvASSIGN NAME = "l.encoding" VALUE = "base64">	<MvASSIGN NAME = "l.encoded_content" VALUE = "{ crypto_base64_encode( l.content ) }">
	<MvELSEIF EXPR = "{ NOT isascii( l.content ) }">	<MvASSIGN NAME = "l.encoding" VALUE = "base64">	<MvASSIGN NAME = "l.encoded_content" VALUE = "{ crypto_base64_encode( l.content ) }">
	<MvELSE>											<MvASSIGN NAME = "l.encoding" VALUE = "">		<MvREFERENCE NAME = "l.encoded_content" VARIABLE = "l.content">
	</MvIF>

	<MvASSIGN NAME = "l.md5" VALUE = "{ crypto_md5( l.content ) }">

	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ManagedContent"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'ManagedContent WHERE md5 = ?' }"
				FIELDS	= "l.md5">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00700', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvWHILE EXPR = "{ NOT ManagedContent.d.EOF }">
		<MvIF EXPR = "{ ( len_var( l.encoded_content ) EQ len_var( ManagedContent.d.content ) ) AND ( l.encoding EQ ManagedContent.d.encoding ) }">
			<MvIF EXPR = "{ strcmp( l.encoded_content, ManagedContent.d.content ) EQ 0 }">
				<MvEVAL EXPR = "{ ManagedContent_Read( l.managedcontent ) }">

				<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedContent">
				<MvFUNCTIONRETURN VALUE = 1>
			</MvIF>
		</MvIF>

		<MvSKIP NAME = "Merchant" VIEW = "ManagedContent" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedContent">

	<MvASSIGN NAME = "l.id" VALUE = "{ [ g.Module_Library_DB ].StoreKey_Generate( 'ManagedContent' ) }">

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'ManagedContent
						  ( id, refcount, md5, encoding, content )
						  VALUES
						  ( ?, 0, ?, ?, ? )' }"
			 FIELDS	= "l.id, l.md5, l.encoding, l.encoded_content">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00701', g.MvQUERY_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.managedcontent"				VALUE = "">
	<MvASSIGN NAME = "l.managedcontent:id"			VALUE = "{ l.id }">
	<MvASSIGN NAME = "l.managedcontent:refcount"	VALUE = 0>
	<MvASSIGN NAME = "l.managedcontent:md5"			VALUE = "{ l.md5 }">
	<MvASSIGN NAME = "l.managedcontent:encoding"	VALUE = "{ l.encoding }">
	<MvASSIGN NAME = "l.managedcontent:content"		VALUE = "{ l.content }">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedContent_Load_ID" PARAMETERS = "id, managedcontent var" STANDARDOUTPUTLEVEL = ""  ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "ManagedContent"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'ManagedContent WHERE id	= ?' }"
				FIELDS	= "l.id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00702', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ ManagedContent.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedContent">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00703' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ ManagedContent_Read( l.managedcontent ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedContent">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedContent_Increment_ReferenceCount" PARAMETERS = "id" STANDARDOUTPUTLEVEL = ""  ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'ManagedContent
						  SET
							refcount	= refcount + 1
						  WHERE
						  	id			= ?' }"
			 FIELDS	= "l.id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00704', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedContent_Decrement_ReferenceCount" PARAMETERS = "id" STANDARDOUTPUTLEVEL = ""  ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'ManagedContent
						  SET
							refcount	= refcount - 1
						  WHERE
						  	id			= ?' }"
			 FIELDS	= "l.id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00705', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedContent_Decrement_All_CSSResource" PARAMETERS = "res_id" STANDARDOUTPUTLEVEL = ""  ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW 	= "CSSResourceVersions"
				QUERY 	= "{ 'SELECT
								content_id,
								COUNT( * ) AS count
							  FROM
								' $ g.Store_Table_Prefix $ 'CSSResourceVersions
							  WHERE
								res_id		= ? AND
								content_id	<> 0
							  GROUP BY
							  	content_id' }"
				FIELDS	= "l.res_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00849', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvWHILE EXPR = "{ NOT CSSResourceVersions.d.EOF }">
		<MvQUERY NAME	= "Merchant"
				 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'ManagedContent
							  SET
								refcount	= refcount - ?
							  WHERE
							  	id			= ?' }"
				 FIELDS	= "CSSResourceVersions.d.count,
				 		   CSSResourceVersions.d.content_id">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSResourceVersions">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00853', g.MvQUERY_Error ) }">
		</MvIF>

		<MvSKIP NAME = "Merchant" VIEW = "CSSResourceVersions" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSResourceVersions">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedContent_Decrement_All_Orphaned_CSSResources" STANDARDOUTPUTLEVEL = ""  ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW 	= "CSSResourceVersions"
				QUERY 	= "{ 'SELECT
								cssv.content_id,
								COUNT( * ) AS count
							  FROM
								' $ g.Store_Table_Prefix $ 'CSSResourceVersions cssv
					 			LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'CSSResourceBranchVersions mpbv ON mpbv.res_id = cssv.res_id
							  WHERE
								mpbv.res_id IS NULL AND
								cssv.content_id <> 0
							  GROUP BY
							  	cssv.content_id' }">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00850', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvWHILE EXPR = "{ NOT CSSResourceVersions.d.EOF }">
		<MvQUERY NAME	= "Merchant"
				 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'ManagedContent
							  SET
								refcount	= refcount - ?
							  WHERE
							  	id			= ?' }"
				 FIELDS	= "CSSResourceVersions.d.count,
				 		   CSSResourceVersions.d.content_id">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSResourceVersions">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00854', g.MvQUERY_Error ) }">
		</MvIF>

		<MvSKIP NAME = "Merchant" VIEW = "CSSResourceVersions" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "CSSResourceVersions">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedContent_Decrement_All_JavaScriptResource" PARAMETERS = "res_id" STANDARDOUTPUTLEVEL = ""  ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW 	= "JavaScriptResourceVersions"
				QUERY 	= "{ 'SELECT
								content_id,
								COUNT( * ) AS count
							  FROM
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceVersions
							  WHERE
								res_id		= ? AND
								content_id	<> 0
							  GROUP BY
							  	content_id' }"
				FIELDS	= "l.res_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00851', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvWHILE EXPR = "{ NOT JavaScriptResourceVersions.d.EOF }">
		<MvQUERY NAME	= "Merchant"
				 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'ManagedContent
							  SET
								refcount	= refcount - ?
							  WHERE
							  	id			= ?' }"
				 FIELDS	= "JavaScriptResourceVersions.d.count,
				 		   JavaScriptResourceVersions.d.content_id">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptResourceVersions">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00855', g.MvQUERY_Error ) }">
		</MvIF>

		<MvSKIP NAME = "Merchant" VIEW = "JavaScriptResourceVersions" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptResourceVersions">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedContent_Decrement_All_Orphaned_JavaScriptResources" STANDARDOUTPUTLEVEL = ""  ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW 	= "JavaScriptResourceVersions"
				QUERY 	= "{ 'SELECT
								jsv.content_id,
								COUNT( * ) AS count
							  FROM
								' $ g.Store_Table_Prefix $ 'JavaScriptResourceVersions jsv
					 			LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'JavaScriptResourceBranchVersions mpbv ON mpbv.res_id = jsv.res_id
							  WHERE
								mpbv.res_id IS NULL AND
								jsv.content_id <> 0
							  GROUP BY
							  	jsv.content_id' }">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00852', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvWHILE EXPR = "{ NOT JavaScriptResourceVersions.d.EOF }">
		<MvQUERY NAME	= "Merchant"
				 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'ManagedContent
							  SET
								refcount	= refcount - ?
							  WHERE
							  	id			= ?' }"
				 FIELDS	= "JavaScriptResourceVersions.d.count,
				 		   JavaScriptResourceVersions.d.content_id">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptResourceVersions">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00856', g.MvQUERY_Error ) }">
		</MvIF>

		<MvSKIP NAME = "Merchant" VIEW = "JavaScriptResourceVersions" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "JavaScriptResourceVersions">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedContent_Decrement_All_ManagedProperty" PARAMETERS = "prop_id" STANDARDOUTPUTLEVEL = ""  ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW 	= "ManagedPropertyVersions"
				QUERY 	= "{ 'SELECT
								content_id,
								COUNT( * ) AS count
							  FROM
								' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions
							  WHERE
								prop_id		= ? AND
								content_id	<> 0
							  GROUP BY
							  	content_id' }"
				FIELDS	= "l.prop_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00972', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvWHILE EXPR = "{ NOT ManagedPropertyVersions.d.EOF }">
		<MvQUERY NAME	= "Merchant"
				 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'ManagedContent
							  SET
								refcount	= refcount - ?
							  WHERE
							  	id			= ?' }"
				 FIELDS	= "ManagedPropertyVersions.d.count,
				 		   ManagedPropertyVersions.d.content_id">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedPropertyVersions">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00973', g.MvQUERY_Error ) }">
		</MvIF>

		<MvSKIP NAME = "Merchant" VIEW = "ManagedPropertyVersions" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedPropertyVersions">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ManagedContent_Decrement_All_Orphaned_ManagedProperties" STANDARDOUTPUTLEVEL = ""  ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW 	= "ManagedPropertyVersions"
				QUERY 	= "{ 'SELECT
								mpv.content_id,
								COUNT( * ) AS count
							  FROM
								' $ g.Store_Table_Prefix $ 'ManagedPropertyVersions mpv
					 			LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'ManagedPropertyBranchVersions mpbv ON mpbv.prop_id = mpv.prop_id
							  WHERE
								mpbv.prop_id IS NULL AND
								mpv.content_id <> 0
							  GROUP BY
							  	mpv.content_id' }">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00974', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvWHILE EXPR = "{ NOT ManagedPropertyVersions.d.EOF }">
		<MvQUERY NAME	= "Merchant"
				 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'ManagedContent
							  SET
								refcount	= refcount - ?
							  WHERE
							  	id			= ?' }"
				 FIELDS	= "ManagedPropertyVersions.d.count,
				 		   ManagedPropertyVersions.d.content_id">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedPropertyVersions">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00975', g.MvQUERY_Error ) }">
		</MvIF>

		<MvSKIP NAME = "Merchant" VIEW = "ManagedPropertyVersions" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "ManagedPropertyVersions">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| Fonts
|
</MvCOMMENT>

<MvFUNCTION NAME = "Font_Copy" PARAMETERS = "source var, dest var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.dest:name"				VALUE = "{ l.source:name }">
	<MvASSIGN NAME = "l.dest:type"				VALUE = "{ l.source:type }">
	<MvASSIGN NAME = "l.dest:family"			VALUE = "{ l.source:family }">
	<MvASSIGN NAME = "l.dest:google_font_name"	VALUE = "{ l.source:google_font_name }">
	<MvASSIGN NAME = "l.dest:active"			VALUE = "{ l.source:active }">
	<MvASSIGN NAME = "l.dest:weights"			VALUE = "{ l.source:weights }">
	<MvASSIGN NAME = "l.dest:styles"			VALUE = "{ l.source:styles }">
	<MvASSIGN NAME = "l.dest:embed"				VALUE = "{ l.source:embed }">
</MvFUNCTION>

<MvFUNCTION NAME = "Font_Read" PARAMETERS = "managedproperty var, font var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.font:code"				VALUE = "{ l.managedproperty:code }">

	<MvEVAL EXPR = "{ Font_Copy( l.managedproperty:version:settings, l.font ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Font_Load_Code_Cached" PARAMETERS = "code, font var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ Font_Load_Branch_Code_Cached( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.code, l.font ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Font_Load_Branch_Code_Cached" PARAMETERS = "branch_id, code, font var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.branch_id" VALUE = "{ int( l.branch_id ) }">

	<MvIF EXPR = "{ l.branch_id LE 0 }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-TUI-DTB-00970' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ [ g.Module_Library_DB ].DB_Cache_Data_Reference( 'font_load_branch_code_cached', l.code, l.ref ) }">

	<MvIF EXPR = "{ [ g.Module_Library_DB ].DB_Cache_Data_Requires_Load( l.ref ) }">
		<MvASSIGN NAME = "l.result"	VALUE = "{ Font_Load_Branch_Code( l.branch_id, l.code, l.font ) }">

		<MvEVAL EXPR = "{ [ g.Module_Library_DB ].DB_Cache_Data_Store_Result( l.ref, l.result, l.font ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].DB_Cache_Data_Result( l.ref, l.font ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Font_Load_Code" PARAMETERS = "code, font var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ Font_Load_Branch_Code( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.code, l.font ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Font_Load_Branch_Code" PARAMETERS = "branch_id, code, font var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT ManagedPropertyAndVersion_Load_Branch_Code( l.branch_id, 'font', l.code, l.managedproperty ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvEVAL EXPR = "{ Font_Read( l.managedproperty, l.font ) }">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "FontList_Load_Active" PARAMETERS = "fonts var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ FontList_Load_Branch_Active( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.fonts ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "FontList_Load_Branch_Active" PARAMETERS = "branch_id, fonts var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.fonts"		VALUE = "">
	<MvASSIGN NAME = "l.font_count"	VALUE = 0>

	<MvFOREACH ITERATOR = "l.managedproperty" ARRAY = "l.managedproperties" COUNT = "{ ManagedPropertyAndVersionList_Load_Branch_Type( l.branch_id, 'font', l.managedproperties ) }">
		<MvEVAL EXPR = "{ Font_Read( l.managedproperty, l.font ) }">

		<MvIF EXPR = "{ l.font:active }">
			<MvASSIGN NAME = "l.font_count" VALUE = "{ miva_array_insert_var( l.fonts, l.font, -1 ) }">
		</MvIF>
	</MvFOREACH>

	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00971', l.font_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "FontList_Load_All" PARAMETERS = "fonts var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ FontList_Load_Branch_All( [ g.Feature_Filename_TUI_MGR ].TemplateManager_Working_Branch_ID(), l.fonts ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "FontList_Load_Branch_All" PARAMETERS = "branch_id, fonts var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.fonts"		VALUE = "">
	<MvASSIGN NAME = "l.font_count"	VALUE = 0>

	<MvFOREACH ITERATOR = "l.managedproperty" ARRAY = "l.managedproperties" COUNT = "{ ManagedPropertyAndVersionList_Load_Branch_Type( l.branch_id, 'font', l.managedproperties ) }">
		<MvEVAL EXPR = "{ Font_Read( l.managedproperty, l.font ) }">

		<MvASSIGN NAME = "l.font_count" VALUE = "{ miva_array_insert_var( l.fonts, l.font, -1 ) }">
	</MvFOREACH>

	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-TUI-DTB-00968', l.font_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Font_Insert" PARAMETERS = "font var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ Font_Copy( l.font, l.settings ) }">

	<MvIF EXPR = "{ NOT [ g.Module_Feature_TUI_MGR ].TemplateManager_Create_ManagedProperty( 'font', l.font:code, 'notemplate', l.null_source, l.settings, l.null_managedproperty ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ [ g.Module_Feature_TUI_MGR ].TemplateManager_Load_Theme( l.theme ) }">
		<MvFOREACH ITERATOR = "l.module" ARRAY = "l.modules" COUNT = "{ [ g.Module_Library_DB ].StoreModuleList_Load_Features_Cached( 'not_theme', l.modules ) }">
			<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Root $ l.module:module ].Module_Notify_Theme_Update( l.module, l.theme ) }">
		</MvFOREACH>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Font_Update" PARAMETERS = "original_font var, font var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT ManagedPropertyAndVersion_Load_Code_Current( 'font', l.original_font:code, l.managedproperty ) }">
		<MvIF EXPR = "{ NOT [ g.Module_Library_DB ].Error_Is_EOF() }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>

		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-TUI-DTB-00969', 'Font not found' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ Font_Copy( l.font, l.settings ) }">

	<MvASSIGN NAME = "l.managedproperty:code" VALUE = "{ l.font:code }">

	<MvIF EXPR = "{ NOT [ g.Module_Feature_TUI_MGR ].TemplateManager_Create_ManagedPropertyVersion( l.managedproperty, l.settings ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ [ g.Module_Feature_TUI_MGR ].TemplateManager_Load_Theme( l.theme ) }">
		<MvFOREACH ITERATOR = "l.module" ARRAY = "l.modules" COUNT = "{ [ g.Module_Library_DB ].StoreModuleList_Load_Features_Cached( 'not_theme', l.modules ) }">
			<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Root $ l.module:module ].Module_Notify_Theme_Update( l.module, l.theme ) }">
		</MvFOREACH>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Font_Delete" PARAMETERS = "font var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT ManagedProperty_Load_Code( 'font', l.font:code, l.managedproperty ) }">
		<MvIF EXPR = "{ NOT [ g.Module_Library_DB ].Error_Is_EOF() }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>

		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT [ g.Module_Feature_TUI_MGR ].TemplateManager_Delete_ManagedProperty( l.managedproperty ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ [ g.Module_Feature_TUI_MGR ].TemplateManager_Load_Theme( l.theme ) }">
		<MvFOREACH ITERATOR = "l.module" ARRAY = "l.modules" COUNT = "{ [ g.Module_Library_DB ].StoreModuleList_Load_Features_Cached( 'not_theme', l.modules ) }">
			<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Root $ l.module:module ].Module_Notify_Theme_Update( l.module, l.theme ) }">
		</MvFOREACH>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>
