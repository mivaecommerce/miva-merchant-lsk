<MIVA STANDARDOUTPUTLEVEL = "">

<MvCOMMENT>
|
| Miva Merchant
|
| This file and the source codes contained herein are the property of
| Miva, Inc.  Use of this file is restricted to the specific terms and
| conditions in the License Agreement associated with this file.  Distribution
| of this file or portions of this file for uses not covered by the License
| Agreement is not allowed without a written agreement signed by an officer of
| Miva, Inc.
|
| Copyright 1998-2025 Miva, Inc.  All rights reserved.
| http://www.miva.com
|
| Prefix         : MER-SEA-UTL-
| Next Error Code: 30
|
</MvCOMMENT>

<MvCOMMENT>
|
| Helper Functions
|
</MvCOMMENT>

<MvFUNCTION NAME = "SearchableField_Load_Builtin" PARAMETERS = "field_code, searchablefield var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT [ g.Feature_Filename_SEA_DB ].SearchSettings_Load_Cached( l.searchsettings ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvASSIGN NAME = "l.searchablefield"					VALUE = "">

	<MvIF EXPR = "{ l.field_code EQ 'code' }">
		<MvASSIGN NAME = "l.searchablefield:field_code"		VALUE = "code">
		<MvASSIGN NAME = "l.searchablefield:field_name"		VALUE = "Product Code">
		<MvASSIGN NAME = "l.searchablefield:enabled"		VALUE = "{ l.searchsettings:code }">
		<MvASSIGN NAME = "l.searchablefield:searchtype"		VALUE = "{ l.searchsettings:code_st }">
		<MvASSIGN NAME = "l.searchablefield:relevance"		VALUE = "{ l.searchsettings:code_rel }">
		<MvASSIGN NAME = "l.searchablefield:weight"			VALUE = "{ l.searchsettings:code_wt }">
	<MvELSEIF EXPR = "{ l.field_code EQ 'name' }">
		<MvASSIGN NAME = "l.searchablefield:field_code"		VALUE = "name">
		<MvASSIGN NAME = "l.searchablefield:field_name"		VALUE = "Product Name">
		<MvASSIGN NAME = "l.searchablefield:enabled"		VALUE = "{ l.searchsettings:name }">
		<MvASSIGN NAME = "l.searchablefield:searchtype"		VALUE = "{ l.searchsettings:name_st }">
		<MvASSIGN NAME = "l.searchablefield:relevance"		VALUE = "{ l.searchsettings:name_rel }">
		<MvASSIGN NAME = "l.searchablefield:weight"			VALUE = "{ l.searchsettings:name_wt }">
	<MvELSEIF EXPR = "{ l.field_code EQ 'sku' }">
		<MvASSIGN NAME = "l.searchablefield:field_code"		VALUE = "sku">
		<MvASSIGN NAME = "l.searchablefield:field_name"		VALUE = "Product SKU">
		<MvASSIGN NAME = "l.searchablefield:enabled"		VALUE = "{ l.searchsettings:sku }">
		<MvASSIGN NAME = "l.searchablefield:searchtype"		VALUE = "{ l.searchsettings:sku_st }">
		<MvASSIGN NAME = "l.searchablefield:relevance"		VALUE = "{ l.searchsettings:sku_rel }">
		<MvASSIGN NAME = "l.searchablefield:weight"			VALUE = "{ l.searchsettings:sku_wt }">
	<MvELSEIF EXPR = "{ l.field_code EQ 'descrip' }">
		<MvASSIGN NAME = "l.searchablefield:field_code"		VALUE = "descrip">
		<MvASSIGN NAME = "l.searchablefield:field_name"		VALUE = "Product Description">
		<MvASSIGN NAME = "l.searchablefield:enabled"		VALUE = "{ l.searchsettings:descrip }">
		<MvASSIGN NAME = "l.searchablefield:searchtype"		VALUE = "{ l.searchsettings:desc_st }">
		<MvASSIGN NAME = "l.searchablefield:relevance"		VALUE = "{ l.searchsettings:desc_rel }">
		<MvASSIGN NAME = "l.searchablefield:weight"			VALUE = "{ l.searchsettings:desc_wt }">
	<MvELSEIF EXPR = "{ l.field_code EQ 'atr_code' }">
		<MvASSIGN NAME = "l.searchablefield:field_code"		VALUE = "atr_code">
		<MvASSIGN NAME = "l.searchablefield:field_name"		VALUE = "Attribute Code">
		<MvASSIGN NAME = "l.searchablefield:enabled"		VALUE = "{ l.searchsettings:atr_code }">
		<MvASSIGN NAME = "l.searchablefield:searchtype"		VALUE = "{ l.searchsettings:acode_st }">
		<MvASSIGN NAME = "l.searchablefield:relevance"		VALUE = "{ l.searchsettings:acode_rel }">
		<MvASSIGN NAME = "l.searchablefield:weight"			VALUE = "{ l.searchsettings:acode_wt }">
	<MvELSEIF EXPR = "{ l.field_code EQ 'atr_prompt' }">
		<MvASSIGN NAME = "l.searchablefield:field_code"		VALUE = "atr_prompt">
		<MvASSIGN NAME = "l.searchablefield:field_name"		VALUE = "Attribute Prompt">
		<MvASSIGN NAME = "l.searchablefield:enabled"		VALUE = "{ l.searchsettings:atr_prompt }">
		<MvASSIGN NAME = "l.searchablefield:searchtype"		VALUE = "{ l.searchsettings:aprom_st }">
		<MvASSIGN NAME = "l.searchablefield:relevance"		VALUE = "{ l.searchsettings:aprom_rel }">
		<MvASSIGN NAME = "l.searchablefield:weight"			VALUE = "{ l.searchsettings:aprom_wt }">
	<MvELSEIF EXPR = "{ l.field_code EQ 'opt_code' }">
		<MvASSIGN NAME = "l.searchablefield:field_code"		VALUE = "opt_code">
		<MvASSIGN NAME = "l.searchablefield:field_name"		VALUE = "Option Code">
		<MvASSIGN NAME = "l.searchablefield:enabled"		VALUE = "{ l.searchsettings:opt_code }">
		<MvASSIGN NAME = "l.searchablefield:searchtype"		VALUE = "{ l.searchsettings:ocode_st }">
		<MvASSIGN NAME = "l.searchablefield:relevance"		VALUE = "{ l.searchsettings:ocode_rel }">
		<MvASSIGN NAME = "l.searchablefield:weight"			VALUE = "{ l.searchsettings:ocode_wt }">
	<MvELSEIF EXPR = "{ l.field_code EQ 'opt_prompt' }">
		<MvASSIGN NAME = "l.searchablefield:field_code"		VALUE = "opt_prompt">
		<MvASSIGN NAME = "l.searchablefield:field_name"		VALUE = "Option Prompt">
		<MvASSIGN NAME = "l.searchablefield:enabled"		VALUE = "{ l.searchsettings:opt_prompt }">
		<MvASSIGN NAME = "l.searchablefield:searchtype"		VALUE = "{ l.searchsettings:oprom_st }">
		<MvASSIGN NAME = "l.searchablefield:relevance"		VALUE = "{ l.searchsettings:oprom_rel }">
		<MvASSIGN NAME = "l.searchablefield:weight"			VALUE = "{ l.searchsettings:oprom_wt }">
	<MvELSE>
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-SEA-UTL-00017' ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "SearchableFieldList_Load_All_Builtins" PARAMETERS = "searchablefields var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT [ g.Feature_Filename_SEA_DB ].SearchSettings_Load_Cached( l.searchsettings ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvASSIGN NAME = "l.searchablefields"				VALUE = "">
	<MvASSIGN NAME = "l.searchablefield_count"			VALUE = 0>

	<MvASSIGN NAME = "l.searchablefield"				VALUE = "">
	<MvASSIGN NAME = "l.searchablefield:field_code"		VALUE = "code">
	<MvASSIGN NAME = "l.searchablefield:field_name"		VALUE = "Product Code">
	<MvASSIGN NAME = "l.searchablefield:enabled"		VALUE = "{ l.searchsettings:code }">
	<MvASSIGN NAME = "l.searchablefield:searchtype"		VALUE = "{ l.searchsettings:code_st }">
	<MvASSIGN NAME = "l.searchablefield:relevance"		VALUE = "{ l.searchsettings:code_rel }">
	<MvASSIGN NAME = "l.searchablefield:weight"			VALUE = "{ l.searchsettings:code_wt }">
	<MvASSIGN NAME = "l.searchablefield_count"			VALUE = "{ miva_array_insert_var( l.searchablefields, l.searchablefield, -1 ) }">

	<MvASSIGN NAME = "l.searchablefield"				VALUE = "">
	<MvASSIGN NAME = "l.searchablefield:field_code"		VALUE = "name">
	<MvASSIGN NAME = "l.searchablefield:field_name"		VALUE = "Product Name">
	<MvASSIGN NAME = "l.searchablefield:enabled"		VALUE = "{ l.searchsettings:name }">
	<MvASSIGN NAME = "l.searchablefield:searchtype"		VALUE = "{ l.searchsettings:name_st }">
	<MvASSIGN NAME = "l.searchablefield:relevance"		VALUE = "{ l.searchsettings:name_rel }">
	<MvASSIGN NAME = "l.searchablefield:weight"			VALUE = "{ l.searchsettings:name_wt }">
	<MvASSIGN NAME = "l.searchablefield_count"			VALUE = "{ miva_array_insert_var( l.searchablefields, l.searchablefield, -1 ) }">

	<MvASSIGN NAME = "l.searchablefield"				VALUE = "">
	<MvASSIGN NAME = "l.searchablefield:field_code"		VALUE = "sku">
	<MvASSIGN NAME = "l.searchablefield:field_name"		VALUE = "Product SKU">
	<MvASSIGN NAME = "l.searchablefield:enabled"		VALUE = "{ l.searchsettings:sku }">
	<MvASSIGN NAME = "l.searchablefield:searchtype"		VALUE = "{ l.searchsettings:sku_st }">
	<MvASSIGN NAME = "l.searchablefield:relevance"		VALUE = "{ l.searchsettings:sku_rel }">
	<MvASSIGN NAME = "l.searchablefield:weight"			VALUE = "{ l.searchsettings:sku_wt }">
	<MvASSIGN NAME = "l.searchablefield_count"			VALUE = "{ miva_array_insert_var( l.searchablefields, l.searchablefield, -1 ) }">

	<MvASSIGN NAME = "l.searchablefield"				VALUE = "">
	<MvASSIGN NAME = "l.searchablefield:field_code"		VALUE = "descrip">
	<MvASSIGN NAME = "l.searchablefield:field_name"		VALUE = "Product Description">
	<MvASSIGN NAME = "l.searchablefield:enabled"		VALUE = "{ l.searchsettings:descrip }">
	<MvASSIGN NAME = "l.searchablefield:searchtype"		VALUE = "{ l.searchsettings:desc_st }">
	<MvASSIGN NAME = "l.searchablefield:relevance"		VALUE = "{ l.searchsettings:desc_rel }">
	<MvASSIGN NAME = "l.searchablefield:weight"			VALUE = "{ l.searchsettings:desc_wt }">
	<MvASSIGN NAME = "l.searchablefield_count"			VALUE = "{ miva_array_insert_var( l.searchablefields, l.searchablefield, -1 ) }">

	<MvASSIGN NAME = "l.searchablefield"				VALUE = "">
	<MvASSIGN NAME = "l.searchablefield:field_code"		VALUE = "atr_code">
	<MvASSIGN NAME = "l.searchablefield:field_name"		VALUE = "Attribute Code">
	<MvASSIGN NAME = "l.searchablefield:enabled"		VALUE = "{ l.searchsettings:atr_code }">
	<MvASSIGN NAME = "l.searchablefield:searchtype"		VALUE = "{ l.searchsettings:acode_st }">
	<MvASSIGN NAME = "l.searchablefield:relevance"		VALUE = "{ l.searchsettings:acode_rel }">
	<MvASSIGN NAME = "l.searchablefield:weight"			VALUE = "{ l.searchsettings:acode_wt }">
	<MvASSIGN NAME = "l.searchablefield_count"			VALUE = "{ miva_array_insert_var( l.searchablefields, l.searchablefield, -1 ) }">

	<MvASSIGN NAME = "l.searchablefield"				VALUE = "">
	<MvASSIGN NAME = "l.searchablefield:field_code"		VALUE = "atr_prompt">
	<MvASSIGN NAME = "l.searchablefield:field_name"		VALUE = "Attribute Prompt">
	<MvASSIGN NAME = "l.searchablefield:enabled"		VALUE = "{ l.searchsettings:atr_prompt }">
	<MvASSIGN NAME = "l.searchablefield:searchtype"		VALUE = "{ l.searchsettings:aprom_st }">
	<MvASSIGN NAME = "l.searchablefield:relevance"		VALUE = "{ l.searchsettings:aprom_rel }">
	<MvASSIGN NAME = "l.searchablefield:weight"			VALUE = "{ l.searchsettings:aprom_wt }">
	<MvASSIGN NAME = "l.searchablefield_count"			VALUE = "{ miva_array_insert_var( l.searchablefields, l.searchablefield, -1 ) }">

	<MvASSIGN NAME = "l.searchablefield"				VALUE = "">
	<MvASSIGN NAME = "l.searchablefield:field_code"		VALUE = "opt_code">
	<MvASSIGN NAME = "l.searchablefield:field_name"		VALUE = "Option Code">
	<MvASSIGN NAME = "l.searchablefield:enabled"		VALUE = "{ l.searchsettings:opt_code }">
	<MvASSIGN NAME = "l.searchablefield:searchtype"		VALUE = "{ l.searchsettings:ocode_st }">
	<MvASSIGN NAME = "l.searchablefield:relevance"		VALUE = "{ l.searchsettings:ocode_rel }">
	<MvASSIGN NAME = "l.searchablefield:weight"			VALUE = "{ l.searchsettings:ocode_wt }">
	<MvASSIGN NAME = "l.searchablefield_count"			VALUE = "{ miva_array_insert_var( l.searchablefields, l.searchablefield, -1 ) }">

	<MvASSIGN NAME = "l.searchablefield"				VALUE = "">
	<MvASSIGN NAME = "l.searchablefield:field_code"		VALUE = "opt_prompt">
	<MvASSIGN NAME = "l.searchablefield:field_name"		VALUE = "Option Prompt">
	<MvASSIGN NAME = "l.searchablefield:enabled"		VALUE = "{ l.searchsettings:opt_prompt }">
	<MvASSIGN NAME = "l.searchablefield:searchtype"		VALUE = "{ l.searchsettings:oprom_st }">
	<MvASSIGN NAME = "l.searchablefield:relevance"		VALUE = "{ l.searchsettings:oprom_rel }">
	<MvASSIGN NAME = "l.searchablefield:weight"			VALUE = "{ l.searchsettings:oprom_wt }">
	<MvASSIGN NAME = "l.searchablefield_count"			VALUE = "{ miva_array_insert_var( l.searchablefields, l.searchablefield, -1 ) }">

	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-SEA-UTL-00018', l.searchablefield_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "SearchableField_Update_Builtin" PARAMETERS = "searchablefield var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT [ g.Feature_Filename_SEA_DB ].SearchSettings_Load_Cached( l.searchsettings ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvASSIGN NAME = "l.original_searchsettings"		VALUE = "{ l.searchsettings }">

	<MvIF EXPR = "{ l.searchablefield:field_code EQ 'code' }">
		<MvASSIGN NAME = "l.searchsettings:code"		VALUE = "{ l.searchablefield:enabled }">
		<MvASSIGN NAME = "l.searchsettings:code_st"		VALUE = "{ l.searchablefield:searchtype }">
		<MvASSIGN NAME = "l.searchsettings:code_rel"	VALUE = "{ l.searchablefield:relevance }">
		<MvASSIGN NAME = "l.searchsettings:code_wt"		VALUE = "{ l.searchablefield:weight }">
	<MvELSEIF EXPR = "{ l.searchablefield:field_code EQ 'name' }">
		<MvASSIGN NAME = "l.searchsettings:name"		VALUE = "{ l.searchablefield:enabled }">
		<MvASSIGN NAME = "l.searchsettings:name_st"		VALUE = "{ l.searchablefield:searchtype }">
		<MvASSIGN NAME = "l.searchsettings:name_rel"	VALUE = "{ l.searchablefield:relevance }">
		<MvASSIGN NAME = "l.searchsettings:name_wt"		VALUE = "{ l.searchablefield:weight }">
	<MvELSEIF EXPR = "{ l.searchablefield:field_code EQ 'sku' }">
		<MvASSIGN NAME = "l.searchsettings:sku"			VALUE = "{ l.searchablefield:enabled }">
		<MvASSIGN NAME = "l.searchsettings:sku_st"		VALUE = "{ l.searchablefield:searchtype }">
		<MvASSIGN NAME = "l.searchsettings:sku_rel"		VALUE = "{ l.searchablefield:relevance }">
		<MvASSIGN NAME = "l.searchsettings:sku_wt"		VALUE = "{ l.searchablefield:weight }">
	<MvELSEIF EXPR = "{ l.searchablefield:field_code EQ 'descrip' }">
		<MvASSIGN NAME = "l.searchsettings:descrip"		VALUE = "{ l.searchablefield:enabled }">
		<MvASSIGN NAME = "l.searchsettings:desc_st"		VALUE = "{ l.searchablefield:searchtype }">
		<MvASSIGN NAME = "l.searchsettings:desc_rel"	VALUE = "{ l.searchablefield:relevance }">
		<MvASSIGN NAME = "l.searchsettings:desc_wt"		VALUE = "{ l.searchablefield:weight }">
	<MvELSEIF EXPR = "{ l.searchablefield:field_code EQ 'atr_code' }">
		<MvASSIGN NAME = "l.searchsettings:atr_code"	VALUE = "{ l.searchablefield:enabled }">
		<MvASSIGN NAME = "l.searchsettings:acode_st"	VALUE = "{ l.searchablefield:searchtype }">
		<MvASSIGN NAME = "l.searchsettings:acode_rel"	VALUE = "{ l.searchablefield:relevance }">
		<MvASSIGN NAME = "l.searchsettings:acode_wt"	VALUE = "{ l.searchablefield:weight }">
	<MvELSEIF EXPR = "{ l.searchablefield:field_code EQ 'atr_prompt' }">
		<MvASSIGN NAME = "l.searchsettings:atr_prompt"	VALUE = "{ l.searchablefield:enabled }">
		<MvASSIGN NAME = "l.searchsettings:aprom_st"	VALUE = "{ l.searchablefield:searchtype }">
		<MvASSIGN NAME = "l.searchsettings:aprom_rel"	VALUE = "{ l.searchablefield:relevance }">
		<MvASSIGN NAME = "l.searchsettings:aprom_wt"	VALUE = "{ l.searchablefield:weight }">
	<MvELSEIF EXPR = "{ l.searchablefield:field_code EQ 'opt_code' }">
		<MvASSIGN NAME = "l.searchsettings:opt_code"	VALUE = "{ l.searchablefield:enabled }">
		<MvASSIGN NAME = "l.searchsettings:ocode_st"	VALUE = "{ l.searchablefield:searchtype }">
		<MvASSIGN NAME = "l.searchsettings:ocode_rel"	VALUE = "{ l.searchablefield:relevance }">
		<MvASSIGN NAME = "l.searchsettings:ocode_wt"	VALUE = "{ l.searchablefield:weight }">
	<MvELSEIF EXPR = "{ l.searchablefield:field_code EQ 'opt_prompt' }">
		<MvASSIGN NAME = "l.searchsettings:opt_prompt"	VALUE = "{ l.searchablefield:enabled }">
		<MvASSIGN NAME = "l.searchsettings:oprom_st"	VALUE = "{ l.searchablefield:searchtype }">
		<MvASSIGN NAME = "l.searchsettings:oprom_rel"	VALUE = "{ l.searchablefield:relevance }">
		<MvASSIGN NAME = "l.searchsettings:oprom_wt"	VALUE = "{ l.searchablefield:weight }">
	</MvIF>

	<MvIF EXPR = "{ NOT [ g.Feature_Filename_SEA_DB ].SearchSettings_Update( l.searchsettings ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvASSIGN NAME = "l.searchablecustomfield_count"	VALUE = "{ [ g.Feature_Filename_SEA_DB ].SearchableCustomFieldList_Load( l.searchablecustomfields ) }">

	<MvFUNCTIONRETURN VALUE = "{ SearchSettings_Notify_Modules( l.original_searchsettings, l.searchablecustomfields, l.searchablecustomfield_count, l.searchsettings, l.searchablecustomfields, l.searchablecustomfield_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "SearchableField_Load_CustomField" PARAMETERS = "module_id, field_code, searchablecustomfield var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT [ g.Module_Library_DB ].ModuleAndFeatures_Load_ID_Cached( l.module_id, l.module ) }">
		<MvIF EXPR = "{ NOT [ g.Module_Library_DB ].Error_Is_EOF() }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>

		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-SEA-UTL-00019', 'Module not found' ) }">
	<MvELSEIF EXPR = "{ NOT l.module:active }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-SEA-UTL-00020', 'Module \'' $ l.module:code $ '\' is deactivated' ) }">
	<MvELSEIF EXPR = "{ l.module:api_ver LT 9.07 }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-SEA-UTL-00021', 'Module \'' $ l.module:code $ '\' does not support module product field capabilities' ) }">
	<MvELSEIF EXPR = "{ NOT l.module:feature_hash:fields_prod }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-SEA-UTL-00022', 'Module \'' $ l.module:code $ '\' does not provide feature \'fields_prod\'' ) }">
	<MvELSEIF EXPR = "{ NOT [ g.Module_Library_DB ].StoreModule_Count_Module_Cached( l.module:id ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-SEA-UTL-00023', 'Module \'' $ l.module:code $ '\' is not installed in store \'' $ g.Store:code $ '\'' ) }">
	</MvIF>

	<MvASSIGN NAME = "l.module_field_count" VALUE = "{ [ g.Module_Root $ l.module:module ].Module_Product_Fields( l.module, l.module_fields ) }">

	<MvIF EXPR = "{ NOT miva_array_search( l.module_fields, 1, l.field, 'l.field:code EQ l.field_code' ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-SEA-UTL-00024' ) }">
	</MvIF>

	<MvASSIGN NAME = "l.capabilities" VALUE = "">

	<MvEVAL EXPR = "{ [ g.Module_Root $ l.module:module ].Module_Product_Field_Capabilities( l.module, l.field:code, l.capabilities ) }">

	<MvIF EXPR = "{ NOT l.capabilities:search }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-SEA-UTL-00025', 'Searchable custom field does not provide the \'search\' capability' ) }">
	</MvIF>

	<MvIF EXPR = "{ NOT [ g.Feature_Filename_SEA_DB ].SearchableCustomField_Load_FieldOrDefault( l.module:id, l.field:code, l.searchablecustomfield ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvASSIGN NAME = "l.searchablecustomfield:field_name"	VALUE = "{ l.field:name }">
	<MvASSIGN NAME = "l.searchablecustomfield:module"		VALUE = "{ l.module }">
	<MvASSIGN NAME = "l.searchablecustomfield:capabilities"	VALUE = "{ l.capabilities }">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "SearchableFieldList_Load_All_CustomFields" PARAMETERS = "searchablecustomfields var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.searchablecustomfields"						VALUE = "">
	<MvASSIGN NAME = "l.searchablecustomfield_count"				VALUE = 0>

	<MvFOREACH ITERATOR = "l.module" ARRAY = "l.modules" INDEX = "l.pos" COUNT = "{ [ g.Module_Library_DB ].StoreModuleList_Load_Features_Cached( 'fields_prod', l.modules ) }">
		<MvIF EXPR = "{ l.module:api_ver LT 9.07 }">
			<MvFOREACHCONTINUE>
		</MvIF>

		<MvASSIGN NAME = "l.module_fields"							VALUE = "">

		<MvFOREACH ITERATOR = "l.module_field" ARRAY = "l.module_fields" COUNT = "{ [ g.Module_Root $ l.module:module ].Module_Product_Fields( l.module, l.module_fields ) }">
			<MvASSIGN NAME = "l.capabilities"						VALUE = "">

			<MvEVAL EXPR = "{ [ g.Module_Root $ l.module:module ].Module_Product_Field_Capabilities( l.module, l.module_field:code, l.capabilities ) }">

			<MvIF EXPR = "{ NOT l.capabilities:search }">
				<MvFOREACHCONTINUE>
			</MvIF>

			<MvASSIGN NAME = "l.searchablecustomfield"				VALUE = "">

			<MvIF EXPR = "{ NOT [ g.Feature_Filename_SEA_DB ].SearchableCustomField_Load_FieldOrDefault( l.module:id, l.module_field:code, l.searchablecustomfield ) }">
				<MvFUNCTIONRETURN VALUE = 0>
			</MvIF>

			<MvASSIGN NAME = "l.searchablecustomfield:field_name"	VALUE = "{ l.module_field:name }">
			<MvASSIGN NAME = "l.searchablecustomfield:module"		VALUE = "{ l.module }">
			<MvASSIGN NAME = "l.searchablecustomfield:capabilities"	VALUE = "{ l.capabilities }">

			<MvASSIGN NAME = "l.searchablecustomfield_count"		VALUE = "{ miva_array_insert_var( l.searchablecustomfields, l.searchablecustomfield, -1 ) }">
		</MvFOREACH>
	</MvFOREACH>

	<MvEVAL EXPR = "{ [ g.Module_Library_Utilities ].SortCustomFieldList( l.searchablecustomfields ) }">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-SEA-UTL-00026', l.searchablecustomfield_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "SearchableField_Update_CustomField" PARAMETERS = "searchablecustomfield var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT [ g.Feature_Filename_SEA_DB ].SearchSettings_Load_Cached( l.searchsettings ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvASSIGN NAME = "l.original_searchablecustomfield_count" VALUE = "{ [ g.Module_Feature_SEA_DB ].SearchableCustomFieldList_Load( l.original_searchablecustomfields ) }">

	<MvIF EXPR = "{ [ g.Feature_Filename_SEA_DB ].SearchableCustomFields_Equal_Default( l.searchablecustomfield ) }">
		<MvIF EXPR = "{ NOT [ g.Feature_Filename_SEA_DB ].SearchableCustomField_Delete_Field( l.searchablecustomfield:module_id, l.searchablecustomfield:field_code ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>

		<MvEVAL EXPR = "{ [ g.Module_Admin ].Admin_Log_Action( 'MER-SEA-UTL-00027', 'Searchable custom field \'' $ l.searchablecustomfield:field_code $ '\' for module \'' $ l.searchablecustomfield:module:code $ '\' deleted' ) }">
	<MvELSE>
		<MvIF EXPR = "{ [ g.Feature_Filename_SEA_DB ].SearchableCustomField_Insert( l.searchablecustomfield ) }">
			<MvEVAL EXPR = "{ [ g.Module_Admin ].Admin_Log_Action( 'MER-SEA-UTL-00028', 'Searchable custom field \'' $ l.searchablecustomfield:field_code $ '\' for module \'' $ l.searchablecustomfield:module:code $ '\' inserted' ) }">
		<MvELSE>
			<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_Error_IsIndexDuplicate( g.Error_Message ) }">				<MvFUNCTIONRETURN VALUE = 0>
			<MvELSEIF EXPR = "{ NOT [ g.Feature_Filename_SEA_DB ].SearchableCustomField_Update( l.searchablecustomfield ) }">	<MvFUNCTIONRETURN VALUE = 0>
			<MvELSE>
				<MvEVAL EXPR = "{ [ g.Module_Admin ].Admin_Log_Action( 'MER-SEA-UTL-00029', 'Searchable custom field \'' $ l.searchablecustomfield:field_code $ '\' for module \'' $ l.searchablecustomfield:module:code $ '\' updated' ) }">
			</MvIF>
		</MvIF>
	</MvIF>

	<MvASSIGN NAME = "l.searchablecustomfield_count" VALUE = "{ [ g.Module_Feature_SEA_DB ].SearchableCustomFieldList_Load( l.searchablecustomfields ) }">

	<MvFUNCTIONRETURN VALUE = "{ SearchSettings_Notify_Modules( l.searchsettings, l.original_searchablecustomfields, l.original_searchablecustomfield_count, l.searchsettings, l.searchablecustomfields, l.searchablecustomfield_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ProductCustomFieldList_Load_Searchable" PARAMETERS = "customfields var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.customfields"				VALUE = "">
	<MvASSIGN NAME = "l.customfield_count"			VALUE = 0>

	<MvFOREACH ITERATOR = "l.module" ARRAY = "l.modules" INDEX = "l.pos" COUNT = "{ [ g.Module_Library_DB ].StoreModuleList_Load_Features_Cached( 'fields_prod', l.modules ) }">
		<MvASSIGN NAME = "l.module_fields"			VALUE = "">

		<MvFOREACH ITERATOR = "l.module_field" ARRAY = "l.module_fields" COUNT = "{ [ g.Module_Root $ l.module:module ].Module_Product_Fields( l.module, l.module_fields ) }">
			<MvASSIGN NAME = "l.capabilities"		VALUE = "">

			<MvIF EXPR = "{ l.module:api_ver LT 9.07 }">
				<MvFOREACHCONTINUE>
			</MvIF>

			<MvEVAL EXPR = "{ [ g.Module_Root $ l.module:module ].Module_Product_Field_Capabilities( l.module, l.module_field:code, l.capabilities ) }">

			<MvIF EXPR = "{ NOT l.capabilities:search }">
				<MvFOREACHCONTINUE>
			</MvIF>

			<MvREFERENCEARRAY NAME = "l.customfield" VARIABLE = "l.customfields">
				<MvDIMENSION INDEX = "{ ++l.customfield_count }">
			</MvREFERENCEARRAY>

			<MvREFERENCEARRAY NAME = "l.customfield:module" VARIABLE = "l.modules">
				<MvDIMENSION INDEX = "{ l.pos }">
			</MvREFERENCEARRAY>

			<MvASSIGN NAME = "l.customfield:code"	VALUE = "{ l.module_field:code }">
			<MvASSIGN NAME = "l.customfield:name"	VALUE = "{ l.module_field:name }">
		</MvFOREACH>
	</MvFOREACH>

	<MvEVAL EXPR = "{ [ g.Module_Library_Utilities ].SortCustomFieldList( l.customfields ) }">
	<MvFUNCTIONRETURN VALUE = "{ l.customfield_count }">
</MvFUNCTION>

<MvFUNCTION NAME = "SearchableCustomFieldList_Load_With_Capabilities_Cached" PARAMETERS = "searchablecustomfields var" STANDARDOUTPUTLEVEL = "">
	<MvREFERENCE NAME = "l.cache" VARIABLE = "g.Session:cache:SEA:searchablecustomfields">

	<MvIF EXPR = "{ ISNULL l.cache }">
		<MvASSIGN NAME = "l.cache:result"				VALUE = "{ SearchableCustomFieldList_Load_With_Capabilities( l.cache:searchablecustomfields ) }">

		<MvIF EXPR = "{ NOT l.cache:result }">
			<MvASSIGN NAME = "l.cache:error_code"		VALUE = "{ g.Error_Code }">
			<MvASSIGN NAME = "l.cache:error_message"	VALUE = "{ g.Error_Message }">
			<MvASSIGN NAME = "l.cache:error_db_eof"		VALUE = "{ g.Error_DB_EOF }">
		</MvIF>
	</MvIF>

	<MvIF EXPR = "{ NOT l.cache:result }">
		<MvIF EXPR = "{ NOT l.cache:error_db_eof }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( l.cache:error_code, l.cache:error_message ) }">
		</MvIF>

		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( l.cache:error_code ) }">
	</MvIF>

	<MvASSIGN NAME = "l.searchablecustomfields"			VALUE = "{ l.cache:searchablecustomfields }">

	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( l.cache:error_code, l.cache:result ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "SearchableCustomFieldList_Load_With_Capabilities" PARAMETERS = "searchablecustomfields var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.searchablecustomfields"					VALUE = "">
	<MvASSIGN NAME = "l.searchablecustomfield_count"			VALUE = 0>

	<MvFOREACH ITERATOR = "l.loaded_searchablecustomfield" ARRAY = "l.loaded_searchablecustomfields" COUNT = "{ [ g.Feature_Filename_SEA_DB ].SearchableCustomFieldList_Load( l.loaded_searchablecustomfields ) }">
		<MvIF EXPR = "{ NOT [ g.Module_Library_DB ].Module_Load_ID_Cached( l.loaded_searchablecustomfield:module_id, l.loaded_searchablecustomfield:module ) OR l.loaded_searchablecustomfield:module:api_ver LT 9.07 }">
			<MvFOREACHCONTINUE>
		</MvIF>

		<MvEVAL EXPR = "{ [ g.Module_Root $ l.loaded_searchablecustomfield:module:module ].Module_Product_Field_Capabilities( l.loaded_searchablecustomfield:module, l.loaded_searchablecustomfield:field_code, l.loaded_searchablecustomfield:capabilities ) }">

		<MvIF EXPR = "{ l.loaded_searchablecustomfield:capabilities:search }">
			<MvASSIGN NAME = "l.searchablecustomfield_count"	VALUE = "{ miva_array_insert_ref( l.searchablecustomfields, l.loaded_searchablecustomfield, -1 ) }">
		</MvIF>
	</MvFOREACH>

	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-SEA-UTL-00016', l.searchablecustomfield_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "SearchSettings_Notify_Modules" PARAMETERS = "original_searchsettings var, original_searchablecustomfields var, original_searchablecustomfield_count, searchsettings var, searchablecustomfields var, searchablecustomfield_count" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.original_searchablecustomfield_count NE l.searchablecustomfield_count }">												<MvASSIGN NAME = "l.notify" VALUE = 1>
	<MvELSEIF EXPR = "{ miva_array_serialize( l.original_searchsettings ) NE miva_array_serialize( l.searchsettings ) }">					<MvASSIGN NAME = "l.notify" VALUE = 1>
	<MvELSEIF EXPR = "{ miva_array_serialize( l.original_searchablecustomfields ) NE miva_array_serialize( l.searchablecustomfields ) }">	<MvASSIGN NAME = "l.notify" VALUE = 1>
	<MvELSE>																																<MvASSIGN NAME = "l.notify" VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ l.notify }">
		<MvFOREACH ITERATOR = "l.module" ARRAY = "l.modules" COUNT = "{ [ g.Module_Library_DB ].StoreModuleList_Load_Features_Cached( 'not_search', l.modules ) }">
			<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Root $ l.module:module ].Module_Notify_SearchSettings( l.module, l.original_searchsettings, l.original_searchablecustomfields, l.original_searchablecustomfield_count, l.searchsettings, l.searchablecustomfields, l.searchablecustomfield_count ) }">
		</MvFOREACH>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "SearchLogEntry_Process_Runtime_Search" PARAMETERS = "search, total_count, origin, index_id" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT [ g.Feature_Filename_SEA_DB ].SearchSettings_Load_Cached( l.searchsettings ) }">
		<MvEVAL EXPR = "{ [ g.Feature_Filename_SEA_DB ].SearchSettings_Default( l.searchsettings ) }">
	</MvIF>

	<MvFOREACH ITERATOR = "l.excluded_useragent" ARRAY = "l.excluded_useragents" COUNT = "{ miva_splitstring( l.searchsettings:logexua, asciichar( 10 ), l.excluded_useragents, 'trim,noempty' ) }">
		<MvIF EXPR = "{ l.excluded_useragent CIN s.http_user_agent }">
			<MvFUNCTIONRETURN VALUE = 1>
		</MvIF>
	</MvFOREACH>

	<MvREFERENCEARRAY NAME = "l.cookie" VARIABLE = "g.Request_Cookies">
		<MvMEMBER NAME = "{ 'mm5-' $ [ g.Module_Library_Utilities ].AlphaNumericOnly( g.Store:code ) $ '-search-session' }">
	</MvREFERENCEARRAY>

	<MvIF EXPR = "{ NOT ISNULL l.cookie }">
		<MvASSIGN NAME = "l.srchses_id" VALUE = "{ l.cookie }">
	<MvELSE>
		<MvASSIGN NAME = "l.srchses_id" VALUE = "{ MakeSessionID() }">

		<MvIF EXPR = "{ g.Domain:mmcexp }">	<MvASSIGN NAME = "l.expires" VALUE = "{ s.dyn_time_t + ( g.Domain:mmcexp * 60 ) }">
		<MvELSE>							<MvASSIGN NAME = "l.expires" VALUE = "">
		</MvIF>

		<MvEVAL EXPR = "{ [ g.Module_Library_Utilities ].v10_SetCookie( g.Output_Cookies, 'mm5-' $ [ g.Module_Library_Utilities ].AlphaNumericOnly( g.Store:code ) $ '-search-session', l.srchses_id, g.cookiedomain, l.expires, g.cookiepath, 0, g.Domain:mmc_site ) }">

		<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Library_Utilities ].OutputCookies( g.Output_Cookies ) }">
	</MvIF>

	<MvASSIGN NAME = "l.searchlogentry" 			VALUE = "">
	<MvASSIGN NAME = "l.searchlogentry:srchses_id"	VALUE = "{ l.srchses_id }">
	<MvASSIGN NAME = "l.searchlogentry:cust_id"		VALUE = "{ g.Basket:cust_id }">
	<MvASSIGN NAME = "l.searchlogentry:order_id"	VALUE = "{ g.Basket:order_id }">
	<MvASSIGN NAME = "l.searchlogentry:dtstamp"		VALUE = "{ s.dyn_time_t }">
	<MvASSIGN NAME = "l.searchlogentry:ip"			VALUE = "{ s.remote_addr }">
	<MvASSIGN NAME = "l.searchlogentry:useragent"	VALUE = "{ substring_var( s.http_user_agent, 1, 254 ) }">
	<MvASSIGN NAME = "l.searchlogentry:search"		VALUE = "{ substring_var( l.search, 1, 254 ) }">
	<MvASSIGN NAME = "l.searchlogentry:prodcount"	VALUE = "{ l.total_count }">
	<MvASSIGN NAME = "l.searchlogentry:origin"		VALUE = "{ substring_var( l.origin, 1, 100 ) }">
	<MvASSIGN NAME = "l.searchlogentry:index_id"	VALUE = "{ l.index_id }">

	<MvFUNCTIONRETURN VALUE = "{ [ g.Feature_Filename_SEA_DB ].SearchLogEntry_Insert( l.searchlogentry ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "SearchLogEntry_Process_Customer_Login" PARAMETERS = "cust_id" STANDARDOUTPUTLEVEL = "">
	<MvREFERENCEARRAY NAME = "l.cookie" VARIABLE = "g.Request_Cookies">
		<MvMEMBER NAME = "{ 'mm5-' $ [ g.Module_Library_Utilities ].AlphaNumericOnly( g.Store:code ) $ '-search-session' }">
	</MvREFERENCEARRAY>

	<MvIF EXPR = "{ ISNULL l.cookie }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = "{ [ g.Feature_Filename_SEA_DB ].SearchLogEntry_Update_SearchSession_Customer( l.cookie, l.cust_id ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "SearchLogEntry_Process_Order" PARAMETERS = "order var" STANDARDOUTPUTLEVEL = "">
	<MvREFERENCEARRAY NAME = "l.cookie" VARIABLE = "g.Request_Cookies">
		<MvMEMBER NAME = "{ 'mm5-' $ [ g.Module_Library_Utilities ].AlphaNumericOnly( g.Store:code ) $ '-search-session' }">
	</MvREFERENCEARRAY>

	<MvIF EXPR = "{ ISNULL l.cookie }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ NOT [ g.Feature_Filename_SEA_DB ].SearchLogEntry_Update_SearchSession_Order( l.cookie, l.order:id ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvEVAL EXPR = "{ [ g.Module_Library_Utilities ].ClearCookie( g.Output_Cookies, 'mm5-' $ [ g.Module_Library_Utilities ].AlphaNumericOnly( g.Store:code ) $ '-search-session', g.cookiedomain, g.cookiepath, 0 ) }">

	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].OutputCookies( g.Output_Cookies ) }">
</MvFUNCTION>

<MvCOMMENT>
|
| FULLTEXT Index
|
</MvCOMMENT>

<MvFUNCTION NAME = "Search_Update_FULLTEXT_Indexes" PARAMETERS = "original_searchsettings var, searchsettings var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_FULLTEXT_Supported() }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.result"	VALUE = 1>

	<MvLOCKFILE FILE = "{ g.MerchantPath $ 'search_update_fulltext_indexes_' $ int( g.Store:id ) }">
		<MvIF EXPR = "{ l.result }"> <MvASSIGN NAME = "l.result" VALUE = "{ Search_Update_FULLTEXT_Indexes_Products( l.original_searchsettings, l.searchsettings ) }">		</MvIF>
		<MvIF EXPR = "{ l.result }"> <MvASSIGN NAME = "l.result" VALUE = "{ Search_Update_FULLTEXT_Indexes_Attributes( l.original_searchsettings, l.searchsettings ) }">	</MvIF>
		<MvIF EXPR = "{ l.result }"> <MvASSIGN NAME = "l.result" VALUE = "{ Search_Update_FULLTEXT_Indexes_Options( l.original_searchsettings, l.searchsettings ) }">		</MvIF>
	</MvLOCKFILE>

	<MvFUNCTIONRETURN VALUE = "{ l.result }">
</MvFUNCTION>

<MvFUNCTION NAME = "Search_Update_FULLTEXT_Indexes_Products" PARAMETERS = "original_searchsettings var, searchsettings var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.orig_prod"			VALUE = "">
	<MvASSIGN NAME = "l.orig_prod:code"		VALUE = "{ l.original_searchsettings:code_rel OR ( l.original_searchsettings:code_st EQ 'fulltext' ) }">
	<MvASSIGN NAME = "l.orig_prod:name"		VALUE = "{ l.original_searchsettings:name_rel OR ( l.original_searchsettings:name_st EQ 'fulltext' ) }">
	<MvASSIGN NAME = "l.orig_prod:sku"		VALUE = "{ l.original_searchsettings:sku_rel OR ( l.original_searchsettings:sku_st EQ 'fulltext' ) }">
	<MvASSIGN NAME = "l.orig_prod:descrip"	VALUE = "{ l.original_searchsettings:desc_rel OR ( l.original_searchsettings:desc_st EQ 'fulltext' ) }">

	<MvASSIGN NAME = "l.prod"				VALUE = "">
	<MvASSIGN NAME = "l.prod:code"			VALUE = "{ l.searchsettings:code_rel OR ( l.searchsettings:code_st EQ 'fulltext' ) }">
	<MvASSIGN NAME = "l.prod:name"			VALUE = "{ l.searchsettings:name_rel OR ( l.searchsettings:name_st EQ 'fulltext' ) }">
	<MvASSIGN NAME = "l.prod:sku"			VALUE = "{ l.searchsettings:sku_rel OR ( l.searchsettings:sku_st EQ 'fulltext' ) }">
	<MvASSIGN NAME = "l.prod:descrip"		VALUE = "{ l.searchsettings:desc_rel OR ( l.searchsettings:desc_st EQ 'fulltext' ) }">

	<MvIF EXPR = "{ miva_array_serialize( l.orig_prod ) EQ miva_array_serialize( l.prod ) }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = "{ Search_Generate_FULLTEXT_Indexes_Products( l.prod ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Search_Update_FULLTEXT_Indexes_Attributes" PARAMETERS = "original_searchsettings var, searchsettings var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.orig_attr"				VALUE = "">
	<MvASSIGN NAME = "l.orig_attr:atr_code"		VALUE = "{ l.original_searchsettings:acode_rel OR ( l.original_searchsettings:acode_st EQ 'fulltext' ) }">
	<MvASSIGN NAME = "l.orig_attr:atr_prompt"	VALUE = "{ l.original_searchsettings:aprom_rel OR ( l.original_searchsettings:aprom_st EQ 'fulltext' ) }">

	<MvASSIGN NAME = "l.attr"					VALUE = "">
	<MvASSIGN NAME = "l.attr:atr_code"			VALUE = "{ l.searchsettings:acode_rel OR ( l.searchsettings:acode_st EQ 'fulltext' ) }">
	<MvASSIGN NAME = "l.attr:atr_prompt"		VALUE = "{ l.searchsettings:aprom_rel OR ( l.searchsettings:aprom_st EQ 'fulltext' ) }">

	<MvIF EXPR = "{ miva_array_serialize( l.orig_attr ) EQ miva_array_serialize( l.attr ) }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = "{ Search_Generate_FULLTEXT_Indexes_Attributes( l.attr ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Search_Update_FULLTEXT_Indexes_Options" PARAMETERS = "original_searchsettings var, searchsettings var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.orig_opt"				VALUE = "">
	<MvASSIGN NAME = "l.orig_opt:opt_code"		VALUE = "{ l.original_searchsettings:ocode_rel OR ( l.original_searchsettings:ocode_st EQ 'fulltext' ) }">
	<MvASSIGN NAME = "l.orig_opt:opt_prompt"	VALUE = "{ l.original_searchsettings:oprom_rel OR ( l.original_searchsettings:oprom_st EQ 'fulltext' ) }">

	<MvASSIGN NAME = "l.opt"					VALUE = "">
	<MvASSIGN NAME = "l.opt:opt_code"			VALUE = "{ l.searchsettings:ocode_rel OR ( l.searchsettings:ocode_st EQ 'fulltext' ) }">
	<MvASSIGN NAME = "l.opt:opt_prompt"			VALUE = "{ l.searchsettings:oprom_rel OR ( l.searchsettings:oprom_st EQ 'fulltext' ) }">

	<MvIF EXPR = "{ miva_array_serialize( l.orig_opt ) EQ miva_array_serialize( l.opt ) }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = "{ Search_Generate_FULLTEXT_Indexes_Options( l.opt ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Search_Generate_FULLTEXT_Indexes_Products" PARAMETERS = "indexes var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_Index_Exists( g.Store_Table_Prefix $ 'Products', g.Store_Table_Prefix $ 'Products_FT_code', l.code_ft_exists ) }">			<MvFUNCTIONRETURN VALUE = 0> </MvIF>
	<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_Index_Exists( g.Store_Table_Prefix $ 'Products', g.Store_Table_Prefix $ 'Products_FT_name', l.name_ft_exists ) }">			<MvFUNCTIONRETURN VALUE = 0> </MvIF>
	<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_Index_Exists( g.Store_Table_Prefix $ 'Products', g.Store_Table_Prefix $ 'Products_FT_sku', l.sku_ft_exists ) }">			<MvFUNCTIONRETURN VALUE = 0> </MvIF>
	<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_Index_Exists( g.Store_Table_Prefix $ 'Products', g.Store_Table_Prefix $ 'Products_FT_descrip', l.descrip_ft_exists ) }">	<MvFUNCTIONRETURN VALUE = 0> </MvIF>

	<MvIF EXPR = "{ l.indexes:code AND ( NOT l.code_ft_exists ) }">
		<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_Create_FULLTEXT_Index( g.Store_Table_Prefix $ 'Products', g.Store_Table_Prefix $ 'Products_FT_code', 'code' ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	<MvELSEIF EXPR = "{ ( NOT l.indexes:code ) AND ( l.code_ft_exists ) }">
		<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_Drop_Index( g.Store_Table_Prefix $ 'Products', g.Store_Table_Prefix $ 'Products_FT_code' ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	</MvIF>

	<MvIF EXPR = "{ l.indexes:name AND ( NOT l.name_ft_exists ) }">
		<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_Create_FULLTEXT_Index( g.Store_Table_Prefix $ 'Products', g.Store_Table_Prefix $ 'Products_FT_name', 'name' ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	<MvELSEIF EXPR = "{ ( NOT l.indexes:name ) AND ( l.name_ft_exists ) }">
		<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_Drop_Index( g.Store_Table_Prefix $ 'Products', g.Store_Table_Prefix $ 'Products_FT_name' ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	</MvIF>

	<MvIF EXPR = "{ l.indexes:sku AND ( NOT l.sku_ft_exists ) }">
		<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_Create_FULLTEXT_Index( g.Store_Table_Prefix $ 'Products', g.Store_Table_Prefix $ 'Products_FT_sku', 'sku' ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	<MvELSEIF EXPR = "{ ( NOT l.indexes:sku ) AND ( l.sku_ft_exists ) }">
		<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_Drop_Index( g.Store_Table_Prefix $ 'Products', g.Store_Table_Prefix $ 'Products_FT_sku' ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	</MvIF>

	<MvIF EXPR = "{ l.indexes:descrip AND ( NOT l.descrip_ft_exists ) }">
		<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_Create_FULLTEXT_Index( g.Store_Table_Prefix $ 'Products', g.Store_Table_Prefix $ 'Products_FT_descrip', 'descrip' ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	<MvELSEIF EXPR = "{ ( NOT l.indexes:descrip ) AND ( l.descrip_ft_exists ) }">
		<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_Drop_Index( g.Store_Table_Prefix $ 'Products', g.Store_Table_Prefix $ 'Products_FT_descrip' ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Search_Generate_FULLTEXT_Indexes_Attributes" PARAMETERS = "indexes var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_Index_Exists( g.Store_Table_Prefix $ 'Attributes', g.Store_Table_Prefix $ 'Attributes_FT_code', l.atr_code_ft_exists ) }">									<MvFUNCTIONRETURN VALUE = 0> </MvIF>
	<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_Index_Exists( g.Store_Table_Prefix $ 'AttributeTemplateAttrs', g.Store_Table_Prefix $ 'AttributeTemplateAttrs_FT_code', l.attatr_code_ft_exists ) }">		<MvFUNCTIONRETURN VALUE = 0> </MvIF>
	<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_Index_Exists( g.Store_Table_Prefix $ 'Attributes', g.Store_Table_Prefix $ 'Attributes_FT_prompt', l.atr_prompt_ft_exists ) }">								<MvFUNCTIONRETURN VALUE = 0> </MvIF>
	<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_Index_Exists( g.Store_Table_Prefix $ 'AttributeTemplateAttrs', g.Store_Table_Prefix $ 'AttributeTemplateAttrs_FT_prompt', l.attatr_prompt_ft_exists ) }">	<MvFUNCTIONRETURN VALUE = 0> </MvIF>

	<MvIF EXPR = "{ l.indexes:atr_code }">
		<MvIF EXPR = "{ NOT l.atr_code_ft_exists }">
			<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_Create_FULLTEXT_Index( g.Store_Table_Prefix $ 'Attributes', g.Store_Table_Prefix $ 'Attributes_FT_code', 'code' ) }">
				<MvFUNCTIONRETURN VALUE = 0>
			</MvIF>
		</MvIF>

		<MvIF EXPR = "{ NOT l.attatr_code_ft_exists }">
			<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_Create_FULLTEXT_Index( g.Store_Table_Prefix $ 'AttributeTemplateAttrs', g.Store_Table_Prefix $ 'AttributeTemplateAttrs_FT_code', 'code' ) }">
				<MvFUNCTIONRETURN VALUE = 0>
			</MvIF>
		</MvIF>
	<MvELSE>
		<MvIF EXPR = "{ l.atr_code_ft_exists }">
			<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_Drop_Index( g.Store_Table_Prefix $ 'Attributes', g.Store_Table_Prefix $ 'Attributes_FT_code' ) }">
				<MvFUNCTIONRETURN VALUE = 0>
			</MvIF>
		</MvIF>

		<MvIF EXPR = "{ l.attatr_code_ft_exists }">
			<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_Drop_Index( g.Store_Table_Prefix $ 'AttributeTemplateAttrs', g.Store_Table_Prefix $ 'AttributeTemplateAttrs_FT_code' ) }">
				<MvFUNCTIONRETURN VALUE = 0>
			</MvIF>
		</MvIF>
	</MvIF>

	<MvIF EXPR = "{ l.indexes:atr_prompt }">
		<MvIF EXPR = "{ NOT l.atr_prompt_ft_exists }">
			<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_Create_FULLTEXT_Index( g.Store_Table_Prefix $ 'Attributes', g.Store_Table_Prefix $ 'Attributes_FT_prompt', 'prompt' ) }">
				<MvFUNCTIONRETURN VALUE = 0>
			</MvIF>
		</MvIF>

		<MvIF EXPR = "{ NOT l.attatr_prompt_ft_exists }">
			<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_Create_FULLTEXT_Index( g.Store_Table_Prefix $ 'AttributeTemplateAttrs', g.Store_Table_Prefix $ 'AttributeTemplateAttrs_FT_prompt', 'prompt' ) }">
				<MvFUNCTIONRETURN VALUE = 0>
			</MvIF>
		</MvIF>
	<MvELSE>
		<MvIF EXPR = "{ l.atr_prompt_ft_exists }">
			<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_Drop_Index( g.Store_Table_Prefix $ 'Attributes', g.Store_Table_Prefix $ 'Attributes_FT_prompt' ) }">
				<MvFUNCTIONRETURN VALUE = 0>
			</MvIF>
		</MvIF>

		<MvIF EXPR = "{ l.attatr_prompt_ft_exists }">
			<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_Drop_Index( g.Store_Table_Prefix $ 'AttributeTemplateAttrs', g.Store_Table_Prefix $ 'AttributeTemplateAttrs_FT_prompt' ) }">
				<MvFUNCTIONRETURN VALUE = 0>
			</MvIF>
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Search_Generate_FULLTEXT_Indexes_Options" PARAMETERS = "indexes var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_Index_Exists( g.Store_Table_Prefix $ 'Options', g.Store_Table_Prefix $ 'Options_FT_code', l.opt_code_ft_exists ) }">											<MvFUNCTIONRETURN VALUE = 0> </MvIF>
	<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_Index_Exists( g.Store_Table_Prefix $ 'AttributeTemplateOptions', g.Store_Table_Prefix $ 'AttributeTemplateOptions_FT_code', l.attopt_code_ft_exists ) }">		<MvFUNCTIONRETURN VALUE = 0> </MvIF>
	<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_Index_Exists( g.Store_Table_Prefix $ 'Options', g.Store_Table_Prefix $ 'Options_FT_prompt', l.opt_prompt_ft_exists ) }">										<MvFUNCTIONRETURN VALUE = 0> </MvIF>
	<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_Index_Exists( g.Store_Table_Prefix $ 'AttributeTemplateOptions', g.Store_Table_Prefix $ 'AttributeTemplateOptions_FT_prompt', l.attopt_prompt_ft_exists ) }">	<MvFUNCTIONRETURN VALUE = 0> </MvIF>

	<MvIF EXPR = "{ l.indexes:opt_code }">
		<MvIF EXPR = "{ NOT l.opt_code_ft_exists }">
			<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_Create_FULLTEXT_Index( g.Store_Table_Prefix $ 'Options', g.Store_Table_Prefix $ 'Options_FT_code', 'code' ) }">
				<MvFUNCTIONRETURN VALUE = 0>
			</MvIF>
		</MvIF>

		<MvIF EXPR = "{ NOT l.attopt_code_ft_exists }">
			<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_Create_FULLTEXT_Index( g.Store_Table_Prefix $ 'AttributeTemplateOptions', g.Store_Table_Prefix $ 'AttributeTemplateOptions_FT_code', 'code' ) }">
				<MvFUNCTIONRETURN VALUE = 0>
			</MvIF>
		</MvIF>
	<MvELSE>
		<MvIF EXPR = "{ l.opt_code_ft_exists }">
			<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_Drop_Index( g.Store_Table_Prefix $ 'Options', g.Store_Table_Prefix $ 'Options_FT_code' ) }">
				<MvFUNCTIONRETURN VALUE = 0>
			</MvIF>
		</MvIF>

		<MvIF EXPR = "{ l.attopt_code_ft_exists }">
			<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_Drop_Index( g.Store_Table_Prefix $ 'AttributeTemplateOptions', g.Store_Table_Prefix $ 'AttributeTemplateOptions_FT_code' ) }">
				<MvFUNCTIONRETURN VALUE = 0>
			</MvIF>
		</MvIF>
	</MvIF>

	<MvIF EXPR = "{ l.indexes:opt_prompt }">
		<MvIF EXPR = "{ NOT l.opt_prompt_ft_exists }">
			<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_Create_FULLTEXT_Index( g.Store_Table_Prefix $ 'Options', g.Store_Table_Prefix $ 'Options_FT_prompt', 'prompt' ) }">
				<MvFUNCTIONRETURN VALUE = 0>
			</MvIF>
		</MvIF>

		<MvIF EXPR = "{ NOT l.attopt_prompt_ft_exists }">
			<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_Create_FULLTEXT_Index( g.Store_Table_Prefix $ 'AttributeTemplateOptions', g.Store_Table_Prefix $ 'AttributeTemplateOptions_FT_prompt', 'prompt' ) }">
				<MvFUNCTIONRETURN VALUE = 0>
			</MvIF>
		</MvIF>
	<MvELSE>
		<MvIF EXPR = "{ l.opt_prompt_ft_exists }">
			<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_Drop_Index( g.Store_Table_Prefix $ 'Options', g.Store_Table_Prefix $ 'Options_FT_prompt' ) }">
				<MvFUNCTIONRETURN VALUE = 0>
			</MvIF>
		</MvIF>

		<MvIF EXPR = "{ l.attopt_prompt_ft_exists }">
			<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_Drop_Index( g.Store_Table_Prefix $ 'AttributeTemplateOptions', g.Store_Table_Prefix $ 'AttributeTemplateOptions_FT_prompt' ) }">
				<MvFUNCTIONRETURN VALUE = 0>
			</MvIF>
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>