<MIVA STANDARDOUTPUTLEVEL = "">

<MvCOMMENT>
|
| Miva Merchant
|
| This file and the source codes contained herein are the property of
| Miva, Inc.  Use of this file is restricted to the specific terms and
| conditions in the License Agreement associated with this file.  Distribution
| of this file or portions of this file for uses not covered by the License
| Agreement is not allowed without a written agreement signed by an officer of
| Miva, Inc.
|
| Copyright 1998-2025 Miva, Inc.  All rights reserved.
| http://www.miva.com
|
| Prefix         : MER-PGR-DTB-
| Next Error Code: 465
|
</MvCOMMENT>

<MvFUNCTION NAME = "PGR_Store_Create" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvCOMMENT>
	|
	| sNN_PriceGroups
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $  g.Store_Table_Prefix $ 'PriceGroups
						  (
							id				' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()			$ ',
							name			' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 100 )		$ ',
							custscope		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 1 )			$ ',
							rate			' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 1 )			$ ',
							discount		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_NUMBER( 10, 2 )	$ ',
							markup			' $ [ g.Module_Library_Native_DBAPI ].DB_Type_NUMBER( 10, 2 )	$ ',
							module_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()			$ ',
							exclusion		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()			$ ',
							config			' $ [ g.Module_Library_Native_DBAPI ].DB_Type_MEMO()			$ ',	
							descrip			' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 254 )		$ ',
							display			' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()			$ ',
							dt_start		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()			$ ',
							dt_end			' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()			$ ',
							qmn_subtot		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_NUMBER( 10, 2 )	$ ',
							qmx_subtot		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_NUMBER( 10, 2 )	$ ',
							qmn_quan		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()			$ ',
							qmx_quan		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()			$ ',
							qmn_weight		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_NUMBER( 10, 2 )	$ ',
							qmx_weight		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_NUMBER( 10, 2 )	$ ',
							bmn_subtot		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_NUMBER( 10, 2 )	$ ',
							bmx_subtot		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_NUMBER( 10, 2 )	$ ',
							bmn_quan		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()			$ ',
							bmx_quan		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()			$ ',
							bmn_weight		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_NUMBER( 10, 2 )	$ ',
							bmx_weight		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_NUMBER( 10, 2 )	$ ',
							priority		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()			$ ',
							baskexc			' $ [ g.Module_Library_Native_DBAPI ].DB_Type_MEMO()			$ ',
							itemexc			' $ [ g.Module_Library_Native_DBAPI ].DB_Type_MEMO()			$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00001', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'PriceGroups_1 ON ' $ g.Store_Table_Prefix $ 'PriceGroups ( id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00002', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'PriceGroups_2 ON ' $ g.Store_Table_Prefix $ 'PriceGroups ( name )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00003', g.MvQUERY_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ NOT [ g.Module_Library_DB ].StoreKey_Insert( 'PriceGroups', 1 ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_PriceGroupExclusions
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'PriceGroupExclusions
						  (
							pgrp_id1	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ ',
							pgrp_id2	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ ',
							scope		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 1 )	$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00037', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'PriceGroupExclusions_1 ON ' $ g.Store_Table_Prefix $ 'PriceGroupExclusions ( pgrp_id1, pgrp_id2 )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00038', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'PriceGroupExclusions_2 ON ' $ g.Store_Table_Prefix $ 'PriceGroupExclusions ( pgrp_id2 )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00039', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_PriceGroupXCustomer
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $  g.Store_Table_Prefix $ 'PriceGroupXCustomer
						  (
							pgrp_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							cust_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00007', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'PriceGroupXCustomer_1 ON ' $ g.Store_Table_Prefix $ 'PriceGroupXCustomer ( pgrp_id, cust_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00008', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'PriceGroupXCustomer_2 ON ' $ g.Store_Table_Prefix $ 'PriceGroupXCustomer ( cust_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00009', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_PriceGroupXProduct
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'PriceGroupXProduct
						  (
							pgrp_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ ',
							product_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ ',
							automatic	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL() 	$ ',
							colcount	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00004', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'PriceGroupXProduct_1 ON ' $ g.Store_Table_Prefix $ 'PriceGroupXProduct ( pgrp_id, product_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00005', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'PriceGroupXProduct_2 ON ' $ g.Store_Table_Prefix $ 'PriceGroupXProduct ( product_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00006', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'PriceGroupXProduct_3 ON ' $ g.Store_Table_Prefix $ 'PriceGroupXProduct ( pgrp_id, automatic, colcount )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00371', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'PriceGroupXProduct_4 ON ' $ g.Store_Table_Prefix $ 'PriceGroupXProduct ( product_id, automatic, colcount )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00372', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_PriceGroupXExcludedProduct
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedProduct
						  (
							pgrp_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							product_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							automatic	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL() 	$ ',
							colcount	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00188', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedProduct_1 ON ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedProduct ( pgrp_id, product_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00189', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedProduct_2 ON ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedProduct ( product_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00190', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedProduct_3 ON ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedProduct ( pgrp_id, automatic, colcount )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00373', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedProduct_4 ON ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedProduct ( product_id, automatic, colcount )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00374', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_PriceGroupXQualifyingProduct
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingProduct
						  (
							pgrp_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							product_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							automatic	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL() 	$ ',
							colcount	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00119', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingProduct_1 ON ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingProduct ( pgrp_id, product_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00120', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingProduct_2 ON ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingProduct ( product_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00121', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingProduct_3 ON ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingProduct ( pgrp_id, automatic, colcount )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00375', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingProduct_4 ON ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingProduct ( product_id, automatic, colcount )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00376', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_PriceGroupXProductSubscription
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'PriceGroupXProductSubscription
						  (
							pgrp_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							product_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							subterm_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00166', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'PriceGroupXProductSubscription_1 ON ' $ g.Store_Table_Prefix $ 'PriceGroupXProductSubscription ( pgrp_id, product_id, subterm_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00167', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'PriceGroupXProductSubscription_2 ON ' $ g.Store_Table_Prefix $ 'PriceGroupXProductSubscription ( product_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00168', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_PriceGroupXExcludedProductSubscription
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedProductSubscription
						  (
							pgrp_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							product_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							subterm_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00191', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedProductSubscription_1 ON ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedProductSubscription ( pgrp_id, product_id, subterm_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00192', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedProductSubscription_2 ON ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedProductSubscription ( product_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00193', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_PriceGroupXQualifyingProductSubscription
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingProductSubscription
						  (
							pgrp_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							product_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							subterm_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00176', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingProductSubscription_1 ON ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingProductSubscription ( pgrp_id, product_id, subterm_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00177', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingProductSubscription_2 ON ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingProductSubscription ( product_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00178', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_PriceGroupXCollection
	|
	</MvCOMMENT>

	<MvQUERY NAME   = "Merchant"
			 QUERY  = "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'PriceGroupXCollection
						  (
							pgrp_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ ',
							col_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00377', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME   = "Merchant"
			 QUERY  = "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'PriceGroupXCollection_1 ON ' $ g.Store_Table_Prefix $ 'PriceGroupXCollection ( pgrp_id, col_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00378', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_PriceGroupXExcludedCollection
	|
	</MvCOMMENT>

	<MvQUERY NAME   = "Merchant"
			 QUERY  = "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedCollection
						  (
							pgrp_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ ',
							col_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00379', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME   = "Merchant"
			 QUERY  = "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedCollection_1 ON ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedCollection ( pgrp_id, col_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00380', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_PriceGroupXQualifyingCollection
	|
	</MvCOMMENT>

	<MvQUERY NAME   = "Merchant"
			 QUERY  = "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingCollection
						  (
							pgrp_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ ',
							col_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00381', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME   = "Merchant"
			 QUERY  = "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingCollection_1 ON ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingCollection ( pgrp_id, col_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00382', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_PriceGroupXProductCollectionExclusions
	|
	</MvCOMMENT>

	<MvQUERY NAME   = "Merchant"
			 QUERY  = "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'PriceGroupXProductCollectionExclusions
						  (
							pgrp_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ ',
							product_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ ',
							colcount	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00383', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME   = "Merchant"
			 QUERY  = "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'PriceGroupXProductCollectionExclusions_1 ON ' $ g.Store_Table_Prefix $ 'PriceGroupXProductCollectionExclusions ( pgrp_id, product_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00384', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME   = "Merchant"
			 QUERY  = "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'PriceGroupXProductCollectionExclusions_2 ON ' $ g.Store_Table_Prefix $ 'PriceGroupXProductCollectionExclusions ( product_id, pgrp_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00385', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME   = "Merchant"
			 QUERY  = "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'PriceGroupXProductCollectionExclusions_3 ON ' $ g.Store_Table_Prefix $ 'PriceGroupXProductCollectionExclusions ( pgrp_id, colcount )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00386', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME   = "Merchant"
			 QUERY  = "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'PriceGroupXProductCollectionExclusions_4 ON ' $ g.Store_Table_Prefix $ 'PriceGroupXProductCollectionExclusions ( product_id, colcount )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00387', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_PriceGroupXExcludedProductCollectionExclusions
	|
	</MvCOMMENT>

	<MvQUERY NAME   = "Merchant"
			 QUERY  = "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedProductCollectionExclusions
						  (
							pgrp_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ ',
							product_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ ',
							colcount	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00388', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME   = "Merchant"
			 QUERY  = "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedProductCollectionExclusions_1 ON ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedProductCollectionExclusions ( pgrp_id, product_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00389', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME   = "Merchant"
			 QUERY  = "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedProductCollectionExclusions_2 ON ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedProductCollectionExclusions ( product_id, pgrp_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00390', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME   = "Merchant"
			 QUERY  = "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedProductCollectionExclusions_3 ON ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedProductCollectionExclusions ( pgrp_id, colcount )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00391', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME   = "Merchant"
			 QUERY  = "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedProductCollectionExclusions_4 ON ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedProductCollectionExclusions ( product_id, colcount )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00392', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_PriceGroupXQualifyingProductCollectionExclusions
	|
	</MvCOMMENT>

	<MvQUERY NAME   = "Merchant"
			 QUERY  = "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingProductCollectionExclusions
						  (
							pgrp_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ ',
							product_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ ',
							colcount	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00393', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME   = "Merchant"
			 QUERY  = "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingProductCollectionExclusions_1 ON ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingProductCollectionExclusions ( pgrp_id, product_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00394', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME   = "Merchant"
			 QUERY  = "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingProductCollectionExclusions_2 ON ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingProductCollectionExclusions ( product_id, pgrp_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00395', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME   = "Merchant"
			 QUERY  = "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingProductCollectionExclusions_3 ON ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingProductCollectionExclusions ( pgrp_id, colcount )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00396', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME   = "Merchant"
			 QUERY  = "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingProductCollectionExclusions_4 ON ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingProductCollectionExclusions ( product_id, colcount )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00397', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_Coupons
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'Coupons
						  (
							id			' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							code		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 50 )	$ ',
							descrip		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 254 )	$ ',
							custscope	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 1 )		$ ',
							dt_start	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							dt_end		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							max_use		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							max_per		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							active		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()		$ ',
							use_count	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00040', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'Coupons_1 ON ' $ g.Store_Table_Prefix $ 'Coupons ( id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00041', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'Coupons_2 ON ' $ g.Store_Table_Prefix $ 'Coupons ( code )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00042', g.MvQUERY_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ NOT [ g.Module_Library_DB ].StoreKey_Insert( 'Coupons', 1 ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_CouponXPriceGroup
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'CouponXPriceGroup
						  (
							coupon_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ ',
							pgrp_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00043', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'CouponXPriceGroup_1 ON ' $ g.Store_Table_Prefix $ 'CouponXPriceGroup ( coupon_id, pgrp_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00044', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'CouponXPriceGroup_2 ON ' $ g.Store_Table_Prefix $ 'CouponXPriceGroup ( pgrp_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00045', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_CouponXCustomer
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'CouponXCustomer
						  (
							coupon_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ ',
							cust_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00046', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'CouponXCustomer_1 ON ' $ g.Store_Table_Prefix $ 'CouponXCustomer ( coupon_id, cust_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00047', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'CouponXCustomer_2 ON ' $ g.Store_Table_Prefix $ 'CouponXCustomer ( cust_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00048', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_CouponXBusinessAccount
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'CouponXBusinessAccount
						  (
							coupon_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ ',
							account_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00362', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'CouponXBusinessAccount_1 ON ' $ g.Store_Table_Prefix $ 'CouponXBusinessAccount ( coupon_id, account_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00363', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'CouponXBusinessAccount_2 ON ' $ g.Store_Table_Prefix $ 'CouponXBusinessAccount ( account_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00364', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_CouponXShopper
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'CouponXShopper
						  (
							coupon_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ ',
							cust_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ ',
							use_count	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00049', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'CouponXShopper_1 ON ' $ g.Store_Table_Prefix $ 'CouponXShopper ( coupon_id, cust_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00050', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_CouponXAnonymousShopper
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'CouponXAnonymousShopper
						  (
							coupon_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							bill_email	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 254 )	$ ',
							use_count	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00269', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'CouponXAnonymousShopper_1 ON ' $ g.Store_Table_Prefix $ 'CouponXAnonymousShopper ( coupon_id, bill_email )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00051', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_BasketCoupons
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'BasketCoupons
						  (
							basket_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()			$ ',
							coupon_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()			$ ',
							total		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_NUMBER( 16, 8 )	$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00052', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'BasketCoupons_1 ON ' $ g.Store_Table_Prefix $ 'BasketCoupons ( basket_id, coupon_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00053', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'BasketCoupons_2 ON ' $ g.Store_Table_Prefix $ 'BasketCoupons ( coupon_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00054', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_BasketDiscountTotals
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'BasketDiscountTotals
						  (
							basket_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()			$ ',
							pgrp_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()			$ ',
							coupon_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()			$ ',
							total		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_NUMBER( 16, 8 )	$ ',
							persist		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()			$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00131', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'BasketDiscountTotals_1 ON ' $ g.Store_Table_Prefix $ 'BasketDiscountTotals ( basket_id, pgrp_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00132', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_OrderCoupons
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'OrderCoupons
						  (
							order_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()			$ ',
							coupon_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()			$ ',
							code		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 50 )		$ ',
							descrip		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 254 )		$ ',
							total		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_NUMBER( 16, 8 )	$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00055', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'OrderCoupons_1 ON ' $ g.Store_Table_Prefix $ 'OrderCoupons ( order_id, coupon_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00056', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'OrderCoupons_2 ON ' $ g.Store_Table_Prefix $ 'OrderCoupons ( coupon_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00057', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_OrderDiscountTotals
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'OrderDiscountTotals
						  (
							order_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()			$ ',
							pgrp_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()			$ ',
							coupon_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()			$ ',
							name		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 100 )		$ ',
							priority	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()			$ ',
							descrip		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 254 )		$ ',
							total		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_NUMBER( 16, 8 )	$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00133', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'OrderDiscountTotals_1 ON ' $ g.Store_Table_Prefix $ 'OrderDiscountTotals ( order_id, pgrp_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00134', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_DiscountOptions
	|
	</MvCOMMENT>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'DiscountOptions
						  (
							repricerma	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 10 )	$ ',
							repricecan	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()		$ ',
							reshipcan	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()		$ ',
							delshipcan	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()		$ ',
							retaxcan	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()		$ ',
							repricetot	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 10 )	$ ',
							adj_code	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 50 )	$ ',
							adj_name	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 100 )	$ ',
							adj_charge	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 100 )	$ ',
							usl_disc	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()		$ ',
							usl_qual	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()		$ ',
							exdefault	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 1 )		$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00135', g.MvQUERY_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.discountoptions:repricerma"	VALUE = "received">
	<MvASSIGN NAME = "l.discountoptions:repricecan"	VALUE = 1>
	<MvASSIGN NAME = "l.discountoptions:reshipcan"	VALUE = 1>
	<MvASSIGN NAME = "l.discountoptions:delshipcan"	VALUE = 1>
	<MvASSIGN NAME = "l.discountoptions:retaxcan"	VALUE = 1>
	<MvASSIGN NAME = "l.discountoptions:repricetot"	VALUE = "item">
	<MvASSIGN NAME = "l.discountoptions:adj_code"	VALUE = "adjustment">
	<MvASSIGN NAME = "l.discountoptions:adj_name"	VALUE = "Discount Adjustment">
	<MvASSIGN NAME = "l.discountoptions:adj_charge"	VALUE = "Discount Adjustment">
	<MvASSIGN NAME = "l.discountoptions:usl_disc"	VALUE = 1>
	<MvASSIGN NAME = "l.discountoptions:usl_qual"	VALUE = 1>
	<MvASSIGN NAME = "l.discountoptions:exdefault"	VALUE = "">

	<MvIF EXPR = "{ NOT DiscountOptions_Insert( l.discountoptions ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_PriceGroupXBusinessAccount
	|
	</MvCOMMENT>

	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'PriceGroupXBusinessAccount
						  (
							pgrp_id 	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							account_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00156', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'PriceGroupXBusinessAccount_1 ON ' $ g.Store_Table_Prefix $ 'PriceGroupXBusinessAccount ( pgrp_id, account_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00164', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'PriceGroupXBusinessAccount_2 ON ' $ g.Store_Table_Prefix $ 'PriceGroupXBusinessAccount ( account_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00165', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_PriceGroupXCategory
	|
	</MvCOMMENT>

	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'PriceGroupXCategory
						  (
							pgrp_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							cat_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00210', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'PriceGroupXCategory_1 ON ' $ g.Store_Table_Prefix $ 'PriceGroupXCategory ( pgrp_id, cat_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00211', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'PriceGroupXCategory_2 ON ' $ g.Store_Table_Prefix $ 'PriceGroupXCategory ( cat_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00212', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_PriceGroupXExcludedCategory
	|
	</MvCOMMENT>

	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedCategory
						  (
							pgrp_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							cat_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00213', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedCategory_1 ON ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedCategory ( pgrp_id, cat_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00214', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedCategory_2 ON ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedCategory ( cat_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00215', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_DiscountSignatures
	|
	</MvCOMMENT>

	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'DiscountSignatures
						  (
							id			' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							signature	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 50 )	$ ',
							inuse		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()		$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00216', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'DiscountSignatures_1 ON ' $ g.Store_Table_Prefix $ 'DiscountSignatures ( id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00217', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'DiscountSignatures_2 ON ' $ g.Store_Table_Prefix $ 'DiscountSignatures ( signature )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00218', g.MvQUERY_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ NOT [ g.Module_Library_DB ].StoreKey_Insert( 'DiscountSignatures', 1 ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_DiscountSignatureXPriceGroup
	|
	</MvCOMMENT>

	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'DiscountSignatureXPriceGroup
						  (
							dscsig_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							pgrp_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00219', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'DiscountSignatureXPriceGroup_1 ON ' $ g.Store_Table_Prefix $ 'DiscountSignatureXPriceGroup ( dscsig_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00220', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'DiscountSignatureXPriceGroup_2 ON ' $ g.Store_Table_Prefix $ 'DiscountSignatureXPriceGroup ( pgrp_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00221', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_DiscountPrices
	|
	</MvCOMMENT>

	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'DiscountPrices
						  (
							product_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()			$ ',
							dscsig_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()			$ ',
							base_price	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_NUMBER( 16, 8 )	$ ',
							price		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_NUMBER( 16, 8 )	$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00222', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'DiscountPrices_1 ON ' $ g.Store_Table_Prefix $ 'DiscountPrices ( product_id, dscsig_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00223', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'DiscountPrices_2 ON ' $ g.Store_Table_Prefix $ 'DiscountPrices ( dscsig_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00224', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_DiscountVariantPrices
	|
	</MvCOMMENT>

	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'DiscountVariantPrices
						  (
							product_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()			$ ',
							variant_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()			$ ',
							dscsig_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()			$ ',
							base_price	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_NUMBER( 16, 8 )	$ ',
							price		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_NUMBER( 16, 8 )	$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00343', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'DiscountVariantPrices_1 ON ' $ g.Store_Table_Prefix $ 'DiscountVariantPrices ( product_id, variant_id, dscsig_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00344', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'DiscountVariantPrices_2 ON ' $ g.Store_Table_Prefix $ 'DiscountVariantPrices ( dscsig_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00345', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PGR_Create_Data_Files" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT [ g.Module_Library_DB ].DomainPrivilege_Insert( 'PGRP', 'Price Groups' )	OR
					NOT [ g.Module_Library_DB ].DomainPrivilege_Insert( 'COUP', 'Coupons' ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PGR_Store_Delete" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'PriceGroups' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'PriceGroupExclusions' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'PriceGroupXProduct' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedProduct' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'PriceGroupXCustomer' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingProduct' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'PriceGroupXProductSubscription' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedProductSubscription' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingProductSubscription' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'PriceGroupXCollection' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedCollection' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingCollection' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'PriceGroupXProductCollectionExclusions' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedProductCollectionExclusions' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingProductCollectionExclusions' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'PriceGroupXBusinessAccount' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'PriceGroupXCategory' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedCategory' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'Coupons' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'CouponXPriceGroup' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'CouponXCustomer' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'CouponXBusinessAccount' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'CouponXShopper' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'CouponXAnonymousShopper' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'BasketCoupons' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'BasketDiscountTotals' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'OrderCoupons' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'OrderDiscountTotals' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'DiscountOptions' }">	
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'DiscountSignatures' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'DiscountSignatureXPriceGroup' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'DiscountPrices' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'DiscountVariantPrices' }">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_PriceGroups
|
</MvCOMMENT>

<MvFUNCTION NAME = "PriceGroup_Read" PARAMETERS = "pricegroup var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.pricegroup:id"					VALUE = "{ PriceGroups.d.id }">
	<MvASSIGN NAME = "l.pricegroup:name"				VALUE = "{ PriceGroups.d.name }">
	<MvASSIGN NAME = "l.pricegroup:custscope"			VALUE = "{ PriceGroups.d.custscope }">
	<MvASSIGN NAME = "l.pricegroup:original_custscope"	VALUE = "{ PriceGroups.d.custscope }">
	<MvASSIGN NAME = "l.pricegroup:rate"				VALUE = "{ PriceGroups.d.rate }">
	<MvASSIGN NAME = "l.pricegroup:discount"			VALUE = "{ PriceGroups.d.discount }">
	<MvASSIGN NAME = "l.pricegroup:markup"				VALUE = "{ PriceGroups.d.markup }">
	<MvASSIGN NAME = "l.pricegroup:module_id"			VALUE = "{ PriceGroups.d.module_id }">
	<MvASSIGN NAME = "l.pricegroup:original_module_id"	VALUE = "{ PriceGroups.d.module_id }">
	<MvASSIGN NAME = "l.pricegroup:exclusion"			VALUE = "{ PriceGroups.d.exclusion }">
	<MvASSIGN NAME = "l.pricegroup:config"				VALUE = "{ miva_array_deserialize( PriceGroups.d.config ) }">
	<MvASSIGN NAME = "l.pricegroup:descrip"				VALUE = "{ PriceGroups.d.descrip }">
	<MvASSIGN NAME = "l.pricegroup:display"				VALUE = "{ PriceGroups.d.display }">
	<MvASSIGN NAME = "l.pricegroup:dt_start"			VALUE = "{ PriceGroups.d.dt_start }">
	<MvASSIGN NAME = "l.pricegroup:dt_end"				VALUE = "{ PriceGroups.d.dt_end }">
	<MvASSIGN NAME = "l.pricegroup:qmn_subtot"			VALUE = "{ PriceGroups.d.qmn_subtot }">
	<MvASSIGN NAME = "l.pricegroup:qmx_subtot"			VALUE = "{ PriceGroups.d.qmx_subtot }">
	<MvASSIGN NAME = "l.pricegroup:qmn_quan"			VALUE = "{ PriceGroups.d.qmn_quan }">
	<MvASSIGN NAME = "l.pricegroup:qmx_quan"			VALUE = "{ PriceGroups.d.qmx_quan }">
	<MvASSIGN NAME = "l.pricegroup:qmn_weight"			VALUE = "{ PriceGroups.d.qmn_weight }">
	<MvASSIGN NAME = "l.pricegroup:qmx_weight"			VALUE = "{ PriceGroups.d.qmx_weight }">
	<MvASSIGN NAME = "l.pricegroup:bmn_subtot"			VALUE = "{ PriceGroups.d.bmn_subtot }">
	<MvASSIGN NAME = "l.pricegroup:bmx_subtot"			VALUE = "{ PriceGroups.d.bmx_subtot }">
	<MvASSIGN NAME = "l.pricegroup:bmn_quan"			VALUE = "{ PriceGroups.d.bmn_quan }">
	<MvASSIGN NAME = "l.pricegroup:bmx_quan"			VALUE = "{ PriceGroups.d.bmx_quan }">
	<MvASSIGN NAME = "l.pricegroup:bmn_weight"			VALUE = "{ PriceGroups.d.bmn_weight }">
	<MvASSIGN NAME = "l.pricegroup:bmx_weight"			VALUE = "{ PriceGroups.d.bmx_weight }">
	<MvASSIGN NAME = "l.pricegroup:priority"			VALUE = "{ PriceGroups.d.priority }">
	<MvASSIGN NAME = "l.pricegroup:baskexc"				VALUE = "{ miva_array_deserialize( PriceGroups.d.baskexc ) }">
	<MvASSIGN NAME = "l.pricegroup:itemexc"				VALUE = "{ miva_array_deserialize( PriceGroups.d.itemexc ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupAndModule_Read" PARAMETERS = "pricegroup var" STANDARDOUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ PriceGroup_Read( l.pricegroup ) }">

	<MvASSIGN NAME = "l.pricegroup:module:id"		VALUE = "{ PriceGroups.d.loaded_module_id }">
	<MvASSIGN NAME = "l.pricegroup:module:code"		VALUE = "{ PriceGroups.d.module_code }">
	<MvASSIGN NAME = "l.pricegroup:module:name"		VALUE = "{ PriceGroups.d.module_name }">
	<MvASSIGN NAME = "l.pricegroup:module:provider"	VALUE = "{ PriceGroups.d.module_provider }">
	<MvASSIGN NAME = "l.pricegroup:module:api_ver"	VALUE = "{ PriceGroups.d.module_api_ver }">
	<MvASSIGN NAME = "l.pricegroup:module:version"	VALUE = "{ PriceGroups.d.module_version }">
	<MvASSIGN NAME = "l.pricegroup:module:module"	VALUE = "{ PriceGroups.d.module_module }">
	<MvASSIGN NAME = "l.pricegroup:module:refcount"	VALUE = "{ PriceGroups.d.module_refcount }">
	<MvASSIGN NAME = "l.pricegroup:module:active"	VALUE = "{ PriceGroups.d.module_active }">
	<MvASSIGN NAME = "l.pricegroup:module:priority"	VALUE = "{ PriceGroups.d.module_priority }">
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroup_Insert" PARAMETERS = "pricegroup var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.pricegroup:id" VALUE = "{ [ g.Module_Library_DB ].StoreKey_Generate( 'PriceGroups' ) }">

	<MvIF EXPR = "{ NOT PriceGroup_Insert_LowLevel( l.pricegroup ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFOREACH ITERATOR = "l.module" ARRAY = "l.modules" COUNT = "{ [ g.Module_Library_DB ].StoreModuleList_Load_Features_Cached( 'not_pricegroup', l.modules ) }">
		<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Root $ l.module:module ].Module_Notify_PriceGroup_Insert( l.module, l.pricegroup ) }">
	</MvFOREACH>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroup_Insert_LowLevel" PARAMETERS = "pricegroup var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.config" VALUE = "{ miva_array_serialize( l.pricegroup:config ) }">

	<MvIF EXPR = "{ ISNULL l.pricegroup:custscope }">		<MvASSIGN NAME = "l.pricegroup:custscope"		VALUE = "X">	</MvIF>
	<MvIF EXPR = "{ ISNULL l.pricegroup:module_id }">		<MvASSIGN NAME = "l.pricegroup:module_id"		VALUE = 0>		</MvIF>
	<MvIF EXPR = "{ ISNULL l.pricegroup:exclusion }">		<MvASSIGN NAME = "l.pricegroup:exclusion"		VALUE = 0>		</MvIF>
	<MvIF EXPR = "{ ISNULL l.pricegroup:display }">			<MvASSIGN NAME = "l.pricegroup:display"			VALUE = 0>		</MvIF>
	<MvIF EXPR = "{ ISNULL l.pricegroup:dt_start }">		<MvASSIGN NAME = "l.pricegroup:dt_start"		VALUE = 0>		</MvIF>
	<MvIF EXPR = "{ ISNULL l.pricegroup:dt_end }">			<MvASSIGN NAME = "l.pricegroup:dt_end"			VALUE = 0>		</MvIF>
	<MvIF EXPR = "{ ISNULL l.pricegroup:qmn_subtot }">		<MvASSIGN NAME = "l.pricegroup:qmn_subtot"		VALUE = 0>		</MvIF>
	<MvIF EXPR = "{ ISNULL l.pricegroup:qmx_subtot }">		<MvASSIGN NAME = "l.pricegroup:qmx_subtot"		VALUE = 0>		</MvIF>
	<MvIF EXPR = "{ ISNULL l.pricegroup:qmn_quan }">		<MvASSIGN NAME = "l.pricegroup:qmn_quan"		VALUE = 0>		</MvIF>
	<MvIF EXPR = "{ ISNULL l.pricegroup:qmx_quan }">		<MvASSIGN NAME = "l.pricegroup:qmx_quan"		VALUE = 0>		</MvIF>
	<MvIF EXPR = "{ ISNULL l.pricegroup:qmn_weight }">		<MvASSIGN NAME = "l.pricegroup:qmn_weight"		VALUE = 0>		</MvIF>
	<MvIF EXPR = "{ ISNULL l.pricegroup:qmx_weight }">		<MvASSIGN NAME = "l.pricegroup:qmx_weight"		VALUE = 0>		</MvIF>
	<MvIF EXPR = "{ ISNULL l.pricegroup:bmn_subtot }">		<MvASSIGN NAME = "l.pricegroup:bmn_subtot"		VALUE = 0>		</MvIF>
	<MvIF EXPR = "{ ISNULL l.pricegroup:bmx_subtot }">		<MvASSIGN NAME = "l.pricegroup:bmx_subtot"		VALUE = 0>		</MvIF>
	<MvIF EXPR = "{ ISNULL l.pricegroup:bmn_quan }">		<MvASSIGN NAME = "l.pricegroup:bmn_quan"		VALUE = 0>		</MvIF>
	<MvIF EXPR = "{ ISNULL l.pricegroup:bmx_quan }">		<MvASSIGN NAME = "l.pricegroup:bmx_quan"		VALUE = 0>		</MvIF>
	<MvIF EXPR = "{ ISNULL l.pricegroup:bmn_weight }">		<MvASSIGN NAME = "l.pricegroup:bmn_weight"		VALUE = 0>		</MvIF>
	<MvIF EXPR = "{ ISNULL l.pricegroup:bmx_weight }">		<MvASSIGN NAME = "l.pricegroup:bmx_weight"		VALUE = 0>		</MvIF>
	<MvIF EXPR = "{ ISNULL l.pricegroup:priority }">		<MvASSIGN NAME = "l.pricegroup:priority"		VALUE = 0>		</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'PriceGroups
					      ( id, name, custscope, rate, discount, markup, module_id, exclusion, config, descrip, display,
						    dt_start, dt_end, qmn_subtot, qmx_subtot, qmn_quan, qmx_quan, qmn_weight, qmx_weight,
							bmn_subtot, bmx_subtot, bmn_quan, bmx_quan, bmn_weight, bmx_weight, priority,
							baskexc, itemexc )
						  VALUES
						  ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, \'\', \'\' )' }"
			 FIELDS	= "l.pricegroup:id, l.pricegroup:name, l.pricegroup:custscope, l.pricegroup:rate,
					   l.pricegroup:discount, l.pricegroup:markup, l.pricegroup:module_id, l.pricegroup:exclusion, l.config,
					   l.pricegroup:descrip, l.pricegroup:display, l.pricegroup:dt_start, l.pricegroup:dt_end,
					   l.pricegroup:qmn_subtot, l.pricegroup:qmx_subtot, l.pricegroup:qmn_quan, l.pricegroup:qmx_quan,
					   l.pricegroup:qmn_weight, l.pricegroup:qmx_weight, l.pricegroup:bmn_subtot, l.pricegroup:bmx_subtot,
					   l.pricegroup:bmn_quan, l.pricegroup:bmx_quan, l.pricegroup:bmn_weight, l.pricegroup:bmx_weight,
					   l.pricegroup:priority">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00013', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroup_Update" PARAMETERS = "pricegroup var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT DiscountPrice_Delete_All_PriceGroup( l.pricegroup:id )			OR
					NOT DiscountVariantPrice_Delete_All_PriceGroup( l.pricegroup:id )	OR
					NOT PriceGroup_Update_LowLevel( l.pricegroup ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ l.pricegroup:original_module_id AND ( l.pricegroup:original_module_id NE l.pricegroup:module_id ) }">
		<MvIF EXPR = "{ [ g.Module_Library_DB ].Module_Load_ID( l.pricegroup:original_module_id, l.module ) }">
			<MvIF EXPR = "{ l.module:api_ver GE 9.01 }">
				<MvIF EXPR = "{ NOT [ g.Module_Root $ l.module:module ].DiscountModule_PriceGroup_Delete( l.module, l.pricegroup ) }">
					<MvFUNCTIONRETURN VALUE = 0>
				</MvIF>
			</MvIF>
		</MvIF>
	</MvIF>

	<MvFOREACH ITERATOR = "l.module" ARRAY = "l.modules" COUNT = "{ [ g.Module_Library_DB ].StoreModuleList_Load_Features_Cached( 'not_pricegroup', l.modules ) }">
		<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Root $ l.module:module ].Module_Notify_PriceGroup_Update( l.module, l.pricegroup ) }">
	</MvFOREACH>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroup_Update_LowLevel" PARAMETERS = "pricegroup var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.config" VALUE = "{ miva_array_serialize( l.pricegroup:config ) }">

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'PriceGroups
						  SET
							name		= ?,
							custscope	= ?,
							rate		= ?,
							discount	= ?,
							markup		= ?,
							module_id	= ?,
							exclusion	= ?,
							config		= ?,
							descrip		= ?,
							display		= ?,
							dt_start	= ?,
							dt_end		= ?,
							qmn_subtot	= ?,
							qmx_subtot	= ?,
							qmn_quan	= ?,
							qmx_quan	= ?,
							qmn_weight	= ?,
							qmx_weight	= ?,
							bmn_subtot	= ?,
							bmx_subtot	= ?,
							bmn_quan	= ?,
							bmx_quan	= ?,
							bmn_weight	= ?,
							bmx_weight	= ?,
							priority	= ?
						  WHERE
							id			= ?' }"
			 FIELDS	= "l.pricegroup:name, l.pricegroup:custscope, l.pricegroup:rate, l.pricegroup:discount,
					   l.pricegroup:markup, l.pricegroup:module_id, l.pricegroup:exclusion, l.config, l.pricegroup:descrip,
					   l.pricegroup:display, l.pricegroup:dt_start, l.pricegroup:dt_end, l.pricegroup:qmn_subtot, l.pricegroup:qmx_subtot,
					   l.pricegroup:qmn_quan, l.pricegroup:qmx_quan, l.pricegroup:qmn_weight, l.pricegroup:qmx_weight,
					   l.pricegroup:bmn_subtot, l.pricegroup:bmx_subtot, l.pricegroup:bmn_quan, l.pricegroup:bmx_quan,
					   l.pricegroup:bmn_weight, l.pricegroup:bmx_weight, l.pricegroup:priority,
					   l.pricegroup:id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00014', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroup_Calculate_Exclusions" PARAMETERS = "pricegroup var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.pricegroup:baskexc"	VALUE = "">
	<MvASSIGN NAME = "l.pricegroup:itemexc"	VALUE = "">

	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PriceGroupExclusions"
				QUERY	= "{ 'SELECT
								pge.pgrp_id2	AS pgrp_id,
								p.priority		AS priority,
								p.module_id		AS module_id,
								pge.scope		AS scope
							  FROM
								' $ g.Store_Table_Prefix $ 'PriceGroupExclusions pge,
								' $ g.Store_Table_Prefix $ 'PriceGroups p
							  WHERE
								pge.pgrp_id1	= ?	AND
								p.id			= pge.pgrp_id2
							  UNION ALL
							  SELECT
								pge.pgrp_id1	AS pgrp_id,
								p.priority		AS priority,
								p.module_id		AS module_id,
								pge.scope		AS scope
							  FROM
								' $ g.Store_Table_Prefix $ 'PriceGroupExclusions pge,
								' $ g.Store_Table_Prefix $ 'PriceGroups p
							  WHERE
								pge.pgrp_id2	= ?	AND
								p.id			= pge.pgrp_id1' }"
				FIELDS	= "l.pricegroup:id, l.pricegroup:id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00311', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvWHILE EXPR = "{ NOT PriceGroupExclusions.d.EOF }">
		<MvIF EXPR = "{ ( ( l.pricegroup:priority GT PriceGroupExclusions.d.priority ) OR
						  ( ( l.pricegroup:priority EQ PriceGroupExclusions.d.priority ) AND ( l.pricegroup:id LT PriceGroupExclusions.d.pgrp_id ) ) ) AND
						( ( PriceGroupExclusions.d.scope EQ 'B' ) OR
						  ( l.pricegroup:module_id EQ 0 ) OR ( PriceGroupExclusions.d.module_id EQ 0 ) ) }">
			<MvASSIGN NAME = "l.null"	VALUE = "{ miva_array_insert_var( l.pricegroup:baskexc, PriceGroupExclusions.d.pgrp_id, -1 ) }">
		<MvELSEIF EXPR = "{ ( ( l.pricegroup:priority LT PriceGroupExclusions.d.priority ) OR
							  ( ( l.pricegroup:priority EQ PriceGroupExclusions.d.priority ) AND ( l.pricegroup:id GT PriceGroupExclusions.d.pgrp_id ) ) ) AND
							( PriceGroupExclusions.d.scope NE 'B' ) }">
			<MvASSIGNARRAY NAME = "l.pricegroup:itemexc" VALUE = "{ PriceGroupExclusions.d.scope }">
				<MvDIMENSION INDEX = "{ PriceGroupExclusions.d.pgrp_id }">
			</MvASSIGNARRAY>
		</MvIF>
						
		<MvSKIP NAME = "Merchant" VIEW = "PriceGroupExclusions" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupExclusions">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroup_Update_Exclusions" PARAMETERS = "pricegroup var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.baskexc"	VALUE = "{ miva_array_serialize( l.pricegroup:baskexc ) }">
	<MvASSIGN NAME = "l.itemexc"	VALUE = "{ miva_array_serialize( l.pricegroup:itemexc ) }">

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'PriceGroups
						  SET
							baskexc	= ?,
							itemexc	= ?
						  WHERE
							id		= ?' }"
			 FIELDS	= "l.baskexc, l.itemexc,
					   l.pricegroup:id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00312', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroup_Delete" PARAMETERS = "pricegroup var" STANDARDOUTPUTLEVEL = "">
	<MvTRANSACT NAME = "Merchant">

	<MvCOMMENT>
	|
	| The notification here happens before the price group is actually deleted which
	| is not how most notification APIs work.  This is necessary for certain modules
	| as they need access to the price group and all of its associated records before
	| it is deleted.
	|
	</MvCOMMENT>

	<MvFOREACH ITERATOR = "l.module" ARRAY = "l.modules" COUNT = "{ [ g.Module_Library_DB ].StoreModuleList_Load_Features_Cached( 'not_pricegroup', l.modules ) }">
		<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Root $ l.module:module ].Module_Notify_PriceGroup_Delete( l.module, l.pricegroup ) }">
	</MvFOREACH>

	<MvIF EXPR = "{ [ g.Module_Library_DB ].Module_Load_ID( l.pricegroup:module_id, l.module ) }">
		<MvIF EXPR = "{ l.module:api_ver GE 9.01 }">
			<MvIF EXPR = "{ NOT [ g.Module_Root $ l.module:module ].DiscountModule_PriceGroup_Delete( l.module, l.pricegroup ) }">
				<MvROLLBACK NAME = "Merchant">
				<MvFUNCTIONRETURN VALUE = 0>
			</MvIF>
		</MvIF>
	</MvIF>

	<MvIF EXPR = "{ NOT [ g.Module_Library_DB ].Product_Decrement_PriceGroupCount_All( l.pricegroup:id )				OR
					NOT [ g.Module_Feature_CUS_DB ].BusinessAccount_Decrement_PriceGroupCount_All( l.pricegroup:id )	OR
					NOT [ g.Module_Feature_CUS_DB ].Customer_Decrement_PriceGroupCount_All( l.pricegroup:id )			OR
					NOT CouponXPriceGroup_Delete_All_PriceGroup( l.pricegroup:id )										OR
					NOT PriceGroupExclusion_Delete_All_PriceGroup( l.pricegroup:id )									OR
					NOT PriceGroupXCustomer_Delete_All_PriceGroup( l.pricegroup:id )									OR
					NOT PriceGroupXProduct_Delete_All_PriceGroup( l.pricegroup:id )										OR
					NOT PriceGroupXExcludedProduct_Delete_All_PriceGroup( l.pricegroup:id )								OR
					NOT PriceGroupXProductSubscription_Delete_All_PriceGroup( l.pricegroup:id )							OR
					NOT PriceGroupXExcludedProductSubscription_Delete_All_PriceGroup( l.pricegroup:id )					OR
					NOT PriceGroupXQualifyingProduct_Delete_All_PriceGroup( l.pricegroup:id	)							OR
					NOT PriceGroupXQualifyingProductSubscription_Delete_All_PriceGroup( l.pricegroup:id )				OR
					NOT PriceGroupXBusinessAccount_Delete_All_PriceGroup( l.pricegroup:id )								OR
					NOT PriceGroupXCategory_Delete_All_PriceGroup( l.pricegroup:id )									OR
					NOT PriceGroupXExcludedCategory_Delete_All_PriceGroup( l.pricegroup:id )							OR
					NOT DiscountPrice_Delete_All_PriceGroup( l.pricegroup:id )											OR
					NOT DiscountVariantPrice_Delete_All_PriceGroup( l.pricegroup:id )									OR
					NOT PriceGroupXCollection_Delete_All_PriceGroup( l.pricegroup:id )									OR
					NOT PriceGroupXProductCollectionExclusion_Delete_All_PriceGroup( l.pricegroup:id )					OR
					NOT PriceGroupXExcludedCollection_Delete_All_PriceGroup( l.pricegroup:id )							OR
					NOT PriceGroupXExcludedProductCollectionExclusion_Delete_All_PriceGroup( l.pricegroup:id )			OR
					NOT PriceGroupXQualifyingCollection_Delete_All_PriceGroup( l.pricegroup:id )						OR
					NOT PriceGroupXQualifyingProductCollectionExclusion_Delete_All_PriceGroup( l.pricegroup:id )		OR
					NOT PriceGroup_Delete_ID( l.pricegroup:id ) }">
		<MvROLLBACK NAME = "Merchant">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMIT NAME = "Merchant">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroup_Delete_ID" PARAMETERS = "id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroups WHERE id = ?' }"
			 FIELDS	= "l.id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00015', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupList_Load_Offset" PARAMETERS = "offset, search, searchable_fields, max, nextoffset var, groups var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.query"		VALUE = "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'PriceGroups' }">

	<MvIF EXPR = "{ len( l.search ) }">
		<MvASSIGN NAME = "l.query"	VALUE = "{ l.query $ ' WHERE ' $ [ g.Module_Library_DB ].SQL_Search_Clause( l.search, g.Store_Table_Prefix $ 'PriceGroups', l.searchable_fields, l.fields ) }">
	</MvIF>

	<MvASSIGN NAME = "l.query"		VALUE = "{ l.query $ ' ORDER BY id' }">

	<MvIF EXPR = "{ l.max EQ 0 }">	<MvASSIGN NAME = "l.limit" VALUE = 0>
	<MvELSE>						<MvASSIGN NAME = "l.limit" VALUE = "{ l.max + 1 }">
	</MvIF>

	<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_OPENVIEW_Range( 'Merchant', 'PriceGroups',
																			 l.query, l.fields,
																			 l.offset, l.limit ) }">
		<MvFUNCTIONRETURN VALUE = "{  [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00016', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.group_count" VALUE = 0>
	<MvWHILE EXPR = "{ ( NOT PriceGroups.d.EOF ) AND ( ( l.max EQ 0 ) OR ( l.group_count LT l.max ) ) }">
		<MvASSIGN NAME = "l.group_count" VALUE = "{ l.group_count + 1 }">
		<MvEVAL EXPR = "{ PriceGroup_Read( l.groups[ l.group_count ] ) }">

		<MvSKIP NAME = "Merchant" VIEW = "PriceGroups" ROWS = 1>
	</MvWHILE>

	<MvIF EXPR = "{ PriceGroups.d.EOF }">
		<MvASSIGN NAME = "l.nextoffset"	VALUE = 0>
	<MvELSE>
		<MvASSIGN NAME = "l.nextoffset"	VALUE = "{ l.offset + l.group_count }">
	</MvIF>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroups">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-PGR-DTB-00030', l.group_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupList_Load_All" PARAMETERS = "pricegroups var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PriceGroups"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'PriceGroups ORDER BY priority DESC, id ASC' }">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00017', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.pricegroup_count" VALUE = 0>
	<MvWHILE EXPR = "{ NOT PriceGroups.d.EOF }">
		<MvASSIGN NAME = "l.pricegroup_count" VALUE = "{ l.pricegroup_count + 1 }">
		<MvEVAL EXPR = "{ PriceGroup_Read( l.pricegroups[ l.pricegroup_count ] ) }">

		<MvSKIP NAME = "Merchant" VIEW = "PriceGroups" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroups">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-PGR-DTB-00031', l.pricegroup_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupAndModuleList_Load_All" PARAMETERS = "pricegroups var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PriceGroups"
				QUERY	= "{ 'SELECT
								pgr.*,
								m.id		AS loaded_module_id,
								m.code		AS module_code,
								m.name		AS module_name,
								m.provider	AS module_provider,
								m.api_ver	AS module_api_ver,
								m.version	AS module_version,
								m.module	AS module_module,
								m.refcount	AS module_refcount,
								m.active	AS module_active,
								m.priority	AS module_priority
							  FROM
								' $ g.Store_Table_Prefix $ 'PriceGroups pgr
								LEFT OUTER JOIN Modules m ON m.id = pgr.module_id
							  ORDER BY
								pgr.priority DESC, pgr.id ASC' }">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00313', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.pricegroup_count" VALUE = 0>
	<MvWHILE EXPR = "{ NOT PriceGroups.d.EOF }">
		<MvEVAL EXPR = "{ PriceGroupAndModule_Read( l.pricegroups[ ++l.pricegroup_count ] ) }">

		<MvSKIP NAME = "Merchant" VIEW = "PriceGroups" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroups">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-PGR-DTB-00314', l.pricegroup_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupList_Load_Module" PARAMETERS = "module_id, pricegroups var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PriceGroups"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'PriceGroups WHERE module_id = ?' }"
				FIELDS	= "l.module_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00117', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.pricegroup_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT PriceGroups.d.EOF }">
		<MvEVAL EXPR = "{ PriceGroup_Read( l.pricegroups[ ++l.pricegroup_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "PriceGroups" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroups">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-PGR-DTB-00118', l.pricegroup_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroup_Count_Module" PARAMETERS = "module_id, count var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PriceGroups"
				QUERY	= "{ 'SELECT COUNT( * ) AS pricegroup_count FROM ' $ g.Store_Table_Prefix $ 'PriceGroups WHERE module_id = ?' }"
				FIELDS	= "l.module_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00342', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ PriceGroups.d.EOF }">
		<MvASSIGN NAME = "l.count"	VALUE = 0>

		<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroups">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvASSIGN NAME = "l.count"		VALUE = "{ PriceGroups.d.pricegroup_count }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroups">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupAndModuleList_Load_BusinessAccount" PARAMETERS = "account_id, pricegroups var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ PriceGroupAndModuleList_Load_BusinessAccount_AsOf( l.account_id, [ g.Module_Feature_TUI_MGR ].TemplateManager_DateTime(), l.pricegroups ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupAndModuleList_Load_BusinessAccount_AsOf" PARAMETERS = "account_id, asof, pricegroups var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PriceGroups"
				QUERY	= "{ 'SELECT
								pgr.*,
								m.id			AS loaded_module_id,
								m.code			AS module_code,
								m.name			AS module_name,
								m.provider		AS module_provider,
								m.api_ver		AS module_api_ver,
								m.version		AS module_version,
								m.module		AS module_module,
								m.refcount		AS module_refcount,
								m.active		AS module_active,
								m.priority		AS module_priority
							  FROM
								' $ g.Store_Table_Prefix $ 'PriceGroups pgr
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'PriceGroupXBusinessAccount pgxba ON pgxba.account_id = ? AND pgxba.pgrp_id = pgr.id
								LEFT OUTER JOIN Modules m ON m.id = pgr.module_id
							  WHERE
								(
									pgr.custscope = \'L\'				OR
									pgr.custscope = \'A\'				OR
									(
										pgr.custscope = \'X\'			AND
										(
											pgxba.account_id IS NOT NULL
										)
									)
								)										AND
								(
									pgr.module_id	= 0					OR
									m.active		= 1
								)										AND
								(
									pgr.dt_start	= 0					OR
									pgr.dt_start	<= ?
								)										AND
								(
									pgr.dt_end		= 0					OR
									pgr.dt_end		>= ?
								)
							  ORDER BY
								pgr.priority DESC, pgr.id ASC' }"
				FIELDS	= "l.account_id, l.asof, l.asof">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00230', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.pricegroup_count"				VALUE = 0>

	<MvWHILE EXPR = "{ NOT PriceGroups.d.EOF }">
		<MvEVAL EXPR = "{ PriceGroupAndModule_Read( l.pricegroups[ ++l.pricegroup_count ] ) }">

		<MvSKIP NAME = "Merchant" VIEW = "PriceGroups" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroups">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-PGR-DTB-00231', l.pricegroup_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupAndModuleList_Load_Customer" PARAMETERS = "cust_id, pricegroups var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ PriceGroupAndModuleList_Load_Customer_AsOf( l.cust_id, [ g.Module_Feature_TUI_MGR ].TemplateManager_DateTime(), l.pricegroups ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupAndModuleList_Load_Customer_AsOf" PARAMETERS = "cust_id, asof, pricegroups var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.columns"	VALUE = "pgr.*,
											 m.id			AS loaded_module_id,
											 m.code			AS module_code,
											 m.name			AS module_name,
											 m.provider		AS module_provider,
											 m.api_ver		AS module_api_ver,
											 m.version		AS module_version,
											 m.module		AS module_module,
											 m.refcount		AS module_refcount,
											 m.active		AS module_active,
											 m.priority		AS module_priority">
	<MvIF EXPR = "{ l.cust_id EQ 0 }">
		<MvOPENVIEW NAME	= "Merchant"
					VIEW	= "PriceGroups"
					QUERY	= "{ 'SELECT
									' $ l.columns $ '
								  FROM
									' $ g.Store_Table_Prefix $ 'PriceGroups pgr
									LEFT OUTER JOIN Modules m ON m.id = pgr.module_id
								  WHERE
									pgr.custscope		= \'A\'	AND
									(
										pgr.module_id	= 0		OR
										m.active		= 1
									)							AND
									(
										pgr.dt_start	= 0		OR
										pgr.dt_start	<= ?
									)							AND
									(
										pgr.dt_end		= 0		OR
										pgr.dt_end		>= ?
									)
								  ORDER BY
									pgr.priority DESC, pgr.id ASC' }"
					FIELDS	= "l.asof, l.asof">
		<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00065', g.MvOPENVIEW_Error ) }">
		</MvIF>
	<MvELSE>
		<MvOPENVIEW NAME	= "Merchant"
					VIEW	= "PriceGroups"
					QUERY	= "{ 'SELECT
									' $ l.columns $ '
								  FROM
									' $ g.Store_Table_Prefix $ 'PriceGroups pgr
									LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'Customers cust ON cust.id = ?
									LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'PriceGroupXCustomer pgxc ON cust.id = pgxc.cust_id AND pgxc.pgrp_id = pgr.id
									LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'PriceGroupXBusinessAccount pgxba ON pgxba.account_id = cust.account_id AND pgxba.pgrp_id = pgr.id
									LEFT OUTER JOIN Modules m ON m.id = pgr.module_id
								  WHERE
									(
										pgr.custscope = \'L\'				OR
										pgr.custscope = \'A\'				OR
										(
											pgr.custscope = \'X\'			AND
											(
												pgxc.cust_id IS NOT NULL	OR
												pgxba.account_id IS NOT NULL
											)
										)
									)										AND
									(
										pgr.module_id	= 0					OR
										m.active		= 1
									)										AND
									(
										pgr.dt_start	= 0					OR
										pgr.dt_start	<= ?
									)										AND
									(
										pgr.dt_end		= 0					OR
										pgr.dt_end		>= ?
									)
								  ORDER BY
									pgr.priority DESC, pgr.id ASC' }"
					FIELDS	= "l.cust_id, l.asof, l.asof">
		<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00066', g.MvOPENVIEW_Error ) }">
		</MvIF>
	</MvIF>

	<MvASSIGN NAME = "l.pricegroup_count"				VALUE = 0>

	<MvWHILE EXPR = "{ NOT PriceGroups.d.EOF }">
		<MvEVAL EXPR = "{ PriceGroupAndModule_Read( l.pricegroups[ ++l.pricegroup_count ] ) }">

		<MvSKIP NAME = "Merchant" VIEW = "PriceGroups" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroups">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-PGR-DTB-00067', l.pricegroup_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupAndModuleList_Load_AllLoggedInCustomers" PARAMETERS = "pricegroups var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ PriceGroupAndModuleList_Load_AllLoggedInCustomers_AsOf( [ g.Module_Feature_TUI_MGR ].TemplateManager_DateTime(), l.pricegroups ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupAndModuleList_Load_AllLoggedInCustomers_AsOf" PARAMETERS = "asof, pricegroups var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PriceGroups"
				QUERY	= "{ 'SELECT
								pgr.*,
								m.id			AS loaded_module_id,
								m.code			AS module_code,
								m.name			AS module_name,
								m.provider		AS module_provider,
								m.api_ver		AS module_api_ver,
								m.version		AS module_version,
								m.module		AS module_module,
								m.refcount		AS module_refcount,
								m.active		AS module_active,
								m.priority		AS module_priority
							  FROM
								' $ g.Store_Table_Prefix $ 'PriceGroups pgr
								LEFT OUTER JOIN Modules m ON m.id = pgr.module_id
							  WHERE
								(
									pgr.custscope = \'L\'				OR
									pgr.custscope = \'A\'
								)										AND
								(
									pgr.module_id	= 0					OR
									m.active		= 1
								)										AND
								(
									pgr.dt_start	= 0					OR
									pgr.dt_start	<= ?
								)										AND
								(
									pgr.dt_end		= 0					OR
									pgr.dt_end		>= ?
								)
							  ORDER BY
								pgr.priority DESC, pgr.id ASC' }"
				FIELDS	= "l.asof, l.asof">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00232', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.pricegroup_count"				VALUE = 0>

	<MvWHILE EXPR = "{ NOT PriceGroups.d.EOF }">
		<MvEVAL EXPR = "{ PriceGroupAndModule_Read( l.pricegroups[ ++l.pricegroup_count ] ) }">

		<MvSKIP NAME = "Merchant" VIEW = "PriceGroups" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroups">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-PGR-DTB-00233', l.pricegroup_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupAndModuleList_Load_DiscountSignature" PARAMETERS = "dscsig_id, pricegroups var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PriceGroups"
				QUERY	= "{ 'SELECT
								pgr.*,
								m.id			AS loaded_module_id,
								m.code			AS module_code,
								m.name			AS module_name,
								m.provider		AS module_provider,
								m.api_ver		AS module_api_ver,
								m.version		AS module_version,
								m.module		AS module_module,
								m.refcount		AS module_refcount,
								m.active		AS module_active,
								m.priority		AS module_priority
							  FROM
								' $ g.Store_Table_Prefix $ 'DiscountSignatureXPriceGroup dsxpg,
								' $ g.Store_Table_Prefix $ 'PriceGroups pgr
								LEFT OUTER JOIN Modules m ON m.id = pgr.module_id
							  WHERE
								dsxpg.dscsig_id		= ?					AND
								pgr.id				= dsxpg.pgrp_id
							  ORDER BY
								pgr.priority DESC, pgr.id ASC' }"
				FIELDS	= "l.dscsig_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00234', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.pricegroup_count"				VALUE = 0>

	<MvWHILE EXPR = "{ NOT PriceGroups.d.EOF }">
		<MvEVAL EXPR = "{ PriceGroupAndModule_Read( l.pricegroups[ ++l.pricegroup_count ] ) }">

		<MvSKIP NAME = "Merchant" VIEW = "PriceGroups" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroups">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-PGR-DTB-00235', l.pricegroup_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupAndModuleList_Load_Basket_Coupons" PARAMETERS = "basket var, pricegroups var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ [ g.Module_Library_DB ].Basket_Is_Provisional( l.basket ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-PGR-DTB-00326', 0 ) }">
	</MvIF>

	<MvASSIGN NAME = "l.datetime" 	VALUE = "{ [ g.Module_Feature_TUI_MGR ].TemplateManager_DateTime() }">

	<MvASSIGN NAME = "l.columns"	VALUE = "pgr.*,
											 cxpg.coupon_id	AS coupon_id,
											 m.id			AS loaded_module_id,
											 m.code			AS module_code,
											 m.name			AS module_name,
											 m.provider		AS module_provider,
											 m.api_ver		AS module_api_ver,
											 m.version		AS module_version,
											 m.module		AS module_module,
											 m.refcount		AS module_refcount,
											 m.active		AS module_active,
											 m.priority		AS module_priority">
	<MvIF EXPR = "{ l.basket:cust_id EQ 0 }">
		<MvOPENVIEW NAME	= "Merchant"
					VIEW	= "PriceGroups"
					QUERY	= "{ 'SELECT
									' $ l.columns $ '
								  FROM
									' $ g.Store_Table_Prefix $ 'BasketCoupons bc,
									' $ g.Store_Table_Prefix $ 'CouponXPriceGroup cxpg
									LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'CouponXAnonymousShopper cxas ON cxas.coupon_id = cxpg.coupon_id AND ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'cxas.bill_email' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) $ ',
									' $ g.Store_Table_Prefix $ 'Coupons c,
									' $ g.Store_Table_Prefix $ 'PriceGroups pgr
									LEFT OUTER JOIN Modules m ON m.id = pgr.module_id
								  WHERE
									bc.basket_id		= ?				AND
									cxpg.coupon_id		= bc.coupon_id	AND
									pgr.id				= cxpg.pgrp_id	AND
									(
										pgr.module_id	= 0				OR
										m.active		= 1
									)									AND
									c.id				= bc.coupon_id	AND
									(
										c.dt_start		= 0				OR
										c.dt_start		<= ?
									)									AND
									(
										c.dt_end		= 0				OR
										c.dt_end		>= ?
									)									AND
									(
										c.max_use		= 0				OR
										c.use_count		< c.max_use
									)									AND
									(
										c.max_per		= 0				OR
										cxas.coupon_id IS NULL			OR
										cxas.use_count	< c.max_per
									)
								  ORDER BY
									pgr.priority DESC, pgr.id ASC, c.id ASC' }"
					FIELDS	= "l.basket:bill_email, l.basket:basket_id, l.datetime, l.datetime">
		<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00068', g.MvOPENVIEW_Error ) }">
		</MvIF>
	<MvELSE>
		<MvOPENVIEW NAME	= "Merchant"
					VIEW	= "PriceGroups"
					QUERY	= "{ 'SELECT
									' $ l.columns $ '
								  FROM
									' $ g.Store_Table_Prefix $ 'BasketCoupons bc,
									' $ g.Store_Table_Prefix $ 'CouponXPriceGroup cxpg
									LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'CouponXAnonymousShopper cxas ON cxas.coupon_id = cxpg.coupon_id AND ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'cxas.bill_email' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) $ '
									LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'CouponXShopper cxs ON cxs.coupon_id = cxpg.coupon_id AND cxs.cust_id = ?,
									' $ g.Store_Table_Prefix $ 'Coupons c,
									' $ g.Store_Table_Prefix $ 'PriceGroups pgr
									LEFT OUTER JOIN Modules m ON m.id = pgr.module_id
								  WHERE
									bc.basket_id		= ?				AND
									cxpg.coupon_id		= bc.coupon_id	AND
									pgr.id				= cxpg.pgrp_id	AND
									(
										pgr.module_id	= 0				OR
										m.active		= 1
									)									AND
									c.id				= bc.coupon_id	AND
									(
										c.dt_start		= 0				OR
										c.dt_start		<= ?
									)									AND
									(
										c.dt_end		= 0				OR
										c.dt_end		>= ?
									)									AND
									(
										c.max_use		= 0				OR
										c.use_count		< c.max_use
									)									AND
									(
										c.max_per		= 0				OR
										(
											(
												cxas.coupon_id IS NULL		OR
												cxas.use_count	< c.max_per
											)								AND
											(
												cxs.coupon_id IS NULL		OR
												cxs.use_count < c.max_per
											)
										)
									)
								  ORDER BY
									pgr.priority DESC, pgr.id ASC, c.id ASC' }"
					FIELDS	= "l.basket:bill_email, l.basket:cust_id, l.basket:basket_id, l.datetime, l.datetime">
		<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00069', g.MvOPENVIEW_Error ) }">
		</MvIF>
	</MvIF>

	<MvASSIGN NAME = "l.pricegroup_count"				VALUE = 0>

	<MvWHILE EXPR = "{ NOT PriceGroups.d.EOF }">
		<MvREFERENCEARRAY NAME = "l.pricegroup" VARIABLE = "l.pricegroups">
			<MvDIMENSION INDEX = "{ ++l.pricegroup_count }">
		</MvREFERENCEARRAY>

		<MvEVAL EXPR = "{ PriceGroupAndModule_Read( l.pricegroup ) }">

		<MvASSIGN NAME = "l.pricegroup:coupon_id"		VALUE = "{ PriceGroups.d.coupon_id }">

		<MvSKIP NAME = "Merchant" VIEW = "PriceGroups" ROWS = 1>
	</MvWHILE>
	
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroups">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-PGR-DTB-00070', l.pricegroup_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupAndModuleList_Load_Coupon" PARAMETERS = "coupon_id, pricegroups var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PriceGroups"
				QUERY	= "{ 'SELECT
								pgr.*,
								cxpg.coupon_id	AS coupon_id,
								m.id			AS loaded_module_id,
								m.code			AS module_code,
								m.name			AS module_name,
								m.provider		AS module_provider,
								m.api_ver		AS module_api_ver,
								m.version		AS module_version,
								m.module		AS module_module,
								m.refcount		AS module_refcount,
								m.active		AS module_active,
								m.priority		AS module_priority
							  FROM
								' $ g.Store_Table_Prefix $ 'CouponXPriceGroup cxpg,
								' $ g.Store_Table_Prefix $ 'PriceGroups pgr
								LEFT OUTER JOIN Modules m ON m.id = pgr.module_id
							  WHERE
								cxpg.coupon_id		= ?				AND
								pgr.id				= cxpg.pgrp_id	AND
								(
									pgr.module_id	= 0				OR
									m.active		= 1
								)
							  ORDER BY
								pgr.priority DESC, pgr.id ASC' }"
				FIELDS	= "l.coupon_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00071', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.pricegroup_count"				VALUE = 0>

	<MvWHILE EXPR = "{ NOT PriceGroups.d.EOF }">
		<MvREFERENCEARRAY NAME = "l.pricegroup" VARIABLE = "l.pricegroups">
			<MvDIMENSION INDEX = "{ ++l.pricegroup_count }">
		</MvREFERENCEARRAY>

		<MvEVAL EXPR = "{ PriceGroupAndModule_Read( l.pricegroup ) }">

		<MvASSIGN NAME = "l.pricegroup:coupon_id"		VALUE = "{ l.coupon_id }">

		<MvSKIP NAME = "Merchant" VIEW = "PriceGroups" ROWS = 1>
	</MvWHILE>
	
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroups">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-PGR-DTB-00072', l.pricegroup_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupAndModuleList_Load_Order" PARAMETERS = "order_id, pricegroups var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PriceGroups"
				QUERY	= "{ 'SELECT
								pgr.*,
								odt.coupon_id	AS coupon_id,
								m.id			AS loaded_module_id,
								m.code			AS module_code,
								m.name			AS module_name,
								m.provider		AS module_provider,
								m.api_ver		AS module_api_ver,
								m.version		AS module_version,
								m.module		AS module_module,
								m.refcount		AS module_refcount,
								m.active		AS module_active,
								m.priority		AS module_priority
							  FROM
								' $ g.Store_Table_Prefix $ 'OrderDiscountTotals odt,
								' $ g.Store_Table_Prefix $ 'PriceGroups pgr
								LEFT OUTER JOIN Modules m ON m.id = pgr.module_id
							  WHERE
								odt.order_id	= ?				AND
								pgr.id			= odt.pgrp_id
							  ORDER BY
								pgr.priority DESC, pgr.id ASC' }"
				FIELDS	= "l.order_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00138', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.pricegroup_count"				VALUE = 0>

	<MvWHILE EXPR = "{ NOT PriceGroups.d.EOF }">
		<MvREFERENCEARRAY NAME = "l.pricegroup" VARIABLE = "l.pricegroups">
			<MvDIMENSION INDEX = "{ ++l.pricegroup_count }">
		</MvREFERENCEARRAY>

		<MvEVAL EXPR = "{ PriceGroupAndModule_Read( l.pricegroup ) }">

		<MvASSIGN NAME = "l.pricegroup:coupon_id"		VALUE = "{ PriceGroups.d.coupon_id }">

		<MvSKIP NAME = "Merchant" VIEW = "PriceGroups" ROWS = 1>
	</MvWHILE>
	
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroups">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-PGR-DTB-00139', l.pricegroup_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroup_Load_ID" PARAMETERS = "id, pricegroup var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PriceGroups"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'PriceGroups WHERE id = ?' }"
				FIELDS	= "l.id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00018', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ PriceGroups.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroups">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-PGR-DTB-00032' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ PriceGroup_Read( l.pricegroup ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroups">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroup_Load_Name" PARAMETERS = "name, pricegroup var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PriceGroups"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'PriceGroups WHERE ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'name' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) }"
				FIELDS	= "l.name">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00019', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ PriceGroups.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroups">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-PGR-DTB-00033' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ PriceGroup_Read( l.pricegroup ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroups">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupLookup_Load_Product_Cached" PARAMETERS = "product_id, pricegroup_lookup var" STANDARDOUTPUTLEVEL = "">
	<MvREFERENCE NAME = "l.cache"						VARIABLE = "g.Session:cache:pricegrouplookup_load_product">

	<MvIF EXPR = "{ l.cache:product_id NE l.product_id }">
		<MvASSIGN NAME = "l.cache:result"				VALUE = "{ PriceGroupLookup_Load_Product( l.product_id, l.cache:lookup ) }">
		<MvIF EXPR = "{ NOT l.cache:result }">
			<MvASSIGN NAME = "l.cache:error_code"		VALUE = "{ g.Error_Code }">
			<MvASSIGN NAME = "l.cache:error_message"	VALUE = "{ g.Error_Message }">
			<MvASSIGN NAME = "l.cache:error_db_eof"		VALUE = "{ g.Error_DB_EOF }">
		</MvIF>
	</MvIF>

	<MvIF EXPR = "{ NOT l.cache:result }">
		<MvIF EXPR = "{ l.cache:error_db_eof }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( l.cache:error_code ) }">
		</MvIF>

		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( l.cache:error_code, l.cache:error_message ) }">
	</MvIF>

	<MvASSIGN NAME = "l.pricegroup_lookup"				VALUE = "{ l.cache:lookup }">

	<MvFUNCTIONRETURN VALUE = "{ l.cache:result }">
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupLookup_Load_Product" PARAMETERS = "product_id, pricegroup_lookup var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.pricegroup_lookup"	VALUE = "">
	<MvASSIGN NAME = "l.inclusion_ids"		VALUE = "">
	<MvASSIGN NAME = "l.exclusion_ids"		VALUE = "">

	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PriceGroups"
				QUERY	= "{ 'SELECT
								pg.*
							  FROM
								' $ g.Store_Table_Prefix $ 'PriceGroups pg,
								' $ g.Store_Table_Prefix $ 'PriceGroupXProduct pgxp
							  WHERE
								pg.exclusion	= 0		AND
								pgxp.pgrp_id	= pg.id	AND
								pgxp.product_id	= ?
							  UNION ALL
							  SELECT
								pg.*
							  FROM
								' $ g.Store_Table_Prefix $ 'PriceGroups pg
								LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedProduct pgxep ON pgxep.pgrp_id = pg.id AND pgxep.product_id = ?
							  WHERE
								pg.exclusion	= 1		AND
								pgxep.pgrp_id IS NULL' }"
				FIELDS	= "l.product_id, l.product_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00291', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvWHILE EXPR = "{ NOT PriceGroups.d.EOF }">
		<MvEVAL EXPR = "{ PriceGroup_Read( l.pricegroup ) }">

		<MvIF EXPR = "{ l.pricegroup:id GT 0 }">
			<MvIF EXPR = "{ l.pricegroup:exclusion }">
				<MvASSIGN NAME = "l.exclusion_ids"		INDEX = "{ l.pricegroup:id }"	VALUE = 1>
			<MvELSE>
				<MvASSIGN NAME = "l.inclusion_ids"		INDEX = "{ l.pricegroup:id }"	VALUE = 1>
				<MvASSIGN NAME = "l.pricegroup_lookup"	INDEX = "{ l.pricegroup:id }"	VALUE = "{ l.pricegroup }">
			</MvIF>
		</MvIF>

		<MvSKIP NAME = "Merchant" VIEW = "PriceGroups" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroups">

	<MvOPENVIEW NAME	= "Merchant"
				VIEW 	= "PriceGroups"
				QUERY 	= "{ 'SELECT
								pg.*
							  FROM
							  	' $ g.Store_Table_Prefix $ 'PriceGroups pg,
							  	' $ g.Store_Table_Prefix $ 'PriceGroupXCategory pgxc,
							  	' $ g.Store_Table_Prefix $ 'CategoryXProduct cxp
							  WHERE
							  	pg.exclusion	= 0				AND
							  	pg.id			= pgxc.pgrp_id	AND
							  	cxp.product_id	= ?				AND
							  	cxp.cat_id		= pgxc.cat_id
							  UNION ALL
							  SELECT DISTINCT
							  	pg.*
							  FROM
							  	' $ g.Store_Table_Prefix $ 'PriceGroups pg
							  	LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedCategory pgxec ON pgxec.pgrp_id = pg.id
							  	LEFT OUTER JOIN	' $ g.Store_Table_Prefix $ 'CategoryXProduct cxp ON cxp.cat_id = pgxec.cat_id AND cxp.product_id = ?
							  WHERE
							  	pg.exclusion	= 1 AND
							  	cxp.product_id IS NULL' }"
				FIELDS	= "l.product_id, l.product_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00292', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvWHILE EXPR = "{ NOT PriceGroups.d.EOF }">
		<MvEVAL EXPR = "{ PriceGroup_Read( l.pricegroup ) }">

		<MvIF EXPR = "{ l.pricegroup:id GT 0 }">
			<MvIF EXPR = "{ l.pricegroup:exclusion }">
				<MvIF EXPR = "{ l.exclusion_ids[ l.pricegroup:id ] }">
					<MvASSIGN NAME = "l.pricegroup_lookup" INDEX = "{ l.pricegroup:id }"	VALUE = "{ l.pricegroup }">
				</MvIF>
			<MvELSE>
				<MvIF EXPR = "{ NOT l.inclusion_ids[ l.pricegroup:id ] }">
					<MvASSIGN NAME = "l.pricegroup_lookup" INDEX = "{ l.pricegroup:id }"	VALUE = "{ l.pricegroup }">
				</MvIF>
			</MvIF>
		</MvIF>

		<MvSKIP NAME = "Merchant" VIEW = "PriceGroups" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroups">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_PriceGroupExclusions
|
</MvCOMMENT>

<MvFUNCTION NAME = "PriceGroupExclusion_Read" PARAMETERS = "pricegroupexclusion var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.pricegroupexclusion:pgrp_id1"	VALUE = "{ PriceGroupExclusions.d.pgrp_id1 }">
	<MvASSIGN NAME = "l.pricegroupexclusion:pgrp_id2"	VALUE = "{ PriceGroupExclusions.d.pgrp_id2 }">
	<MvASSIGN NAME = "l.pricegroupexclusion:scope"		VALUE = "{ PriceGroupExclusions.d.scope }">
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupExclusion_Insert" PARAMETERS = "pricegroupexclusion var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'PriceGroupExclusions
						  ( pgrp_id1, pgrp_id2, scope )
						  VALUES
						  ( ?, ?, ? )' }"
			 FIELDS	= "l.pricegroupexclusion:pgrp_id1, l.pricegroupexclusion:pgrp_id2, l.pricegroupexclusion:scope">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00073', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupExclusion_Delete" PARAMETERS = "pricegroupexclusion var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupExclusions
						  WHERE
							pgrp_id1	= ? AND
							pgrp_id2	= ?' }"
			 FIELDS	= "l.pricegroupexclusion:pgrp_id1, l.pricegroupexclusion:pgrp_id2">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00074', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupExclusion_Delete_All_PriceGroup" PARAMETERS = "pgrp_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupExclusions
						  WHERE
							pgrp_id1	= ? OR
							pgrp_id2	= ?' }"
			 FIELDS	= "l.pgrp_id, l.pgrp_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00075', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupExclusion_Copy_All_PriceGroup" PARAMETERS = "source_pgrp_id, dest_pgrp_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'PriceGroupExclusions ( pgrp_id1, pgrp_id2, scope )
			 			  SELECT ?, pgrp_id2, scope FROM ' $ g.Store_Table_Prefix $ 'PriceGroupExclusions WHERE pgrp_id1 = ? UNION
						  SELECT pgrp_id1, ?, scope FROM ' $ g.Store_Table_Prefix $ 'PriceGroupExclusions WHERE pgrp_id2 = ?' }"
			 FIELDS = "l.dest_pgrp_id, l.source_pgrp_id,
					   l.dest_pgrp_id, l.source_pgrp_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00315', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupExclusionList_Load_PriceGroup" PARAMETERS = "pgrp_id, pricegroupexclusions var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PriceGroupExclusions"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'PriceGroupExclusions WHERE pgrp_id1	= ?
							  UNION ALL
							  SELECT * FROM ' $ g.Store_Table_Prefix $ 'PriceGroupExclusions WHERE pgrp_id2 = ?' }"
				FIELDS	= "l.pgrp_id, l.pgrp_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00076', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.pricegroupexclusion_count"		VALUE = 0>
	<MvWHILE EXPR = "{ NOT PriceGroupExclusions.d.EOF }">
		<MvEVAL EXPR = "{ PriceGroupExclusion_Read( l.pricegroupexclusions[ ++l.pricegroupexclusion_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "PriceGroupExclusions" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupExclusions">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-PGR-DTB-00077', l.pricegroupexclusion_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupExclusion_Load" PARAMETERS = "pgrp_id1, pgrp_id2, pricegroupexclusion var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PriceGroupExclusions"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'PriceGroupExclusions
							  WHERE
								pgrp_id1	= ? AND
								pgrp_id2	= ?' }"
				FIELDS	= "l.pgrp_id1, l.pgrp_id2">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00078', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ PriceGroupExclusions.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupExclusions">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-PGR-DTB-00079' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ PriceGroupExclusion_Read( l.pricegroupexclusion ) }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupExclusions">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_PriceGroupXCustomer
|
</MvCOMMENT>

<MvFUNCTION NAME = "PriceGroupXCustomer_Read" PARAMETERS = "pricegroupxcustomer var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.pricegroupxcustomer:pgrp_id"	VALUE = "{ PriceGroupXCustomer.d.pgrp_id }">
	<MvASSIGN NAME = "l.pricegroupxcustomer:cust_id"	VALUE = "{ PriceGroupXCustomer.d.cust_id }">
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXCustomer_Insert" PARAMETERS = "pgrp_id, cust_id" STANDARDOUTPUTLEVEL = "">
	<MvTRANSACT NAME = "Merchant">

	<MvIF EXPR = "{ NOT PriceGroupXCustomer_Insert_LowLevel( l.pgrp_id, l.cust_id ) OR
					NOT [ g.Module_Feature_CUS_DB ].Customer_Increment_PriceGroupCount( l.cust_id ) }">
		<MvROLLBACK NAME = "Merchant">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFOREACH ITERATOR = "l.module" ARRAY = "l.modules" COUNT = "{ [ g.Module_Library_DB ].StoreModuleList_Load_Features_Cached( 'not_pricegroup', l.modules ) }">
		<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Root $ l.module:module ].Module_Notify_PriceGroupXCustomer_Insert( l.module, l.pgrp_id, l.cust_id ) }">
	</MvFOREACH>

	<MvCOMMIT NAME = "Merchant">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXCustomer_Insert_LowLevel" PARAMETERS = "pgrp_id, cust_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'PriceGroupXCustomer
					      ( pgrp_id, cust_id )
						  VALUES
						  ( ?, ? )' }"
			 FIELDS	= "l.pgrp_id, l.cust_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00020', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXCustomer_Delete" PARAMETERS = "pgrp_id, cust_id" STANDARDOUTPUTLEVEL = "">
	<MvTRANSACT NAME = "Merchant">

	<MvIF EXPR = "{ NOT PriceGroupXCustomer_Delete_LowLevel( l.pgrp_id, l.cust_id ) OR
					NOT [ g.Module_Feature_CUS_DB ].Customer_Decrement_PriceGroupCount( l.cust_id ) }">
		<MvROLLBACK NAME = "Merchant">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFOREACH ITERATOR = "l.module" ARRAY = "l.modules" COUNT = "{ [ g.Module_Library_DB ].StoreModuleList_Load_Features_Cached( 'not_pricegroup', l.modules ) }">
		<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Root $ l.module:module ].Module_Notify_PriceGroupXCustomer_Delete( l.module, l.pgrp_id, l.cust_id ) }">
	</MvFOREACH>

	<MvCOMMIT NAME = "Merchant">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXCustomer_Delete_LowLevel" PARAMETERS = "pgrp_id, cust_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXCustomer
						  WHERE
							pgrp_id	= ? AND
							cust_id	= ?' }"
			 FIELDS	= "l.pgrp_id, l.cust_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00021', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXCustomer_Copy_All_PriceGroup" PARAMETERS = "source_pgrp_id, dest_pgrp_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'PriceGroupXCustomer ( pgrp_id, cust_id )
			 			  SELECT ?, cust_id FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXCustomer WHERE pgrp_id = ?' }"
			 FIELDS = "l.dest_pgrp_id, l.source_pgrp_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00316', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXCustomer_Load" PARAMETERS = "pgrp_id, cust_id, pricegroupxcustomer var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PriceGroupXCustomer"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXCustomer WHERE pgrp_id = ? AND cust_id = ?' }"
			    FIELDS	= "l.pgrp_id, l.cust_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00022', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ PriceGroupXCustomer.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupXCustomer">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-PGR-DTB-00034' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ PriceGroupXCustomer_Read( l.pricegroupxcustomer ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupXCustomer">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXCustomer_Delete_All_PriceGroup" PARAMETERS = "pgrp_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXCustomer WHERE pgrp_id = ?' }"
			 FIELDS	= "l.pgrp_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00023', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXCustomer_Delete_All_Customer" PARAMETERS = "cust_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXCustomer WHERE cust_id = ?' }"
			 FIELDS	= "l.cust_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00024', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_PriceGroupXProduct
|
</MvCOMMENT>

<MvFUNCTION NAME = "PriceGroupXProduct_Read" PARAMETERS = "pricegroupxproduct var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.pricegroupxproduct:pgrp_id"		VALUE = "{ PriceGroupXProduct.d.pgrp_id }">
	<MvASSIGN NAME = "l.pricegroupxproduct:product_id"	VALUE = "{ PriceGroupXProduct.d.product_id }">
	<MvASSIGN NAME = "l.pricegroupxproduct:automatic"	VALUE = "{ PriceGroupXProduct.d.automatic }">
	<MvASSIGN NAME = "l.pricegroupxproduct:colcount"	VALUE = "{ PriceGroupXProduct.d.colcount }">
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXProduct_Insert" PARAMETERS = "pgrp_id, product_id" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.pricegroupxproduct"				VALUE = "">
	<MvASSIGN NAME = "l.pricegroupxproduct:pgrp_id"		VALUE = "{ l.pgrp_id }">
	<MvASSIGN NAME = "l.pricegroupxproduct:product_id"	VALUE = "{ l.product_id }">
	<MvASSIGN NAME = "l.pricegroupxproduct:automatic"	VALUE = 0>
	<MvASSIGN NAME = "l.pricegroupxproduct:colcount"	VALUE = 0>

	<MvFUNCTIONRETURN VALUE = "{ v10_PriceGroupXProduct_Insert( l.pricegroupxproduct ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "v10_PriceGroupXProduct_Insert" PARAMETERS = "pricegroupxproduct var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT PriceGroupXProduct_Insert_LowLevel( l.pricegroupxproduct ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ NOT DiscountPrice_Delete_All_PriceGroupProduct( l.pricegroupxproduct:pgrp_id, l.pricegroupxproduct:product_id )			OR
					NOT DiscountVariantPrice_Delete_All_PriceGroupProduct( l.pricegroupxproduct:pgrp_id, l.pricegroupxproduct:product_id )	OR
					NOT PriceGroupXProductCollectionExclusion_Delete( l.pricegroupxproduct:pgrp_id, l.pricegroupxproduct:product_id )		OR
					NOT [ g.Module_Library_DB ].Product_Increment_PriceGroupCount( l.pricegroupxproduct:product_id ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFOREACH ITERATOR = "l.module" ARRAY = "l.modules" COUNT = "{ [ g.Module_Library_DB ].StoreModuleList_Load_Features_Cached( 'not_pricegroup', l.modules ) }">
		<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Root $ l.module:module ].Module_Notify_PriceGroupXProduct_Insert( l.module, l.pricegroupxproduct:pgrp_id, l.pricegroupxproduct:product_id ) }">
	</MvFOREACH>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXProduct_Insert_LowLevel" PARAMETERS = "pricegroupxproduct var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ ISNULL l.pricegroupxproduct:automatic }">	<MvASSIGN NAME = "l.pricegroupxproduct:automatic"	VALUE = 0> </MvIF>
	<MvIF EXPR = "{ ISNULL l.pricegroupxproduct:colcount }">	<MvASSIGN NAME = "l.pricegroupxproduct:colcount"	VALUE = 0> </MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'PriceGroupXProduct
					      ( pgrp_id, product_id, automatic, colcount )
						  VALUES
						  ( ?, ?, ?, ? )' }"
			 FIELDS	= "l.pricegroupxproduct:pgrp_id, l.pricegroupxproduct:product_id, l.pricegroupxproduct:automatic, l.pricegroupxproduct:colcount">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00025', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXProduct_Delete" PARAMETERS = "pgrp_id, product_id" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ PriceGroupXProduct_Load( l.pgrp_id, l.product_id, l.pricegroupxproduct ) }">
		<MvIF EXPR = "{ NOT v10_PriceGroupXProduct_Delete( l.pricegroupxproduct ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "v10_PriceGroupXProduct_Delete" PARAMETERS = "pricegroupxproduct var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT DiscountPrice_Delete_All_PriceGroupProduct( l.pricegroupxproduct:pgrp_id, l.pricegroupxproduct:product_id )			OR
					NOT DiscountVariantPrice_Delete_All_PriceGroupProduct( l.pricegroupxproduct:pgrp_id, l.pricegroupxproduct:product_id )	OR
					NOT PriceGroupXProduct_Delete_LowLevel( l.pricegroupxproduct:pgrp_id, l.pricegroupxproduct:product_id )					OR
					NOT [ g.Module_Library_DB ].Product_Decrement_PriceGroupCount( l.pricegroupxproduct:product_id ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ l.pricegroupxproduct:colcount GT 0 }">
		<MvASSIGN NAME = "l.pricegroupxproductcollectionexclusion"				VALUE = "">
		<MvASSIGN NAME = "l.pricegroupxproductcollectionexclusion:pgrp_id"		VALUE = "{ l.pricegroupxproduct:pgrp_id }">
		<MvASSIGN NAME = "l.pricegroupxproductcollectionexclusion:product_id"	VALUE = "{ l.pricegroupxproduct:product_id }">
		<MvASSIGN NAME = "l.pricegroupxproductcollectionexclusion:colcount"		VALUE = "{ l.pricegroupxproduct:colcount }">

		<MvIF EXPR = "{ NOT PriceGroupXProductCollectionExclusion_Insert( l.pricegroupxproductcollectionexclusion ) }">
			<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_Error_IsIndexDuplicate( g.Error_Message ) }">
				<MvFUNCTIONRETURN VALUE = 0>
			</MvIF>
		</MvIF>
	</MvIF>

	<MvFOREACH ITERATOR = "l.module" ARRAY = "l.modules" COUNT = "{ [ g.Module_Library_DB ].StoreModuleList_Load_Features_Cached( 'not_pricegroup', l.modules ) }">
		<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Root $ l.module:module ].Module_Notify_PriceGroupXProduct_Delete( l.module, l.pricegroupxproduct:pgrp_id, l.pricegroupxproduct:product_id ) }">
	</MvFOREACH>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXProduct_Delete_LowLevel" PARAMETERS = "pgrp_id, product_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXProduct
						  WHERE
							pgrp_id		= ? AND
							product_id	= ?' }"
			 FIELDS	= "l.pgrp_id, l.product_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00026', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXProduct_Copy_All_PriceGroup" PARAMETERS = "source_pgrp_id, dest_pgrp_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'PriceGroupXProduct ( pgrp_id, product_id, automatic, colcount )
			 			  SELECT ?, product_id, 0, 0 FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXProduct WHERE pgrp_id = ?' }"
			 FIELDS = "l.dest_pgrp_id, l.source_pgrp_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00317', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXProduct_Load" PARAMETERS = "pgrp_id, product_id, pricegroupxproduct var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PriceGroupXProduct"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXProduct WHERE pgrp_id = ? AND product_id = ?' }"
			    FIELDS	= "l.pgrp_id, l.product_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00027', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ PriceGroupXProduct.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupXProduct">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-PGR-DTB-00035' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ PriceGroupXProduct_Read( l.pricegroupxproduct ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupXProduct">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXProductLookup_Load_Product_Cached" PARAMETERS = "product_id, pricegroup_lookup var" STANDARDOUTPUTLEVEL = "">
	<MvREFERENCE NAME = "l.cache"						VARIABLE = "g.Session:cache:pricegroupxproductlookup_load_product">

	<MvIF EXPR = "{ l.cache:product_id NE l.product_id }">
		<MvASSIGN NAME = "l.cache:result"				VALUE = "{ PriceGroupXProductLookup_Load_Product( l.product_id, l.cache:lookup ) }">
		<MvIF EXPR = "{ NOT l.cache:result }">
			<MvASSIGN NAME = "l.cache:error_code"		VALUE = "{ g.Error_Code }">
			<MvASSIGN NAME = "l.cache:error_message"	VALUE = "{ g.Error_Message }">
			<MvASSIGN NAME = "l.cache:error_db_eof"		VALUE = "{ g.Error_DB_EOF }">
		</MvIF>
	</MvIF>

	<MvIF EXPR = "{ NOT l.cache:result }">
		<MvIF EXPR = "{ l.cache:error_db_eof }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( l.cache:error_code ) }">
		</MvIF>

		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( l.cache:error_code, l.cache:error_message ) }">
	</MvIF>

	<MvASSIGN NAME = "l.pricegroup_lookup"				VALUE = "{ l.cache:lookup }">

	<MvFUNCTIONRETURN VALUE = "{ l.cache:result }">
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXProductLookup_Load_Product" PARAMETERS = "product_id, pricegroup_lookup var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PriceGroupXProduct"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXProduct WHERE product_id = ?' }"
				FIELDS	= "l.product_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00080', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.pricegroup_lookup"													VALUE = "">
	<MvWHILE EXPR = "{ NOT PriceGroupXProduct.d.EOF }">
		<MvASSIGN NAME = "l.pricegroup_lookup" INDEX = "{ PriceGroupXProduct.d.pgrp_id }"	VALUE = 1>
		<MvSKIP NAME = "Merchant" VIEW = "PriceGroupXProduct" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupXProduct">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXProduct_Delete_All_PriceGroup" PARAMETERS = "pgrp_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXProduct WHERE pgrp_id = ?' }"
			 FIELDS	= "l.pgrp_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00028', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXProduct_Delete_All_Product" PARAMETERS = "product_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXProduct WHERE product_id = ?' }"
			 FIELDS	= "l.product_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00029', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_PriceGroupXExcludedProduct
|
</MvCOMMENT>

<MvFUNCTION NAME = "PriceGroupXExcludedProduct_Read" PARAMETERS = "pricegroupxexcludedproduct var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.pricegroupxexcludedproduct:pgrp_id"		VALUE = "{ PriceGroupXExcludedProduct.d.pgrp_id }">
	<MvASSIGN NAME = "l.pricegroupxexcludedproduct:product_id"	VALUE = "{ PriceGroupXExcludedProduct.d.product_id }">
	<MvASSIGN NAME = "l.pricegroupxexcludedproduct:automatic"	VALUE = "{ PriceGroupXExcludedProduct.d.automatic }">
	<MvASSIGN NAME = "l.pricegroupxexcludedproduct:colcount"	VALUE = "{ PriceGroupXExcludedProduct.d.colcount }">
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXExcludedProduct_Insert" PARAMETERS = "pgrp_id, product_id" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.pricegroupxexcludedproduct"				VALUE = "">
	<MvASSIGN NAME = "l.pricegroupxexcludedproduct:pgrp_id"		VALUE = "{ l.pgrp_id }">
	<MvASSIGN NAME = "l.pricegroupxexcludedproduct:product_id"	VALUE = "{ l.product_id }">
	<MvASSIGN NAME = "l.pricegroupxexcludedproduct:automatic"	VALUE = 0>
	<MvASSIGN NAME = "l.pricegroupxexcludedproduct:colcount"	VALUE = 0>

	<MvFUNCTIONRETURN VALUE = "{ v10_PriceGroupXExcludedProduct_Insert( l.pricegroupxexcludedproduct ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "v10_PriceGroupXExcludedProduct_Insert" PARAMETERS = "pricegroupxexcludedproduct var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT DiscountPrice_Delete_All_PriceGroupProduct( l.pricegroupxexcludedproduct:pgrp_id, l.pricegroupxexcludedproduct:product_id )				OR
					NOT DiscountVariantPrice_Delete_All_PriceGroupProduct( l.pricegroupxexcludedproduct:pgrp_id, l.pricegroupxexcludedproduct:product_id )		OR
					NOT PriceGroupXExcludedProductCollectionExclusion_Delete( l.pricegroupxexcludedproduct:pgrp_id, l.pricegroupxexcludedproduct:product_id )	OR
					NOT PriceGroupXExcludedProduct_Insert_LowLevel( l.pricegroupxexcludedproduct ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFOREACH ITERATOR = "l.module" ARRAY = "l.modules" COUNT = "{ [ g.Module_Library_DB ].StoreModuleList_Load_Features_Cached( 'not_pricegroup', l.modules ) }">
		<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Root $ l.module:module ].Module_Notify_PriceGroupXExcludedProduct_Insert( l.module, l.pricegroupxexcludedproduct:pgrp_id, l.pricegroupxexcludedproduct:product_id ) }">
	</MvFOREACH>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXExcludedProduct_Insert_LowLevel" PARAMETERS = "pricegroupxexcludedproduct var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ ISNULL l.pricegroupxexcludedproduct:automatic }">	<MvASSIGN NAME = "l.pricegroupxexcludedproduct:automatic"	VALUE = 0> </MvIF>
	<MvIF EXPR = "{ ISNULL l.pricegroupxexcludedproduct:colcount }">	<MvASSIGN NAME = "l.pricegroupxexcludedproduct:colcount"	VALUE = 0> </MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedProduct
					      ( pgrp_id, product_id, automatic, colcount )
						  VALUES
						  ( ?, ?, ?, ? )' }"
			 FIELDS	= "l.pricegroupxexcludedproduct:pgrp_id, l.pricegroupxexcludedproduct:product_id, l.pricegroupxexcludedproduct:automatic, l.pricegroupxexcludedproduct:colcount">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00197', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXExcludedProduct_Delete" PARAMETERS = "pgrp_id, product_id" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ PriceGroupXExcludedProduct_Load( l.pgrp_id, l.product_id, l.pricegroupxexcludedproduct ) }">
		<MvIF EXPR = "{ NOT v10_PriceGroupXExcludedProduct_Delete( l.pricegroupxexcludedproduct ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "v10_PriceGroupXExcludedProduct_Delete" PARAMETERS = "pricegroupxexcludedproduct var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT DiscountPrice_Delete_All_PriceGroupProduct( l.pricegroupxexcludedproduct:pgrp_id, l.pricegroupxexcludedproduct:product_id )			OR
					NOT DiscountVariantPrice_Delete_All_PriceGroupProduct( l.pricegroupxexcludedproduct:pgrp_id, l.pricegroupxexcludedproduct:product_id )	OR
					NOT PriceGroupXExcludedProduct_Delete_LowLevel( l.pricegroupxexcludedproduct:pgrp_id, l.pricegroupxexcludedproduct:product_id ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ l.pricegroupxexcludedproduct:colcount GT 0 }">
		<MvASSIGN NAME = "l.pricegroupxexcludedproductcollectionexclusion"				VALUE = "">
		<MvASSIGN NAME = "l.pricegroupxexcludedproductcollectionexclusion:pgrp_id"		VALUE = "{ l.pricegroupxexcludedproduct:pgrp_id }">
		<MvASSIGN NAME = "l.pricegroupxexcludedproductcollectionexclusion:product_id"	VALUE = "{ l.pricegroupxexcludedproduct:product_id }">
		<MvASSIGN NAME = "l.pricegroupxexcludedproductcollectionexclusion:colcount"		VALUE = "{ l.pricegroupxexcludedproduct:colcount }">

		<MvIF EXPR = "{ NOT PriceGroupXExcludedProductCollectionExclusion_Insert( l.pricegroupxexcludedproductcollectionexclusion ) }">
			<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_Error_IsIndexDuplicate( g.Error_Message ) }">
				<MvFUNCTIONRETURN VALUE = 0>
			</MvIF>
		</MvIF>
	</MvIF>

	<MvFOREACH ITERATOR = "l.module" ARRAY = "l.modules" COUNT = "{ [ g.Module_Library_DB ].StoreModuleList_Load_Features_Cached( 'not_pricegroup', l.modules ) }">
		<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Root $ l.module:module ].Module_Notify_PriceGroupXExcludedProduct_Delete( l.module, l.pricegroupxexcludedproduct:pgrp_id, l.pricegroupxexcludedproduct:product_id ) }">
	</MvFOREACH>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXExcludedProduct_Delete_LowLevel" PARAMETERS = "pgrp_id, product_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedProduct
						  WHERE
							pgrp_id		= ? AND
							product_id	= ?' }"
			 FIELDS	= "l.pgrp_id, l.product_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00198', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXExcludedProduct_Copy_All_PriceGroup" PARAMETERS = "source_pgrp_id, dest_pgrp_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedProduct ( pgrp_id, product_id, automatic, colcount )
			 			  SELECT ?, product_id, 0, 0 FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedProduct WHERE pgrp_id = ?' }"
			 FIELDS = "l.dest_pgrp_id, l.source_pgrp_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00318', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXExcludedProduct_Load" PARAMETERS = "pgrp_id, product_id, pricegroupxexcludedproduct var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PriceGroupXExcludedProduct"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedProduct WHERE pgrp_id = ? AND product_id = ?' }"
			    FIELDS	= "l.pgrp_id, l.product_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00199', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ PriceGroupXExcludedProduct.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupXExcludedProduct">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-PGR-DTB-00200' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ PriceGroupXExcludedProduct_Read( l.pricegroupxexcludedproduct ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupXExcludedProduct">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXExcludedProduct_Delete_All_PriceGroup" PARAMETERS = "pgrp_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedProduct WHERE pgrp_id = ?' }"
			 FIELDS	= "l.pgrp_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00201', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXExcludedProduct_Delete_All_Product" PARAMETERS = "product_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedProduct WHERE product_id = ?' }"
			 FIELDS	= "l.product_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00202', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_PriceGroupXQualifyingProduct
|
</MvCOMMENT>

<MvFUNCTION NAME = "PriceGroupXQualifyingProduct_Read" PARAMETERS = "pricegroupxqualifyingproduct var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.pricegroupxqualifyingproduct:pgrp_id"		VALUE = "{ PriceGroupXQualifyingProduct.d.pgrp_id }">
	<MvASSIGN NAME = "l.pricegroupxqualifyingproduct:product_id"	VALUE = "{ PriceGroupXQualifyingProduct.d.product_id }">
	<MvASSIGN NAME = "l.pricegroupxqualifyingproduct:automatic"		VALUE = "{ PriceGroupXQualifyingProduct.d.automatic }">
	<MvASSIGN NAME = "l.pricegroupxqualifyingproduct:colcount"		VALUE = "{ PriceGroupXQualifyingProduct.d.colcount }">
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXQualifyingProduct_Insert" PARAMETERS = "pgrp_id, product_id" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.pricegroupxqualifyingproduct"				VALUE = "">
	<MvASSIGN NAME = "l.pricegroupxqualifyingproduct:pgrp_id"		VALUE = "{ l.pgrp_id }">
	<MvASSIGN NAME = "l.pricegroupxqualifyingproduct:product_id"	VALUE = "{ l.product_id }">
	<MvASSIGN NAME = "l.pricegroupxqualifyingproduct:automatic"		VALUE = 0>
	<MvASSIGN NAME = "l.pricegroupxqualifyingproduct:colcount"		VALUE = 0>

	<MvFUNCTIONRETURN VALUE = "{ v10_PriceGroupXQualifyingProduct_Insert( l.pricegroupxqualifyingproduct ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "v10_PriceGroupXQualifyingProduct_Insert" PARAMETERS = "pricegroupxqualifyingproduct var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT PriceGroupXQualifyingProduct_Insert_LowLevel( l.pricegroupxqualifyingproduct ) OR
					NOT PriceGroupXQualifyingProductCollectionExclusion_Delete( l.pricegroupxqualifyingproduct:pgrp_id, l.pricegroupxqualifyingproduct:product_id ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFOREACH ITERATOR = "l.module" ARRAY = "l.modules" COUNT = "{ [ g.Module_Library_DB ].StoreModuleList_Load_Features_Cached( 'not_pricegroup', l.modules ) }">
		<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Root $ l.module:module ].Module_Notify_PriceGroupXQualifyingProduct_Insert( l.module, l.pricegroupxqualifyingproduct:pgrp_id, l.pricegroupxqualifyingproduct:product_id ) }">
	</MvFOREACH>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXQualifyingProduct_Insert_LowLevel" PARAMETERS = "pricegroupxqualifyingproduct var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ ISNULL l.pricegroupxqualifyingproduct:automatic }">	<MvASSIGN NAME = "l.pricegroupxqualifyingproduct:automatic"	VALUE = 0> </MvIF>
	<MvIF EXPR = "{ ISNULL l.pricegroupxqualifyingproduct:colcount }">	<MvASSIGN NAME = "l.pricegroupxqualifyingproduct:colcount"	VALUE = 0> </MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingProduct
					      ( pgrp_id, product_id, automatic, colcount )
						  VALUES
						  ( ?, ?, ?, ? )' }"
			 FIELDS	= "l.pricegroupxqualifyingproduct:pgrp_id, l.pricegroupxqualifyingproduct:product_id, l.pricegroupxqualifyingproduct:automatic, l.pricegroupxqualifyingproduct:colcount">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00122', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXQualifyingProduct_Delete" PARAMETERS = "pgrp_id, product_id" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ PriceGroupXQualifyingProduct_Load( l.pgrp_id, l.product_id, l.pricegroupxqualifyingproduct ) }">
		<MvIF EXPR = "{ NOT v10_PriceGroupXQualifyingProduct_Delete( l.pricegroupxqualifyingproduct ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "v10_PriceGroupXQualifyingProduct_Delete" PARAMETERS = "pricegroupxqualifyingproduct var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT PriceGroupXQualifyingProduct_Delete_LowLevel( l.pricegroupxqualifyingproduct:pgrp_id, l.pricegroupxqualifyingproduct:product_id ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ l.pricegroupxqualifyingproduct:colcount GT 0 }">
		<MvASSIGN NAME = "l.pricegroupxqualifyingproductcollectionexclusion"			VALUE = "">
		<MvASSIGN NAME = "l.pricegroupxqualifyingproductcollectionexclusion:pgrp_id"	VALUE = "{ l.pricegroupxqualifyingproduct:pgrp_id }">
		<MvASSIGN NAME = "l.pricegroupxqualifyingproductcollectionexclusion:product_id"	VALUE = "{ l.pricegroupxqualifyingproduct:product_id }">
		<MvASSIGN NAME = "l.pricegroupxqualifyingproductcollectionexclusion:colcount"	VALUE = "{ l.pricegroupxqualifyingproduct:colcount }">

		<MvIF EXPR = "{ NOT PriceGroupXQualifyingProductCollectionExclusion_Insert( l.pricegroupxqualifyingproductcollectionexclusion ) }">
			<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_Error_IsIndexDuplicate( g.Error_Message ) }">
				<MvFUNCTIONRETURN VALUE = 0>
			</MvIF>
		</MvIF>
	</MvIF>

	<MvFOREACH ITERATOR = "l.module" ARRAY = "l.modules" COUNT = "{ [ g.Module_Library_DB ].StoreModuleList_Load_Features_Cached( 'not_pricegroup', l.modules ) }">
		<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Root $ l.module:module ].Module_Notify_PriceGroupXQualifyingProduct_Delete( l.module, l.pricegroupxqualifyingproduct:pgrp_id, l.pricegroupxqualifyingproduct:product_id ) }">
	</MvFOREACH>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXQualifyingProduct_Delete_LowLevel" PARAMETERS = "pgrp_id, product_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingProduct
						  WHERE
							pgrp_id		= ? AND
							product_id	= ?' }"
			 FIELDS	= "l.pgrp_id, l.product_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00123', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXQualifyingProduct_Copy_All_PriceGroup" PARAMETERS = "source_pgrp_id, dest_pgrp_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingProduct ( pgrp_id, product_id, automatic, colcount )
			 			  SELECT ?, product_id, 0, 0 FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingProduct WHERE pgrp_id = ?' }"
			 FIELDS = "l.dest_pgrp_id, l.source_pgrp_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00319', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXQualifyingProduct_Load" PARAMETERS = "pgrp_id, product_id, pricegroupxqualifyingproduct var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PriceGroupXQualifyingProduct"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingProduct WHERE pgrp_id = ? AND product_id = ?' }"
			    FIELDS	= "l.pgrp_id, l.product_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00124', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ PriceGroupXQualifyingProduct.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupXQualifyingProduct">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-PGR-DTB-00125' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ PriceGroupXQualifyingProduct_Read( l.pricegroupxqualifyingproduct ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupXQualifyingProduct">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXQualifyingProduct_Delete_All_PriceGroup" PARAMETERS = "pgrp_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingProduct WHERE pgrp_id = ?' }"
			 FIELDS	= "l.pgrp_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00126', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXQualifyingProduct_Delete_All_Product" PARAMETERS = "product_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingProduct WHERE product_id = ?' }"
			 FIELDS	= "l.product_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00127', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_PriceGroupXProductSubscription
|
</MvCOMMENT>

<MvFUNCTION NAME = "PriceGroupXProductSubscription_Read" PARAMETERS = "pricegroupxproductsubscription var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.pricegroupxproductsubscription:pgrp_id"		VALUE = "{ PriceGroupXProductSubscription.d.pgrp_id }">
	<MvASSIGN NAME = "l.pricegroupxproductsubscription:product_id"	VALUE = "{ PriceGroupXProductSubscription.d.product_id }">
	<MvASSIGN NAME = "l.pricegroupxproductsubscription:subterm_id"	VALUE = "{ PriceGroupXProductSubscription.d.subterm_id }">
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXProductSubscription_Insert" PARAMETERS = "pgrp_id, product_id, subterm_id" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT PriceGroupXProductSubscription_Insert_LowLevel( l.pgrp_id, l.product_id, l.subterm_id ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFOREACH ITERATOR = "l.module" ARRAY = "l.modules" COUNT = "{ [ g.Module_Library_DB ].StoreModuleList_Load_Features_Cached( 'not_pricegroup', l.modules ) }">
		<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Root $ l.module:module ].Module_Notify_PriceGroupXProductSubscription_Insert( l.module, l.pgrp_id, l.product_id, l.subterm_id ) }">
	</MvFOREACH>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXProductSubscription_Insert_LowLevel" PARAMETERS = "pgrp_id, product_id, subterm_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'PriceGroupXProductSubscription
					      ( pgrp_id, product_id, subterm_id )
						  VALUES
						  ( ?, ?, ? )' }"
			 FIELDS	= "l.pgrp_id, l.product_id, l.subterm_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00170', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXProductSubscription_Delete" PARAMETERS = "pgrp_id, product_id, subterm_id" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT PriceGroupXProductSubscription_Delete_LowLevel( l.pgrp_id, l.product_id, l.subterm_id ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFOREACH ITERATOR = "l.module" ARRAY = "l.modules" COUNT = "{ [ g.Module_Library_DB ].StoreModuleList_Load_Features_Cached( 'not_pricegroup', l.modules ) }">
		<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Root $ l.module:module ].Module_Notify_PriceGroupXProductSubscription_Delete( l.module, l.pgrp_id, l.product_id, l.subterm_id ) }">
	</MvFOREACH>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXProductSubscription_Delete_LowLevel" PARAMETERS = "pgrp_id, product_id, subterm_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXProductSubscription
						  WHERE
							pgrp_id		= ? AND
							product_id	= ? AND
							subterm_id	= ?' }"
			 FIELDS	= "l.pgrp_id, l.product_id, l.subterm_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00171', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXProductSubscription_Copy_All_PriceGroup" PARAMETERS = "source_pgrp_id, dest_pgrp_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'PriceGroupXProductSubscription ( pgrp_id, product_id, subterm_id )
			 			  SELECT ?, product_id, subterm_id FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXProductSubscription WHERE pgrp_id = ?' }"
			 FIELDS = "l.dest_pgrp_id, l.source_pgrp_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00320', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXProductSubscription_Load" PARAMETERS = "pgrp_id, product_id, subterm_id, pricegroupxproductsubscription var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PriceGroupXProductSubscription"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXProductSubscription WHERE pgrp_id = ? AND product_id = ? AND subterm_id = ?' }"
			    FIELDS	= "l.pgrp_id, l.product_id, l.subterm_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00172', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ PriceGroupXProductSubscription.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupXProductSubscription">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-PGR-DTB-00173' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ PriceGroupXProductSubscription_Read( l.pricegroupxproductsubscription ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupXProductSubscription">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXProductSubscription_Delete_All_PriceGroup" PARAMETERS = "pgrp_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXProductSubscription WHERE pgrp_id = ?' }"
			 FIELDS	= "l.pgrp_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00174', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXProductSubscription_Delete_All_Product" PARAMETERS = "product_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXProductSubscription WHERE product_id = ?' }"
			 FIELDS	= "l.product_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00180', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXProductSubscription_Delete_All_ProductSubscriptionTerm" PARAMETERS = "product_id, subterm_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXProductSubscription WHERE product_id = ? AND subterm_id = ?' }"
			 FIELDS	= "l.product_id, l.subterm_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00175', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_PriceGroupXExcludedProductSubscription
|
</MvCOMMENT>

<MvFUNCTION NAME = "PriceGroupXExcludedProductSubscription_Read" PARAMETERS = "pricegroupxexcludedproductsubscription var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.pricegroupxexcludedproductsubscription:pgrp_id"		VALUE = "{ PriceGroupXExcludedProductSubscription.d.pgrp_id }">
	<MvASSIGN NAME = "l.pricegroupxexcludedproductsubscription:product_id"	VALUE = "{ PriceGroupXExcludedProductSubscription.d.product_id }">
	<MvASSIGN NAME = "l.pricegroupxexcludedproductsubscription:subterm_id"	VALUE = "{ PriceGroupXExcludedProductSubscription.d.subterm_id }">
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXExcludedProductSubscription_Insert" PARAMETERS = "pgrp_id, product_id, subterm_id" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT PriceGroupXExcludedProductSubscription_Insert_LowLevel( l.pgrp_id, l.product_id, l.subterm_id ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFOREACH ITERATOR = "l.module" ARRAY = "l.modules" COUNT = "{ [ g.Module_Library_DB ].StoreModuleList_Load_Features_Cached( 'not_pricegroup', l.modules ) }">
		<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Root $ l.module:module ].Module_Notify_PriceGroupXExcludedProductSubscription_Insert( l.module, l.pgrp_id, l.product_id, l.subterm_id ) }">
	</MvFOREACH>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXExcludedProductSubscription_Insert_LowLevel" PARAMETERS = "pgrp_id, product_id, subterm_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedProductSubscription
					      ( pgrp_id, product_id, subterm_id )
						  VALUES
						  ( ?, ?, ? )' }"
			 FIELDS	= "l.pgrp_id, l.product_id, l.subterm_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00203', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXExcludedProductSubscription_Delete" PARAMETERS = "pgrp_id, product_id, subterm_id" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT PriceGroupXExcludedProductSubscription_Delete_LowLevel( l.pgrp_id, l.product_id, l.subterm_id ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFOREACH ITERATOR = "l.module" ARRAY = "l.modules" COUNT = "{ [ g.Module_Library_DB ].StoreModuleList_Load_Features_Cached( 'not_pricegroup', l.modules ) }">
		<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Root $ l.module:module ].Module_Notify_PriceGroupXExcludedProductSubscription_Delete( l.module, l.pgrp_id, l.product_id, l.subterm_id ) }">
	</MvFOREACH>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXExcludedProductSubscription_Delete_LowLevel" PARAMETERS = "pgrp_id, product_id, subterm_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedProductSubscription
						  WHERE
							pgrp_id		= ? AND
							product_id	= ? AND
							subterm_id	= ?' }"
			 FIELDS	= "l.pgrp_id, l.product_id, l.subterm_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00204', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXExcludedProductSubscription_Copy_All_PriceGroup" PARAMETERS = "source_pgrp_id, dest_pgrp_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedProductSubscription ( pgrp_id, product_id, subterm_id )
			 			  SELECT ?, product_id, subterm_id FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedProductSubscription WHERE pgrp_id = ?' }"
			 FIELDS = "l.dest_pgrp_id, l.source_pgrp_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00321', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXExcludedProductSubscription_Load" PARAMETERS = "pgrp_id, product_id, subterm_id, pricegroupxexcludedproductsubscription var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PriceGroupXExcludedProductSubscription"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedProductSubscription WHERE pgrp_id = ? AND product_id = ? AND subterm_id = ?' }"
			    FIELDS	= "l.pgrp_id, l.product_id, l.subterm_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00205', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ PriceGroupXExcludedProductSubscription.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupXExcludedProductSubscription">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-PGR-DTB-00206' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ PriceGroupXExcludedProductSubscription_Read( l.pricegroupxexcludedproductsubscription ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupXExcludedProductSubscription">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXExcludedProductSubscription_Delete_All_PriceGroup" PARAMETERS = "pgrp_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedProductSubscription WHERE pgrp_id = ?' }"
			 FIELDS	= "l.pgrp_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00207', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXExcludedProductSubscription_Delete_All_Product" PARAMETERS = "product_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedProductSubscription WHERE product_id = ?' }"
			 FIELDS	= "l.product_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00208', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXExcludedProductSubscription_Delete_All_ProductSubscriptionTerm" PARAMETERS = "product_id, subterm_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedProductSubscription WHERE product_id = ? AND subterm_id = ?' }"
			 FIELDS	= "l.product_id, l.subterm_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00209', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_PriceGroupXQualifyingProductSubscription
|
</MvCOMMENT>

<MvFUNCTION NAME = "PriceGroupXQualifyingProductSubscription_Read" PARAMETERS = "pricegroupxqualifyingproductsubscription var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.pricegroupxqualifyingproductsubscription:pgrp_id"		VALUE = "{ PriceGroupXQualifyingProductSubscription.d.pgrp_id }">
	<MvASSIGN NAME = "l.pricegroupxqualifyingproductsubscription:product_id"	VALUE = "{ PriceGroupXQualifyingProductSubscription.d.product_id }">
	<MvASSIGN NAME = "l.pricegroupxqualifyingproductsubscription:subterm_id"	VALUE = "{ PriceGroupXQualifyingProductSubscription.d.subterm_id }">
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXQualifyingProductSubscription_Insert" PARAMETERS = "pgrp_id, product_id, subterm_id" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT PriceGroupXQualifyingProductSubscription_Insert_LowLevel( l.pgrp_id, l.product_id, l.subterm_id ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFOREACH ITERATOR = "l.module" ARRAY = "l.modules" COUNT = "{ [ g.Module_Library_DB ].StoreModuleList_Load_Features_Cached( 'not_pricegroup', l.modules ) }">
		<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Root $ l.module:module ].Module_Notify_PriceGroupXQualifyingProductSubscription_Insert( l.module, l.pgrp_id, l.product_id, l.subterm_id ) }">
	</MvFOREACH>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXQualifyingProductSubscription_Insert_LowLevel" PARAMETERS = "pgrp_id, product_id, subterm_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingProductSubscription
					      ( pgrp_id, product_id, subterm_id )
						  VALUES
						  ( ?, ?, ? )' }"
			 FIELDS	= "l.pgrp_id, l.product_id, l.subterm_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00181', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXQualifyingProductSubscription_Delete" PARAMETERS = "pgrp_id, product_id, subterm_id" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT PriceGroupXQualifyingProductSubscription_Delete_LowLevel( l.pgrp_id, l.product_id, l.subterm_id ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFOREACH ITERATOR = "l.module" ARRAY = "l.modules" COUNT = "{ [ g.Module_Library_DB ].StoreModuleList_Load_Features_Cached( 'not_pricegroup', l.modules ) }">
		<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Root $ l.module:module ].Module_Notify_PriceGroupXQualifyingProductSubscription_Delete( l.module, l.pgrp_id, l.product_id, l.subterm_id ) }">
	</MvFOREACH>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXQualifyingProductSubscription_Delete_LowLevel" PARAMETERS = "pgrp_id, product_id, subterm_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingProductSubscription
						  WHERE
							pgrp_id		= ? AND
							product_id	= ? AND
							subterm_id	= ?' }"
			 FIELDS	= "l.pgrp_id, l.product_id, l.subterm_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00182', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXQualifyingProductSubscription_Copy_All_PriceGroup" PARAMETERS = "source_pgrp_id, dest_pgrp_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingProductSubscription ( pgrp_id, product_id, subterm_id )
			 			  SELECT ?, product_id, subterm_id FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingProductSubscription WHERE pgrp_id = ?' }"
			 FIELDS = "l.dest_pgrp_id, l.source_pgrp_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00322', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXQualifyingProductSubscription_Load" PARAMETERS = "pgrp_id, product_id, subterm_id, pricegroupxqualifyingproductsubscription var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PriceGroupXQualifyingProductSubscription"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingProductSubscription WHERE pgrp_id = ? AND product_id = ? AND subterm_id = ?' }"
			    FIELDS	= "l.pgrp_id, l.product_id, l.subterm_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00183', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ PriceGroupXQualifyingProductSubscription.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupXQualifyingProductSubscription">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-PGR-DTB-00184' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ PriceGroupXQualifyingProductSubscription_Read( l.pricegroupxqualifyingproductsubscription ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupXQualifyingProductSubscription">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXQualifyingProductSubscription_Delete_All_PriceGroup" PARAMETERS = "pgrp_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingProductSubscription WHERE pgrp_id = ?' }"
			 FIELDS	= "l.pgrp_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00185', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXQualifyingProductSubscription_Delete_All_Product" PARAMETERS = "product_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingProductSubscription WHERE product_id = ?' }"
			 FIELDS	= "l.product_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00186', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXQualifyingProductSubscription_Delete_All_ProductSubscriptionTerm" PARAMETERS = "product_id, subterm_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingProductSubscription WHERE product_id = ? AND subterm_id = ?' }"
			 FIELDS	= "l.product_id, l.subterm_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00187', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_PriceGroupXCollection
|
</MvCOMMENT>

<MvFUNCTION NAME = "PriceGroupXCollection_Read" PARAMETERS = "pricegroupxcollection var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.pricegroupxcollection:pgrp_id"	VALUE = "{ PriceGroupXCollection.d.pgrp_id }">
	<MvASSIGN NAME = "l.pricegroupxcollection:col_id"	VALUE = "{ PriceGroupXCollection.d.col_id }">
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXCollection_Load" PARAMETERS = "pgrp_id, col_id, pricegroupxcollection var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PriceGroupXCollection"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXCollection WHERE pgrp_id = ? AND col_id = ?' }"
				FIELDS	= "l.pgrp_id, l.col_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00398', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ PriceGroupXCollection.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupXCollection">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-PGR-DTB-00399' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ PriceGroupXCollection_Read( l.pricegroupxcollection ) }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupXCollection">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXCollection_Load_PriceGroup" PARAMETERS = "pgrp_id, pricegroupxcollections var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PriceGroupXCollection"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXCollection WHERE pgrp_id = ?' }"
				FIELDS	= "l.pgrp_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00400', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT PriceGroupXCollection.d.EOF }">
		<MvEVAL EXPR = "{ PriceGroupXCollection_Read( l.pricegroupxcollections[ ++l.count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "PriceGroupXCollection" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupXCollection">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-PGR-DTB-00401', l.count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXCollection_Load_Collection" PARAMETERS = "col_id, pricegroupxcollections var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PriceGroupXCollection"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXCollection WHERE col_id = ?' }"
				FIELDS	= "l.col_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00402', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT PriceGroupXCollection.d.EOF }">
		<MvEVAL EXPR = "{ PriceGroupXCollection_Read( l.pricegroupxcollections[ ++l.count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "PriceGroupXCollection" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupXCollection">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-PGR-DTB-00403', l.count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXCollection_Count_Collection" PARAMETERS = "col_id, count var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PriceGroupXCollection"
				QUERY	= "{ 'SELECT COUNT( * ) AS total_count FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXCollection WHERE col_id = ?' }"
				FIELDS	= "l.col_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00461', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ PriceGroupXCollection.d.EOF }">	<MvASSIGN NAME = "l.count" VALUE = 0>
	<MvELSE>										<MvASSIGN NAME = "l.count" VALUE = "{ PriceGroupXCollection.d.total_count }">
	</MvIF>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupXCollection">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXCollection_Insert" PARAMETERS = "pricegroupxcollection var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'PriceGroupXCollection
					      ( pgrp_id, col_id )
						  VALUES
						  ( ?, ? )' }"
			 FIELDS	= "l.pricegroupxcollection:pgrp_id, l.pricegroupxcollection:col_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00404', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXCollection_Copy_All_PriceGroup" PARAMETERS = "source_pgrp_id, dest_pgrp_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'PriceGroupXCollection ( pgrp_id, col_id )
			 			  SELECT ?, col_id FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXCollection WHERE pgrp_id = ?' }"
			 FIELDS = "l.dest_pgrp_id, l.source_pgrp_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00405', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXCollection_Delete" PARAMETERS = "pgrp_id, col_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXCollection
						  WHERE
							pgrp_id	= ? AND
							col_id	= ?' }"
			 FIELDS	= "l.pgrp_id, l.col_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00406', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXCollection_Delete_All_PriceGroup" PARAMETERS = "pgrp_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXCollection WHERE pgrp_id = ?' }"
			 FIELDS	= "l.pgrp_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00407', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXCollection_Delete_All_Collection" PARAMETERS = "col_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXCollection WHERE col_id = ?' }"
			 FIELDS	= "l.col_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00408', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_PriceGroupXExcludedCollection
|
</MvCOMMENT>

<MvFUNCTION NAME = "PriceGroupXExcludedCollection_Read" PARAMETERS = "pricegroupxexcludedcollection var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.pricegroupxexcludedcollection:pgrp_id"	VALUE = "{ PriceGroupXExcludedCollection.d.pgrp_id }">
	<MvASSIGN NAME = "l.pricegroupxexcludedcollection:col_id"	VALUE = "{ PriceGroupXExcludedCollection.d.col_id }">
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXExcludedCollection_Load" PARAMETERS = "pgrp_id, col_id, pricegroupxexcludedcollection var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PriceGroupXExcludedCollection"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedCollection WHERE pgrp_id = ? AND col_id = ?' }"
				FIELDS	= "l.pgrp_id, l.col_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00409', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ PriceGroupXExcludedCollection.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupXExcludedCollection">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-PGR-DTB-00410' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ PriceGroupXExcludedCollection_Read( l.pricegroupxexcludedcollection ) }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupXExcludedCollection">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXExcludedCollection_Load_PriceGroup" PARAMETERS = "pgrp_id, pricegroupxexcludedcollections var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PriceGroupXExcludedCollection"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedCollection WHERE pgrp_id = ?' }"
				FIELDS	= "l.pgrp_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00411', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT PriceGroupXExcludedCollection.d.EOF }">
		<MvEVAL EXPR = "{ PriceGroupXExcludedCollection_Read( l.pricegroupxexcludedcollections[ ++l.count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "PriceGroupXExcludedCollection" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupXExcludedCollection">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-PGR-DTB-00412', l.count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXExcludedCollection_Load_Collection" PARAMETERS = "col_id, pricegroupxexcludedcollections var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PriceGroupXExcludedCollection"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedCollection WHERE col_id = ?' }"
				FIELDS	= "l.col_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00413', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT PriceGroupXExcludedCollection.d.EOF }">
		<MvEVAL EXPR = "{ PriceGroupXExcludedCollection_Read( l.pricegroupxexcludedcollections[ ++l.count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "PriceGroupXExcludedCollection" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupXExcludedCollection">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-PGR-DTB-00414', l.count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXExcludedCollection_Count_Collection" PARAMETERS = "col_id, count var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PriceGroupXExcludedCollection"
				QUERY	= "{ 'SELECT COUNT( * ) AS total_count FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedCollection WHERE col_id = ?' }"
				FIELDS	= "l.col_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00462', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ PriceGroupXExcludedCollection.d.EOF }">	<MvASSIGN NAME = "l.count" VALUE = 0>
	<MvELSE>												<MvASSIGN NAME = "l.count" VALUE = "{ PriceGroupXExcludedCollection.d.total_count }">
	</MvIF>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupXExcludedCollection">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXExcludedCollection_Insert" PARAMETERS = "pricegroupxexcludedcollection var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedCollection
					      ( pgrp_id, col_id )
						  VALUES
						  ( ?, ? )' }"
			 FIELDS	= "l.pricegroupxexcludedcollection:pgrp_id, l.pricegroupxexcludedcollection:col_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00415', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXExcludedCollection_Copy_All_PriceGroup" PARAMETERS = "source_pgrp_id, dest_pgrp_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedCollection ( pgrp_id, col_id )
			 			  SELECT ?, col_id FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedCollection WHERE pgrp_id = ?' }"
			 FIELDS = "l.dest_pgrp_id, l.source_pgrp_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00416', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXExcludedCollection_Delete" PARAMETERS = "pgrp_id, col_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedCollection
						  WHERE
							pgrp_id	= ? AND
							col_id	= ?' }"
			 FIELDS	= "l.pgrp_id, l.col_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00417', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXExcludedCollection_Delete_All_PriceGroup" PARAMETERS = "pgrp_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedCollection WHERE pgrp_id = ?' }"
			 FIELDS	= "l.pgrp_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00418', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXExcludedCollection_Delete_All_Collection" PARAMETERS = "col_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedCollection WHERE col_id = ?' }"
			 FIELDS	= "l.col_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00419', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_PriceGroupXQualifyingCollection
|
</MvCOMMENT>

<MvFUNCTION NAME = "PriceGroupXQualifyingCollection_Read" PARAMETERS = "pricegroupxqualifyingcollection var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.pricegroupxqualifyingcollection:pgrp_id"	VALUE = "{ PriceGroupXQualifyingCollection.d.pgrp_id }">
	<MvASSIGN NAME = "l.pricegroupxqualifyingcollection:col_id"		VALUE = "{ PriceGroupXQualifyingCollection.d.col_id }">
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXQualifyingCollection_Load" PARAMETERS = "pgrp_id, col_id, pricegroupxqualifyingcollection var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PriceGroupXQualifyingCollection"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingCollection WHERE pgrp_id = ? AND col_id = ?' }"
				FIELDS	= "l.pgrp_id, l.col_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00420', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ PriceGroupXQualifyingCollection.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupXQualifyingCollection">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-PGR-DTB-00421' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ PriceGroupXQualifyingCollection_Read( l.pricegroupxqualifyingcollection ) }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupXQualifyingCollection">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXQualifyingCollection_Load_PriceGroup" PARAMETERS = "pgrp_id, pricegroupxqualifyingcollections var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PriceGroupXQualifyingCollection"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingCollection WHERE pgrp_id = ?' }"
				FIELDS	= "l.pgrp_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00422', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT PriceGroupXQualifyingCollection.d.EOF }">
		<MvEVAL EXPR = "{ PriceGroupXQualifyingCollection_Read( l.pricegroupxqualifyingcollections[ ++l.count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "PriceGroupXQualifyingCollection" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupXQualifyingCollection">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-PGR-DTB-00423', l.count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXQualifyingCollection_Load_Collection" PARAMETERS = "col_id, pricegroupxqualifyingcollections var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PriceGroupXQualifyingCollection"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingCollection WHERE col_id = ?' }"
				FIELDS	= "l.col_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00424', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT PriceGroupXQualifyingCollection.d.EOF }">
		<MvEVAL EXPR = "{ PriceGroupXQualifyingCollection_Read( l.pricegroupxqualifyingcollections[ ++l.count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "PriceGroupXQualifyingCollection" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupXQualifyingCollection">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-PGR-DTB-00425', l.count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXQualifyingCollection_Count_Collection" PARAMETERS = "col_id, count var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PriceGroupXQualifyingCollection"
				QUERY	= "{ 'SELECT COUNT( * ) AS total_count FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingCollection WHERE col_id = ?' }"
				FIELDS	= "l.col_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00463', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ PriceGroupXQualifyingCollection.d.EOF }">	<MvASSIGN NAME = "l.count" VALUE = 0>
	<MvELSE>													<MvASSIGN NAME = "l.count" VALUE = "{ PriceGroupXQualifyingCollection.d.total_count }">
	</MvIF>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupXQualifyingCollection">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXQualifyingCollection_Insert" PARAMETERS = "pricegroupxqualifyingcollection var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingCollection
					      ( pgrp_id, col_id )
						  VALUES
						  ( ?, ? )' }"
			 FIELDS	= "l.pricegroupxqualifyingcollection:pgrp_id, l.pricegroupxqualifyingcollection:col_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00426', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXQualifyingCollection_Copy_All_PriceGroup" PARAMETERS = "source_pgrp_id, dest_pgrp_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingCollection ( pgrp_id, col_id )
			 			  SELECT ?, col_id FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingCollection WHERE pgrp_id = ?' }"
			 FIELDS = "l.dest_pgrp_id, l.source_pgrp_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00427', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXQualifyingCollection_Delete" PARAMETERS = "pgrp_id, col_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingCollection
						  WHERE
							pgrp_id	= ? AND
							col_id	= ?' }"
			 FIELDS	= "l.pgrp_id, l.col_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00428', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXQualifyingCollection_Delete_All_PriceGroup" PARAMETERS = "pgrp_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingCollection WHERE pgrp_id = ?' }"
			 FIELDS	= "l.pgrp_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00429', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXQualifyingCollection_Delete_All_Collection" PARAMETERS = "col_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingCollection WHERE col_id = ?' }"
			 FIELDS	= "l.col_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00430', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_PriceGroupXProductCollectionExclusions
|
</MvCOMMENT>

<MvFUNCTION NAME = "PriceGroupXProductCollectionExclusion_Read" PARAMETERS = "pricegroupxproductcollectionexclusion var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.pricegroupxproductcollectionexclusion:pgrp_id"		VALUE = "{ PriceGroupXProductCollectionExclusions.d.pgrp_id }">
	<MvASSIGN NAME = "l.pricegroupxproductcollectionexclusion:product_id"	VALUE = "{ PriceGroupXProductCollectionExclusions.d.product_id }">
	<MvASSIGN NAME = "l.pricegroupxproductcollectionexclusion:colcount"		VALUE = "{ PriceGroupXProductCollectionExclusions.d.colcount }">
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXProductCollectionExclusion_Load" PARAMETERS = "pgrp_id, product_id, pricegroupxproductcollectionexclusion var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PriceGroupXProductCollectionExclusions"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXProductCollectionExclusions WHERE pgrp_id = ? AND product_id = ?' }"
				FIELDS	= "l.pgrp_id, l.product_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00431', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ PriceGroupXProductCollectionExclusions.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupXProductCollectionExclusions">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-PGR-DTB-00432' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ PriceGroupXProductCollectionExclusion_Read( l.pricegroupxproductcollectionexclusion ) }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupXProductCollectionExclusions">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXProductCollectionExclusion_Load_PriceGroup" PARAMETERS = "pgrp_id, pricegroupxproductcollectionexclusions var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PriceGroupXProductCollectionExclusions"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXProductCollectionExclusions WHERE pgrp_id = ?' }"
				FIELDS	= "l.pgrp_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00433', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT PriceGroupXProductCollectionExclusions.d.EOF }">
		<MvEVAL EXPR = "{ PriceGroupXProductCollectionExclusion_Read( l.pricegroupxproductcollectionexclusions[ ++l.count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "PriceGroupXProductCollectionExclusions" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupXProductCollectionExclusions">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-PGR-DTB-00434', l.count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXProductCollectionExclusion_Load_Product" PARAMETERS = "product_id, pricegroupxproductcollectionexclusions var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PriceGroupXProductCollectionExclusions"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXProductCollectionExclusions WHERE product_id = ?' }"
				FIELDS	= "l.product_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00435', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT PriceGroupXProductCollectionExclusions.d.EOF }">
		<MvEVAL EXPR = "{ PriceGroupXProductCollectionExclusion_Read( l.pricegroupxproductcollectionexclusions[ ++l.count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "PriceGroupXProductCollectionExclusions" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupXProductCollectionExclusions">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-PGR-DTB-00436', l.count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXProductCollectionExclusion_Insert" PARAMETERS = "pricegroupxproductcollectionexclusion var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'PriceGroupXProductCollectionExclusions
					      ( pgrp_id, product_id, colcount )
						  VALUES
						  ( ?, ?, ? )' }"
			 FIELDS	= "l.pricegroupxproductcollectionexclusion:pgrp_id, l.pricegroupxproductcollectionexclusion:product_id, l.pricegroupxproductcollectionexclusion:colcount">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00437', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXProductCollectionExclusion_Delete" PARAMETERS = "pgrp_id, product_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXProductCollectionExclusions
						  WHERE
							pgrp_id		= ? AND
							product_id	= ?' }"
			 FIELDS	= "l.pgrp_id, l.product_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00438', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXProductCollectionExclusion_Delete_All_PriceGroup" PARAMETERS = "pgrp_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXProductCollectionExclusions WHERE pgrp_id = ?' }"
			 FIELDS	= "l.pgrp_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00439', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXProductCollectionExclusion_Delete_All_Product" PARAMETERS = "product_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXProductCollectionExclusions WHERE product_id = ?' }"
			 FIELDS	= "l.product_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00440', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_PriceGroupXExcludedProductCollectionExclusions
|
</MvCOMMENT>

<MvFUNCTION NAME = "PriceGroupXExcludedProductCollectionExclusion_Read" PARAMETERS = "pricegroupxexcludedproductcollectionexclusion var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.pricegroupxexcludedproductcollectionexclusion:pgrp_id"		VALUE = "{ PriceGroupXExcludedProductCollectionExclusions.d.pgrp_id }">
	<MvASSIGN NAME = "l.pricegroupxexcludedproductcollectionexclusion:product_id"	VALUE = "{ PriceGroupXExcludedProductCollectionExclusions.d.product_id }">
	<MvASSIGN NAME = "l.pricegroupxexcludedproductcollectionexclusion:colcount"		VALUE = "{ PriceGroupXExcludedProductCollectionExclusions.d.colcount }">
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXExcludedProductCollectionExclusion_Load" PARAMETERS = "pgrp_id, product_id, pricegroupxexcludedproductcollectionexclusion var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PriceGroupXExcludedProductCollectionExclusions"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedProductCollectionExclusions WHERE pgrp_id = ? AND product_id = ?' }"
				FIELDS	= "l.pgrp_id, l.product_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00441', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ PriceGroupXExcludedProductCollectionExclusions.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupXExcludedProductCollectionExclusions">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-PGR-DTB-00442' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ PriceGroupXExcludedProductCollectionExclusion_Read( l.pricegroupxexcludedproductcollectionexclusion ) }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupXExcludedProductCollectionExclusions">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXExcludedProductCollectionExclusion_Load_PriceGroup" PARAMETERS = "pgrp_id, pricegroupxexcludedproductcollectionexclusions var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PriceGroupXExcludedProductCollectionExclusions"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedProductCollectionExclusions WHERE pgrp_id = ?' }"
				FIELDS	= "l.pgrp_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00443', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT PriceGroupXExcludedProductCollectionExclusions.d.EOF }">
		<MvEVAL EXPR = "{ PriceGroupXExcludedProductCollectionExclusion_Read( l.pricegroupxexcludedproductcollectionexclusions[ ++l.count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "PriceGroupXExcludedProductCollectionExclusions" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupXExcludedProductCollectionExclusions">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-PGR-DTB-00444', l.count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXExcludedProductCollectionExclusion_Load_Product" PARAMETERS = "product_id, pricegroupxexcludedproductcollectionexclusions var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PriceGroupXExcludedProductCollectionExclusions"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedProductCollectionExclusions WHERE product_id = ?' }"
				FIELDS	= "l.product_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00445', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT PriceGroupXExcludedProductCollectionExclusions.d.EOF }">
		<MvEVAL EXPR = "{ PriceGroupXExcludedProductCollectionExclusion_Read( l.pricegroupxexcludedproductcollectionexclusions[ ++l.count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "PriceGroupXExcludedProductCollectionExclusions" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupXExcludedProductCollectionExclusions">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-PGR-DTB-00446', l.count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXExcludedProductCollectionExclusion_Insert" PARAMETERS = "pricegroupxexcludedproductcollectionexclusion var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedProductCollectionExclusions
					      ( pgrp_id, product_id, colcount )
						  VALUES
						  ( ?, ?, ? )' }"
			 FIELDS	= "l.pricegroupxexcludedproductcollectionexclusion:pgrp_id, l.pricegroupxexcludedproductcollectionexclusion:product_id, l.pricegroupxexcludedproductcollectionexclusion:colcount">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00447', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXExcludedProductCollectionExclusion_Delete" PARAMETERS = "pgrp_id, product_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedProductCollectionExclusions
						  WHERE
							pgrp_id		= ? AND
							product_id	= ?' }"
			 FIELDS	= "l.pgrp_id, l.product_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00448', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXExcludedProductCollectionExclusion_Delete_All_PriceGroup" PARAMETERS = "pgrp_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedProductCollectionExclusions WHERE pgrp_id = ?' }"
			 FIELDS	= "l.pgrp_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00449', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXExcludedProductCollectionExclusion_Delete_All_Product" PARAMETERS = "product_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedProductCollectionExclusions WHERE product_id = ?' }"
			 FIELDS	= "l.product_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00450', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_PriceGroupXQualifyingProductCollectionExclusions
|
</MvCOMMENT>

<MvFUNCTION NAME = "PriceGroupXQualifyingProductCollectionExclusion_Read" PARAMETERS = "pricegroupxqualifyingproductcollectionexclusion var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.pricegroupxqualifyingproductcollectionexclusion:pgrp_id"	VALUE = "{ PriceGroupXQualifyingProductCollectionExclusions.d.pgrp_id }">
	<MvASSIGN NAME = "l.pricegroupxqualifyingproductcollectionexclusion:product_id"	VALUE = "{ PriceGroupXQualifyingProductCollectionExclusions.d.product_id }">
	<MvASSIGN NAME = "l.pricegroupxqualifyingproductcollectionexclusion:colcount"	VALUE = "{ PriceGroupXQualifyingProductCollectionExclusions.d.colcount }">
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXQualifyingProductCollectionExclusion_Load" PARAMETERS = "pgrp_id, product_id, pricegroupxqualifyingproductcollectionexclusion var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PriceGroupXQualifyingProductCollectionExclusions"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingProductCollectionExclusions WHERE pgrp_id = ? AND product_id = ?' }"
				FIELDS	= "l.pgrp_id, l.product_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00451', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ PriceGroupXQualifyingProductCollectionExclusions.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupXQualifyingProductCollectionExclusions">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-PGR-DTB-00452' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ PriceGroupXQualifyingProductCollectionExclusion_Read( l.pricegroupxqualifyingproductcollectionexclusion ) }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupXQualifyingProductCollectionExclusions">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXQualifyingProductCollectionExclusion_Load_PriceGroup" PARAMETERS = "pgrp_id, pricegroupxqualifyingproductcollectionexclusions var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PriceGroupXQualifyingProductCollectionExclusions"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingProductCollectionExclusions WHERE pgrp_id = ?' }"
				FIELDS	= "l.pgrp_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00453', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT PriceGroupXQualifyingProductCollectionExclusions.d.EOF }">
		<MvEVAL EXPR = "{ PriceGroupXQualifyingProductCollectionExclusion_Read( l.pricegroupxqualifyingproductcollectionexclusions[ ++l.count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "PriceGroupXQualifyingProductCollectionExclusions" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupXQualifyingProductCollectionExclusions">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-PGR-DTB-00454', l.count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXQualifyingProductCollectionExclusion_Load_Product" PARAMETERS = "product_id, pricegroupxqualifyingproductcollectionexclusions var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PriceGroupXQualifyingProductCollectionExclusions"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingProductCollectionExclusions WHERE product_id = ?' }"
				FIELDS	= "l.product_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00455', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT PriceGroupXQualifyingProductCollectionExclusions.d.EOF }">
		<MvEVAL EXPR = "{ PriceGroupXQualifyingProductCollectionExclusion_Read( l.pricegroupxqualifyingproductcollectionexclusions[ ++l.count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "PriceGroupXQualifyingProductCollectionExclusions" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupXQualifyingProductCollectionExclusions">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-PGR-DTB-00456', l.count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXQualifyingProductCollectionExclusion_Insert" PARAMETERS = "pricegroupxqualifyingproductcollectionexclusion var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingProductCollectionExclusions
					      ( pgrp_id, product_id, colcount )
						  VALUES
						  ( ?, ?, ? )' }"
			 FIELDS	= "l.pricegroupxqualifyingproductcollectionexclusion:pgrp_id, l.pricegroupxqualifyingproductcollectionexclusion:product_id, l.pricegroupxqualifyingproductcollectionexclusion:colcount">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00457', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXQualifyingProductCollectionExclusion_Delete" PARAMETERS = "pgrp_id, product_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingProductCollectionExclusions
						  WHERE
							pgrp_id		= ? AND
							product_id	= ?' }"
			 FIELDS	= "l.pgrp_id, l.product_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00458', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXQualifyingProductCollectionExclusion_Delete_All_PriceGroup" PARAMETERS = "pgrp_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingProductCollectionExclusions WHERE pgrp_id = ?' }"
			 FIELDS	= "l.pgrp_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00459', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXQualifyingProductCollectionExclusion_Delete_All_Product" PARAMETERS = "product_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXQualifyingProductCollectionExclusions WHERE product_id = ?' }"
			 FIELDS	= "l.product_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00460', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_Coupons
|
</MvCOMMENT>

<MvFUNCTION NAME = "Coupon_Read" PARAMETERS = "coupon var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.coupon:id"			VALUE = "{ Coupons.d.id }">
	<MvASSIGN NAME = "l.coupon:code"		VALUE = "{ Coupons.d.code }">
	<MvASSIGN NAME = "l.coupon:descrip"		VALUE = "{ Coupons.d.descrip }">
	<MvASSIGN NAME = "l.coupon:custscope"	VALUE = "{ Coupons.d.custscope }">
	<MvASSIGN NAME = "l.coupon:dt_start"	VALUE = "{ Coupons.d.dt_start }">
	<MvASSIGN NAME = "l.coupon:dt_end"		VALUE = "{ Coupons.d.dt_end }">
	<MvASSIGN NAME = "l.coupon:max_use"		VALUE = "{ Coupons.d.max_use }">
	<MvASSIGN NAME = "l.coupon:max_per"		VALUE = "{ Coupons.d.max_per }">
	<MvASSIGN NAME = "l.coupon:active"		VALUE = "{ Coupons.d.active }">
	<MvASSIGN NAME = "l.coupon:use_count"	VALUE = "{ Coupons.d.use_count }">
</MvFUNCTION>

<MvFUNCTION NAME = "Coupon_Insert" PARAMETERS = "coupon var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.coupon:id"	VALUE = "{ [ g.Module_Library_DB ].StoreKey_Generate( 'Coupons' ) }">

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'Coupons
					      ( id, code, descrip, custscope, dt_start, dt_end, max_use, max_per,
							active, use_count )
						  VALUES
						  ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )' }"
			 FIELDS	= "l.coupon:id, l.coupon:code, l.coupon:descrip, l.coupon:custscope,
					   l.coupon:dt_start, l.coupon:dt_end, l.coupon:max_use, l.coupon:max_per,
					   l.coupon:active, l.coupon:use_count">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00081', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Coupon_Update" PARAMETERS = "coupon var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'Coupons
						  SET
							code		= ?,
							descrip		= ?,
							custscope	= ?,
							dt_start	= ?,
							dt_end		= ?,
							max_use		= ?,
							max_per		= ?,
							active		= ?
						  WHERE
							id			= ?' }"
			 FIELDS	= "l.coupon:code, l.coupon:descrip, l.coupon:custscope, l.coupon:dt_start, l.coupon:dt_end,
					   l.coupon:max_use, l.coupon:max_per, l.coupon:active,
					   l.coupon:id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00082', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Coupon_Update_UseCount" PARAMETERS = "coupon var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'Coupons
						  SET
							use_count	= ?
						  WHERE
							id			= ?' }"
			 FIELDS	= "l.coupon:use_count,
					   l.coupon:id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00083', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Coupon_Delete" PARAMETERS = "coupon var" STANDARDOUTPUTLEVEL = "">
	<MvTRANSACT NAME = "Merchant">

	<MvIF EXPR = "{ NOT CouponXPriceGroup_Delete_All_Coupon( l.coupon:id )			OR
					NOT CouponXCustomer_Delete_All_Coupon( l.coupon:id )			OR
					NOT CouponXBusinessAccount_Delete_All_Coupon( l.coupon:id )		OR
					NOT BasketCoupon_Delete_All_Coupon( l.coupon:id )				OR
					NOT CouponXShopper_Delete_All_Coupon( l.coupon:id )				OR
					NOT CouponXAnonymousShopper_Delete_All_Coupon( l.coupon:id )	OR
					NOT Coupon_Delete_ID( l.coupon:id ) }">
		<MvROLLBACK NAME = "Merchant">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMIT NAME = "Merchant">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Coupon_Delete_ID" PARAMETERS = "id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'Coupons WHERE id = ?' }"
			 FIELDS	= "l.id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00084', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Coupon_Load_ID" PARAMETERS = "id, coupon var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "Coupons"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'Coupons WHERE id = ?' }"
				FIELDS	= "l.id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00085', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ Coupons.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "Coupons">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-PGR-DTB-00086' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ Coupon_Read( l.coupon ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Coupons">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Coupon_Load_Code" PARAMETERS = "code, coupon var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "Coupons"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'Coupons WHERE ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) }"
				FIELDS	= "l.code">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00087', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ Coupons.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "Coupons">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-PGR-DTB-00088' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ Coupon_Read( l.coupon ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Coupons">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Runtime_Coupon_Load_Code" PARAMETERS = "cust_id, bill_email, code, coupon var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvEVAL EXPR = "{ [ g.Module_Library_DB ].SQL_Query_SELECT( l.query, 'c.*' ) }">
	<MvEVAL EXPR = "{ [ g.Module_Library_DB ].SQL_Query_FROM( l.query, g.Store_Table_Prefix $ 'Coupons', 'c' ) }">
	<MvEVAL EXPR = "{ [ g.Module_Library_DB ].SQL_Query_WHERE( l.query, [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'c.code' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ), [ g.Module_Library_DB ].SQL_Query_Field( l.code ) ) }">
	<MvEVAL EXPR = "{ [ g.Module_Library_DB ].SQL_Query_WHERE( l.query, 'c.active = 1', '' ) }">
	<MvEVAL EXPR = "{ [ g.Module_Library_DB ].SQL_Query_WHERE( l.query, '( c.dt_start = 0 OR c.dt_start <= ? )', [ g.Module_Library_DB ].SQL_Query_Field( [ g.Module_Feature_TUI_MGR ].TemplateManager_DateTime() ) ) }">
	<MvEVAL EXPR = "{ [ g.Module_Library_DB ].SQL_Query_WHERE( l.query, '( c.dt_end = 0 OR c.dt_end >= ? )', [ g.Module_Library_DB ].SQL_Query_Field( [ g.Module_Feature_TUI_MGR ].TemplateManager_DateTime() ) ) }">
	<MvEVAL EXPR = "{ [ g.Module_Library_DB ].SQL_Query_WHERE( l.query, '( c.max_use = 0 OR c.use_count < max_use )', '' ) }">

	<MvIF EXPR = "{ l.cust_id EQ 0 }">
		<MvEVAL EXPR = "{ [ g.Module_Library_DB ].SQL_Query_WHERE( l.query, 'c.custscope = \'A\'', '' ) }">
	<MvELSE>
		<MvEVAL EXPR = "{ [ g.Module_Library_DB ].SQL_Query_LEFT_OUTER_JOIN( l.query, 'c', 	g.Store_Table_Prefix $ 'CouponXCustomer', 			'cxc', 'cxc.coupon_id = c.id AND cxc.cust_id = ?', [ g.Module_Library_DB ].SQL_Query_Field( l.cust_id ) ) }">
		<MvEVAL EXPR = "{ [ g.Module_Library_DB ].SQL_Query_LEFT_OUTER_JOIN( l.query, 'c', 	g.Store_Table_Prefix $ 'CouponXBusinessAccount', 	'cxb', 'c.id = cxb.coupon_id', '' ) }">
		<MvEVAL EXPR = "{ [ g.Module_Library_DB ].SQL_Query_LEFT_OUTER_JOIN( l.query, 'c', 	g.Store_Table_Prefix $ 'Customers', 				'cst', 'cst.id = ? AND cxb.account_id = cst.account_id', [ g.Module_Library_DB ].SQL_Query_Field( l.cust_id ) ) }">
		<MvEVAL EXPR = "{ [ g.Module_Library_DB ].SQL_Query_WHERE( l.query, '( c.custscope = \'A\' OR c.custscope = \'L\' OR ( c.custscope = \'X\' AND ( cxc.cust_id IS NOT NULL OR cst.account_id IS NOT NULL ) ) )', '' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ [ g.Module_Library_DB ].SQL_Query_LEFT_OUTER_JOIN( l.query, 'c', g.Store_Table_Prefix $ 'CouponXAnonymousShopper', 'cxas', 'cxas.coupon_id = c.id AND ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'cxas.bill_email' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ), [ g.Module_Library_DB ].SQL_Query_Field( l.bill_email ) ) }">
	<MvEVAL EXPR = "{ [ g.Module_Library_DB ].SQL_Query_WHERE( l.query, '( c.max_per = 0 OR cxas.use_count IS NULL OR cxas.use_count < c.max_per )', '' ) }">

	<MvIF EXPR = "{ l.cust_id }">
		<MvEVAL EXPR = "{ [ g.Module_Library_DB ].SQL_Query_LEFT_OUTER_JOIN( l.query, 'c', g.Store_Table_Prefix $ 'CouponXShopper', 'cxs', 'cxs.coupon_id = c.id AND cxs.cust_id = ?', [ g.Module_Library_DB ].SQL_Query_Field( l.cust_id ) ) }">
		<MvEVAL EXPR = "{ [ g.Module_Library_DB ].SQL_Query_WHERE( l.query, '( c.max_per = 0 OR cxs.use_count IS NULL OR cxs.use_count < c.max_per )', '' ) }">
	</MvIF>

	<MvASSIGN NAME = "l.sql" VALUE = "{ [ g.Module_Library_DB ].SQL_Query_Build( l.query, l.fields ) }">

	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "Coupons"
				QUERY	= "{ l.sql }"
				FIELDS	= "{ l.fields }">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00089', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ Coupons.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "Coupons">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-PGR-DTB-00090' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ Coupon_Read( l.coupon ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Coupons">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CouponList_Load_Basket" PARAMETERS = "basket_id, coupons var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ [ g.Module_Library_DB ].Basket_ID_Is_Provisional( l.basket_id ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-PGR-DTB-00282', 0 ) }">
	</MvIF>

	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "Coupons"
				QUERY	= "{ 'SELECT
								c.*,
								bc.total
							  FROM
								' $ g.Store_Table_Prefix $ 'BasketCoupons bc,
								' $ g.Store_Table_Prefix $ 'Coupons c
							  WHERE
								bc.basket_id	= ?				AND
								c.id			= bc.coupon_id
							  ORDER BY
								c.id' }"
			    FIELDS	= "l.basket_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00091', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.coupon_count"	VALUE = 0>
	<MvWHILE EXPR = "{ NOT Coupons.d.EOF }">
		<MvEVAL EXPR = "{ Coupon_Read( l.coupons[ ++l.coupon_count ] ) }">

		<MvASSIGN NAME = "l.coupons" INDEX = "{ l.coupon_count }" MEMBER = "total"	VALUE = "{ Coupons.d.total }">

		<MvSKIP NAME = "Merchant" VIEW = "Coupons" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Coupons">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-PGR-DTB-00092', l.coupon_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CouponList_Load_Order" PARAMETERS = "order_id, coupons var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "Coupons"
				QUERY	= "{ 'SELECT
								c.*,
								oc.total
							  FROM
								' $ g.Store_Table_Prefix $ 'OrderCoupons oc,
								' $ g.Store_Table_Prefix $ 'Coupons c
							  WHERE
								oc.order_id		= ?				AND
								c.id			= oc.coupon_id
							  ORDER BY
								c.id' }"
			    FIELDS	= "l.order_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00140', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.coupon_count"	VALUE = 0>
	<MvWHILE EXPR = "{ NOT Coupons.d.EOF }">
		<MvEVAL EXPR = "{ Coupon_Read( l.coupons[ ++l.coupon_count ] ) }">

		<MvASSIGN NAME = "l.coupons" INDEX = "{ l.coupon_count }" MEMBER = "total"	VALUE = "{ Coupons.d.total }">

		<MvSKIP NAME = "Merchant" VIEW = "Coupons" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "Coupons">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-PGR-DTB-00141', l.coupon_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "Coupon_Increment_UseCount" PARAMETERS = "id, use_count" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'Coupons
						  SET
							use_count	= use_count + ?
						  WHERE
							id			= ?' }"
			 FIELDS	= "l.use_count, l.id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00093', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Coupon_Decrement_UseCount" PARAMETERS = "id, use_count" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'Coupons
						  SET
							use_count	= use_count - ?
						  WHERE
							id			= ?' }"
			 FIELDS	= "l.use_count, l.id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00298', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_CouponXPriceGroup
|
</MvCOMMENT>

<MvFUNCTION NAME = "CouponXPriceGroup_Read" PARAMETERS = "couponxpricegroup var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.couponxpricegroup:coupon_id"	VALUE = "{ CouponXPriceGroup.d.coupon_id }">
	<MvASSIGN NAME = "l.couponxpricegroup:pgrp_id"		VALUE = "{ CouponXPriceGroup.d.pgrp_id }">
</MvFUNCTION>

<MvFUNCTION NAME = "CouponXPriceGroup_Insert" PARAMETERS = "coupon_id, pgrp_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'CouponXPriceGroup
					      ( coupon_id, pgrp_id )
						  VALUES
						  ( ?, ? )' }"
			 FIELDS	= "l.coupon_id, l.pgrp_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00094', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CouponXPriceGroup_Delete" PARAMETERS = "coupon_id, pgrp_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'CouponXPriceGroup
						  WHERE
							coupon_id	= ? AND
							pgrp_id		= ?' }"
			 FIELDS	= "l.coupon_id, l.pgrp_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00095', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CouponXPriceGroup_Load" PARAMETERS = "coupon_id, pgrp_id, couponxpricegroup var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "CouponXPriceGroup"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'CouponXPriceGroup WHERE coupon_id = ? AND pgrp_id = ?' }"
			    FIELDS	= "l.coupon_id, l.pgrp_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00096', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ CouponXPriceGroup.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "CouponXPriceGroup">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-PGR-DTB-00097' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ CouponXPriceGroup_Read( l.couponxpricegroup ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "CouponXPriceGroup">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CouponXPriceGroup_Delete_All_Coupon" PARAMETERS = "coupon_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'CouponXPriceGroup WHERE coupon_id = ?' }"
			 FIELDS	= "l.coupon_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00098', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CouponXPriceGroup_Delete_All_PriceGroup" PARAMETERS = "pgrp_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'CouponXPriceGroup WHERE pgrp_id = ?' }"
			 FIELDS	= "l.pgrp_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00099', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_CouponXCustomer
|
</MvCOMMENT>

<MvFUNCTION NAME = "CouponXCustomer_Read" PARAMETERS = "couponxcustomer var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.couponxcustomer:coupon_id"	VALUE = "{ CouponXCustomer.d.coupon_id }">
	<MvASSIGN NAME = "l.couponxcustomer:cust_id"	VALUE = "{ CouponXCustomer.d.cust_id }">
</MvFUNCTION>

<MvFUNCTION NAME = "CouponXCustomer_Insert" PARAMETERS = "coupon_id, cust_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'CouponXCustomer
					      ( coupon_id, cust_id )
						  VALUES
						  ( ?, ? )' }"
			 FIELDS	= "l.coupon_id, l.cust_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00100', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CouponXCustomer_Delete" PARAMETERS = "coupon_id, cust_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'CouponXCustomer
						  WHERE
							coupon_id	= ? AND
							cust_id		= ?' }"
			 FIELDS	= "l.coupon_id, l.cust_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00101', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CouponXCustomer_Load" PARAMETERS = "coupon_id, cust_id, couponxcustomer var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "CouponXCustomer"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'CouponXCustomer WHERE coupon_id = ? AND cust_id = ?' }"
			    FIELDS	= "l.coupon_id, l.cust_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00102', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ CouponXCustomer.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "CouponXCustomer">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-PGR-DTB-00103' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ CouponXCustomer_Read( l.couponxcustomer ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "CouponXCustomer">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CouponXCustomer_Delete_All_Coupon" PARAMETERS = "coupon_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'CouponXCustomer WHERE coupon_id = ?' }"
			 FIELDS	= "l.coupon_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00104', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CouponXCustomer_Delete_All_Customer" PARAMETERS = "cust_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'CouponXCustomer WHERE cust_id = ?' }"
			 FIELDS	= "l.cust_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00105', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_CouponXBusinessAccount
|
</MvCOMMENT>

<MvFUNCTION NAME = "CouponXBusinessAccount_Read" PARAMETERS = "couponxbusinessaccount var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.couponxbusinessaccount:coupon_id"	VALUE = "{ CouponXBusinessAccount.d.coupon_id }">
	<MvASSIGN NAME = "l.couponxbusinessaccount:account_id"	VALUE = "{ CouponXBusinessAccount.d.account_id }">
</MvFUNCTION>

<MvFUNCTION NAME = "CouponXBusinessAccount_Insert" PARAMETERS = "coupon_id, account_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'CouponXBusinessAccount
					      ( coupon_id, account_id )
						  VALUES
						  ( ?, ? )' }"
			 FIELDS	= "l.coupon_id, l.account_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00365', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CouponXBusinessAccount_Delete" PARAMETERS = "coupon_id, account_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'CouponXBusinessAccount
						  WHERE
							coupon_id	= ? AND
							account_id	= ?' }"
			 FIELDS	= "l.coupon_id, l.account_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00366', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CouponXBusinessAccount_Load" PARAMETERS = "coupon_id, account_id, couponxbusinessaccount var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "CouponXBusinessAccount"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'CouponXBusinessAccount WHERE coupon_id = ? AND account_id = ?' }"
			    FIELDS	= "l.coupon_id, l.account_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00367', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ CouponXBusinessAccount.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "CouponXBusinessAccount">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-PGR-DTB-00368' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ CouponXBusinessAccount_Read( l.couponxbusinessaccount ) }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "CouponXBusinessAccount">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CouponXBusinessAccount_Delete_All_Coupon" PARAMETERS = "coupon_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'CouponXBusinessAccount WHERE coupon_id = ?' }"
			 FIELDS	= "l.coupon_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00369', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CouponXBusinessAccount_Delete_All_BusinessAccount" PARAMETERS = "account_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'CouponXBusinessAccount WHERE account_id = ?' }"
			 FIELDS	= "l.account_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00370', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_CouponXShopper
|
</MvCOMMENT>

<MvFUNCTION NAME = "CouponXShopper_Read" PARAMETERS = "couponxshopper var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.couponxshopper:coupon_id"	VALUE = "{ CouponXShopper.d.coupon_id }">
	<MvASSIGN NAME = "l.couponxshopper:cust_id"		VALUE = "{ CouponXShopper.d.cust_id }">
	<MvASSIGN NAME = "l.couponxshopper:use_count"	VALUE = "{ CouponXShopper.d.use_count }">
</MvFUNCTION>

<MvFUNCTION NAME = "CouponXShopper_Insert" PARAMETERS = "couponxshopper var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'CouponXShopper
					      ( coupon_id, cust_id, use_count )
						  VALUES
						  ( ?, ?, ? )' }"
			 FIELDS	= "l.couponxshopper:coupon_id, l.couponxshopper:cust_id, l.couponxshopper:use_count">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00106', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CouponXShopper_Load_Basket" PARAMETERS = "coupon_id, basket var, couponxshopper var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ CouponXShopper_Load( l.coupon_id, l.basket:cust_id, l.couponxshopper ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CouponXShopper_Load" PARAMETERS = "coupon_id, cust_id, couponxshopper var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "CouponXShopper"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'CouponXShopper
							  WHERE
								coupon_id	= ? AND
								cust_id		= ?' }"
			    FIELDS	= "l.coupon_id, l.cust_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00306', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ CouponXShopper.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "CouponXShopper">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-PGR-DTB-00307' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ CouponXShopper_Read( l.couponxshopper ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "CouponXShopper">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CouponXShopper_Increment_UseCount_Basket" PARAMETERS = "coupon_id, basket var, use_count" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ CouponXShopper_Increment_UseCount( l.coupon_id, l.basket:cust_id, l.use_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CouponXShopper_Increment_UseCount" PARAMETERS = "coupon_id, cust_id, use_count" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'CouponXShopper
						  SET
							use_count	= use_count + ?
						  WHERE
							coupon_id	= ? AND
							cust_id		= ?' }"
			 FIELDS	= "l.use_count, l.coupon_id, l.cust_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00299', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CouponXShopper_Decrement_UseCount" PARAMETERS = "coupon_id, cust_id, use_count" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'CouponXShopper
						  SET
							use_count	= use_count - ?
						  WHERE
							coupon_id	= ? AND
							cust_id		= ?' }"
			 FIELDS	= "l.use_count, l.coupon_id, l.cust_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00300', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CouponXShopper_Delete_All_Coupon" PARAMETERS = "coupon_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'CouponXShopper WHERE coupon_id = ?' }"
			 FIELDS	= "l.coupon_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00110', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CouponXShopper_Delete_All_Customer" PARAMETERS = "cust_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'CouponXShopper WHERE cust_id = ?' }"
			 FIELDS	= "l.cust_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00464', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_CouponXAnonymousShopper
|
</MvCOMMENT>

<MvFUNCTION NAME = "CouponXAnonymousShopper_Read" PARAMETERS = "couponxanonymousshopper var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.couponxanonymousshopper:coupon_id"	VALUE = "{ CouponXAnonymousShopper.d.coupon_id }">
	<MvASSIGN NAME = "l.couponxanonymousshopper:bill_email"	VALUE = "{ CouponXAnonymousShopper.d.bill_email }">
	<MvASSIGN NAME = "l.couponxanonymousshopper:use_count"	VALUE = "{ CouponXAnonymousShopper.d.use_count }">
</MvFUNCTION>

<MvFUNCTION NAME = "CouponXAnonymousShopper_Insert" PARAMETERS = "couponxanonymousshopper var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'CouponXAnonymousShopper
					      ( coupon_id, bill_email, use_count )
						  VALUES
						  ( ?, ?, ? )' }"
			 FIELDS	= "l.couponxanonymousshopper:coupon_id, l.couponxanonymousshopper:bill_email, l.couponxanonymousshopper:use_count">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00271', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CouponXAnonymousShopper_Load" PARAMETERS = "coupon_id, bill_email, couponxanonymousshopper var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "CouponXAnonymousShopper"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'CouponXAnonymousShopper
							  WHERE
								coupon_id	= ? AND
								' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'bill_email' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_Upper( '?' ) }"
			    FIELDS	= "l.coupon_id, l.bill_email">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00308', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ CouponXAnonymousShopper.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "CouponXAnonymousShopper">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-PGR-DTB-00309' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ CouponXAnonymousShopper_Read( l.couponxanonymousshopper ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "CouponXAnonymousShopper">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CouponXAnonymousShopper_Increment_UseCount_Basket" PARAMETERS = "coupon_id, basket var, use_count" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ CouponXAnonymousShopper_Increment_UseCount( l.coupon_id, l.basket:bill_email, l.use_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "CouponXAnonymousShopper_Increment_UseCount" PARAMETERS = "coupon_id, bill_email, use_count" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'CouponXAnonymousShopper
						  SET
							use_count	= use_count + ?
						  WHERE
							coupon_id	= ? AND
							' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'bill_email' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_Upper( '?' ) }"
			 FIELDS	= "l.use_count, l.coupon_id, l.bill_email">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00301', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CouponXAnonymousShopper_Decrement_UseCount" PARAMETERS = "coupon_id, bill_email, use_count" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'CouponXAnonymousShopper
						  SET
							use_count	= use_count - ?
						  WHERE
							coupon_id	= ? AND
							' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'bill_email' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_Upper( '?' ) }"
			 FIELDS	= "l.use_count, l.coupon_id, l.bill_email">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00302', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "CouponXAnonymousShopper_Delete_All_Coupon" PARAMETERS = "coupon_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'CouponXAnonymousShopper WHERE coupon_id = ?' }"
			 FIELDS	= "l.coupon_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00275', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_BasketCoupon
|
</MvCOMMENT>

<MvFUNCTION NAME = "BasketCoupon_Read" PARAMETERS = "basketcoupon var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.basketcoupon:basket_id"	VALUE = "{ BasketCoupons.d.basket_id }">
	<MvASSIGN NAME = "l.basketcoupon:coupon_id"	VALUE = "{ BasketCoupons.d.coupon_id }">
	<MvASSIGN NAME = "l.basketcoupon:total"		VALUE = "{ BasketCoupons.d.total }">
</MvFUNCTION>

<MvFUNCTION NAME = "BasketCoupon_Insert" PARAMETERS = "basket_id, coupon_id, total" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ [ g.Module_Library_DB ].Basket_ID_Is_Provisional( l.basket_id ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00283', 'Basket is provisional' ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'BasketCoupons
					      ( basket_id, coupon_id, total )
						  VALUES
						  ( ?, ?, ? )' }"
			 FIELDS	= "l.basket_id, l.coupon_id, l.total">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00111', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "BasketCoupon_Update_Total" PARAMETERS = "basket_id, coupon_id, total" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ [ g.Module_Library_DB ].Basket_ID_Is_Provisional( l.basket_id ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00284', 'Basket is provisional' ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'BasketCoupons SET total = ? WHERE basket_id = ? AND coupon_id = ?' }"
			 FIELDS	= "l.total, l.basket_id, l.coupon_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00142', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "BasketCoupon_Delete" PARAMETERS = "basket_id, coupon_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ [ g.Module_Library_DB ].Basket_ID_Is_Provisional( l.basket_id ) }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'BasketCoupons
						  WHERE
							basket_id	= ? AND
							coupon_id	= ?' }"
			 FIELDS	= "l.basket_id, l.coupon_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00112', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "BasketCoupon_Delete_All_Basket" PARAMETERS = "basket_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ [ g.Module_Library_DB ].Basket_ID_Is_Provisional( l.basket_id ) }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'BasketCoupons WHERE basket_id = ?' }"
			 FIELDS	= "l.basket_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00113', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "BasketCoupon_Delete_All_Coupon" PARAMETERS = "coupon_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ [ g.Module_Library_DB ].Basket_ID_Is_Provisional( l.basket_id ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-PGR-DTB-00337', 0 ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'BasketCoupons WHERE coupon_id = ?' }"
			 FIELDS	= "l.coupon_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00114', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "BasketCouponList_Load_Basket" PARAMETERS = "basket_id, basketcoupons var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ [ g.Module_Library_DB ].Basket_ID_Is_Provisional( l.basket_id ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-PGR-DTB-00341', 0 ) }">
	</MvIF>

	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "BasketCoupons"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'BasketCoupons WHERE basket_id = ? ORDER BY coupon_id' }"
			    FIELDS	= "l.basket_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00331', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.basketcoupon_count"	VALUE = 0>
	<MvWHILE EXPR = "{ NOT BasketCoupons.d.EOF }">
		<MvEVAL EXPR = "{ BasketCoupon_Read( l.basketcoupons[ ++l.basketcoupon_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "BasketCoupons" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "BasketCoupons">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-PGR-DTB-00332', l.basketcoupon_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "BasketCoupon_Recalculate_Basket" PARAMETERS = "basket_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ [ g.Module_Library_DB ].Basket_ID_Is_Provisional( l.basket_id ) }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'BasketCoupons
						  SET
							total		= ( SELECT SUM( total ) FROM ' $ g.Store_Table_Prefix $ 'BasketDiscountTotals WHERE basket_id = ' $ g.Store_Table_Prefix $ 'BasketCoupons.basket_id AND coupon_id = ' $ g.Store_Table_Prefix $ 'BasketCoupons.coupon_id )
						  WHERE
							basket_id	= ?' }"
			 FIELDS	= "l.basket_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00338', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_BasketDiscountTotal
|
</MvCOMMENT>

<MvFUNCTION NAME = "BasketDiscountTotal_Read" PARAMETERS = "basketdiscounttotal var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.basketdiscounttotal:basket_id" 	VALUE = "{ BasketDiscountTotals.d.basket_id }">
	<MvASSIGN NAME = "l.basketdiscounttotal:pgrp_id" 	VALUE = "{ BasketDiscountTotals.d.pgrp_id }">
	<MvASSIGN NAME = "l.basketdiscounttotal:coupon_id" 	VALUE = "{ BasketDiscountTotals.d.coupon_id }">
	<MvASSIGN NAME = "l.basketdiscounttotal:total" 		VALUE = "{ BasketDiscountTotals.d.total }">
	<MvASSIGN NAME = "l.basketdiscounttotal:persist" 	VALUE = "{ BasketDiscountTotals.d.persist }">
</MvFUNCTION>

<MvFUNCTION NAME = "BasketDiscountTotal_Insert" PARAMETERS = "basketdiscounttotal var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ [ g.Module_Library_DB ].Basket_ID_Is_Provisional( l.basketdiscounttotal:basket_id ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00285', 'Basket is provisional' ) }">
	</MvIF>

	<MvIF EXPR = "{ ISNULL l.basketdiscounttotal:pgrp_id }"> <MvASSIGN NAME = "l.basketdiscounttotal:pgrp_id" VALUE = 0> </MvIF>
	<MvIF EXPR = "{ ISNULL l.basketdiscounttotal:persist }"> <MvASSIGN NAME = "l.basketdiscounttotal:persist" VALUE = 0> </MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'BasketDiscountTotals
					      ( basket_id, pgrp_id, coupon_id, total, persist )
						  VALUES
						  ( ?, ?, ?, ?, ? )' }"
			 FIELDS	= "l.basketdiscounttotal:basket_id, l.basketdiscounttotal:pgrp_id, l.basketdiscounttotal:coupon_id,
					   l.basketdiscounttotal:total, l.basketdiscounttotal:persist">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00143', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "BasketDiscountTotal_Update_Total" PARAMETERS = "basketdiscounttotal var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'BasketDiscountTotals
						  SET
							total		= ?
						  WHERE
							basket_id	= ? AND
							pgrp_id		= ?' }"
			 FIELDS	= "l.basketdiscounttotal:total,
					   l.basketdiscounttotal:basket_id, l.basketdiscounttotal:pgrp_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00339', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "BasketDiscountTotal_Delete_Basket_PriceGroup" PARAMETERS = "basket_id, pgrp_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ [ g.Module_Library_DB ].Basket_ID_Is_Provisional( l.basket_id ) }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'BasketDiscountTotals WHERE basket_id = ? AND pgrp_id = ?' }"
			 FIELDS	= "l.basket_id, l.pgrp_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00340', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "BasketDiscountTotal_Delete_All_Basket" PARAMETERS = "basket_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ [ g.Module_Library_DB ].Basket_ID_Is_Provisional( l.basket_id ) }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'BasketDiscountTotals WHERE basket_id = ?' }"
			 FIELDS	= "l.basket_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00144', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "BasketDiscountTotalList_Load_Basket" PARAMETERS = "basket_id, basketdiscounttotals var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ [ g.Module_Library_DB ].Basket_ID_Is_Provisional( l.basket_id ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-PGR-DTB-00333', 0 ) }">
	</MvIF>

	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "BasketDiscountTotals"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'BasketDiscountTotals WHERE basket_id = ?' }"
			    FIELDS	= "l.basket_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00334', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.basketdiscounttotals_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT BasketDiscountTotals.d.EOF }">
		<MvEVAL EXPR = "{ BasketDiscountTotal_Read( l.basketdiscounttotals[ ++l.basketdiscounttotals_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "BasketDiscountTotals" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "BasketDiscountTotals">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-PGR-DTB-00335', l.basketdiscounttotals_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "BasketDiscountTotal_Update_Persistent" PARAMETERS = "basket_id, pgrp_id, persist" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ [ g.Module_Library_DB ].Basket_ID_Is_Provisional( l.basket_id ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00286', 'Basket is provisional' ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'BasketDiscountTotals SET persist = ? WHERE basket_id = ? AND pgrp_id = ?' }"
			 FIELDS	= "l.persist, l.basket_id, l.pgrp_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00276', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "BasketDiscountTotal_Delete_Basket_Persistent" PARAMETERS = "basket_id, pgrp_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ [ g.Module_Library_DB ].Basket_ID_Is_Provisional( l.basket_id ) }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'BasketDiscountTotals WHERE basket_id = ? AND pgrp_id = ? AND persist = 1' }"
			 FIELDS	= "l.basket_id, l.pgrp_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00277', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "BasketDiscountTotalList_Load_Basket_Persistent" PARAMETERS = "basket_id, basketdiscounttotals var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ [ g.Module_Library_DB ].Basket_ID_Is_Provisional( l.basket_id ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-PGR-DTB-00287', 0 ) }">
	</MvIF>

	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "BasketDiscountTotals"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'BasketDiscountTotals WHERE basket_id = ? AND persist = 1' }"
			    FIELDS	= "l.basket_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00278', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.basketdiscounttotals_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT BasketDiscountTotals.d.EOF }">
		<MvEVAL EXPR = "{ BasketDiscountTotal_Read( l.basketdiscounttotals[ ++l.basketdiscounttotals_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "BasketDiscountTotals" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "BasketDiscountTotals">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-PGR-DTB-00279', l.basketdiscounttotals_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupAndModuleList_Load_Basket_Persistent" PARAMETERS = "basket var, pricegroups var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ PriceGroupAndModuleList_Load_Basket_Persistent_AsOf( l.basket, [ g.Module_Feature_TUI_MGR ].TemplateManager_DateTime(), l.pricegroups ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupAndModuleList_Load_Basket_Persistent_AsOf" PARAMETERS = "basket var, asof, pricegroups var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ [ g.Module_Library_DB ].Basket_Is_Provisional( l.basket ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-PGR-DTB-00288', 0 ) }">
	</MvIF>

	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PriceGroups"
				QUERY	= "{ 'SELECT
								bdt.*,
								pgr.*,
								m.id			AS loaded_module_id,
								m.code			AS module_code,
								m.name			AS module_name,
								m.provider		AS module_provider,
								m.api_ver		AS module_api_ver,
								m.version		AS module_version,
								m.module		AS module_module,
								m.refcount		AS module_refcount,
								m.active		AS module_active,
								m.priority		AS module_priority
							  FROM
								' $ g.Store_Table_Prefix $ 'BasketDiscountTotals bdt,
								' $ g.Store_Table_Prefix $ 'PriceGroups pgr,
														    Modules m
							  WHERE
							  		bdt.basket_id	= ?					AND
							  		bdt.persist 	= 1					AND
							  		pgr.id 			= bdt.pgrp_id		AND
									m.id 			= pgr.module_id		AND
									m.active		= 1					AND
									(
										pgr.dt_start	= 0				OR
										pgr.dt_start	<= ?
									)									AND
									(
										pgr.dt_end		= 0				OR
										pgr.dt_end		>= ?
									)
							  ORDER BY
								pgr.priority DESC, pgr.id ASC' }"
				FIELDS	= "l.basket:basket_id, l.asof, l.asof">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00280', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.pricegroup_count"				VALUE = 0>

	<MvWHILE EXPR = "{ NOT PriceGroups.d.EOF }">
		<MvEVAL EXPR = "{ PriceGroupAndModule_Read( l.pricegroups[ ++l.pricegroup_count ] ) }">

		<MvSKIP NAME = "Merchant" VIEW = "PriceGroups" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroups">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-PGR-DTB-00281', l.pricegroup_count ) }">
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_OrderCoupons
|
</MvCOMMENT>

<MvFUNCTION NAME = "OrderCoupon_Read" PARAMETERS = "ordercoupon var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.ordercoupon:order_id"	VALUE = "{ OrderCoupons.d.order_id }">
	<MvASSIGN NAME = "l.ordercoupon:coupon_id"	VALUE = "{ OrderCoupons.d.coupon_id }">
	<MvASSIGN NAME = "l.ordercoupon:code"		VALUE = "{ OrderCoupons.d.code }">
	<MvASSIGN NAME = "l.ordercoupon:descrip"	VALUE = "{ OrderCoupons.d.descrip }">
	<MvASSIGN NAME = "l.ordercoupon:total"		VALUE = "{ OrderCoupons.d.total }">
</MvFUNCTION>

<MvFUNCTION NAME = "OrderCoupon_Insert" PARAMETERS = "ordercoupon var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'OrderCoupons
					      ( order_id, coupon_id, code, descrip, total )
						  VALUES
						  ( ?, ?, ?, ?, ? )' }"
			 FIELDS	= "l.ordercoupon:order_id, l.ordercoupon:coupon_id, l.ordercoupon:code, l.ordercoupon:descrip, l.ordercoupon:total">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00115', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "OrderCoupon_Copy_Basket" PARAMETERS = "basket var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ [ g.Module_Library_DB ].Basket_Is_Provisional( l.basket ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00289', 'Basket is provisional' ) }">
	</MvIF>

	<MvASSIGN NAME = "l.ordercoupon:order_id"			VALUE = "{ l.basket:order_id }">

	<MvFOREACH ITERATOR = "l.coupon" ARRAY = "l.coupons" COUNT = "{ CouponList_Load_Basket( l.basket:basket_id, l.coupons ) }">
		<MvIF EXPR = "{ l.coupon:total EQ 0 }">
			<MvFOREACHCONTINUE>
		</MvIF>

		<MvASSIGN NAME = "l.ordercoupon:coupon_id"		VALUE = "{ l.coupon:id }">
		<MvASSIGN NAME = "l.ordercoupon:code"			VALUE = "{ l.coupon:code }">
		<MvASSIGN NAME = "l.ordercoupon:descrip"		VALUE = "{ l.coupon:descrip }">
		<MvASSIGN NAME = "l.ordercoupon:total"			VALUE = "{ l.coupon:total }">

		<MvIF EXPR = "{ NOT OrderCoupon_Insert( l.ordercoupon )			OR
						NOT Coupon_Increment_UseCount( l.coupon:id, 1 ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>

		<MvASSIGN NAME = "l.couponxanonymousshopper:coupon_id"	VALUE = "{ l.coupon:id }">
		<MvASSIGN NAME = "l.couponxanonymousshopper:bill_email"	VALUE = "{ l.basket:bill_email }">
		<MvASSIGN NAME = "l.couponxanonymousshopper:use_count"	VALUE = 1>
		
		<MvIF EXPR = "{ NOT CouponXAnonymousShopper_Insert( l.couponxanonymousshopper ) }">
			<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_Error_IsIndexDuplicate( g.Error_Message ) }">
				<MvFUNCTIONRETURN VALUE = 0>
			<MvELSEIF EXPR = "{ NOT CouponXAnonymousShopper_Increment_UseCount_Basket( l.coupon:id, l.basket, 1 ) }">
				<MvFUNCTIONRETURN VALUE = 0>
			</MvIF>
		</MvIF>

		<MvIF EXPR = "{ l.basket:cust_id }">
			<MvASSIGN NAME = "l.couponxshopper:coupon_id"	VALUE = "{ l.coupon:id }">
			<MvASSIGN NAME = "l.couponxshopper:cust_id"		VALUE = "{ l.basket:cust_id }">
			<MvASSIGN NAME = "l.couponxshopper:use_count"	VALUE = 1>

			<MvIF EXPR = "{ NOT CouponXShopper_Insert( l.couponxshopper ) }">
				<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_Error_IsIndexDuplicate( g.Error_Message ) }">
					<MvFUNCTIONRETURN VALUE = 0>
				<MvELSEIF EXPR = "{ NOT CouponXShopper_Increment_UseCount_Basket( l.coupon:id, l.basket, 1 ) }">
					<MvFUNCTIONRETURN VALUE = 0>
				</MvIF>
			</MvIF>
		</MvIF>
	</MvFOREACH>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "OrderCoupon_Update_Total" PARAMETERS = "order_id, coupon_id, total" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'OrderCoupons SET total = ? WHERE order_id = ? AND coupon_id = ?' }"
			 FIELDS	= "l.total, l.order_id, l.coupon_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00145', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "OrderCoupon_Delete" PARAMETERS = "order_id, coupon_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'OrderCoupons
						  WHERE
							order_id	= ? AND
							coupon_id	= ?' }"
			 FIELDS	= "l.order_id, l.coupon_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00146', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "OrderCoupon_Delete_All_Order" PARAMETERS = "order_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'OrderCoupons WHERE order_id = ?' }"
			 FIELDS	= "l.order_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00116', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "OrderCoupon_Load" PARAMETERS = "order_id, coupon_id, ordercoupon var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "OrderCoupons"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'OrderCoupons WHERE order_id = ? AND coupon_id = ?' }"
				FIELDS	= "l.order_id, l.coupon_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00329', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ OrderCoupons.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "OrderCoupons">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-PGR-DTB-00330' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ OrderCoupon_Read( l.ordercoupon ) }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "OrderCoupons">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "OrderCouponList_Load_Order" PARAMETERS = "order_id, ordercoupons var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "OrderCoupons"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'OrderCoupons WHERE order_id = ? ORDER BY coupon_id' }"
			    FIELDS	= "l.order_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00128', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.ordercoupon_count"	VALUE = 0>
	<MvWHILE EXPR = "{ NOT OrderCoupons.d.EOF }">
		<MvEVAL EXPR = "{ OrderCoupon_Read( l.ordercoupons[ ++l.ordercoupon_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "OrderCoupons" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "OrderCoupons">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-PGR-DTB-00129', l.ordercoupon_count ) }">
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_OrderDiscountTotal
|
</MvCOMMENT>

<MvFUNCTION NAME = "OrderDiscountTotal_Read" PARAMETERS = "orderdiscounttotal var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.orderdiscounttotal:order_id"	VALUE = "{ OrderDiscountTotals.d.order_id }">
	<MvASSIGN NAME = "l.orderdiscounttotal:pgrp_id"		VALUE = "{ OrderDiscountTotals.d.pgrp_id }">
	<MvASSIGN NAME = "l.orderdiscounttotal:coupon_id"	VALUE = "{ OrderDiscountTotals.d.coupon_id }">
	<MvASSIGN NAME = "l.orderdiscounttotal:name"		VALUE = "{ OrderDiscountTotals.d.name }">
	<MvASSIGN NAME = "l.orderdiscounttotal:priority"	VALUE = "{ OrderDiscountTotals.d.priority }">
	<MvASSIGN NAME = "l.orderdiscounttotal:descrip"		VALUE = "{ OrderDiscountTotals.d.descrip }">
	<MvASSIGN NAME = "l.orderdiscounttotal:total"		VALUE = "{ OrderDiscountTotals.d.total }">
</MvFUNCTION>

<MvFUNCTION NAME = "OrderDiscountTotal_Copy_Basket" PARAMETERS = "basket var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ [ g.Module_Library_DB ].Basket_Is_Provisional( l.basket ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00290', 'Basket is provisional' ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'OrderDiscountTotals
						  ( order_id, pgrp_id, coupon_id, name, priority, descrip, total )
						  SELECT
							?, bd.pgrp_id, bd.coupon_id, pg.name, pg.priority, pg.descrip, bd.total
						  FROM
							' $ g.Store_Table_Prefix $ 'BasketDiscountTotals bd
							LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'PriceGroups pg ON pg.id = bd.pgrp_id
						  WHERE
							basket_id	= ?	AND
							(
								total	<> 0 OR
								persist	= 1
							)' }"
			 FIELDS	= "l.basket:order_id, l.basket:basket_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00147', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "OrderDiscountTotal_Insert" PARAMETERS = "orderdiscounttotal var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'OrderDiscountTotals
					      ( order_id, pgrp_id, coupon_id, name, priority, descrip, total )
						  VALUES
						  ( ?, ?, ?, ?, ?, ?, ? )' }"
			 FIELDS	= "l.orderdiscounttotal:order_id, l.orderdiscounttotal:pgrp_id, l.orderdiscounttotal:coupon_id,
					   l.orderdiscounttotal:name, l.orderdiscounttotal:priority, l.orderdiscounttotal:descrip,
					   l.orderdiscounttotal:total">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00148', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "OrderDiscountTotal_Update_Total" PARAMETERS = "orderdiscounttotal var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'OrderDiscountTotals
						  SET
							total		= ?
						  WHERE
							order_id	= ? AND
							pgrp_id		= ?' }"
			 FIELDS	= "l.orderdiscounttotal:total,
					   l.orderdiscounttotal:order_id, l.orderdiscounttotal:pgrp_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00336', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "OrderDiscountTotal_Delete_Order_PriceGroup" PARAMETERS = "order_id, pgrp_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'OrderDiscountTotals WHERE order_id = ? AND pgrp_id = ?' }"
			 FIELDS	= "l.order_id, l.pgrp_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00327', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "OrderDiscountTotal_Delete_All_Order_Coupon" PARAMETERS = "order_id, coupon_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'OrderDiscountTotals WHERE order_id = ? AND coupon_id = ?' }"
			 FIELDS	= "l.order_id, l.coupon_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00328', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "OrderDiscountTotal_Delete_All_Order" PARAMETERS = "order_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'OrderDiscountTotals WHERE order_id = ?' }"
			 FIELDS	= "l.order_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00149', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "OrderDiscountTotalList_Load_Order" PARAMETERS = "order_id, orderdiscounttotals var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "OrderDiscountTotals"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'OrderDiscountTotals WHERE order_id = ? ORDER BY priority DESC, pgrp_id ASC' }"
			    FIELDS	= "l.order_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00150', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.orderdiscounttotal_count"	VALUE = 0>
	<MvWHILE EXPR = "{ NOT OrderDiscountTotals.d.EOF }">
		<MvEVAL EXPR = "{ OrderDiscountTotal_Read( l.orderdiscounttotals[ ++l.orderdiscounttotal_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "OrderDiscountTotals" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "OrderDiscountTotals">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-PGR-DTB-00151', l.orderdiscounttotal_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "OrderDiscountTotal_Total_Order" PARAMETERS = "order_id, total var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "OrderDiscountTotals"
				QUERY	= "{ 'SELECT SUM( total ) as total FROM ' $ g.Store_Table_Prefix $ 'OrderDiscountTotals WHERE order_id = ?' }"
			    FIELDS	= "l.order_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00310', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ OrderDiscountTotals.d.EOF }">   <MvASSIGN NAME = "l.total"  VALUE = 0.00>                                                                                                                                              
    <MvELSE>                                        <MvASSIGN NAME = "l.total"  VALUE = "{ OrderDiscountTotals.d.total ROUND 2 }">                                                                                                         
    </MvIF>   

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "OrderDiscountTotals">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_DiscountOptions
|
</MvCOMMENT>

<MvFUNCTION NAME = "DiscountOptions_Load_Cached" PARAMETERS = "discountoptions var" STANDARDOUTPUTLEVEL = "">
	<MvREFERENCE NAME = "l.cache"						VARIABLE = "g.Session:cache:discountoptions_load_cached">

	<MvIF EXPR = "{ ISNULL l.cache:result }">
		<MvASSIGN NAME = "l.cache:result"				VALUE = "{ DiscountOptions_Load( l.cache:discountoptions ) }">

		<MvIF EXPR = "{ NOT l.cache:result }">
			<MvASSIGN NAME = "l.cache:error_code"		VALUE = "{ g.Error_Code }">
			<MvASSIGN NAME = "l.cache:error_message"	VALUE = "{ g.Error_Message }">
			<MvASSIGN NAME = "l.cache:error_db_eof"		VALUE = "{ g.Error_DB_EOF }">
		</MvIF>
	</MvIF>

	<MvIF EXPR = "{ NOT l.cache:result }">
		<MvIF EXPR = "{ l.cache:error_db_eof }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( l.cache:error_code ) }">
		</MvIF>

		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( l.cache:error_code, l.cache:error_message ) }">
	</MvIF>

	<MvASSIGN NAME = "l.discountoptions"				VALUE = "{ l.cache:discountoptions }">

	<MvFUNCTIONRETURN VALUE = "{ l.cache:result }">
</MvFUNCTION>

<MvFUNCTION NAME = "DiscountOptions_Load" PARAMETERS = "discountoptions var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "DiscountOptions"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'DiscountOptions' }">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00152', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.discountoptions:repricerma"	VALUE = "{ DiscountOptions.d.repricerma }">
	<MvASSIGN NAME = "l.discountoptions:repricecan"	VALUE = "{ DiscountOptions.d.repricecan }">
	<MvASSIGN NAME = "l.discountoptions:reshipcan"	VALUE = "{ DiscountOptions.d.reshipcan }">
	<MvASSIGN NAME = "l.discountoptions:delshipcan"	VALUE = "{ DiscountOptions.d.delshipcan }">
	<MvASSIGN NAME = "l.discountoptions:retaxcan"	VALUE = "{ DiscountOptions.d.retaxcan }">
	<MvASSIGN NAME = "l.discountoptions:repricetot"	VALUE = "{ DiscountOptions.d.repricetot }">
	<MvASSIGN NAME = "l.discountoptions:adj_code"	VALUE = "{ DiscountOptions.d.adj_code }">
	<MvASSIGN NAME = "l.discountoptions:adj_name"	VALUE = "{ DiscountOptions.d.adj_name }">
	<MvASSIGN NAME = "l.discountoptions:adj_charge"	VALUE = "{ DiscountOptions.d.adj_charge }">
	<MvASSIGN NAME = "l.discountoptions:usl_disc"	VALUE = "{ DiscountOptions.d.usl_disc }">
	<MvASSIGN NAME = "l.discountoptions:usl_qual"	VALUE = "{ DiscountOptions.d.usl_qual }">
	<MvASSIGN NAME = "l.discountoptions:exdefault"	VALUE = "{ DiscountOptions.d.exdefault }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "DiscountOptions">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "DiscountOptions_Insert" PARAMETERS = "discountoptions var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'DiscountOptions
					      ( repricerma, repricecan, reshipcan, delshipcan, retaxcan, repricetot, adj_code, adj_name, adj_charge, usl_disc, usl_qual, exdefault )
						  VALUES
						  ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )' }"
			 FIELDS	= "l.discountoptions:repricerma, l.discountoptions:repricecan, l.discountoptions:reshipcan, l.discountoptions:delshipcan,
			 		   l.discountoptions:retaxcan, l.discountoptions:repricetot, l.discountoptions:adj_code, l.discountoptions:adj_name,
			 		   l.discountoptions:adj_charge, l.discountoptions:usl_disc, l.discountoptions:usl_qual, l.discountoptions:exdefault">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00153', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "DiscountOptions_Update" PARAMETERS = "discountoptions var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'DiscountOptions
						  SET
							repricerma	= ?,
							repricecan	= ?,
							reshipcan	= ?,
							delshipcan	= ?,
							retaxcan	= ?,
							repricetot	= ?,
							adj_code	= ?,
							adj_name	= ?,
							adj_charge	= ?,
							usl_disc	= ?,
							usl_qual	= ?,
							exdefault	= ?' }"
			 FIELDS	= "l.discountoptions:repricerma, l.discountoptions:repricecan, l.discountoptions:reshipcan, l.discountoptions:delshipcan,
			 		   l.discountoptions:retaxcan, l.discountoptions:repricetot, l.discountoptions:adj_code, l.discountoptions:adj_name,
			 		   l.discountoptions:adj_charge, l.discountoptions:usl_disc, l.discountoptions:usl_qual, l.discountoptions:exdefault">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00154', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_PriceGroupXBusinessAccount
|
</MvCOMMENT>

<MvFUNCTION NAME = "PriceGroupXBusinessAccount_Read" PARAMETERS = "pricegroupxbusinessaccount var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.pricegroupxbusinessaccount:pgrp_id"		VALUE = "{ PriceGroupXBusinessAccount.d.pgrp_id }">
	<MvASSIGN NAME = "l.pricegroupxbusinessaccount:account_id"	VALUE = "{ PriceGroupXBusinessAccount.d.account_id }">
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXBusinessAccount_Insert" PARAMETERS = "pgrp_id, account_id" STANDARDOUTPUTLEVEL = "">
	<MvTRANSACT NAME = "Merchant">

	<MvIF EXPR = "{ NOT PriceGroupXBusinessAccount_Insert_LowLevel( l.pgrp_id, l.account_id ) OR
					NOT [ g.Module_Feature_CUS_DB ].BusinessAccount_Increment_PriceGroupCount( l.account_id ) }">
		<MvROLLBACK NAME = "Merchant">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMIT NAME = "Merchant">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXBusinessAccount_Insert_LowLevel" PARAMETERS = "pgrp_id, account_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'PriceGroupXBusinessAccount
					      ( pgrp_id, account_id )
						  VALUES
						  ( ?, ? )' }"
			 FIELDS	= "l.pgrp_id, l.account_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00158', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXBusinessAccount_Delete" PARAMETERS = "pgrp_id, account_id" STANDARDOUTPUTLEVEL = "">
	<MvTRANSACT NAME = "Merchant">

	<MvIF EXPR = "{ NOT PriceGroupXBusinessAccount_Delete_LowLevel( l.pgrp_id, l.account_id ) OR
					NOT [ g.Module_Feature_CUS_DB ].BusinessAccount_Decrement_PriceGroupCount( l.account_id ) }">
		<MvROLLBACK NAME = "Merchant">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMIT NAME = "Merchant">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXBusinessAccount_Delete_LowLevel" PARAMETERS = "pgrp_id, account_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXBusinessAccount
						  WHERE
							pgrp_id		= ? AND
							account_id	= ?' }"
			 FIELDS	= "l.pgrp_id, l.account_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00159', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXBusinessAccount_Copy_All_PriceGroup" PARAMETERS = "source_pgrp_id, dest_pgrp_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'PriceGroupXBusinessAccount ( pgrp_id, account_id )
			 			  SELECT ?, account_id FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXBusinessAccount WHERE pgrp_id = ?' }"
			 FIELDS = "l.dest_pgrp_id, l.source_pgrp_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00323', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXBusinessAccount_Load" PARAMETERS = "pgrp_id, account_id, pricegroupxbusinessaccount var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PriceGroupXBusinessAccount"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXBusinessAccount WHERE pgrp_id = ? AND account_id = ?' }"
				FIELDS	= "l.pgrp_id, l.account_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00160', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ PriceGroupXBusinessAccount.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupXBusinessAccount">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-PGR-DTB-00161' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ PriceGroupXBusinessAccount_Read( l.pricegroupxbusinessaccount ) }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupXBusinessAccount">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXBusinessAccount_Delete_All_PriceGroup" PARAMETERS = "pgrp_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXBusinessAccount WHERE pgrp_id = ?' }"
			 FIELDS	= "l.pgrp_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00162', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXBusinessAccount_Delete_All_BusinessAccount" PARAMETERS = "account_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXBusinessAccount WHERE account_id = ?' }"
			 FIELDS	= "l.account_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00163', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_PriceGroupXCategory
|
</MvCOMMENT>

<MvFUNCTION NAME = "PriceGroupXCategory_Read" PARAMETERS = "pricegroupxcategory var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.pricegroupxcategory:pgrp_id"	VALUE = "{ PriceGroupXCategory.d.pgrp_id }">
	<MvASSIGN NAME = "l.pricegroupxcategory:cat_id"		VALUE = "{ PriceGroupXCategory.d.cat_id }">
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXCategory_Insert" PARAMETERS = "pgrp_id, cat_id" STANDARDOUTPUTLEVEL = "">
	<MvTRANSACT NAME = "Merchant">

	<MvIF EXPR = "{ NOT DiscountPrice_Delete_All_PriceGroupCategory( l.pgrp_id, l.cat_id )			OR
					NOT DiscountVariantPrice_Delete_All_PriceGroupCategory( l.pgrp_id, l.cat_id )	OR
					NOT PriceGroupXCategory_Insert_LowLevel( l.pgrp_id, l.cat_id ) }">
		<MvROLLBACK NAME = "Merchant">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFOREACH ITERATOR = "l.module" ARRAY = "l.modules" COUNT = "{ [ g.Module_Library_DB ].StoreModuleList_Load_Features_Cached( 'not_pricegroup', l.modules ) }">
		<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Root $ l.module:module ].Module_Notify_PriceGroupXCategory_Insert( l.module, l.pgrp_id, l.cat_id ) }">
	</MvFOREACH>

	<MvCOMMIT NAME = "Merchant">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXCategory_Insert_LowLevel" PARAMETERS = "pgrp_id, cat_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'PriceGroupXCategory
						  ( pgrp_id, cat_id )
						  VALUES
						  ( ?, ? )' }"
			 FIELDS	= "l.pgrp_id, l.cat_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00236', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXCategory_Delete" PARAMETERS = "pgrp_id, cat_id" STANDARDOUTPUTLEVEL = "">
	<MvTRANSACT NAME = "Merchant">

	<MvIF EXPR = "{ NOT DiscountPrice_Delete_All_PriceGroupCategory( l.pgrp_id, l.cat_id )			OR
					NOT DiscountVariantPrice_Delete_All_PriceGroupCategory( l.pgrp_id, l.cat_id )	OR
					NOT PriceGroupXCategory_Delete_LowLevel( l.pgrp_id, l.cat_id ) }">
		<MvROLLBACK NAME = "Merchant">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFOREACH ITERATOR = "l.module" ARRAY = "l.modules" COUNT = "{ [ g.Module_Library_DB ].StoreModuleList_Load_Features_Cached( 'not_pricegroup', l.modules ) }">
		<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Root $ l.module:module ].Module_Notify_PriceGroupXCategory_Delete( l.module, l.pgrp_id, l.cat_id ) }">
	</MvFOREACH>

	<MvCOMMIT NAME = "Merchant">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXCategory_Delete_LowLevel" PARAMETERS = "pgrp_id, cat_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXCategory
						  WHERE
							pgrp_id	= ? AND
							cat_id	= ?' }"
			 FIELDS	= "l.pgrp_id, l.cat_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00237', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXCategory_Copy_All_PriceGroup" PARAMETERS = "source_pgrp_id, dest_pgrp_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'PriceGroupXCategory ( pgrp_id, cat_id )
			 			  SELECT ?, cat_id FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXCategory WHERE pgrp_id = ?' }"
			 FIELDS = "l.dest_pgrp_id, l.source_pgrp_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00324', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXCategory_Load" PARAMETERS = "pgrp_id, cat_id, pricegroupxcategory var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PriceGroupXCategory"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXCategory WHERE pgrp_id = ? AND cat_id = ?' }"
				FIELDS	= "l.pgrp_id, l.cat_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00238', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ PriceGroupXCategory.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupXCategory">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-PGR-DTB-00239' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ PriceGroupXCategory_Read( l.pricegroupxcategory ) }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupXCategory">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXCategory_Delete_All_PriceGroup" PARAMETERS = "pgrp_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXCategory WHERE pgrp_id = ?' }"
			 FIELDS	= "l.pgrp_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00240', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXCategory_Delete_All_Category" PARAMETERS = "cat_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXCategory WHERE cat_id = ?' }"
			 FIELDS	= "l.cat_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00241', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_PriceGroupXExcludedCategory
|
</MvCOMMENT>

<MvFUNCTION NAME = "PriceGroupXExcludedCategory_Read" PARAMETERS = "pricegroupxexcludedcategory var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.pricegroupxexcludedcategory:pgrp_id"	VALUE = "{ PriceGroupXExcludedCategory.d.pgrp_id }">
	<MvASSIGN NAME = "l.pricegroupxexcludedcategory:cat_id"		VALUE = "{ PriceGroupXExcludedCategory.d.cat_id }">
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXExcludedCategory_Insert" PARAMETERS = "pgrp_id, cat_id" STANDARDOUTPUTLEVEL = "">
	<MvTRANSACT NAME = "Merchant">

	<MvIF EXPR = "{ NOT DiscountPrice_Delete_All_PriceGroupCategory( l.pgrp_id, l.cat_id )			OR
					NOT DiscountVariantPrice_Delete_All_PriceGroupCategory( l.pgrp_id, l.cat_id )	OR
					NOT PriceGroupXExcludedCategory_Insert_LowLevel( l.pgrp_id, l.cat_id ) }">
		<MvROLLBACK NAME = "Merchant">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFOREACH ITERATOR = "l.module" ARRAY = "l.modules" COUNT = "{ [ g.Module_Library_DB ].StoreModuleList_Load_Features_Cached( 'not_pricegroup', l.modules ) }">
		<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Root $ l.module:module ].Module_Notify_PriceGroupXExcludedCategory_Insert( l.module, l.pgrp_id, l.cat_id ) }">
	</MvFOREACH>

	<MvCOMMIT NAME = "Merchant">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXExcludedCategory_Insert_LowLevel" PARAMETERS = "pgrp_id, cat_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedCategory
						  ( pgrp_id, cat_id )
						  VALUES
						  ( ?, ? )' }"
			 FIELDS	= "l.pgrp_id, l.cat_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00242', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXExcludedCategory_Delete" PARAMETERS = "pgrp_id, cat_id" STANDARDOUTPUTLEVEL = "">
	<MvTRANSACT NAME = "Merchant">

	<MvIF EXPR = "{ NOT DiscountPrice_Delete_All_PriceGroupCategory( l.pgrp_id, l.cat_id )			OR
					NOT DiscountVariantPrice_Delete_All_PriceGroupCategory( l.pgrp_id, l.cat_id )	OR
					NOT PriceGroupXExcludedCategory_Delete_LowLevel( l.pgrp_id, l.cat_id ) }">
		<MvROLLBACK NAME = "Merchant">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFOREACH ITERATOR = "l.module" ARRAY = "l.modules" COUNT = "{ [ g.Module_Library_DB ].StoreModuleList_Load_Features_Cached( 'not_pricegroup', l.modules ) }">
		<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Root $ l.module:module ].Module_Notify_PriceGroupXExcludedCategory_Delete( l.module, l.pgrp_id, l.cat_id ) }">
	</MvFOREACH>

	<MvCOMMIT NAME = "Merchant">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXExcludedCategory_Delete_LowLevel" PARAMETERS = "pgrp_id, cat_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedCategory
						  WHERE
							pgrp_id	= ? AND
							cat_id	= ?' }"
			 FIELDS	= "l.pgrp_id, l.cat_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00243', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXExcludedCategory_Copy_All_PriceGroup" PARAMETERS = "source_pgrp_id, dest_pgrp_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedCategory ( pgrp_id, cat_id )
			 			  SELECT ?, cat_id FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedCategory WHERE pgrp_id = ?' }"
			 FIELDS = "l.dest_pgrp_id, l.source_pgrp_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00325', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXExcludedCategory_Load" PARAMETERS = "pgrp_id, cat_id, pricegroupxexcludedcategory var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PriceGroupXExcludedCategory"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedCategory WHERE pgrp_id = ? AND cat_id = ?' }"
				FIELDS	= "l.pgrp_id, l.cat_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00244', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ PriceGroupXExcludedCategory.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupXExcludedCategory">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-PGR-DTB-00245' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ PriceGroupXExcludedCategory_Read( l.pricegroupxexcludedcategory ) }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroupXExcludedCategory">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXExcludedCategory_Delete_All_PriceGroup" PARAMETERS = "pgrp_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedCategory WHERE pgrp_id = ?' }"
			 FIELDS	= "l.pgrp_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00246', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupXExcludedCategory_Delete_All_Category" PARAMETERS = "cat_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedCategory WHERE cat_id = ?' }"
			 FIELDS	= "l.cat_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00247', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_DiscountSignatures
|
</MvCOMMENT>

<MvFUNCTION NAME = "DiscountSignature_Read" PARAMETERS = "discountsignature var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.discountsignature:id"			VALUE = "{ DiscountSignatures.d.id }">
	<MvASSIGN NAME = "l.discountsignature:signature"	VALUE = "{ DiscountSignatures.d.signature }">
	<MvASSIGN NAME = "l.discountsignature:inuse"		VALUE = "{ DiscountSignatures.d.inuse }">
</MvFUNCTION>

<MvFUNCTION NAME = "DiscountSignature_Insert" PARAMETERS = "discountsignature var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.discountsignature:id"	VALUE = "{ [ g.Module_Library_DB ].StoreKey_Generate( 'DiscountSignatures' ) }">

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'DiscountSignatures
					      ( id, signature, inuse )
						  VALUES
						  ( ?, ?, ? )' }"
			 FIELDS	= "l.discountsignature:id, l.discountsignature:signature, l.discountsignature:inuse">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00248', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "DiscountSignature_Update" PARAMETERS = "discountsignature var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'DiscountSignatures
						  SET
							signature	= ?,
							inuse		= ?
						  WHERE
							id			= ?' }"
			 FIELDS	= "l.discountsignature:signature, l.discountsignature:inuse,
					   l.discountsignature:id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00249', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "DiscountSignature_Load_Signature" PARAMETERS = "signature, discountsignature var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "DiscountSignatures"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'DiscountSignatures WHERE signature = ?' }"
				FIELDS	= "l.signature">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00250', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ DiscountSignatures.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "DiscountSignatures">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-PGR-DTB-00251' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ DiscountSignature_Read( l.discountsignature ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "DiscountSignatures">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "DiscountSignatureList_Load_Unused" PARAMETERS = "discountsignatures var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "DiscountSignatures"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'DiscountSignatures WHERE inuse = 0' }">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00252', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.discountsignature_count"	VALUE = 0>
	<MvWHILE EXPR = "{ NOT DiscountSignatures.d.EOF }">
		<MvEVAL EXPR = "{ DiscountSignature_Read( l.discountsignatures[ ++l.discountsignature_count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "DiscountSignatures" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "DiscountSignatures">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-PGR-DTB-00253', l.discountsignature_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "DiscountSignature_Delete" PARAMETERS = "discountsignature var" STANDARDOUTPUTLEVEL = "">
	<MvTRANSACT NAME = "Merchant">

	<MvIF EXPR = "{ NOT DiscountSignature_Delete_LowLevel( l.discountsignature:id )					OR
					NOT DiscountSignatureXPriceGroup_Delete_Signature_All( l.discountsignature:id )	OR
					NOT DiscountPrice_Delete_All_Signature( l.discountsignature:id )				OR
					NOT DiscountVariantPrice_Delete_All_Signature( l.discountsignature:id ) }">
		<MvROLLBACK NAME = "Merchant">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMIT NAME = "Merchant">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "DiscountSignature_Delete_LowLevel" PARAMETERS = "id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'DiscountSignatures WHERE id = ?' }"
			 FIELDS	= "l.id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00254', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_DiscountSignatureXPriceGroup
|
</MvCOMMENT>

<MvFUNCTION NAME = "DiscountSignatureXPriceGroup_Insert" PARAMETERS = "dscsig_id, pgrp_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'DiscountSignatureXPriceGroup
					      ( dscsig_id, pgrp_id )
						  VALUES
						  ( ?, ? )' }"
			 FIELDS	= "l.dscsig_id, l.pgrp_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00255', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "DiscountSignatureXPriceGroup_Delete_Signature_All" PARAMETERS = "dscsig_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'DiscountSignatureXPriceGroup
						  WHERE
							dscsig_id	= ?' }"
			 FIELDS	= "l.dscsig_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00256', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_DiscountPrices
|
</MvCOMMENT>

<MvFUNCTION NAME = "DiscountPrice_Read" PARAMETERS = "discountprice var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.discountprice:product_id"	VALUE = "{ DiscountPrices.d.product_id }">
	<MvASSIGN NAME = "l.discountprice:dscsig_id"	VALUE = "{ DiscountPrices.d.dscsig_id }">
	<MvASSIGN NAME = "l.discountprice:base_price"	VALUE = "{ DiscountPrices.d.base_price }">
	<MvASSIGN NAME = "l.discountprice:price"		VALUE = "{ DiscountPrices.d.price }">
</MvFUNCTION>

<MvFUNCTION NAME = "DiscountPrice_Load" PARAMETERS = "dscsig_id, product_id, discountprice var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW 	= "DiscountPrices"
				QUERY 	= "{ 'SELECT
								dp.*
							  FROM
								' $ g.Store_Table_Prefix $ 'DiscountSignatures ds,
								' $ g.Store_Table_Prefix $ 'DiscountPrices dp
							  WHERE
								ds.signature	= ? AND
								dp.product_id	= ? AND
								ds.id			= dp.dscsig_id' }"
				FIELDS	= "l.dscsig_id, l.product_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00296', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ DiscountPrices.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "DiscountPrices">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-PGR-DTB-00297' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ DiscountPrice_Read( l.discountprice ) }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "DiscountPrices">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "DiscountPrice_Insert" PARAMETERS = "product_id, dscsig_id, base_price, price" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'DiscountPrices
					      ( product_id, dscsig_id, base_price, price )
						  VALUES
						  ( ?, ?, ?, ? )' }"
			 FIELDS	= "l.product_id, l.dscsig_id, l.base_price, l.price">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00257', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "DiscountPrice_Delete_All_Signature" PARAMETERS = "dscsig_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'DiscountPrices WHERE dscsig_id = ?' }"
			 FIELDS	= "l.dscsig_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00258', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "DiscountPrice_Delete_All_Product" PARAMETERS = "product_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'DiscountPrices WHERE product_id = ?' }"
			 FIELDS	= "l.product_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00259', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "DiscountPrice_Delete_All_PriceGroup" PARAMETERS = "pgrp_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ g.Native_DBAPI EQ 'postgresql' }">
		<MvQUERY NAME 	= "Merchant"
				 QUERY 	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'DiscountPrices dp
				 			  USING
				 			  	' $ g.Store_Table_Prefix $ 'DiscountSignatureXPriceGroup dsxpg
				 			  	WHERE
				 			  		dsxpg.pgrp_id	= ? AND
									dp.dscsig_id	= dsxpg.dscsig_id' }"
				 FIELDS = "l.pgrp_id">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00293', g.MvQUERY_Error ) }">
		</MvIF>
	<MvELSE>
		<MvQUERY NAME	= "Merchant"
				 QUERY	= "{ 'DELETE
								dp
							  FROM
								' $ g.Store_Table_Prefix $ 'DiscountSignatureXPriceGroup dsxpg,
								' $ g.Store_Table_Prefix $ 'DiscountPrices dp
							  WHERE
								dsxpg.pgrp_id	= ? AND
								dp.dscsig_id	= dsxpg.dscsig_id' }"
				 FIELDS	= "l.pgrp_id">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00260', g.MvQUERY_Error ) }">
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "DiscountPrice_Delete_All_PriceGroupProduct" PARAMETERS = "pgrp_id, product_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ g.Native_DBAPI EQ 'postgresql' }">
		<MvQUERY NAME 	= "Merchant"
				 QUERY 	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'DiscountPrices dp
				 			  USING
				 				' $ g.Store_Table_Prefix $ 'DiscountSignatureXPriceGroup dsxpg
				 			  WHERE
				 				dp.product_id	= ? AND
								dsxpg.pgrp_id	= ?	AND
								dp.dscsig_id	= dsxpg.dscsig_id' }"
				 FIELDS = "l.product_id, l.pgrp_id">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00294', g.MvQUERY_Error ) }">
		</MvIF>
	<MvELSE>
		<MvQUERY NAME	= "Merchant"
				 QUERY	= "{ 'DELETE
								dp
							  FROM
								' $ g.Store_Table_Prefix $ 'DiscountPrices dp,
								' $ g.Store_Table_Prefix $ 'DiscountSignatureXPriceGroup dsxpg
							  WHERE
								dp.product_id	= ? AND
								dsxpg.pgrp_id	= ?	AND
								dp.dscsig_id	= dsxpg.dscsig_id' }"
				 FIELDS	= "l.product_id, l.pgrp_id">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00261', g.MvQUERY_Error ) }">
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "DiscountPrice_Delete_All_PriceGroupCategory" PARAMETERS = "pgrp_id, cat_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ g.Native_DBAPI EQ 'postgresql' }">
		<MvQUERY NAME	= "Merchant"
				 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'DiscountPrices dp
				 			  USING
								' $ g.Store_Table_Prefix $ 'CategoryXProduct cxp,
								' $ g.Store_Table_Prefix $ 'DiscountSignatureXPriceGroup dsxpg
							  WHERE
								cxp.cat_id		= ?					AND
								dsxpg.pgrp_id	= ?					AND
								dp.product_id	= cxp.product_id	AND
								dp.dscsig_id	= dsxpg.dscsig_id' }"
				 FIELDS	= "l.cat_id, l.pgrp_id">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00295', g.MvQUERY_Error ) }">
		</MvIF>
	<MvELSE>
		<MvQUERY NAME	= "Merchant"
				 QUERY	= "{ 'DELETE
								dp
							  FROM
								' $ g.Store_Table_Prefix $ 'DiscountPrices dp,
								' $ g.Store_Table_Prefix $ 'CategoryXProduct cxp,
								' $ g.Store_Table_Prefix $ 'DiscountSignatureXPriceGroup dsxpg
							  WHERE
								cxp.cat_id		= ?					AND
								dsxpg.pgrp_id	= ?					AND
								dp.product_id	= cxp.product_id	AND
								dp.dscsig_id	= dsxpg.dscsig_id' }"
				 FIELDS	= "l.cat_id, l.pgrp_id">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00262', g.MvQUERY_Error ) }">
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_DiscountVariantPrices
|
</MvCOMMENT>

<MvFUNCTION NAME = "DiscountVariantPrice_Read" PARAMETERS = "discountvariantprice var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.discountvariantprice:product_id"	VALUE = "{ DiscountVariantPrices.d.product_id }">
	<MvASSIGN NAME = "l.discountvariantprice:variant_id"	VALUE = "{ DiscountVariantPrices.d.variant_id }">
	<MvASSIGN NAME = "l.discountvariantprice:dscsig_id"		VALUE = "{ DiscountVariantPrices.d.dscsig_id }">
	<MvASSIGN NAME = "l.discountvariantprice:base_price"	VALUE = "{ DiscountVariantPrices.d.base_price }">
	<MvASSIGN NAME = "l.discountvariantprice:price"			VALUE = "{ DiscountVariantPrices.d.price }">
</MvFUNCTION>

<MvFUNCTION NAME = "DiscountVariantPrice_Load" PARAMETERS = "dscsig_id, product_id, variant_id, discountvariantprice var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW 	= "DiscountVariantPrices"
				QUERY 	= "{ 'SELECT
								dp.*
							  FROM
								' $ g.Store_Table_Prefix $ 'DiscountSignatures ds,
								' $ g.Store_Table_Prefix $ 'DiscountVariantPrices dp
							  WHERE
								ds.signature	= ? AND
								dp.product_id	= ? AND
								dp.variant_id	= ? AND
								ds.id			= dp.dscsig_id' }"
				FIELDS	= "l.dscsig_id, l.product_id, l.variant_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00346', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ DiscountVariantPrices.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "DiscountVariantPrices">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-PGR-DTB-00347' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ DiscountVariantPrice_Read( l.discountvariantprice ) }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "DiscountVariantPrices">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "DiscountVariantPrice_Insert" PARAMETERS = "product_id, variant_id, dscsig_id, base_price, price" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'DiscountVariantPrices
					      ( product_id, variant_id, dscsig_id, base_price, price )
						  VALUES
						  ( ?, ?, ?, ?, ? )' }"
			 FIELDS	= "l.product_id, l.variant_id, l.dscsig_id, l.base_price, l.price">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00348', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "DiscountVariantPrice_Delete_All_Signature" PARAMETERS = "dscsig_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'DiscountVariantPrices WHERE dscsig_id = ?' }"
			 FIELDS	= "l.dscsig_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00349', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "DiscountVariantPrice_Delete_All_Variant" PARAMETERS = "product_id, variant_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'DiscountVariantPrices WHERE product_id = ? AND variant_id = ?' }"
			 FIELDS	= "l.product_id, l.variant_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00350', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "DiscountVariantPrice_Delete_All_Product" PARAMETERS = "product_id" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ DiscountVariantPrice_Delete_All_Product_Master( l.product_id ) AND
								 DiscountVariantPrice_Delete_All_Product_Part( l.product_id ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "DiscountVariantPrice_Delete_All_Product_Master" PARAMETERS = "product_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'DiscountVariantPrices WHERE product_id = ?' }"
			 FIELDS	= "l.product_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00353', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "DiscountVariantPrice_Delete_All_Product_Part" PARAMETERS = "part_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ g.Native_DBAPI EQ 'postgresql' }">
		<MvQUERY NAME	= "Merchant"
				 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'DiscountVariantPrices dp
				 			  USING
								' $ g.Store_Table_Prefix $ 'ProductVariantParts pvp
							  WHERE
								pvp.part_id		= ?					AND
								dp.product_id	= pvp.product_id	AND
								dp.variant_id	= pvp.variant_id' }"
				 FIELDS	= "l.part_id">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00351', g.MvQUERY_Error ) }">
		</MvIF>
	<MvELSE>
		<MvQUERY NAME	= "Merchant"
				 QUERY	= "{ 'DELETE
								dp
							  FROM
								' $ g.Store_Table_Prefix $ 'DiscountVariantPrices dp,
								' $ g.Store_Table_Prefix $ 'ProductVariantParts pvp
							  WHERE
								pvp.part_id		= ?					AND
								dp.product_id	= pvp.product_id	AND
								dp.variant_id	= pvp.variant_id' }"
				 FIELDS	= "l.part_id">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00352', g.MvQUERY_Error ) }">
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "DiscountVariantPrice_Delete_All_PriceGroup" PARAMETERS = "pgrp_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ g.Native_DBAPI EQ 'postgresql' }">
		<MvQUERY NAME 	= "Merchant"
				 QUERY 	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'DiscountVariantPrices dp
				 			  USING
				 			  	' $ g.Store_Table_Prefix $ 'DiscountSignatureXPriceGroup dsxpg
				 			  	WHERE
				 			  		dsxpg.pgrp_id	= ? AND
									dp.dscsig_id	= dsxpg.dscsig_id' }"
				 FIELDS = "l.pgrp_id">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00354', g.MvQUERY_Error ) }">
		</MvIF>
	<MvELSE>
		<MvQUERY NAME	= "Merchant"
				 QUERY	= "{ 'DELETE
								dp
							  FROM
								' $ g.Store_Table_Prefix $ 'DiscountSignatureXPriceGroup dsxpg,
								' $ g.Store_Table_Prefix $ 'DiscountVariantPrices dp
							  WHERE
								dsxpg.pgrp_id	= ? AND
								dp.dscsig_id	= dsxpg.dscsig_id' }"
				 FIELDS	= "l.pgrp_id">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00355', g.MvQUERY_Error ) }">
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "DiscountVariantPrice_Delete_All_PriceGroupProduct" PARAMETERS = "pgrp_id, product_id" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ DiscountVariantPrice_Delete_All_PriceGroupProduct_Master( l.pgrp_id, l.product_id ) AND
								 DiscountVariantPrice_Delete_All_PriceGroupProduct_Part( l.pgrp_id, l.product_id ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "DiscountVariantPrice_Delete_All_PriceGroupProduct_Master" PARAMETERS = "pgrp_id, product_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ g.Native_DBAPI EQ 'postgresql' }">
		<MvQUERY NAME 	= "Merchant"
				 QUERY 	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'DiscountVariantPrices dp
				 			  USING
				 				' $ g.Store_Table_Prefix $ 'DiscountSignatureXPriceGroup dsxpg
				 			  WHERE
				 				dp.product_id	= ? AND
								dsxpg.pgrp_id	= ?	AND
								dp.dscsig_id	= dsxpg.dscsig_id' }"
				 FIELDS = "l.product_id, l.pgrp_id">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00356', g.MvQUERY_Error ) }">
		</MvIF>
	<MvELSE>
		<MvQUERY NAME	= "Merchant"
				 QUERY	= "{ 'DELETE
								dp
							  FROM
								' $ g.Store_Table_Prefix $ 'DiscountVariantPrices dp,
								' $ g.Store_Table_Prefix $ 'DiscountSignatureXPriceGroup dsxpg
							  WHERE
								dp.product_id	= ? AND
								dsxpg.pgrp_id	= ?	AND
								dp.dscsig_id	= dsxpg.dscsig_id' }"
				 FIELDS	= "l.product_id, l.pgrp_id">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00357', g.MvQUERY_Error ) }">
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "DiscountVariantPrice_Delete_All_PriceGroupProduct_Part" PARAMETERS = "pgrp_id, part_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ g.Native_DBAPI EQ 'postgresql' }">
		<MvQUERY NAME 	= "Merchant"
				 QUERY 	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'DiscountVariantPrices dp
				 			  USING
				 				' $ g.Store_Table_Prefix $ 'DiscountSignatureXPriceGroup dsxpg,
								' $ g.Store_Table_Prefix $ 'ProductVariantParts pvp
				 			  WHERE
								dsxpg.pgrp_id	= ?	AND
								pvp.part_id		= ? AND
				 				dp.product_id	= pvp.product_id AND
				 				dp.variant_id	= pvp.variant_id AND
								dp.dscsig_id	= dsxpg.dscsig_id' }"
				 FIELDS = "l.pgrp_id, l.part_id">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00360', g.MvQUERY_Error ) }">
		</MvIF>
	<MvELSE>
		<MvQUERY NAME	= "Merchant"
				 QUERY	= "{ 'DELETE
								dp
							  FROM
								' $ g.Store_Table_Prefix $ 'DiscountVariantPrices dp,
								' $ g.Store_Table_Prefix $ 'DiscountSignatureXPriceGroup dsxpg,
								' $ g.Store_Table_Prefix $ 'ProductVariantParts pvp
							  WHERE
								dsxpg.pgrp_id	= ?	AND
								pvp.part_id		= ? AND
				 				dp.product_id	= pvp.product_id AND
				 				dp.variant_id	= pvp.variant_id AND
								dp.dscsig_id	= dsxpg.dscsig_id' }"
				 FIELDS	= "l.product_id, l.pgrp_id">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00361', g.MvQUERY_Error ) }">
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "DiscountVariantPrice_Delete_All_PriceGroupCategory" PARAMETERS = "pgrp_id, cat_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ g.Native_DBAPI EQ 'postgresql' }">
		<MvQUERY NAME	= "Merchant"
				 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'DiscountVariantPrices dp
				 			  USING
								' $ g.Store_Table_Prefix $ 'CategoryXProduct cxp,
								' $ g.Store_Table_Prefix $ 'DiscountSignatureXPriceGroup dsxpg
							  WHERE
								cxp.cat_id		= ?					AND
								dsxpg.pgrp_id	= ?					AND
								dp.product_id	= cxp.product_id	AND
								dp.dscsig_id	= dsxpg.dscsig_id' }"
				 FIELDS	= "l.cat_id, l.pgrp_id">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00358', g.MvQUERY_Error ) }">
		</MvIF>
	<MvELSE>
		<MvQUERY NAME	= "Merchant"
				 QUERY	= "{ 'DELETE
								dp
							  FROM
								' $ g.Store_Table_Prefix $ 'DiscountVariantPrices dp,
								' $ g.Store_Table_Prefix $ 'CategoryXProduct cxp,
								' $ g.Store_Table_Prefix $ 'DiscountSignatureXPriceGroup dsxpg
							  WHERE
								cxp.cat_id		= ?					AND
								dsxpg.pgrp_id	= ?					AND
								dp.product_id	= cxp.product_id	AND
								dp.dscsig_id	= dsxpg.dscsig_id' }"
				 FIELDS	= "l.cat_id, l.pgrp_id">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00359', g.MvQUERY_Error ) }">
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| Helper Functions
|
</MvCOMMENT>

<MvFUNCTION NAME = "PriceGroupLookup_Load_Product_Inclusion" PARAMETERS = "product_id, lookup var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PriceGroups"
				QUERY	= "{ 'SELECT
								pgxp.pgrp_id	AS pgrp_id
							  FROM
								' $ g.Store_Table_Prefix $ 'PriceGroupXProduct pgxp
							  WHERE
								pgxp.product_id	= ?
							  UNION ALL
							  SELECT
								pgxc.pgrp_id	AS pgrp_id
							  FROM
								' $ g.Store_Table_Prefix $ 'CategoryXProduct cxp,
								' $ g.Store_Table_Prefix $ 'PriceGroupXCategory pgxc
							  WHERE
								cxp.product_id	= ?				AND
								pgxc.cat_id		= cxp.cat_id' }"
				FIELDS	= "l.product_id, l.product_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00263', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvWHILE EXPR = "{ NOT PriceGroups.d.EOF }">
		<MvIF EXPR = "{ PriceGroups.d.pgrp_id GT 0 }">
			<MvASSIGN NAME = "l.lookup" INDEX = "{ PriceGroups.d.pgrp_id }"	VALUE = 1>
		</MvIF>

		<MvSKIP NAME = "Merchant" VIEW = "PriceGroups" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroups">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroupLookup_Load_Product_Exclusion" PARAMETERS = "product_id, lookup var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "PriceGroups"
				QUERY	= "{ 'SELECT
								pgxep.pgrp_id	AS pgrp_id
							  FROM
								' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedProduct pgxep
							  WHERE
								pgxep.product_id	= ?
							  UNION ALL
							  SELECT
								pgxec.pgrp_id	AS pgrp_id
							  FROM
								' $ g.Store_Table_Prefix $ 'CategoryXProduct cxp,
								' $ g.Store_Table_Prefix $ 'PriceGroupXExcludedCategory pgxec
							  WHERE
								cxp.product_id	= ?				AND
								pgxec.cat_id	= cxp.cat_id' }"
				FIELDS	= "l.product_id, l.product_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00264', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvWHILE EXPR = "{ NOT PriceGroups.d.EOF }">
		<MvIF EXPR = "{ PriceGroups.d.pgrp_id GT 0 }">
			<MvASSIGN NAME = "l.lookup" INDEX = "{ PriceGroups.d.pgrp_id }"	VALUE = 1>
		</MvIF>

		<MvSKIP NAME = "Merchant" VIEW = "PriceGroups" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroups">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroup_Product_In_PriceGroupXCategory" PARAMETERS = "pgrp_id, product_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW 	= "PriceGroup"
				QUERY 	= "{ 'SELECT
								p.id
							  FROM '
								$ g.Store_Table_Prefix $ 'Products p,'
								$ g.Store_Table_Prefix $ 'CategoryXProduct cxp,'
								$ g.Store_Table_Prefix $ 'PriceGroupXCategory pgxc
							  WHERE
								p.id			= ?					AND
								p.id			= cxp.product_id	AND
								cxp.cat_id		= pgxc.cat_id		AND
								pgxc.pgrp_id	= ?' }"
				FIELDS	= "l.product_id, l.pgrp_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00265', g.MvOPENVIEW_Error ) }">
	</MvIF>
	
	<MvIF EXPR = "{ PriceGroup.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroup">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-PGR-DTB-00266' ) }">
	</MvIF>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroup">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "PriceGroup_Product_In_PriceGroupXExcludedCategory" PARAMETERS = "pgrp_id, product_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW 	= "PriceGroup"
				QUERY 	= "{ 'SELECT
								p.id
							  FROM '
								$ g.Store_Table_Prefix $ 'Products p,'
								$ g.Store_Table_Prefix $ 'CategoryXProduct cxp,'
								$ g.Store_Table_Prefix $ 'PriceGroupXExcludedCategory pgxec
							  WHERE
								p.id			= ?					AND
								p.id			= cxp.product_id	AND
								cxp.cat_id		= pgxec.cat_id		AND
								pgxec.pgrp_id	= ?' }"
				FIELDS	= "l.product_id, l.pgrp_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-PGR-DTB-00267', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ PriceGroup.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroup">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-PGR-DTB-00268' ) }">
	</MvIF>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "PriceGroup">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>
