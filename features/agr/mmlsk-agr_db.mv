<MIVA STANDARDOUTPUTLEVEL = "">

<MvCOMMENT>
|
| Miva Merchant
|
| This file and the source codes contained herein are the property of
| Miva, Inc.  Use of this file is restricted to the specific terms and
| conditions in the License Agreement associated with this file.  Distribution
| of this file or portions of this file for uses not covered by the License
| Agreement is not allowed without a written agreement signed by an officer of
| Miva, Inc.
|
| Copyright 1998-2024 Miva, Inc.  All rights reserved.
| http://www.miva.com
|
| Prefix         : MER-AGR-DTB-
| Next Error Code: 109
|
</MvCOMMENT>

<MvFUNCTION NAME = "AGR_Store_Create" PARAMETERS = "" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT [ g.Module_Library_DB ].StoreKey_Insert( 'AvailabilityGroups', 1 ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_AvailabilityGroups
	|
	</MvCOMMENT>

	<MvQUERY	NAME = "Merchant"
				QUERY = "{ 'CREATE TABLE ' $  g.Store_Table_Prefix $ 'AvailabilityGroups
							(
								id			' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
								name		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 40 )	$ ',
								tax_exempt	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()		$ '
							)' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00001', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY	NAME = "Merchant"
				QUERY = "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'AvailabilityGroups_1 ON ' $ g.Store_Table_Prefix $ 'AvailabilityGroups ( id ) ' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00002', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY	NAME = "Merchant"
				QUERY = "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'AvailabilityGroups_2 ON ' $ g.Store_Table_Prefix $ 'AvailabilityGroups ( name ) ' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00003', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_AvailGroupXProduct
	|
	</MvCOMMENT>

	<MvQUERY	NAME = "Merchant"
				QUERY = "{ 'CREATE TABLE ' $  g.Store_Table_Prefix $ 'AvailGroupXProduct
							(
								agrp_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
								product_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
								automatic	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL() 	$ ',
								colcount	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ '
							)' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00004', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY	NAME = "Merchant"
				QUERY = "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'AvailGroupXProduct_1 ON ' $ g.Store_Table_Prefix $ 'AvailGroupXProduct ( agrp_id, product_id ) ' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00005', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY	NAME = "Merchant"
				QUERY = "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'AvailGroupXProduct_2 ON ' $ g.Store_Table_Prefix $ 'AvailGroupXProduct ( product_id ) ' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00006', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'AvailGroupXProduct_3 ON ' $ g.Store_Table_Prefix $ 'AvailGroupXProduct ( agrp_id, automatic, colcount )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00079', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'AvailGroupXProduct_4 ON ' $ g.Store_Table_Prefix $ 'AvailGroupXProduct ( product_id, automatic, colcount )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00080', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_AvailGroupXCollection
	|
	</MvCOMMENT>

	<MvQUERY NAME   = "Merchant"
			 QUERY  = "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'AvailGroupXCollection
						  (
							agrp_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ ',
							col_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00081', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME   = "Merchant"
			 QUERY  = "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'AvailGroupXCollection_1 ON ' $ g.Store_Table_Prefix $ 'AvailGroupXCollection ( agrp_id, col_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00082', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_AvailGroupXProductCollectionExclusions
	|
	</MvCOMMENT>

	<MvQUERY NAME   = "Merchant"
			 QUERY  = "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'AvailGroupXProductCollectionExclusions
						  (
							agrp_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ ',
							product_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ ',
							colcount	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()	$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00083', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME   = "Merchant"
			 QUERY  = "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'AvailGroupXProductCollectionExclusions_1 ON ' $ g.Store_Table_Prefix $ 'AvailGroupXProductCollectionExclusions ( agrp_id, product_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00084', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME   = "Merchant"
			 QUERY  = "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'AvailGroupXProductCollectionExclusions_2 ON ' $ g.Store_Table_Prefix $ 'AvailGroupXProductCollectionExclusions ( product_id, agrp_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00085', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME   = "Merchant"
			 QUERY  = "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'AvailGroupXProductCollectionExclusions_3 ON ' $ g.Store_Table_Prefix $ 'AvailGroupXProductCollectionExclusions ( agrp_id, colcount )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00086', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME   = "Merchant"
			 QUERY  = "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'AvailGroupXProductCollectionExclusions_4 ON ' $ g.Store_Table_Prefix $ 'AvailGroupXProductCollectionExclusions ( product_id, colcount )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00087', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_AvailGroupXCategory
	|
	</MvCOMMENT>

	<MvQUERY	NAME = "Merchant"
				QUERY = "{ 'CREATE TABLE ' $  g.Store_Table_Prefix $ 'AvailGroupXCategory
							(
								agrp_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
								cat_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ '
							)' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00007', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY	NAME = "Merchant"
				QUERY = "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'AvailGroupXCategory_1 ON ' $ g.Store_Table_Prefix $ 'AvailGroupXCategory ( agrp_id, cat_id ) ' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00008', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY	NAME = "Merchant"
				QUERY = "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'AvailGroupXCategory_2 ON ' $ g.Store_Table_Prefix $ 'AvailGroupXCategory ( cat_id ) ' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00009', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_AvailGroupXCustomer
	|
	</MvCOMMENT>

	<MvQUERY	NAME = "Merchant"
				QUERY = "{ 'CREATE TABLE ' $  g.Store_Table_Prefix $ 'AvailGroupXCustomer
							(
								agrp_id ' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
								cust_id ' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ '
							)' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00010', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY	NAME = "Merchant"
				QUERY = "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'AvailGroupXCustomer_1 ON ' $ g.Store_Table_Prefix $ 'AvailGroupXCustomer ( cust_id ) ' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00011', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY	NAME = "Merchant"
				QUERY = "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'AvailGroupXCustomer_2 ON ' $ g.Store_Table_Prefix $ 'AvailGroupXCustomer ( agrp_id, cust_id ) ' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00012', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_AvailGroupXBusinessAccount
	|
	</MvCOMMENT>

	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'AvailGroupXBusinessAccount
						  (
							agrp_id 	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ ',
							account_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER() $ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00042', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'AvailGroupXBusinessAccount_1 ON ' $ g.Store_Table_Prefix $ 'AvailGroupXBusinessAccount ( agrp_id, account_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00043', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'AvailGroupXBusinessAccount_2 ON ' $ g.Store_Table_Prefix $ 'AvailGroupXBusinessAccount ( account_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00044', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_AvailGroupXShippingMethod
	|
	</MvCOMMENT>

	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'AvailGroupXShippingMethod
						  (
							agrp_id 	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							mod_code	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 50 )	$ ',
							meth_code	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 100 )	$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00045', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'AvailGroupXShippingMethod_1 ON ' $ g.Store_Table_Prefix $ 'AvailGroupXShippingMethod ( agrp_id, mod_code, meth_code )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00046', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'AvailGroupXShippingMethod_2 ON ' $ g.Store_Table_Prefix $ 'AvailGroupXShippingMethod ( mod_code, meth_code )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00047', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	| sNN_AvailGroupXPaymentMethod
	|
	</MvCOMMENT>

	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'AvailGroupXPaymentMethod
						  (
							agrp_id 	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ ',
							mod_code	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 50 )	$ ',
							meth_code	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 100 )	$ ',
							pctype_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_INTEGER()		$ '
						  )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00063', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'AvailGroupXPaymentMethod_1 ON ' $ g.Store_Table_Prefix $ 'AvailGroupXPaymentMethod ( agrp_id, mod_code, meth_code, pctype_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00064', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'AvailGroupXPaymentMethod_2 ON ' $ g.Store_Table_Prefix $ 'AvailGroupXPaymentMethod ( mod_code, meth_code, pctype_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00065', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AGR_Store_Delete" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $  g.Store_Table_Prefix $ 'AvailabilityGroups' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $  g.Store_Table_Prefix $ 'AvailGroupXProduct' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $  g.Store_Table_Prefix $ 'AvailGroupXCollection' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $  g.Store_Table_Prefix $ 'AvailGroupXProductCollectionExclusions' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $  g.Store_Table_Prefix $ 'AvailGroupXCategory' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $  g.Store_Table_Prefix $ 'AvailGroupXCustomer' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $  g.Store_Table_Prefix $ 'AvailGroupXBusinessAccount' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $  g.Store_Table_Prefix $ 'AvailGroupXShippingMethod' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $  g.Store_Table_Prefix $ 'AvailGroupXPaymentMethod' }">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AGR_Create_Data_Files" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT [ g.Module_Library_DB ].DomainPrivilege_Insert( 'AGRP', 'Availability Groups' ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailabilityGroup_Read" PARAMETERS = "availabilitygroup var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.availabilitygroup:id"			VALUE = "{ AvailabilityGroups.d.id }">
	<MvASSIGN NAME = "l.availabilitygroup:name"			VALUE = "{ AvailabilityGroups.d.name }">
	<MvASSIGN NAME = "l.availabilitygroup:tax_exempt"	VALUE = "{ AvailabilityGroups.d.tax_exempt }">
</MvFUNCTION>

<MvFUNCTION NAME = "AvailabilityGroup_Insert" PARAMETERS = "availabilitygroup var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.availabilitygroup:id" VALUE = "{ [ g.Module_Library_DB ].StoreKey_Generate( 'AvailabilityGroups' ) }">

	<MvIF EXPR = "{ ISNULL l.availabilitygroup:tax_exempt }">
		<MvASSIGN NAME = "l.availabilitygroup:tax_exempt" VALUE = 0>
	</MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'AvailabilityGroups
					      ( id, name, tax_exempt )
						  VALUES
						  ( ?, ?, ? )' }"
			 FIELDS	= "l.availabilitygroup:id, l.availabilitygroup:name, l.availabilitygroup:tax_exempt">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00013', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailabilityGroup_Update" PARAMETERS = "availabilitygroup var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'AvailabilityGroups
					      SET
							name		= ?,
							tax_exempt 	= ?
						  WHERE
							id			= ?' }"
			 FIELDS	= "l.availabilitygroup:name, l.availabilitygroup:tax_exempt,
					   l.availabilitygroup:id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00014', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailabilityGroup_Delete" PARAMETERS = "availabilitygroup var" STANDARDOUTPUTLEVEL = "">
	<MvTRANSACT NAME = "Merchant">

	<MvIF EXPR = "{ NOT [ g.Module_Library_DB ].Category_Decrement_AvailabilityGroupCount_All( l.availabilitygroup:id )					OR
					NOT [ g.Module_Library_DB ].Product_Decrement_AvailabilityGroupCount_All( l.availabilitygroup:id ) 					OR
					NOT [ g.Module_Feature_PAY_DB ].PaymentMethodRules_Decrement_AvailabilityGroupCount_All( l.availabilitygroup:id )	OR
					NOT [ g.Module_Feature_SHP_DB ].ShippingMethodRules_Decrement_AvailabilityGroupCount_All( l.availabilitygroup:id )	OR
					NOT [ g.Module_Feature_CUS_DB ].Customer_Decrement_AvailabilityGroupCount_All( l.availabilitygroup:id )				OR
					NOT [ g.Module_Feature_CUS_DB ].BusinessAccount_Decrement_AvailabilityGroupCount_All( l.availabilitygroup:id )		OR
					NOT AvailGroupXCustomer_Delete_All_AvailabilityGroup( l.availabilitygroup:id ) 										OR
					NOT AvailGroupXCategory_Delete_All_AvailabilityGroup( l.availabilitygroup:id ) 										OR
					NOT AvailGroupXProduct_Delete_All_AvailabilityGroup( l.availabilitygroup:id ) 										OR
					NOT AvailGroupXBusinessAccount_Delete_All_AvailabilityGroup( l.availabilitygroup:id )								OR
					NOT AvailGroupXShippingMethod_Delete_All_AvailabilityGroup( l.availabilitygroup:id )								OR
					NOT AvailGroupXPaymentMethod_Delete_All_AvailabilityGroup( l.availabilitygroup:id )									OR
					NOT AvailGroupXCollection_Delete_All_AvailabilityGroup( l.availabilitygroup:id )									OR
					NOT AvailGroupXProductCollectionExclusion_Delete_All_AvailabilityGroup( l.availabilitygroup:id )					OR
					NOT AvailabilityGroup_Delete_ID( l.availabilitygroup:id ) }">
		<MvROLLBACK NAME = "Merchant">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMIT NAME = "Merchant">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailabilityGroup_Delete_ID" PARAMETERS = "id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'AvailabilityGroups WHERE id = ?' }"
			 FIELDS	= "l.id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00015', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailabilityGroupList_Load_Offset" PARAMETERS = "offset, search, searchable_fields, max, nextoffset var, groups var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.query"		VALUE = "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'AvailabilityGroups' }">

	<MvIF EXPR = "{ len( l.search ) }">
		<MvASSIGN NAME = "l.query"	VALUE = "{ l.query $ ' WHERE ' $ [ g.Module_Library_DB ].SQL_Search_Clause( l.search, g.Store_Table_Prefix $ 'AvailabilityGroups', l.searchable_fields, l.fields ) }">
	</MvIF>

	<MvASSIGN NAME = "l.query"		VALUE = "{ l.query $ ' ORDER BY id' }">

	<MvIF EXPR = "{ l.max EQ 0 }">	<MvASSIGN NAME = "l.limit" VALUE = 0>
	<MvELSE>						<MvASSIGN NAME = "l.limit" VALUE = "{ l.max + 1 }">
	</MvIF>

	<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_OPENVIEW_Range( 'Merchant', 'AvailabilityGroups',
																			 l.query, l.fields,
																			 l.offset, l.limit ) }">
		<MvFUNCTIONRETURN VALUE = "{  [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00016', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.group_count" VALUE = 0>
	<MvWHILE EXPR = "{ ( NOT AvailabilityGroups.d.EOF ) AND ( ( l.max EQ 0 ) OR ( l.group_count LT l.max ) ) }">
		<MvASSIGN NAME = "l.group_count" VALUE = "{ l.group_count + 1 }">
		<MvEVAL EXPR = "{ AvailabilityGroup_Read( l.groups[ l.group_count ] ) }">

		<MvSKIP NAME = "Merchant" VIEW = "AvailabilityGroups" ROWS = 1>
	</MvWHILE>

	<MvIF EXPR = "{ AvailabilityGroups.d.EOF }">
		<MvASSIGN NAME = "l.nextoffset"	VALUE = 0>
	<MvELSE>
		<MvASSIGN NAME = "l.nextoffset"	VALUE = "{ l.offset + l.group_count }">
	</MvIF>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "AvailabilityGroups">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-AGR-DTB-00035', l.group_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "AvailabilityGroupList_Load_Customer" PARAMETERS = "cust_id, availabilitygroups var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "AvailabilityGroups"
				QUERY	= "{ 'SELECT
								ag.*
							  FROM
								' $ g.Store_Table_Prefix $ 'AvailGroupXCustomer agxc,
								' $ g.Store_Table_Prefix $ 'AvailabilityGroups ag
							  WHERE
							  	agxc.cust_id	= ?				AND
							  	ag.id			= agxc.agrp_id' }"
				FIELDS	= "l.cust_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00076', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.availabilitygroup_count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT AvailabilityGroups.d.EOF }">
		<MvEVAL EXPR = "{ AvailabilityGroup_Read( l.availabilitygroups[ ++l.availabilitygroup_count ] ) }">

		<MvSKIP NAME = "Merchant" VIEW = "AvailabilityGroups" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "AvailabilityGroups">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-AGR-DTB-00077', l.availabilitygroup_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "AvailabilityGroupList_Load_All" PARAMETERS = "availabilitygroups var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "AvailabilityGroups"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'AvailabilityGroups' }">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00017', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.availabilitygroup_count" VALUE = 0>
	<MvWHILE EXPR = "{ NOT AvailabilityGroups.d.EOF }">
		<MvASSIGN NAME = "l.availabilitygroup_count" VALUE = "{ l.availabilitygroup_count + 1 }">
		<MvEVAL EXPR = "{ AvailabilityGroup_Read( l.availabilitygroups[ l.availabilitygroup_count ] ) }">

		<MvSKIP NAME = "Merchant" VIEW = "AvailabilityGroups" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "AvailabilityGroups">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-AGR-DTB-00036', l.availabilitygroup_count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "AvailabilityGroup_Load_ID" PARAMETERS = "id, availabilitygroup var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "AvailabilityGroups"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'AvailabilityGroups WHERE id = ?' }"
				FIELDS	= "l.id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00018', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ AvailabilityGroups.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "AvailabilityGroups">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-AGR-DTB-00037' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ AvailabilityGroup_Read( l.availabilitygroup ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "AvailabilityGroups">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailabilityGroup_Load_Name" PARAMETERS = "name, availabilitygroup var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "AvailabilityGroups"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'AvailabilityGroups WHERE ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( 'name' ) $ ' = ' $ [ g.Module_Library_Native_DBAPI ].DB_Compare_UPPER( '?' ) }"
				FIELDS	= "l.name">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00019', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ AvailabilityGroups.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "AvailabilityGroups">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-AGR-DTB-00038' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ AvailabilityGroup_Read( l.availabilitygroup ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "AvailabilityGroups">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXCategory_Read" PARAMETERS = "availgroupxcategory var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.availgroupxcategory:agrp_id"	VALUE = "{ AvailGroupXCategory.d.agrp_id }">
	<MvASSIGN NAME = "l.availgroupxcategory:cat_id"		VALUE = "{ AvailGroupXCategory.d.cat_id }">
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXCategory_Insert" PARAMETERS = "agrp_id, cat_id" STANDARDOUTPUTLEVEL = "">
	<MvTRANSACT NAME = "Merchant">

	<MvIF EXPR = "{ NOT AvailGroupXCategory_Insert_LowLevel( l.agrp_id, l.cat_id ) OR
					NOT [ g.Module_Library_DB ].Category_Increment_AvailabilityGroupCount( l.cat_id ) }">
		<MvROLLBACK NAME = "Merchant">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMIT NAME = "Merchant">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXCategory_Insert_LowLevel" PARAMETERS = "agrp_id, cat_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'AvailGroupXCategory
					      ( agrp_id, cat_id )
						  VALUES
						  ( ?, ? )' }"
			 FIELDS	= "l.agrp_id, l.cat_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00020', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXCategory_Delete" PARAMETERS = "agrp_id, cat_id" STANDARDOUTPUTLEVEL = "">
	<MvTRANSACT NAME = "Merchant">

	<MvIF EXPR = "{ NOT AvailGroupXCategory_Delete_LowLevel( l.agrp_id, l.cat_id ) OR
					NOT [ g.Module_Library_DB ].Category_Decrement_AvailabilityGroupCount( l.cat_id ) }">
		<MvROLLBACK NAME = "Merchant">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMIT NAME = "Merchant">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXCategory_Delete_LowLevel" PARAMETERS = "agrp_id, cat_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'AvailGroupXCategory
					      WHERE
							agrp_id	= ? AND
							cat_id	= ?' }"
			 FIELDS	= "l.agrp_id, l.cat_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00021', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXCategory_Load" PARAMETERS = "agrp_id, cat_id, availgroupxcategory var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "AvailGroupXCategory"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'AvailGroupXCategory WHERE agrp_id = ? AND cat_id = ?' }"
				FIELDS	= "l.agrp_id, l.cat_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00022', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ AvailGroupXCategory.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "AvailGroupXCategory">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-AGR-DTB-00039' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ AvailGroupXCategory_Read( l.availgroupxcategory ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "AvailGroupXCategory">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXCategory_Delete_All_AvailabilityGroup" PARAMETERS = "agrp_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'AvailGroupXCategory WHERE agrp_id = ?' }"
			 FIELDS	= "l.agrp_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00023', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXCategory_Delete_All_Category" PARAMETERS = "cat_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'AvailGroupXCategory WHERE cat_id = ?' }"
			 FIELDS	= "l.cat_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00024', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXCustomer_Read" PARAMETERS = "availgroupxcustomer var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.availgroupxcustomer:agrp_id"	VALUE = "{ AvailGroupXCustomer.d.agrp_id }">
	<MvASSIGN NAME = "l.availgroupxcustomer:cust_id"	VALUE = "{ AvailGroupXCustomer.d.cust_id }">
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXCustomer_Insert" PARAMETERS = "agrp_id, cust_id" STANDARDOUTPUTLEVEL = "">
	<MvTRANSACT NAME = "Merchant">

	<MvIF EXPR = "{ NOT AvailGroupXCustomer_Insert_LowLevel( l.agrp_id, l.cust_id ) OR
					NOT [ g.Module_Feature_CUS_DB ].Customer_Increment_AvailabilityGroupCount( l.cust_id ) }">
		<MvROLLBACK NAME = "Merchant">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMIT NAME = "Merchant">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXCustomer_Insert_LowLevel" PARAMETERS = "agrp_id, cust_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'AvailGroupXCustomer
					      ( agrp_id, cust_id )
						  VALUES
						  ( ?, ? )' }"
			 FIELDS	= "l.agrp_id, l.cust_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00025', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXCustomer_Delete" PARAMETERS = "agrp_id, cust_id" STANDARDOUTPUTLEVEL = "">
	<MvTRANSACT NAME = "Merchant">

	<MvIF EXPR = "{ NOT AvailGroupXCustomer_Delete_LowLevel( l.agrp_id, l.cust_id ) OR
					NOT [ g.Module_Feature_CUS_DB ].Customer_Decrement_AvailabilityGroupCount( l.cust_id ) }">
		<MvROLLBACK NAME = "Merchant">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMIT NAME = "Merchant">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXCustomer_Delete_LowLevel" PARAMETERS = "agrp_id, cust_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'AvailGroupXCustomer
						  WHERE
							agrp_id	= ? AND
							cust_id	= ?' }"
			 FIELDS	= "l.agrp_id, l.cust_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00026', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXCustomer_Load" PARAMETERS = "agrp_id, cust_id, availgroupxcustomer var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "AvailGroupXCustomer"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'AvailGroupXCustomer WHERE agrp_id = ? AND cust_id = ?' }"
				FIELDS	= "l.agrp_id, l.cust_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00027', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ AvailGroupXCustomer.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "AvailGroupXCustomer">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-AGR-DTB-00040' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ AvailGroupXCustomer_Read( l.availgroupxcustomer ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "AvailGroupXCustomer">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXCustomer_Delete_All_AvailabilityGroup" PARAMETERS = "agrp_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'AvailGroupXCustomer WHERE agrp_id = ?' }"
			 FIELDS	= "l.agrp_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00028', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXCustomer_Delete_All_Customer" PARAMETERS = "cust_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'AvailGroupXCustomer WHERE cust_id = ?' }"
			 FIELDS	= "l.cust_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00029', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXProduct_Read" PARAMETERS = "availgroupxproduct var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.availgroupxproduct:agrp_id"		VALUE = "{ AvailGroupXProduct.d.agrp_id }">
	<MvASSIGN NAME = "l.availgroupxproduct:product_id"	VALUE = "{ AvailGroupXProduct.d.product_id }">
	<MvASSIGN NAME = "l.availgroupxproduct:automatic"	VALUE = "{ AvailGroupXProduct.d.automatic }">
	<MvASSIGN NAME = "l.availgroupxproduct:colcount"	VALUE = "{ AvailGroupXProduct.d.colcount }">
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXProduct_Insert" PARAMETERS = "agrp_id, product_id" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.availgroupxproduct"				VALUE = "">
	<MvASSIGN NAME = "l.availgroupxproduct:agrp_id"		VALUE = "{ l.agrp_id }">
	<MvASSIGN NAME = "l.availgroupxproduct:product_id"	VALUE = "{ l.product_id }">
	<MvASSIGN NAME = "l.availgroupxproduct:automatic"	VALUE = 0>
	<MvASSIGN NAME = "l.availgroupxproduct:colcount"	VALUE = 0>

	<MvFUNCTIONRETURN VALUE = "{ v10_AvailGroupXProduct_Insert( l.availgroupxproduct ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "v10_AvailGroupXProduct_Insert" PARAMETERS = "availgroupxproduct var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT AvailGroupXProduct_Insert_LowLevel( l.availgroupxproduct ) OR
					NOT AvailGroupXProductCollectionExclusion_Delete( l.availgroupxproduct:agrp_id, l.availgroupxproduct:product_id ) OR
					NOT [ g.Module_Library_DB ].Product_Increment_AvailabilityGroupCount( l.availgroupxproduct:product_id ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXProduct_Insert_LowLevel" PARAMETERS = "availgroupxproduct var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ ISNULL l.availgroupxproduct:automatic }">	<MvASSIGN NAME = "l.availgroupxproduct:automatic"	VALUE = 0> </MvIF>
	<MvIF EXPR = "{ ISNULL l.availgroupxproduct:colcount }">	<MvASSIGN NAME = "l.availgroupxproduct:colcount"	VALUE = 0> </MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'AvailGroupXProduct
					      ( agrp_id, product_id, automatic, colcount )
						  VALUES
						  ( ?, ?, ?, ? )' }"
			 FIELDS	= "l.availgroupxproduct:agrp_id, l.availgroupxproduct:product_id, l.availgroupxproduct:automatic, l.availgroupxproduct:colcount">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00030', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXProduct_Delete" PARAMETERS = "agrp_id, product_id" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ AvailGroupXProduct_Load( l.agrp_id, l.product_id, l.availgroupxproduct ) }">
		<MvIF EXPR = "{ NOT v10_AvailGroupXProduct_Delete( l.availgroupxproduct ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "v10_AvailGroupXProduct_Delete" PARAMETERS = "availgroupxproduct var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT AvailGroupXProduct_Delete_LowLevel( l.availgroupxproduct:agrp_id, l.availgroupxproduct:product_id ) OR
					NOT [ g.Module_Library_DB ].Product_Decrement_AvailabilityGroupCount( l.availgroupxproduct:product_id ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ l.availgroupxproduct:colcount GT 0 }">
		<MvASSIGN NAME = "l.availgroupxproductcollectionexclusion"				VALUE = "">
		<MvASSIGN NAME = "l.availgroupxproductcollectionexclusion:agrp_id"		VALUE = "{ l.availgroupxproduct:agrp_id }">
		<MvASSIGN NAME = "l.availgroupxproductcollectionexclusion:product_id"	VALUE = "{ l.availgroupxproduct:product_id }">
		<MvASSIGN NAME = "l.availgroupxproductcollectionexclusion:colcount"		VALUE = "{ l.availgroupxproduct:colcount }">

		<MvIF EXPR = "{ NOT AvailGroupXProductCollectionExclusion_Insert( l.availgroupxproductcollectionexclusion ) }">
			<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_Error_IsIndexDuplicate( g.Error_Message ) }">
				<MvFUNCTIONRETURN VALUE = 0>
			</MvIF>
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXProduct_Delete_LowLevel" PARAMETERS = "agrp_id, product_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'AvailGroupXProduct
					      WHERE
							agrp_id	= ? AND
							product_id	= ?' }"
			 FIELDS	= "l.agrp_id, l.product_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00031', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXProduct_Load" PARAMETERS = "agrp_id, product_id, availgroupxproduct var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "AvailGroupXProduct"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'AvailGroupXProduct WHERE agrp_id = ? AND product_id = ?' }"
				FIELDS	= "l.agrp_id, l.product_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00032', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ AvailGroupXProduct.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "AvailGroupXProduct">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-AGR-DTB-00041' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ AvailGroupXProduct_Read( l.availgroupxproduct ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "AvailGroupXProduct">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXProduct_Delete_All_AvailabilityGroup" PARAMETERS = "agrp_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'AvailGroupXProduct WHERE agrp_id = ?' }"
			 FIELDS	= "l.agrp_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00033', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXProduct_Delete_All_Product" PARAMETERS = "product_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'AvailGroupXProduct WHERE product_id = ?' }"
			 FIELDS	= "l.product_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00034', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_AvailGroupXBusinessAccount
|
</MvCOMMENT>

<MvFUNCTION NAME = "AvailGroupXBusinessAccount_Read" PARAMETERS = "availgroupxbusinessaccount var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.availgroupxbusinessaccount:agrp_id"		VALUE = "{ AvailGroupXBusinessAccount.d.agrp_id }">
	<MvASSIGN NAME = "l.availgroupxbusinessaccount:account_id"	VALUE = "{ AvailGroupXBusinessAccount.d.account_id }">
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXBusinessAccount_Insert" PARAMETERS = "agrp_id, account_id" STANDARDOUTPUTLEVEL = "">
	<MvTRANSACT NAME = "Merchant">

	<MvIF EXPR = "{ NOT AvailGroupXBusinessAccount_Insert_LowLevel( l.agrp_id, l.account_id ) OR
					NOT [ g.Module_Feature_CUS_DB ].BusinessAccount_Increment_AvailabilityGroupCount( l.account_id ) }">
		<MvROLLBACK NAME = "Merchant">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMIT NAME = "Merchant">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXBusinessAccount_Insert_LowLevel" PARAMETERS = "agrp_id, account_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'AvailGroupXBusinessAccount
					      ( agrp_id, account_id )
						  VALUES
						  ( ?, ? )' }"
			 FIELDS	= "l.agrp_id, l.account_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00048', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXBusinessAccount_Delete" PARAMETERS = "agrp_id, account_id" STANDARDOUTPUTLEVEL = "">
	<MvTRANSACT NAME = "Merchant">

	<MvIF EXPR = "{ NOT AvailGroupXBusinessAccount_Delete_LowLevel( l.agrp_id, l.account_id ) OR
					NOT [ g.Module_Feature_CUS_DB ].BusinessAccount_Decrement_AvailabilityGroupCount( l.account_id ) }">
		<MvROLLBACK NAME = "Merchant">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMIT NAME = "Merchant">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXBusinessAccount_Delete_LowLevel" PARAMETERS = "agrp_id, account_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'AvailGroupXBusinessAccount
						  WHERE
							agrp_id		= ? AND
							account_id	= ?' }"
			 FIELDS	= "l.agrp_id, l.account_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00049', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXBusinessAccount_Load" PARAMETERS = "agrp_id, account_id, availgroupxbusinessaccount var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "AvailGroupXBusinessAccount"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'AvailGroupXBusinessAccount WHERE agrp_id = ? AND account_id = ?' }"
				FIELDS	= "l.agrp_id, l.account_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00050', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ AvailGroupXBusinessAccount.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "AvailGroupXBusinessAccount">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-AGR-DTB-00051' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ AvailGroupXBusinessAccount_Read( l.availgroupxbusinessaccount ) }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "AvailGroupXBusinessAccount">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXBusinessAccount_Delete_All_AvailabilityGroup" PARAMETERS = "agrp_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'AvailGroupXBusinessAccount WHERE agrp_id = ?' }"
			 FIELDS	= "l.agrp_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00052', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXBusinessAccount_Delete_All_BusinessAccount" PARAMETERS = "account_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'AvailGroupXBusinessAccount WHERE account_id = ?' }"
			 FIELDS	= "l.account_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00053', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_AvailGroupXShippingMethod
|
</MvCOMMENT>

<MvFUNCTION NAME = "AvailGroupXShippingMethod_Read" PARAMETERS = "availgroupxshippingmethod var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.availgroupxshippingmethod:agrp_id"		VALUE = "{ AvailGroupXShippingMethod.d.agrp_id }">
	<MvASSIGN NAME = "l.availgroupxshippingmethod:mod_code"		VALUE = "{ AvailGroupXShippingMethod.d.mod_code }">
	<MvASSIGN NAME = "l.availgroupxshippingmethod:meth_code"	VALUE = "{ AvailGroupXShippingMethod.d.meth_code }">
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXShippingMethod_Insert" PARAMETERS = "agrp_id, mod_code, meth_code" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT AvailGroupXShippingMethod_Insert_LowLevel( l.agrp_id, l.mod_code, l.meth_code ) OR
					NOT	[ g.Module_Feature_SHP_DB ].ShippingMethodRules_Increment_AvailabilityGroupCount( l.mod_code, l.meth_code ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXShippingMethod_Insert_LowLevel" PARAMETERS = "agrp_id, mod_code, meth_code" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'AvailGroupXShippingMethod
					      ( agrp_id, mod_code, meth_code )
						  VALUES
						  ( ?, ?, ? )' }"
			 FIELDS	= "l.agrp_id, l.mod_code, l.meth_code">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00054', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXShippingMethod_Update_All_Method" PARAMETERS = "mod_code, old_meth_code, new_meth_code" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'AvailGroupXShippingMethod
						  SET
						  	meth_code	= ?
						  WHERE
						  	mod_code	= ? AND
						  	meth_code	= ?' }"
			 FIELDS = "l.new_meth_code,
			 		   l.mod_code, l.old_meth_code">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00075', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXShippingMethod_Delete" PARAMETERS = "agrp_id, mod_code, meth_code" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT AvailGroupXShippingMethod_Delete_LowLevel( l.agrp_id, l.mod_code, l.meth_code ) OR
					NOT [ g.Module_Feature_SHP_DB ].ShippingMethodRules_Decrement_AvailabilityGroupCount( l.mod_code, l.meth_code ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXShippingMethod_Delete_LowLevel" PARAMETERS = "agrp_id, mod_code, meth_code" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'AvailGroupXShippingMethod
						  WHERE
							agrp_id		= ? AND
							mod_code	= ? AND
							meth_code	= ?' }"
			 FIELDS	= "l.agrp_id, l.mod_code, l.meth_code">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00055', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXShippingMethod_Load" PARAMETERS = "agrp_id, mod_code, meth_code, availgroupxshippingmethod var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "AvailGroupXShippingMethod"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'AvailGroupXShippingMethod WHERE agrp_id = ? AND mod_code = ? AND meth_code = ?' }"
				FIELDS	= "l.agrp_id, l.mod_code, l.meth_code">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00056', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ AvailGroupXShippingMethod.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "AvailGroupXShippingMethod">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-AGR-DTB-00057' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ AvailGroupXShippingMethod_Read( l.availgroupxshippingmethod ) }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "AvailGroupXShippingMethod">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXShippingMethodList_Load" PARAMETERS = "agrp_id, availgroupxshippingmethods var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW 	= "AvailGroupXShippingMethod"
				QUERY 	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'AvailGroupXShippingMethod WHERE agrp_id = ?' }"
				FIELDS	= "l.agrp_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00058', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT AvailGroupXShippingMethod.d.EOF }">
		<MvEVAL EXPR = "{ AvailGroupXShippingMethod_Read( l.availgroupxshippingmethods[ ++l.count ] ) }">

		<MvSKIP NAME = "Merchant" VIEW = "AvailGroupXShippingMethod" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "AvailGroupXShippingMethod">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-AGR-DTB-00059', l.count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXShippingMethod_Delete_All_AvailabilityGroup" PARAMETERS = "agrp_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'AvailGroupXShippingMethod WHERE agrp_id = ?' }"
			 FIELDS	= "l.agrp_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00060', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXShippingMethod_Delete_All_Method" PARAMETERS = "mod_code, meth_code" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'AvailGroupXShippingMethod
						  WHERE
						  	mod_code	= ? AND
						  	meth_code	= ?' }"
			 FIELDS = "l.mod_code, l.meth_code">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00078', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailabilityGroupList_Load_ShippingMethod_And_Customer" PARAMETERS = "mod_code, meth_code, cust_id, availabilitygroups var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW 	= "AvailabilityGroups"
				QUERY 	= "{ 'SELECT
								ag.*
							  FROM ' $
							  	g.Store_Table_Prefix $ 'AvailabilityGroups ag
							  	LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'Customers cust ON cust.id = ?
							  	LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'AvailGroupXCustomer agxc ON ag.id = agxc.agrp_id AND cust.id = agxc.cust_id
							  	LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'AvailGroupXBusinessAccount agxba ON ag.id = agxba.agrp_id AND cust.account_id = agxba.account_id, ' $
							  	g.Store_Table_Prefix $ 'AvailGroupXShippingMethod agxsm
							  WHERE
							  	ag.id 			= agxsm.agrp_id	AND
							  	agxsm.mod_code	= ?				AND
							  	agxsm.meth_code	= ?				AND
							  	(
							  		agxc.cust_id IS NOT NULL 	OR
							  		agxba.account_id IS NOT NULL
							  	)' }"
				FIELDS	= "l.cust_id, l.mod_code, l.meth_code">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00061', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT AvailabilityGroups.d.EOF }">
		<MvEVAL EXPR = "{ AvailabilityGroup_Read( l.availabilitygroups[ ++l.count ] ) }">

		<MvSKIP NAME = "Merchant" VIEW = "AvailabilityGroups" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "AvailabilityGroups">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-AGR-DTB-00062', l.count ) }">
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_AvailGroupXPaymentMethod
|
</MvCOMMENT>

<MvFUNCTION NAME = "AvailGroupXPaymentMethod_Read" PARAMETERS = "availgroupxpaymentmethod var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.availgroupxpaymentmethod:agrp_id"		VALUE = "{ AvailGroupXPaymentMethod.d.agrp_id }">
	<MvASSIGN NAME = "l.availgroupxpaymentmethod:mod_code"		VALUE = "{ AvailGroupXPaymentMethod.d.mod_code }">
	<MvASSIGN NAME = "l.availgroupxpaymentmethod:meth_code"		VALUE = "{ AvailGroupXPaymentMethod.d.meth_code }">
	<MvASSIGN NAME = "l.availgroupxpaymentmethod:pctype_id"		VALUE = "{ AvailGroupXPaymentMethod.d.pctype_id }">
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXPaymentMethod_Insert" PARAMETERS = "agrp_id, mod_code, meth_code, pctype_id" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT AvailGroupXPaymentMethod_Insert_LowLevel( l.agrp_id, l.mod_code, l.meth_code, l.pctype_id ) OR
					NOT	[ g.Module_Feature_PAY_DB ].PaymentMethodRules_Increment_AvailabilityGroupCount( l.mod_code, l.meth_code, l.pctype_id ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXPaymentMethod_Insert_LowLevel" PARAMETERS = "agrp_id, mod_code, meth_code, pctype_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'AvailGroupXPaymentMethod
					      ( agrp_id, mod_code, meth_code, pctype_id )
						  VALUES
						  ( ?, ?, ?, ? )' }"
			 FIELDS	= "l.agrp_id, l.mod_code, l.meth_code, l.pctype_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00066', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXPaymentMethod_Delete" PARAMETERS = "agrp_id, mod_code, meth_code, pctype_id" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT AvailGroupXPaymentMethod_Delete_LowLevel( l.agrp_id, l.mod_code, l.meth_code, l.pctype_id ) OR
					NOT [ g.Module_Feature_PAY_DB ].PaymentMethodRules_Decrement_AvailabilityGroupCount( l.mod_code, l.meth_code, l.pctype_id ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXPaymentMethod_Delete_LowLevel" PARAMETERS = "agrp_id, mod_code, meth_code, pctype_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'AvailGroupXPaymentMethod
						  WHERE
							agrp_id		= ? AND
							mod_code	= ? AND
							meth_code	= ? AND
							pctype_id	= ?' }"
			 FIELDS	= "l.agrp_id, l.mod_code, l.meth_code, l.pctype_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00067', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXPaymentMethod_Load" PARAMETERS = "agrp_id, mod_code, meth_code, pctype_id, availgroupxpaymentmethod var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "AvailGroupXPaymentMethod"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'AvailGroupXPaymentMethod WHERE agrp_id = ? AND mod_code = ? AND meth_code = ? AND pctype_id = ?' }"
				FIELDS	= "l.agrp_id, l.mod_code, l.meth_code, l.pctype_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00068', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ AvailGroupXPaymentMethod.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "AvailGroupXPaymentMethod">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-AGR-DTB-00069' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ AvailGroupXPaymentMethod_Read( l.availgroupxpaymentmethod ) }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "AvailGroupXPaymentMethod">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXPaymentMethodList_Load" PARAMETERS = "agrp_id, availgroupxpaymentmethods var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW 	= "AvailGroupXPaymentMethod"
				QUERY 	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'AvailGroupXPaymentMethod WHERE agrp_id = ?' }"
				FIELDS	= "l.agrp_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00070', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT AvailGroupXPaymentMethod.d.EOF }">
		<MvEVAL EXPR = "{ AvailGroupXPaymentMethod_Read( l.availgroupxpaymentmethods[ ++l.count ] ) }">

		<MvSKIP NAME = "Merchant" VIEW = "AvailGroupXPaymentMethod" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "AvailGroupXPaymentMethod">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-AGR-DTB-00071', l.count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXPaymentMethod_Delete_All_AvailabilityGroup" PARAMETERS = "agrp_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'AvailGroupXPaymentMethod WHERE agrp_id = ?' }"
			 FIELDS	= "l.agrp_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00072', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailabilityGroupList_Load_PaymentMethod_And_Customer" PARAMETERS = "mod_code, meth_code, pctype_id, cust_id, availabilitygroups var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW 	= "AvailabilityGroups"
				QUERY 	= "{ 'SELECT
								ag.*
							  FROM ' $
							  	g.Store_Table_Prefix $ 'AvailabilityGroups ag
							  	LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'Customers cust ON cust.id = ?
							  	LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'AvailGroupXCustomer agxc ON ag.id = agxc.agrp_id AND cust.id = agxc.cust_id
							  	LEFT OUTER JOIN ' $ g.Store_Table_Prefix $ 'AvailGroupXBusinessAccount agxba ON ag.id = agxba.agrp_id AND cust.account_id = agxba.account_id, ' $
							  	g.Store_Table_Prefix $ 'AvailGroupXPaymentMethod agxsm
							  WHERE
							  	ag.id 			= agxsm.agrp_id	AND
							  	agxsm.mod_code	= ?				AND
							  	agxsm.meth_code	= ?				AND
							  	agxsm.pctype_id	= ?				AND
							  	(
							  		agxc.cust_id IS NOT NULL 	OR
							  		agxba.account_id IS NOT NULL
							  	)' }"
				FIELDS	= "l.cust_id, l.mod_code, l.meth_code, l.pctype_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00073', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT AvailabilityGroups.d.EOF }">
		<MvEVAL EXPR = "{ AvailabilityGroup_Read( l.availabilitygroups[ ++l.count ] ) }">

		<MvSKIP NAME = "Merchant" VIEW = "AvailabilityGroups" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "AvailabilityGroups">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-AGR-DTB-00074', l.count ) }">
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_AvailGroupXCollection
|
</MvCOMMENT>

<MvFUNCTION NAME = "AvailGroupXCollection_Read" PARAMETERS = "availgroupxcollection var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.availgroupxcollection:agrp_id"	VALUE = "{ AvailGroupXCollection.d.agrp_id }">
	<MvASSIGN NAME = "l.availgroupxcollection:col_id"	VALUE = "{ AvailGroupXCollection.d.col_id }">
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXCollection_Load" PARAMETERS = "agrp_id, col_id, availgroupxcollection var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "AvailGroupXCollection"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'AvailGroupXCollection WHERE agrp_id = ? AND col_id = ?' }"
				FIELDS	= "l.agrp_id, l.col_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00088', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ AvailGroupXCollection.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "AvailGroupXCollection">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-AGR-DTB-00089' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ AvailGroupXCollection_Read( l.availgroupxcollection ) }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "AvailGroupXCollection">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXCollection_Load_AvailabilityGroup" PARAMETERS = "agrp_id, availgroupxcollections var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "AvailGroupXCollection"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'AvailGroupXCollection WHERE agrp_id = ?' }"
				FIELDS	= "l.agrp_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00090', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT AvailGroupXCollection.d.EOF }">
		<MvEVAL EXPR = "{ AvailGroupXCollection_Read( l.availgroupxcollections[ ++l.count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "AvailGroupXCollection" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "AvailGroupXCollection">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-AGR-DTB-00091', l.count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXCollection_Load_Collection" PARAMETERS = "col_id, availgroupxcollections var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "AvailGroupXCollection"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'AvailGroupXCollection WHERE col_id = ?' }"
				FIELDS	= "l.col_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00092', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT AvailGroupXCollection.d.EOF }">
		<MvEVAL EXPR = "{ AvailGroupXCollection_Read( l.availgroupxcollections[ ++l.count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "AvailGroupXCollection" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "AvailGroupXCollection">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-AGR-DTB-00093', l.count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXCollection_Count_Collection" PARAMETERS = "col_id, count var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "AvailGroupXCollection"
				QUERY	= "{ 'SELECT COUNT( * ) AS total_count FROM ' $ g.Store_Table_Prefix $ 'AvailGroupXCollection WHERE col_id = ?' }"
				FIELDS	= "l.col_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00108', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ AvailGroupXCollection.d.EOF }">	<MvASSIGN NAME = "l.count" VALUE = 0>
	<MvELSE>										<MvASSIGN NAME = "l.count" VALUE = "{ AvailGroupXCollection.d.total_count }">
	</MvIF>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "AvailGroupXCollection">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXCollection_Insert" PARAMETERS = "availgroupxcollection var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'AvailGroupXCollection
					      ( agrp_id, col_id )
						  VALUES
						  ( ?, ? )' }"
			 FIELDS	= "l.availgroupxcollection:agrp_id, l.availgroupxcollection:col_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00094', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXCollection_Delete" PARAMETERS = "agrp_id, col_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'AvailGroupXCollection
						  WHERE
							agrp_id	= ? AND
							col_id	= ?' }"
			 FIELDS	= "l.agrp_id, l.col_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00095', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXCollection_Delete_All_AvailabilityGroup" PARAMETERS = "agrp_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'AvailGroupXCollection WHERE agrp_id = ?' }"
			 FIELDS	= "l.agrp_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00096', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXCollection_Delete_All_Collection" PARAMETERS = "col_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'AvailGroupXCollection WHERE col_id = ?' }"
			 FIELDS	= "l.col_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00097', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
| sNN_AvailGroupXProductCollectionExclusions
|
</MvCOMMENT>

<MvFUNCTION NAME = "AvailGroupXProductCollectionExclusion_Read" PARAMETERS = "availgroupxproductcollectionexclusion var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.availgroupxproductcollectionexclusion:agrp_id"		VALUE = "{ AvailGroupXProductCollectionExclusions.d.agrp_id }">
	<MvASSIGN NAME = "l.availgroupxproductcollectionexclusion:product_id"	VALUE = "{ AvailGroupXProductCollectionExclusions.d.product_id }">
	<MvASSIGN NAME = "l.availgroupxproductcollectionexclusion:colcount"		VALUE = "{ AvailGroupXProductCollectionExclusions.d.colcount }">
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXProductCollectionExclusion_Load" PARAMETERS = "agrp_id, product_id, availgroupxproductcollectionexclusion var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "AvailGroupXProductCollectionExclusions"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'AvailGroupXProductCollectionExclusions WHERE agrp_id = ? AND product_id = ?' }"
				FIELDS	= "l.agrp_id, l.product_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00098', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ AvailGroupXProductCollectionExclusions.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "AvailGroupXProductCollectionExclusions">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( 'MER-AGR-DTB-00099' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ AvailGroupXProductCollectionExclusion_Read( l.availgroupxproductcollectionexclusion ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "AvailGroupXProductCollectionExclusions">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXProductCollectionExclusion_Load_AvailabilityGroup" PARAMETERS = "agrp_id, availgroupxproductcollectionexclusions var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "AvailGroupXProductCollectionExclusions"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'AvailGroupXProductCollectionExclusions WHERE agrp_id = ?' }"
				FIELDS	= "l.agrp_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00100', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT AvailGroupXProductCollectionExclusions.d.EOF }">
		<MvEVAL EXPR = "{ AvailGroupXProductCollectionExclusion_Read( l.availgroupxproductcollectionexclusions[ ++l.count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "AvailGroupXProductCollectionExclusions" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "AvailGroupXProductCollectionExclusions">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-AGR-DTB-00101', l.count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXProductCollectionExclusion_Load_Product" PARAMETERS = "product_id, availgroupxproductcollectionexclusions var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "AvailGroupXProductCollectionExclusions"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'AvailGroupXProductCollectionExclusions WHERE product_id = ?' }"
				FIELDS	= "l.product_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00102', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.count" VALUE = 0>

	<MvWHILE EXPR = "{ NOT AvailGroupXProductCollectionExclusions.d.EOF }">
		<MvEVAL EXPR = "{ AvailGroupXProductCollectionExclusion_Read( l.availgroupxproductcollectionexclusions[ ++l.count ] ) }">
		<MvSKIP NAME = "Merchant" VIEW = "AvailGroupXProductCollectionExclusions" ROWS = 1>
	</MvWHILE>

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "AvailGroupXProductCollectionExclusions">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].ListLoad_EOF_Return( 'MER-AGR-DTB-00103', l.count ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXProductCollectionExclusion_Insert" PARAMETERS = "availgroupxproductcollectionexclusion var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'AvailGroupXProductCollectionExclusions
					      ( agrp_id, product_id, colcount )
						  VALUES
						  ( ?, ?, ? )' }"
			 FIELDS	= "l.availgroupxproductcollectionexclusion:agrp_id, l.availgroupxproductcollectionexclusion:product_id, l.availgroupxproductcollectionexclusion:colcount">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00104', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXProductCollectionExclusion_Delete" PARAMETERS = "agrp_id, product_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'AvailGroupXProductCollectionExclusions
						  WHERE
							agrp_id		= ? AND
							product_id	= ?' }"
			 FIELDS	= "l.agrp_id, l.product_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00105', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXProductCollectionExclusion_Delete_All_AvailabilityGroup" PARAMETERS = "agrp_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'AvailGroupXProductCollectionExclusions WHERE agrp_id = ?' }"
			 FIELDS	= "l.agrp_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00106', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "AvailGroupXProductCollectionExclusion_Delete_All_Product" PARAMETERS = "product_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'AvailGroupXProductCollectionExclusions WHERE product_id = ?' }"
			 FIELDS	= "l.product_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( 'MER-AGR-DTB-00107', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>
